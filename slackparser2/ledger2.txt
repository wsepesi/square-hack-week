cqin
:spiral_calendar_pad:  11:50 AM
Hi team, may I borrow staging for testing?:thank:


5 replies
Last reply 2 years agoView thread


hoyi
  12:15 PM
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-90466
(ledger @ e6cec6182f5 to production)
:+1:
4


4 replies
Last reply 2 years agoView thread


hoyi
  12:33 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-90466…
ledger canary :canary:
View newer replies


hoyi
  12:57 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-90466…
Canary looks fine; rolling forwards :rolling_kirby:


hoyi
  4:00 PM
Deploying latest (298d32fadb1) to staging


5 replies
Last reply 2 years agoView thread


cqin
:spiral_calendar_pad:  7:46 AM
Hi team, can I take over staging for testing?:thank: (edited) 


2 replies
Last reply 2 years agoView thread


rpeng
  10:29 AM
Hey team, can I take over ledger staging for about 30 mins for testing?




17 replies
Last reply 2 years agoView thread


hoyi
  1:03 PM
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-90535
(ledger @ 298d32fadb1 to production)


5 replies
Last reply 2 years agoView thread


hoyi
  1:16 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-90535…
ledger canary :canary:
View newer replies


hoyi
  1:56 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-90535…
Canary looks fine; rolling forwards :rolling_kirby:
View newer replies


smartin
  3:04 PM
@oncall
 running the following shift migrations to modify columns related related payouts from varchar(20) to varchar(255)
https://square-console.sqprod.co/app/ledger/databases/shift/request/14293
https://square-console.sqprod.co/app/ledger/databases/shift/request/14276
:ack-red:
1
:+1:
1




41 replies
Last reply 2 years agoView thread

oncall
APP  3:04 PM
@hoyi
 running the following shift migrations to modify columns related related payouts from varchar(20) to varchar(255)
https://square-console.sqprod.co/app/ledger/databases/shift/request/14293
https://square-console.sqprod.co/app/ledger/databases/shift/request/14276


hoyi
  4:23 PM
Deploying latest (3ce20c3e670) to staging


cqin
:spiral_calendar_pad:  7:44 AM
Hi team, can I borrow staging for 30 mins testing:thank:?


6 replies
Last reply 2 years agoView thread


zifan
:spiral_calendar_pad:  9:33 AM
@oncall
 I’m going to add "ledgerCutoffTimesStream":{"interval":"PT2S", "limit":200} to feed_consumer_config flag in production to speed up feed publishing to Kafka. Current config is PT5S, 100
:ack-red:
1


1 reply
2 years agoView thread

oncall
APP  9:33 AM
@hoyi
 I’m going to add "ledgerCutoffTimesStream":{"interval":"PT2S", "limit":200} to feed_consumer_config flag in production to speed up feed publishing to Kafka. Current config is PT5S, 100


hoyi
  1:05 PM
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-90601
(ledger @ 3ce20c3e670 to production)


5 replies
Last reply 2 years agoView thread


hoyi
  1:07 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-90601…
staging checks pass
:canary: canary start
View newer replies


hoyi
  1:44 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-90601…
canary deploy checks pass
:rolling_kirby: rolling forward


mgp
:baby:  2:02 PM
@oncall
 is it okay if I take over Ledger staging for ~20m ?

1 reply
2 years agoView thread

oncall
APP  2:02 PM
@hoyi
 is it okay if I take over Ledger staging for ~20m ?


mgp
:baby:  2:05 PM
Deploying canary build 051ce26 to staging


rpeng
  2:28 PM
@mgp
 ya still need staging? we would also like to borrow staging for ~20m :xd:
2:28
we need like staging-red green blue


mgp
:baby:  2:28 PM
yeah… just waiting for it to finish a pipeline run. Will ping you once done 
@rpeng
2:28
hahaha agreed :joy:
2:29
turns out my 20m estimate didn’t include the time to deploy, sorry :stuck_out_tongue:


rpeng
  2:30 PM
npnp!


mgp
:baby:  2:31 PM
Sweeeet — it’s done. Go ahead 
@rpeng


rpeng
  2:31 PM
@hoyi
 fyi, is it okay for us to take canary for 20m?


hoyi
  2:32 PM
yep, no objections from me


rpeng
  2:32 PM
thank you!


rpeng
  3:50 PM
done with it sorry for the late response! gonna put the latest staging back on (edited) 
:thank:
1



hoyi
  4:04 PM
It’s close enough to our usual deploy time that I’m going to declare that (f50db2c86d3) as the staging build for tonight
:+1::skin-tone-2:
1



zifan
:spiral_calendar_pad:  9:29 AM
@oncall
 Heads up - Removing dynamicflag consumer setting for ledgerCutoffTimesStream since the feed has been caught up.

oncall
APP  9:29 AM
@hoyi
 Heads up - Removing dynamicflag consumer setting for ledgerCutoffTimesStream since the feed has been caught up.


zeke
  10:35 AM
Hi team, looking for a review on this metrics PR when you get a chance


3 replies
Last reply 2 years agoView thread


sarve
  2:55 PM
@oncall
 FYI - I added a route config for PayoutService.InitiatePayout - https://square-console.sqprod.co/app/ledger/security/route-permissions

oncall
APP  2:55 PM
@hoyi
 FYI - I added a route config for PayoutService.InitiatePayout - https://square-console.sqprod.co/app/ledger/security/route-permissions


tochi
  3:05 PM
Hi 
@oncall
, I'm looking into this ticket (https://jira.sqprod.co/browse/ONCALL-127490) filed against my team and its inquiry is about whether anything changed recently about how Ledger settles Capital payments when there is a pending SQ card balance.
Can you help figure out if this behaviour is expected. I don't have the context to answer this question.
cc: 
@nadira
 to provide more context if necessary.
:eyes:
1






13 replies
Last reply 2 years agoView thread

oncall
APP  3:11 PM
Hi 
@hoyi
 & 
@emilyl
 & 
@mgp
 & 
@benv
 & 
@kcrane
 & 
@mengen
 & 
@dskarbek
 & 
@agray
, I'm looking into this ticket (https://jira.sqprod.co/browse/ONCALL-127490) filed against my team and its inquiry is about whether anything changed recently about how Ledger settles Capital payments when there is a pending SQ card balance.
Can you help figure out if this behaviour is expected. I don't have the context to answer this question.
cc: 
@nadira
 to provide more context if necessary.


hoyi
  3:14 PM
… oncall bot are you drunk?
:heavy_plus_sign:
1
:joy:
7
:everyone:
1
:no_longer_at_here:
1



rpeng
  4:19 PM
hi friends, can we get the latest sha on ledger staging :pray: ?


hoyi
  4:19 PM
Whoops yep; almost forgot


rpeng
  4:19 PM
what happened to oncall bot


hoyi
  4:20 PM
@oncall
 bot is possibly drunk

oncall
APP  4:20 PM
@hoyi
 bot is possibly drunk


hoyi
  4:20 PM
Hm, looks like it’s recovered
4:20
Deploying latest (13582fdc7ae) to staging


mgp
:baby:  12:53 PM
@oncall
 can I deploy sha acad276 to staging?

1 reply
2 years agoView thread

oncall
APP  12:53 PM
@enzo
 can I deploy sha acad276 to staging?


mgp
:baby:  12:58 PM
Deploying sha acad276 to staging


mgp
:baby:  3:52 PM
Oops — I didn’t put this back. 1 minute…


2 replies
Last reply 2 years agoView thread


enzo
  4:01 PM
Deploying latest a9561eda92 to staging


mgp
:baby:  7:36 PM
@senth
 
@zeke
 
@tal
 
@rpeng
 
@smartin
 
@sarve
 
@hoyi
 
@dskarbek
 Apologies for the late night ping, but in ~3h we’d like to do a Ledger deploy to production in order to address the log4j VULN that has been getting a lot of press today and which was broadcast in the #java channel this morning. Normally we don’t do deploys between Thursday and Monday, and so the Ledger SHA will not have baked overnight on staging per usual. But letting the VULN go unaddressed over the weekend is very likely the greater of two evils.
ROLL: https://jira.sqprod.co/browse/ROLL-90751
:+1:
3






8 replies
Last reply 2 years agoView thread


mgp
:baby:  10:32 PM
Deploying a9561eda921f15be22c83d91918ca0f69a70890f to Ledger canary :canary:

2 replies
Last reply 2 years agoView thread


mgp
:baby:  11:32 PM
replied to a thread:
Deploying a9561eda921f15be22c83d91918ca0f69a70890f to Ledger canary :canary:
Deploy complete


mgp
:baby:  1:26 PM
@oncall
 since there is no Ledger deploy to prod today, going to deploy 2fae10f to staging
:ack:
1


oncall
APP  1:26 PM
@enzo
 since there is no Ledger deploy to prod today, going to deploy 2fae10f to staging


mgp
:baby:  1:27 PM
Should be done in 30m


bwester
:officepig:  1:55 PM
hi, I'm not even sure if this is the right team, but does anyone know if this is the right place to ask about attempted settlement/deposits/transfers that may have been blocked? I have two unit token that were blocked for a ~1h window, and I'm looking to see if it had any real impact.


7 replies
Last reply 2 years agoView thread


enzo
  4:05 PM
deploying latest ledger 509e16a30feto staging


enzo
  11:17 AM
deploying 0e1b460e977 to staging. we've decided that we will deploy this build to prod today to update log4j to v2.16 since v2.15 does not completely fix the exploit.
:sparkles:
1


1 reply
2 years agoView thread


mgp
:baby:  11:39 AM
set the channel topic: Stable | Discussion for https://registry.sso.global.square/apps/ledger | Contact @oncall for questions | Emergency page the entire team: https://go/ledger911


enzo
  4:08 PM
deploying latest ac1238dafa54 to staging


zandt
:spiral_calendar_pad:  6:40 AM
Hey everyone :wave: . We were doing some testing in the staging environment yesterday for a forex payment (xGDqIZl4oBMVTHujLVOQetYbKJKZY) which was accidentally captured. Please check your staging feed consumers to make sure they were not stuck on this payment. (edited) 


zzhang
  7:26 AM
Hi 
@oncall
 Could you please help check if the $8k payment in this ACH transfer actually succeeded? We are communicating with this seller, she says this ACH is successful while we see otherwise, just want to confirm we are seeing the right status.


2 replies
Last reply 2 years agoView thread

oncall
APP  7:26 AM
Hi 
@hoyi
 Could you please help check if the $8k payment in this ACH transfer actually succeeded? We are communicating with this seller, she says this ACH is successful while we see otherwise, just want to confirm we are seeing the right status.


rpeng
  11:09 AM
qq: do “dry run” settlement jobs do any db writes (e.g. close settlement batches)? the comment in the settlement job input says it doesn’t submit the transfer file, but not sure about what it does to the batches


2 replies
Last reply 2 years agoView thread


enzo
  12:13 PM
Ledger ROLL:
ROLL-90959
(ledger @ ac1238dafa54 to production) (edited) 
:+1:
3




8 replies
Last reply 2 years agoView thread


enzo
  1:53 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


enzo
  2:21 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


enzo
  2:56 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we're out on prod
deploy checks pass


enzo
  4:03 PM
deploying latest 53df7948 to staging


enzo
  4:18 PM
deploying latest (f3f0bb793) to staging


emilyl
  4:50 PM
deploying latest (cf0fb386136) to staging


enzo
  12:51 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-91203
(ledger @ cf0fb386136de to production) (edited) 
:+1:
5




11 replies
Last reply 2 years agoView thread


enzo
  1:19 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


joshuaw
  1:31 PM
Hey, we're seeing a call to list ledger entries fail in staging where the response is not including a required field. Request:
lookup {
  payment_token: "LcSPSazcZdTMvYnHHVYEncZCWxHXvmB"
}
pagination {
  max_results: 2147483647
}
merchant_token: "0A0A83JZP8BGC" 
And getting the error: 1) squareup.ledger.PaymentDetail.type must be present



8 replies
Last reply 2 years agoView thread


enzo
  1:59 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


mdall
:spiral_calendar_pad:  2:37 PM
was added to #ledger by joshuaw
.


enzo
  2:42 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we're out on prod
deploy checks pass


enzo
  4:06 PM
deploying latest (bac54deaeb) to staging


enzo
  12:21 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-91253
(ledger @ bac54deaeb24df3 to production)
:+1:
1


5 replies
Last reply 2 years agoView thread


enzo
  1:28 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


enzo
  2:02 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


enzo
  2:48 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we're out on prod
deploy checks pass


enzo
  3:43 PM
deploying latest (9080b152d66 ) to staging


emilyl
  4:53 PM
deploying latest 4a93b54e200 to staging


minghua
:bulb:  1:35 PM
No staging deploy today since there has not been a new build  since ^
:christmas_parrot:
1


root
APP  12:42 AM
ODS host fpd1533.sjc3b.square (pd-odsgroup383) is down
No action is needed from you. ODS oncall will try to successover metaclusters if they are active on this host.
Please see the #situation channel for more information.
apps affected: ledger
metaclusters affected for these apps:
- pd-mysql-ledger-010
Cc: 
@oncall

oncall
APP  12:42 AM
ODS host fpd1533.sjc3b.square (pd-odsgroup383) is down
No action is needed from you. ODS oncall will try to successover metaclusters if they are active on this host.
Please see the #situation channel for more information.
apps affected: ledger
metaclusters affected for these apps:
- pd-mysql-ledger-010
Cc: 
@kcrane
:cool:
3



smartin
  2:01 PM
I’m investigating some SEPA returns you all had and the bank is requesting the account numbers associated with the returns. Would someone mind stamping my fidelius-get command on ledger for this?
ssh -t 'apa185.iad2b.square' 'sh -l -c "squdo_pair 46430 470123"'


25 replies
Last reply 2 years agoView thread


bforehand
  2:08 PM
FYI, we're removing the BalancePaymentService from wallet which I believe calls some endpoints that are specific to it in ledger. This means you can now drop those endpoints and related services as well. Here's the PR just for reference:
https://github.com/squareup/java/pull/232257
(cc: 
@mgp
 just because I know how much he :heart: marketplaces code :troll:) (edited) 
:niiice:
1
:knife-smile:
1



zifan
:spiral_calendar_pad:  3:50 PM
Hi team! I made this ROLL to reset cursor of ledgerCutoffTimesStream https://jira.sqprod.co/browse/ROLL-91323. I don’t have permission to run update command. Got this error ERROR 1142 (42000): UPDATE command denied to user 'zifan.04'@'10.40.0.23' for table 'feed_cursors'. Looking for some help from @acteng to help! CC 
@fasih

The ROLL is for staging, but we are hoping to have the same thing done in prod today (since there is a deployment freeze starting tomorrow). payouts is the only consumer of the feed, shouldn’t be any impact on other ledger clients.


3 replies
Last reply 2 years agoView thread


justinroberts
:funkyfish:  11:47 AM
Hi there! We (Refunds API) are looking at an unsettle-able failing refund caused by a unit that is frozen and are trying to determine how to proceed. The unit is frozen without a bank account, so we don’t think that it will be possible for their customer to get their money back and instead are thinking that we should mark the refund as failed/rejected due to this. Is rejecting the refund the right move here, or should we try something else first?


2 replies
Last reply 2 years agoView thread


dmitri
:bulb:  3:25 PM
Hi Slacker users,
You are receiving this message because your app is listed as a dependency of go/whatis/slacker.
As per previous comms (doc here) Slacker is now EOL’d. We are giving a renewal grace period through January 2022, but will be shutting down the slacker application on February 1st, 2022. Please migrate to using the slack API directly (see link above).
Please reply in thread or message us in #ml-eval-discuss with any questions or concerns.
Best,
ML Evaluations Team

1 reply
2 years agoView thread


dskarbek
  4:26 PM
Deploying 9f0176c7a4d7a65649bc3d9f46e889460feb8397 to staging
:thank:
1



senth
  9:50 AM
Just starting the review process earlier because of the large number of commits going out today, but deploy will take place as per usual schedule (after noon PST):
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-91419
(ledger @ 9f0176c7a4d7a65649bc3d9f46e889460feb8397 to production)
:thank:
1



5 replies
Last reply 2 years agoView thread


marchernandez
  10:55 AM
Hi all! I'm building an improved version of go/APIMatrix, the Developers team's source of truth for developer-facing product ownership and status. While organizing the related data we've discovered a few endpoints (list) that are available (serving responses) but don't have any public docs and we're looking for help in finding the owners and understanding the state of the endpoints (Alpha, Beta, GA, etc). According to Registry and the envoy-control edge-routes data this channel is the right contact for the services hosting one or more of the endpoints in question. Please take a look at the list (same as linked above) and add comments where you have information (columns B, F, and G most specifically). Please lmk if you need more info! Many Thanks :pray:
Screen Shot 2022-01-05 at 10.50.07 AM.png
 
Screen Shot 2022-01-05 at 10.50.07 AM.png



4 replies
Last reply 2 years agoView thread


senth
  1:22 PM
replied to a thread:
Just starting the review process earlier because of the large number of commits going out today, but deploy will take place as per usual schedule (after noon PST):…
staging checks pass
:canary: canary start
View newer replies


senth
  1:54 PM
replied to a thread:
Just starting the review process earlier because of the large number of commits going out today, but deploy will take place as per usual schedule (after noon PST):…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


senth
  2:56 PM
replied to a thread:
Just starting the review process earlier because of the large number of commits going out today, but deploy will take place as per usual schedule (after noon PST):…
:shipitparrot: we're out on prod
deploy checks pass


senth
  4:28 PM
Deploying a384a25b2ddeb37e765a0a055d03b610ae3303dd to Ledger staging.


dskarbek
  5:13 PM
Deploying e88e1e64f0b9f6b7a1aee6e6b414928b4400077b to Ledger staging to get my PR in.


bbradley
  12:51 PM
Hi 
@oncall
,
I wanted to give you a heads up about an upcoming roll plan for Skeptic where we will be migrating from 2B to 3B datacenters in preparation for our Disaster Recovery Drill.
We are currently scheduling this migration for Monday, January 10. While we expect this to be a transparent change, we wanted to let you know just in case unexpected issues arise. Please let us know in #fraud-eng-oncall if you see anything!
Thanks!
:ack-red:
1



3 replies
Last reply 2 years agoView thread

oncall
APP  12:51 PM
Hi 
@senth
,
I wanted to give you a heads up about an upcoming roll plan for Skeptic where we will be migrating from 2B to 3B datacenters in preparation for our Disaster Recovery Drill.
We are currently scheduling this migration for Monday, January 10. While we expect this to be a transparent change, we wanted to let you know just in case unexpected issues arise. Please let us know in #fraud-eng-oncall if you see anything!
Thanks!


jcook
:spiral_calendar_pad:  3:30 PM
Hi all & 
@oncall
,
The Payment Acceptance Fraud team is planning to execute a DR (Disaster Recovery) Drill on our service skeptic.  You are being notified as we expect there to be a potential impact to a service your team owns.  This drill will involve swinging from SJC datacenter to IAD and then back the following day.
The dates/times we are targeting are:
Wednesday, Jan. 12, 2022 @ 9:30AM PST Swing (SJQ --> IAD)
Thursday, Jan. 13, 2022 @ 9:30AM PST Un-swing (IAD --> SJQ)
We also have fallback dates of:
Tuesday, Jan. 18, 2022 @ 9:30AM PST Swing (SJQ --> IAD)
Wednesday, Jan. 19, 2022 @ 9:30AM PST Un-swing (IAD --> SJQ)
Relevant documents:
ROLL
Technical Recovery Process
Disaster Recovery Plan
Pre-Emptive SEV
Our DR slack channel is #fraud-risk-dr, and I plan to add your team's oncall to that channel before executing the drill.  This is where correspondence regarding the impact of the drill is encouraged to take place.  If you have any questions/concerns, please direct them to this channel as well.
Thank you,
Jackson
:ack-red:
1


1 reply
2 years agoView thread

oncall
APP  3:30 PM
Hi all & 
@senth
,
The Payment Acceptance Fraud team is planning to execute a DR (Disaster Recovery) Drill on our service skeptic.  You are being notified as we expect there to be a potential impact to a service your team owns.  This drill will involve swinging from SJC datacenter to IAD and then back the following day.
The dates/times we are targeting are:
• Wednesday, Jan. 12, 2022 @ 9:30AM PST Swing (SJQ --> IAD)
• Thursday, Jan. 13, 2022 @ 9:30AM PST Un-swing (IAD --> SJQ)
We also have fallback dates of:
• Tuesday, Jan. 18, 2022 @ 9:30AM PST Swing (SJQ --> IAD)
• Wednesday, Jan. 19, 2022 @ 9:30AM PST Un-swing (IAD --> SJQ)
Relevant documents:
• ROLL
• Technical Recovery Process
• Disaster Recovery Plan
• Pre-Emptive SEV
Our DR slack channel is #fraud-risk-dr, and I plan to add your team's oncall to that channel before executing the drill.  This is where correspondence regarding the impact of the drill is encouraged to take place.  If you have any questions/concerns, please direct them to this channel as well.
Thank you,
Jackson


senth
  4:04 PM
Deploying 27a5dc80b0e6736029c6a69ca25a242c14c101ae to Ledger staging.


senth
  4:46 PM
Actually, deploying newer sha 064d5fde414e51c69562570e6c7aec914a91ed45 to Ledger staging


senth
  4:21 PM
Deploying sha a21cd19aa98b12ad16b5aa0b948aefe66b64d4e4 to Ledger staging


emilyl
  12:28 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-91601
(ledger @ a21cd19aa98 to production)
:+1:
4





9 replies
Last reply 2 years agoView thread


emilyl
  1:02 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


emilyl
  1:31 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


emilyl
  2:27 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass


melodyc
:spiral_calendar_pad:  2:50 PM
Hey Ledger team,
I have a question, marketing is looking to run a pilot program for cashback offers. This is something we are funding for the sellers who volunteer to join our pilot and we need a way to credit sellers for the discounts they give out to their buyers from participating in this program. I've seem some endpoints where we can refund bills but in this scenario there won't be a bill for us to refund since we need an ad-hoc way to credit their accounts. Is there an endpoint where we can credit sellers without having that credit tied to a bill?
Thanks!


25 replies
Last reply 2 years agoView thread


emilyl
  4:03 PM
deploying 6d02fa7ee81 (latest) to staging


cwagner
:bulb:  1:34 PM
@emilyl
 Curious if ledger will be deployed today and what will be included in the deploy? We’d like to get this PR deployed so we can test the payouts dry run again asap

2 replies
Last reply 2 years agoView thread


vijayvarikota
:spiral_calendar_pad:  4:20 PM
:wave::skin-tone-3:
DFT (Data Foundation Team) is in the process on migrating app ledger  from the existing DBDB based replication pipeline to Shinkansen (new pipeline).
Considering ledger is a sharded database, in Shinkansen we can merge all sharded tables into a single table in Snowflake. If you dont want to merge that into a single table, we can continue to keep it separate. But merging is a new feature enabled in Shinkansen, and many teams are using this. So wanted to check your preference.


7 replies
Last reply 2 years agoView thread


mgp
:baby:  4:21 PM
Deploying canary build eeaea2626a8936c1706b7ce70e4a6dfdb91e5376 to Ledger staging (edited) 


mgp
:baby:  5:20 PM
Deploying bf3186327f4438aff482ec9907ff514e1de813f2 to Ledger staging


emilyl
  12:19 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-91711
(ledger @ bf3186327f4 to production)

4 replies
Last reply 2 years agoView thread


emilyl
  12:30 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


emilyl
  12:58 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


emilyl
  2:03 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass


emilyl
  4:05 PM
deploying 23ace6fed22 (latest) to staging

2 replies
Last reply 2 years agoView thread


emilyl
  4:32 PM
replied to a thread:
deploying 23ace6fed22 (latest) to staging
canceling this as I need to fix something
View newer replies


emilyl
  5:36 PM
replied to a thread:
deploying 23ace6fed22 (latest) to staging
deploying 904e7fc1f41 to staging


senth
  1:12 PM
Taking over Ledger staging to deploy a canary build and test stuff


senth
  5:08 PM
Deploying latest master sha 28c9a13855c1775262def26c69fe728094708ef1 to Ledger staging


ewalls
  7:54 AM


ewalls
Hi, I’m not sure if this is the right channel for this question, but what shows up on a seller’s bank statement when SFS initiates a debit to their linked bank? I’m working on this oncall ticket and we’re trying to figure out what “Square Inc” payments on a bank statement indicate
Thread in sfs-finops | Jan 14th, 2022 | View message




7 replies
Last reply 1 year agoView thread


senth
  9:36 AM
Taking over Ledger staging for some testing with canary deployment.

1 reply
1 year agoView thread


alicezhang
  3:23 PM
@oncall
 We are seeing a sudden ledger feed lag in Feemo, wanted to see if anything has changed on your side


2 replies
Last reply 1 year agoView thread

oncall
APP  3:23 PM
@hoyi
 We are seeing a sudden ledger feed lag in Feemo, wanted to see if anything has changed on your side


emilyl
  4:25 PM
deploying 6c2af395f12 (latest) to staging


hoyi
  4:06 PM
Deploying latest (1d043a1f55d) to staging


hoyi
  12:47 PM
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-91900
(ledger @ 1d043a1f55d to production)



10 replies
Last reply 1 year agoView thread


hoyi
  1:26 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-91900…
staging checks pass
:canary: canary start
View newer replies


hoyi
  2:10 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-91900…
canary deploy checks pass
:rolling_kirby: rolling forward


dpotvin
:spiral_calendar_pad:  2:16 PM
Hello Ledger,
I'm working on a ticket to rotate the Barclays SEPA signing and encryption key, which is expiring in 3 days. I made a code change in banking-partners to reference the new key, and need to deploy it to Teller and Ledger tomorrow or Wednesday in preparation to switching to the new key. Would it be possible to deploy Ledger in the next two days?
I apologize for the last minute ask on this.
Thanks,
Daniel


2 replies
Last reply 1 year agoView thread


senth
  3:14 PM
Taking over Ledger in staging for testing with a canary build.


senth
  4:29 PM
Deploying latest master SHA 6ba656ae836e93c9cffab433ea562345966787d2 to Ledger staging.


davidsmith
  11:05 AM
Swinging payments out of SJC after some problems with https://jira.sqprod.co/browse/ROLL-91793 were identified.


hoyi
  1:27 PM
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-91958
(ledger @ 1d043a1f55d to production)


4 replies
Last reply 1 year agoView thread


hoyi
  1:51 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-91958…
staging checks pass
:canary: canary start
View newer replies


hoyi
  2:31 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-91958…
canary deploy checks pass
:rolling_kirby: rolling forward


hoyi
  4:11 PM
Deploying latest (5885ca09308) to staging


dpotvin
:spiral_calendar_pad:  8:46 AM
FYI — I rotated the Barclays SEPA signing key for Ledger and Teller, and set the encrypt_with_overrides.percent and encrypt_with_overrides.percent dynamicflags to 100% for both services. This could impact ledger pipeline runs between 10:30 AM and 12 PM PST


alicezhang
  12:03 PM
@oncall
 We applied a pricing change in production that has an error. You might be see some payments erroring out right now. We are rolling back and will let you know soon when it's done. cc 
@son
:ack-red:
1



3 replies
Last reply 1 year agoView thread

oncall
APP  12:03 PM
@hoyi
 We applied a pricing change in production that has an error. You might be see some payments erroring out right now. We are rolling back and will let you know soon when it's done. cc 
@son


son
  12:03 PM
was added to #ledger by alicezhang
.


senth
  10:09 AM
Deploying Ledger staging with a canary build for testing.


senth
  12:38 PM
Deploying latest master SHA 6f980d13b201ddf2da74f467e1f20722a5f545be to Ledger staging.


bjuang
:spiral_calendar_pad:  1:51 PM
@oncall
 I'm oncall for Marketing and got this ticket where the seller is reporting that she was charged twice to her bank account (both failed because of insufficient funds) and once to her credit card for a subscription.  It looks like only one of the two bank account charges were refunded, at least according to the screenshot they provided, but we only seem to see one bank charge in Regulator?  Here's the ticket with screenshots from the seller: https://jira.sqprod.co/browse/ONCALL-129295
Can you help clarify what's going on here?
:eyes:
1



2 replies
Last reply 1 year agoView thread

oncall
APP  1:51 PM
@deni
 I'm oncall for Marketing and got this ticket where the seller is reporting that she was charged twice to her bank account (both failed because of insufficient funds) and once to her credit card for a subscription.  It looks like only one of the two bank account charges were refunded, at least according to the screenshot they provided, but we only seem to see one bank charge in Regulator?  Here's the ticket with screenshots from the seller: https://jira.sqprod.co/browse/ONCALL-129295
Can you help clarify what's going on here?


dpotvin
:spiral_calendar_pad:  1:56 PM
Hi Ledger team,
My team wants to support transfer tags (AKA deposit tags) as part of AU weekend settlement. The transfer tags are stored in Ledger, and Ledger vends APIs for setting and retrieving them. My team wants to call the GetMerchantDepositTags API in Ledger to retrieve these transfer tags in the deposits AU weekend settlement job that would get the transfer tags and then pass them to Teller (design doc).
We estimate the design would result in about 230k calls to the GetMerchantDepositTags API each week, concentrated on the AU weekend settlements deposits job on Friday and Saturday. Are there  concerns with this on the Ledger side?
Thanks,
Daniel
G Suite Document
 

AU Weekend Settlement Transfer Tag Proposal
Google Doc

1 reply
1 year agoView thread


senth
  4:57 PM
Deploying latest SHA of 431c8038e48c73788149b118e30673fef0a4d357 to Ledger staging
:+1::skin-tone-3:
1



deni
  9:24 AM
@bforehand
 
@carol
 
@dpotvin
 we noticed this error in ledger staging
2022-01-24T16:54:11,829 ERROR [main] [SpeleoTraceId=zNfHXKCRbgaXJ] encryption.EncrypterValidator - Cannot encrypt. Key: barclays-sepa
java.lang.RuntimeException: Process exited with status 2 and stderr: gpg: skipped "4C73D5198D5A8E89067F9BFB12736AFF3FC525A2": Unusable secret key
gpg: [stdin]: sign+encrypt failed: Unusable secret key
should we be using the teller keys now?
9:24
or is that unrelated?


dpotvin
:spiral_calendar_pad:  9:27 AM
The Barclays SEPA staging key expired on Jan 21st, and we chose not to renew it or migrate to a new key because the Barclays staging environment is being shut down and we won't be able to communicate with it. We have the same problem with Teller and I'm bringing this up with my team in our oncall review in an hour to determine the safest way to remove our artifacts associated with the Barclays staging environment


senth
  9:30 AM
@dpotvin
 looks like it was renewed in Teller recently (in december), can we copy these over to ledger staging in the meantime? This is actively blocking staging from booting up, so it's going to block our prod deployments too due to lack of staging coverage.


dpotvin
:spiral_calendar_pad:  9:34 AM
we'd have to update the banking-partners code to stop referencing the expired., so just assigning the key to Ledger wouldn't solve the problem. I'm trying to determine whether or not we can just delete the staging keys override.
:thank:
1



dpotvin
:spiral_calendar_pad:  9:37 AM
If deleting barclays staging artifacts isn't straightforward, I'll assign the new staging key to ledger and update the staging code later today

1 reply
1 year agoView thread


dpotvin
:spiral_calendar_pad:  11:35 AM
we're taking the short term approach to unblock ledger and teller. I'm waiting for a kochiku build for https://github.com/squareup/java/pull/234081 and then I'm going to deploy the change to teller staging as a test. This should solve the problem
:+1::skin-tone-3:
1



dpotvin
:spiral_calendar_pad:  1:51 PM
I merged the change that should unblock ledger deploys. I tested this for teller in staging



6 replies
Last reply 1 year agoView thread


dpotvin
:spiral_calendar_pad:  3:18 PM
When is the next time Ledger would deploy changes to prod?

1 reply
1 year agoView thread


zzhang
  3:21 PM
Hi team, one question: if we want to settle a repayment through deducting the borrower’s SQ balance/checking account first, if there is any remaining amount after the deducting, we want to ACH it through borrower’s linked external bank account, how can we use Ledger to achieve this behavior? Thank you!


dpotvin
:spiral_calendar_pad:  3:32 PM
Hi Ledger,
BCON recently rotated the Barclays-SEPA key, and we have to rotate the other Barclays-UK key as well by February 14th. We have a standard way of rolling out the new keys, which would require two deployments for Ledger and Teller: one deployment to always use the new Barclays-SEPA key, then setting the dynamic flags to 0 (they were set to 1 for Barclays SEPA migration), and then another deployment to use the new Barclays-UK key behind dynamic flags.
The other option we have is updating the Barclays-UK config to use the old keys when the dynamic flags are set to 1 and the new keys when the flag is set to zero. This would allow us to deploy Teller and Ledger just once in preparation for the Barclays-UK key migration. There is more risk because we would be deviating from the current process for key rotation, and because we would be inverting the usage of these flags.
Do you have a preference which procedure we use (slightly higher risk and one deployment, or standard practice and two deployments)? cc 
@bforehand
Thanks,
Daniel

1 reply
1 year agoView thread


deni
  4:11 PM
Deploying latest SHA of 8636c7b15b5f4b8c74a28cccf708a5de26a2eb5c to Ledger staging


bjuang
:spiral_calendar_pad:  5:01 PM
replied to a thread:
@oncall I'm oncall for Marketing and got this ticket where the seller is reporting that she was charged twice to her bank account (both failed because of insufficient funds) and once to her credit card for a subscription. It looks like only one of the two bank account charges were refunded, at least according to the screenshot they provided, but we only seem to see one bank charge in Regulator? Here's the ticket with screenshots from the seller: https://jira.sqprod.co/browse/ONCALL-129295…
@oncall
 nudge ^
View newer replies


ahwang
  10:53 AM
Hi! I have some questions regarding the LedgerEntry proto:
is it possible for an ACH payment associated with a ledger entry to have an entry_type of CAPTURE, REFUND, or UNDO?
What could be used as an indicator that a payment is a card payment?
Context: My team owns the Rewards service which uses the ledger-entries feed to apply free processing to  (supposedly) card payments only. However, we recently came across a seller who had free processing applied to ACH payments, and it’s possible that rewards has been doing this for a long time. So I was wondering if our criteria for processing a ledger entry might not be as stringent as expected.


hoyi
  11:02 AM
Ledger doesn’t store information on payment type; both card payments and ACH payments are treated the same


jjoe
  12:12 PM
@oncall
, can we get a deploy of ledger in prod? We started our Afterpay beta in AU yesterday and those payments are getting skipped by Ledger (fixed in this PR: https://github.com/squareup/java/pull/233869). cc: 
@jtan
 who already created a roll for a deploy


5 replies
Last reply 1 year agoView thread

oncall
APP  12:12 PM
@deni
 & 
@bta
, can we get a deploy of ledger in prod? We started our Afterpay beta in AU yesterday and those payments are getting skipped by Ledger (fixed in this PR: https://github.com/squareup/java/pull/233869). cc: 
@jtan
 who already created a roll for a deploy


jtan
  12:16 PM
I wanted to make a gringotts deploy today but typed in ledger cause my muscle memory still lingers :blob-lmao:


deni
  12:18 PM
hey BCON team cc 
@dpotvin
 
@bforehand
 
@carol
 looks like some barclays pipelines are broken in staging. should they be working with yesterday's changes? IE_EUR_BARCLAYS_DRY_RUN, ES_EUR_BARCLAYS_DRY_RUN, FR_BARCLAYS_DRY_RUN, IE_EUR_BARCLAYS, ES_EUR_BARCLAYS, FR_BARCLAYS, BARCLAYS





+3
45 replies
Last reply 1 year agoView thread


deni
  12:33 PM
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-92160
(ledger @ 8636c7b15b5 to production)




6 replies
Last reply 1 year agoView thread


christianadam
  12:34 PM
was added to #ledger by deni
.


deni
  1:01 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-92160…
this is on hold for now pending potential updates related to broken staging pipelines


deni
  1:05 PM
replied to a thread:
@oncall, can we get a deploy of ledger in prod? We started our Afterpay beta in AU yesterday and those payments are getting skipped by Ledger (fixed in this PR: https://github.com/squareup/java/pull/233869). cc: @jtan who already created a roll for a deploy
ledger deploys are currently blocked until SEPA keys are resolved. unfortunately we won't be able to deploy today
View newer replies


deni
  3:08 PM
staging is down - we are aware, looking into it


deni
  3:22 PM
HOTFIX Ledger ROLL: https://jira.sqprod.co/browse/ROLL-92160
(ledger @ 467538e8dd3 to production)

3 replies
Last reply 1 year agoView thread


deni
  3:23 PM
replied to a thread:
HOTFIX Ledger ROLL: https://jira.sqprod.co/browse/ROLL-92160…
:canary: canary start
View newer replies


hoyi
  3:23 PM
staging is back up; sorry for any interruptions!
:bless:
1



deni
  4:09 PM
replied to a thread:
HOTFIX Ledger ROLL: https://jira.sqprod.co/browse/ROLL-92160…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


deni
  4:38 PM
replied to a thread:
HOTFIX Ledger ROLL: https://jira.sqprod.co/browse/ROLL-92160…
:shipitparrot: we're out on prod
deploy checks pass


emilyl
  5:17 PM
taking over staging (062ecffd3ed)


emilyl
  6:42 PM
deploying b74394831b1 (latest) to staging


hoyi
  12:57 PM
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-92223
(ledger @ b74394831b1 to production)





9 replies
Last reply 1 year agoView thread


hoyi
  1:18 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-92223…
staging checks pass
:canary: canary start
View newer replies


hoyi
  1:52 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-92223…
canary deploy checks pass
:rolling_kirby: rolling forward


atsai
:spiral_calendar_pad:  4:01 PM
@oncall
 - Just wanted to raise https://jira.sqprod.co/browse/ONCALL-129295 - please let us know if this is the wrong channel, they haven't gotten a response in 5 days, issue has been happening since 1/13 or 1/19, and they are getting additional charges from their bank
:eyes:
1



4 replies
Last reply 1 year agoView thread

oncall
APP  4:01 PM
@hoyi
 - Just wanted to raise https://jira.sqprod.co/browse/ONCALL-129295 - please let us know if this is the wrong channel, they haven't gotten a response in 5 days, issue has been happening since 1/13 or 1/19, and they are getting additional charges from their bank


barbara
:no_entry:  4:11 PM
@rartecona
 I’m the beta manager running the AU Afterpay Alpha. Just wanted to touch base on the issue that was hotfixed last night. I’m not sure I fully understand the impact to the sellers who took Afterpay transactions during the ~24 hours prior to the hotfix or what we need to do to clean that up.





+1
17 replies
Last reply 1 year agoView thread


hoyi
  4:28 PM
Deploying latest (b3a8da0bbe8) to staging


mgreenberg
  7:19 AM
Hello from omnibus! The invoice team (cc 
@jaeyoon
) noticed latencies (~5s) on omnibus’s charge endpoint yesterday at 8pm EST and at the same time two days prior on monday. that lines up with latencies  (~6s) i’m seeing to ledger’s TenderProcessorService: 1/24's chart and 1/26's chart. I see higher QPS and a few errors on that endpoint from your end but nothing significant. Curious if you have any insight into what’s going on. It does appear your downstream FeePlanService (latency & error qps) and QuotaService (success qps & error qps) [1/24, 1/26] have corresponding blips at the same time


7 replies
Last reply 1 year agoView thread


senth
  9:04 AM
Taking over Ledger in staging for some testing, will put the original SHA back on once I'm done.


dpotvin
:spiral_calendar_pad:  9:13 AM
FYI I plan on executing https://jira.sqprod.co/browse/ROLL-92237  today at 11 AM PST. Ledger will no longer be impacted by these feature flags since this change (to always use new Barclays-SEPA keys) has been deployed. The purpose of this ROLL is to enable BCON to move forward with the Barclays-UK key rotation.
Please let me know if you have concerns or want to discuss this before I move forward with the ROLL
:+1::skin-tone-3:
1



dpotvin
:spiral_calendar_pad:  10:59 AM
Executing the ROLL to set key rotation dynamic flags back to 0% — Ledger deployed the change that uses the new key rather than using dynamic flags to decide whether to use the old key or the new key


amar
:spiral_calendar_pad:  1:15 PM
Hey 
@oncall
 I'm seeing some pages due to increased latency and timeouts from Ledger


3 replies
Last reply 1 year agoView thread

oncall
APP  1:15 PM
Hey 
@deni
 I'm seeing some pages due to increased latency and timeouts from Ledger


senth
  5:24 PM
Deployed latest SHA 17ddbc461a6a0a93710c9c383c2a1cd1e2b37f62 to Ledger staging
:+1::skin-tone-3:
1



senth
  11:40 AM
Deploying Ledger staging with latest SHA of a9224b773a99d649f5c0303b387f920d829d9cac


tal
:no_entry:  1:15 PM
hi, heads up on this PR i just merged, i will be out next week but 
@eyung
 can stamp the change whenever the next deploy happens
:ack:
3



senth
  4:34 PM
Deploying latest sha of f3b2703ae27b7f2c5c38b8c0eb17a0ed46299479 to Ledger staging


nreyna
:spiral_calendar_pad:  7:02 AM
was added to #ledger by nrabie
.


emilyl
  12:32 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-92331
(ledger @ ef9377e07ae to production)
:+1:
4





12 replies
Last reply 1 year agoView thread


fasih
  12:34 PM
was added to #ledger by emilyl
.


emilyl
  1:13 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


senth
  1:26 PM
Taking over Ledger in staging for some testing, will put the original SHA back on once I'm done.


emilyl
  1:49 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


emilyl
  2:38 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass


senth
  4:07 PM
Deploying latest SHA of a4c6ee81721c3db959cfce6c1fb37262fdcb46ba to Ledger staging


akepler
:no_entry:  9:28 AM
was added to #ledger by meenakshi
.


nikita
:spiral_calendar_pad:  10:04 AM
hi! Can i please get an app dependency request approval from feemo to ledger? https://registry.sqprod.co/app_dependency_requests/19472
:stamp:
1



cherry
:spiral_calendar_pad:  10:10 AM
hi there, got paged about these 7 payments being stale (through magistrate)
ZgWOyVD8z3QKeLEJzPgZWEAZD7YZY, 3R9v5fuY1aifk2zXYkcWJOhgYH9YY, HFBYSpY7QgILDVKt8k4LdIa15NRZY, fjmiYDTkmhd9Uzt4QmBsnt2fHhHZY, ts5zuGp5kJB2uOKe4U2iilLanxFZY, 7D1nVhpGLO6O4ZF3Qev116aEyWAZY
I do see the risk states transitions on my end, so not sure if they just need to be reprocessed on your end or if theres something else, thanks





25 replies
Last reply 1 year agoView thread


emilyl
  12:30 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-92387
(ledger @ a4c6ee81721 to production)


5 replies
Last reply 1 year agoView thread


emilyl
  12:34 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


senth
  12:37 PM
Taking over Ledger in staging for some testing, will put the original SHA back on once I'm done.
:greendone:
1



emilyl
  12:59 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


emilyl
  1:43 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass


emilyl
  4:11 PM
deploying 79a1590aaf1 (latest) to staging


nrobinson
:spiral_calendar_pad:  9:01 AM
:wave:  folks. My team is working on a project to understand how we can charge US Sales tax on Afterpay fees that we charge to merchants. Looking through some example payments I noticed that we seem to be already charging taxes on Afterpay fees in AU due to the fixed 10% rate.
From presidio it looks like ledger is responsible for adding the tax amount to the payment. Could anyone here confirm if that is the case?


4 replies
Last reply 1 year agoView thread


mattbooks
:spiral_calendar_pad:  9:12 AM
Hi I have a question about app_fees for this payment: https://rqm.iad1.sqprod.co/index/payment#/query/payment/jfnYyjfWYI0yqFkJFAYFt0BJxDCZY — I expected the app fees to be reflected in the balance of the app_fee_unit_token: https://regulator.sqprod.co/n/users/L9FFYAEZBTC8S but do not see that. Can you help me understand why that's the case? cc 
@cchan


10 replies
Last reply 1 year agoView thread


cwagner
:bulb:  11:30 AM
Hey y’all! I’m curious if there’s a place I could view the 
private channel
 results, but for staging. Would those be logged? Or would this require a ledger db query?




4 replies
Last reply 1 year agoView thread


emilyl
  12:29 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-92443
(ledger @ 79a1590aaf1 to production)


6 replies
Last reply 1 year agoView thread


emilyl
  12:33 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


emilyl
  12:57 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


dpotvin
:spiral_calendar_pad:  1:08 PM
Hello Ledger,
BCON is rotating the Barclays-UK key tomorrow at 9 AM PST. We are performing an almost identical migration to the Barclays-SEPA change a couple weeks ago that prevented Ledger from reading Barclays-SEPA files, but will avoid the problem we had last time by  (importing the current public key to the new public keyring, and importing the current private key to the new private keyring) We will be performing the same test with Barclays when they flip from the current key to the new key, which is to send them an arbitrary string encrypted with the new key, and confirming they are able to decrypt it. Please let me know if you have any questions or want to discuss this.
Best,
Daniel


2 replies
Last reply 1 year agoView thread


emilyl
  2:06 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass


ahdoot
:spiral_calendar_pad:  2:22 PM
hey 
@oncall
,
We've been running into issues with processing refunds in RefundsArbiter staging - seemingly due to this error:
Unauthorized request: caller wallet not authorized for service LedgerService and method ListBankSettlementEntries.
and I believe it's due to a mistype here: https://github.com/squareup/java/blob/master/settlements/ledger/src/main/resources/ledger-staging-common.yaml#L255
,wallet","web"
Thankfully it's only a staging yaml issue, but if we could get some help with this :thank: (edited) 
ledger-staging-common.yaml
          allow_apps: ["bb-statements","beemoreporter","billing","bizbank","cbms","connect","deposits","magnumpii","regulator", "regulator-bpo","sfs-core","v1-payouts-api",wallet","web"]
<https://github.com/squareup/java|squareup/java>squareup/java | Added by GitHub


5 replies
Last reply 1 year agoView thread

oncall
APP  2:22 PM
hey 
@rartecona
 & 
@emilyl
,
We've been running into issues with processing refunds in RefundsArbiter staging - seemingly due to this error:
Unauthorized request: caller wallet not authorized for service LedgerService and method ListBankSettlementEntries.
and I believe it's due to a mistype here: https://github.com/squareup/java/blob/master/settlements/ledger/src/main/resources/ledger-staging-common.yaml#L255
Thankfully it's only a staging yaml issue, but if we could get some help with this :thank:
2:22
hey 
@rartecona
 & 
@emilyl
,
We've been running into issues with processing refunds in RefundsArbiter staging - seemingly due to this error:
Unauthorized request: caller wallet not authorized for service LedgerService and method ListBankSettlementEntries.
and I believe it's due to a mistype here: https://github.com/squareup/java/blob/master/settlements/ledger/src/main/resources/ledger-staging-common.yaml#L255
,wallet","web"
Thankfully it's only a staging yaml issue, but if we could get some help with this :thank:


ahdoot
:spiral_calendar_pad:  2:23 PM
oof, sorry about the double ping there


emilyl
  4:36 PM
deploying 07247babc96 (latest) to staging

1 reply
1 year agoView thread


emilyl
  4:05 PM
deploying 19b62bc6972 (latest) to staging


hoyi
  4:05 PM
Deploying latest (89ade4903f7) to staging


dpotvin
:spiral_calendar_pad:  10:11 AM
Hello Ledger,
Just an FYI — the Barclays-UK staging key is expiring at the end of the week so I rotated it and wrote up a PR to move to the new staging key.
Best,
Daniel


hoyi
  12:42 PM
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-92585
(ledger @ 89ade4903f7 to production)




7 replies
Last reply 1 year agoView thread


hoyi
  1:00 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-92585…
staging checks pass
:canary: canary start
View newer replies


hoyi
  1:51 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-92585…
canary deploy checks pass
:rolling_kirby: rolling forward


bforehand
  3:32 PM
Do ledger folks still use the go/bconrunbook runbook? If not, can we clean up some entries that are specific to ledger?




15 replies
Last reply 1 year agoView thread


hoyi
  12:54 PM
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-92648
(ledger @ ed914fa3bcd to production)
:+1:
1




6 replies
Last reply 1 year agoView thread


hoyi
  1:08 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-92648…
staging checks pass
:canary: canary start
View newer replies


hoyi
  1:52 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-92648…
canary deploy checks pass
:rolling_kirby: rolling forward


senth
  3:54 PM
Taking over Ledger staging for about an hour, will put the latest master when I'm done.


senth
  4:43 PM
Deploying e10222495af6a7b027646461000b19fcafce4859 to Ledger staging


lieberman
:spiral_calendar_pad:  12:04 PM
FYI


lieberman
swinging payments out of IAD for neteng DR exercise (edited) 
Posted in payment-acceptance (archived) | Feb 9th, 2022 | View message


3 replies
Last reply 1 year agoView thread


deni
  12:31 PM
ok I do see the esperanto payments feed doubled in sjc and dropped in iad but no alarming changes elsewhere so should be good to delpoys


deni
  12:34 PM
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-92716
(ledger @ e10222495af to production)



9 replies
Last reply 1 year agoView thread


deni
  12:47 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-92716…
staging checks pass
:canary: canary start
View newer replies


deni
  1:17 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-92716…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


deni
  2:04 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-92716…
:shipitparrot: we’re out on prod
deploy checks pass
View newer replies


nan
:spiral_calendar_pad:  2:17 PM
Anyone has the idea of the delay of the table ledger.PD_MYSQL_LEDGER_001__LEDGER_PRODUCTION.pending_balance_snapshots? It blocks one of my ETL




12 replies
Last reply 1 year agoView thread


deni
  4:12 PM
Deploying 529973fb941f072251093b99ac7314629d9622f0 to Ledger staging


hoyi
  4:05 PM
Deploying latest (59e5fded37b) to staging


rriskmartins
:palm_tree:  11:20 AM
was added to #ledger by kanishka
.


mgp
:baby:  2:38 PM
@oncall
 deploying canary build 233c71d2fcb825d36c92dfb84a3ded1b3773a184 to Ledger staging
:bless:
1


oncall
APP  2:38 PM
@rartecona
 & 
@andreyg
 & 
@kcrane
 deploying canary build 233c71d2fcb825d36c92dfb84a3ded1b3773a184 to Ledger staging


mgp
:baby:  2:38 PM
Includes https://github.com/squareup/java/pull/235941
#235941 Add LD_PRELOAD to enable jemalloc
I'm not sure what Ledger is doing now, but apparently this is required  
to enable jemalloc. See  
https://docs.google.com/document/d/1kCAuyEkFaz8UbVnltaCOgks2JRxgOr2tvGV2NORe4f4/edit  
for details.
Labels
accounting-engineering
Comments
1
<https://github.com/squareup/java|squareup/java>squareup/java | Feb 11th, 2022 | Added by GitHub


emilyl
  4:36 PM
deploying 7a10e210605 (latest) to staging (edited) 


amuldowney
  7:40 PM
@oncall
 there is one stuck payment for stale risk state: 9WutGIXGI8O89gmYCdp9WFk6taB that I can confirm magistrate processed as CLEAR but has been stuck for over an hour and is alerting us


7 replies
Last reply 1 year agoView thread

oncall
APP  7:40 PM
@rartecona
 & 
@emilyl
 there is one stuck payment for stale risk state: 9WutGIXGI8O89gmYCdp9WFk6taB that I can confirm magistrate processed as CLEAR but has been stuck for over an hour and is alerting us


prabhjot
:no_entry:  12:06 PM
@oncall
 We were paged about this and I checked the final state of the this transfer is SUCCEEDED . I’m not sure what manual cleanup is required in ledger so wanted to check and see if you have more context here?
Acknowledged #2079715: Money Transfer Cb1WcVFGZv6XFYCE: Transition from FAILED to SUCCEEDED. This will require manual cleanup in Ledger. by Prabhjot Nagpal (
@prabhjot
) |  Jump


15 replies
Last reply 1 year agoView thread

oncall
APP  12:06 PM
@rartecona
 & 
@emilyl
 We were paged about this and I checked the final state of the this transfer is SUCCEEDED . I’m not sure what manual cleanup is required in ledger so wanted to check and see if you have more context here?


kanishka
  7:43 AM
replied to a thread:
Anyone has the idea of the delay of the table ledger.PD_MYSQL_LEDGER_001__LEDGER_PRODUCTION.pending_balance_snapshots? It blocks one of my ETL
@deni
 Can someone help us with resolving this error? ledger.PD_MYSQL_LEDGER_001__LEDGER_PRODUCTION.pending_balance_snapshots is not working and we pasted the error message above. This run is impacting tables downstream
View newer replies


jcook
:spiral_calendar_pad:  1:18 PM
Hey all, I am looking at our current refund flow and was curious if you could provide some insights!  I am curious how Square/Ledger might debit a seller's bank account in order to allow for refunds that exceed nextDeposit/outstandingBalance?


kcrane
:coolfingergun:  1:29 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-92851
(ledger @ 7a10e210605 to production)

4 replies
Last reply 1 year agoView thread


kcrane
:coolfingergun:  1:56 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


kcrane
:coolfingergun:  2:32 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


kcrane
:coolfingergun:  3:44 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we're out on prod
deploy checks pass


kcrane
:coolfingergun:  4:10 PM
Deploying latest (9f0c19184d4) to staging


sarve
  9:06 PM
:wave::skin-tone-4:


mgp
:baby:  9:06 PM
:wave:
9:07
So the transmit stage of Ledger crapped out and we think it successfully sent only 1 of its 4 files. We’ll need you to call Chase to confirm
9:07
But we need to get more details — will have them for you shortly


sarve
  9:07 PM
ok on it
9:07
what is the name of the file


mgp
:baby:  9:08 PM
SQUARE.ACH.NACHA.L-2022-02-15_P.txt
:ack:
1

9:09
we can get more details — holdon
9:09
@sarve
 we’re going to put the four filenames in your private channel
:+1::skin-tone-4:
1

9:10
hopefully that’s sufficient


kcrane
:coolfingergun:  1:09 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-92918
(ledger @ 9f0c19184d4 to production)


20 replies
Last reply 1 year agoView thread


kcrane
:coolfingergun:  1:17 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


kcrane
:coolfingergun:  1:53 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies

root
APP  3:42 PM
ODS host apd1430.iad3a.square (pd-odsgroup84) is down
No action is needed from you. ODS oncall will try to successover metaclusters if they are active on this host.
Please see the #situation channel for more information.
apps affected: ledger
metaclusters affected for these apps:
- stage-pd-mysql-ledger-001
- stage-pd-mysql-ledger-002
- stage-pd-mysql-ledger-003
- stage-pd-mysql-ledger-004
- stage-pd-mysql-ledger-005
Cc: 
@oncall
:ack:
1


oncall
APP  3:42 PM
ODS host apd1430.iad3a.square (pd-odsgroup84) is down
No action is needed from you. ODS oncall will try to successover metaclusters if they are active on this host.
Please see the #situation channel for more information.
apps affected: ledger
metaclusters affected for these apps:
- stage-pd-mysql-ledger-001
- stage-pd-mysql-ledger-002
- stage-pd-mysql-ledger-003
- stage-pd-mysql-ledger-004
- stage-pd-mysql-ledger-005
Cc: 
@rartecona
 & 
@kcrane
 & 
@bjoseph


kcrane
:coolfingergun:  3:52 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we're out on prod
deploy checks pass
:celeryman3:
1



kcrane
:coolfingergun:  4:07 PM
Deploying latest (02cb41bc58e) to staging


jcook
:spiral_calendar_pad:  5:51 AM
Hey all, I was curious if we attempt to debit a seller's bank account in the case that their nextDeposit/outstandingBalance go negative, i.e. as a result of issuing many refunds/or if we might cancel planned debits to the seller's bank account?


11 replies
Last reply 1 year agoView thread


fgross
  10:12 AM
Hey 
@oncall
, got paged due to some failing refunds, including for merchant MF6VZ0PD6NCN1.
Looking at the trace, it seems the job is failing when it attempts to retrieve a ledger entry. We believe this is holding up a number of refunds (76) from successfully going through. Would you be able to help take a look?
:eyes:
1





24 replies
Last reply 1 year agoView thread

oncall
APP  10:12 AM
Hey 
@rartecona
 & 
@kcrane
 & 
@bjoseph
, got paged due to some failing refunds, including for merchant MF6VZ0PD6NCN1.
Looking at the trace, it seems the job is failing when it attempts to retrieve a ledger entry. We believe this is holding up a number of refunds (76) from successfully going through. Would you be able to help take a look?


cwagner
:bulb:  11:33 AM
Hello! I got randomly assigned this Ledger security issue: https://square-console.sqprod.co/app/ledger-data/security/security-notifications/bundles/[…]2928f97e8f7d2761001cd155c982371a5d3fb033b9bba100fe9d190a. Is there someone I can re-assign it to?
:eyes:
1




4 replies
Last reply 1 year agoView thread


yskhoo
:no_entry:  11:48 AM
@oncall
 q: is there a way to cancel/reverse an inbound transfer / debit that has been sent to this UK merchant (LNJ1XA8B4EVK1?section=transfers)?





+3
34 replies
Last reply 1 year agoView thread

oncall
APP  11:48 AM
@rartecona
 & 
@kcrane
 & 
@bjoseph
 q: is there a way to cancel/reverse an inbound transfer / debit that has been sent to this UK merchant (LNJ1XA8B4EVK1?section=transfers)?


awernick
:spiral_calendar_pad:  1:16 PM
@oncall
 Bumping up ledger/enable_fail_and_unlink_bank_account_via_instruments  flag to 5% in staging
Context: https://github.com/squareup/java/pull/232144
#232144 [BAAPI-405][BAOS] Set up migration of FailAndUnlinkBankAccount flow to Instruments
• Sets up the necessary logic to migrate from using SqWeb's FailAndUnlinkBankAccount API to Instruments' new FailAndUnlinkBankAccount RPC.
• The new FailAndUnlinkBankAccount RPC currently proxies to SqWeb under the hood. BAAPI will begin extracting the logic in SqWeb to Instruments in Q1.
• The migration to the new RPC will be behind a feature flag (ledger/enable_fail_and_unlink_bank_account_via_instruments). Will coordinate with ActEng to determine how they want to proceed with rollout
Labels
accounting-engineering
Comments
3
<https://github.com/squareup/java|squareup/java>squareup/java | Dec 22nd, 2021 | Added by GitHub
:ack:
1


oncall
APP  1:16 PM
@rartecona
 & 
@kcrane
 & 
@bjoseph
 Bumping up ledger/enable_fail_and_unlink_bank_account_via_instruments  flag to 5% in staging
Context: https://github.com/squareup/java/pull/232144


bjoseph
  1:51 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-92993
(`ledger` @ `02cb41bc58e` to *production*)


5 replies
Last reply 1 year agoView thread


bjoseph
  2:01 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


bjoseph
  2:33 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


bjoseph
  3:48 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we're out on prod
deploy checks pass


kcrane
:coolfingergun:  4:58 PM
deploying f01cde76512 to staging


eshields
  1:41 AM
was added to #ledger by jameso
. Also, ilchmaa
 and breffni
 joined.


zjungmann
:palm_tree:  8:00 AM
Hi there! We've a merchant J7NREX9NXFHAR who linked a bank account and provided the wrong sort code....Transfers from the 11/2 to 16/2 have gone to this incorrect account. We usually wait up to 7 working days for these funds to bounce back to us if they are not able to be transferred to this account, but if they don't bounce back, is it possible to recall the transfers? 
@arantxa
 for vis. See a couple of the transfer ID's below. Happy to wait until outside the 7 working days, but just wondering if this course of action is possible if needed. Thank you!
3ZKA126QCF848YS7KZBY12E3434N
3Z9005D1MDNW8YS7KZBY12E3434N
3Z9004RKCDNW8YS7KZBY12E3434N


4 replies
Last reply 1 year agoView thread


dpotvin
:spiral_calendar_pad:  1:49 PM
Hello Ledger,
BCON is making a change to banking-partners that adds retrying when Ledger/Teller calls Mailbox to list files for Wells (and no other partner), and to reduce the timeout when Ledger/Teller calls Mailbox for Wells (in this commit). We do not expect this to change anything except to reduce the occasional pages we get when we fail to call Mailbox to list files for Wells.
Best,
Daniel (edited) 


mgp
:baby:  4:37 PM
Deploying c21bcc3d362b46d49415eb49e53d48eef36be569 to Ledger staging


amuldowney
  10:23 AM
Hey guys, question on the stale payments metric. A few days ago riskarbiter had some issues and payments began getting stale. it resulted in this very odd chart where it maxed out at 32,000 stale payments. The nature of the RA outage implies it was widespread and not limited to any specific cohort. Is there a limit in the ledger metric collector that would stop counting stale payments at 32,000?
Screen Shot 2022-02-18 at 10.21.35 AM.png
 
Screen Shot 2022-02-18 at 10.21.35 AM.png



4 replies
Last reply 1 year agoView thread


emilyl
  4:04 PM
deploying a45b086a604 (latest) to staging


angelia
  9:12 AM
Hi, anyone knows what does money transfer mean in the regulator, normally I see captured, refund, etc... is it just transferring from one bank account to this merchant token?
image.png
 
image.png


13 replies
Last reply 1 year agoView thread


emilyl
  12:55 PM
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-93154
(ledger @ a45b086a604 to production)





+3
38 replies
Last reply 1 year agoView thread


mengen
  1:43 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-93154…
staging checks pass
:canary: canary start
View newer replies


mengen
  2:30 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-93154…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


mengen
  3:40 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-93154…
:shipitparrot: we’re out on prod
deploy checks pass


senth
  4:25 PM
Deploying 3b81b2250d1b09b2be981ed0712fcb9c987cbf11 to Ledger staging


senth
  5:42 PM
Deploying latest e775dc460502220e3ac6b5ae5e06df9b0ca1a5e3 to Ledger staging to pick up a fix.


jlazarus
  11:41 AM
@oncall
 - RE: https://jira.sqprod.co/browse/ONCALL-130536 A merchant was charged multiple times for a failed charge due to "insufficient funds", causing multiple fees assessed by the bank.


3 replies
Last reply 1 year agoView thread

oncall
APP  11:41 AM
@rartecona
 & 
@emilyl
- RE: https://jira.sqprod.co/browse/ONCALL-130536 A merchant was charged multiple times for a failed charge due to "insufficient funds", causing multiple fees assessed by the bank.


bjoseph
  12:23 PM
@oncall
 can I deploy the canary build 03431942ed08e98c076873d024b63208be73ad1f to Ledger Staging? it's to test the new ExternalSource calculation method as part of switching from SqWeb to Rewards




13 replies
Last reply 1 year agoView thread

oncall
APP  12:23 PM
@rartecona
 & 
@emilyl
 I deploy the canary build 03431942ed08e98c076873d024b63208be73ad1f to Ledger Staging? it's to test the new ExternalSource calculation method as part of switching from SqWeb to Rewards


emilyl
  12:34 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-93195
(ledger @ e775dc46050 to production)



6 replies
Last reply 1 year agoView thread


emilyl
  12:54 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:chocobo-face: canary start
View newer replies


emilyl
  1:26 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


bjoseph
  1:48 PM
replied to a thread:
@oncall can I deploy the canary build 03431942ed08e98c076873d024b63208be73ad1f to Ledger Staging? it's to test the new ExternalSource calculation method as part of switching from SqWeb to Rewards
Deploying canary 03431942ed08e98c076873d024b63208be73ad1f  to Ledger Staging
View newer replies


emilyl
  2:50 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass


bjoseph
  3:36 PM
deploying 6bf07b38d338a2751a58699de1974a6bd47bb9ff to staging (edited) 
:thank:
1



senth
  9:18 AM
Taking over Ledger staging for an hour for some testing.


senth
  9:40 AM
^^ testing is done, rolling back staging to its original SHA


bjoseph
  1:20 PM
forgot to post that I took over ledger staging in this channel too, done with it now and rolling it back to the original SHA


sbobba
  2:46 PM
Hi ledger team,
I got this incident for cloud persister
https://square.pagerduty.com/incidents/Q2SH9JEOZXWOT9
I see this error in presidio:
No enum constant com.squareup.ledger.ExternalSourceProtos.ExternalSource.Name.REWARDS_FREE_PROCESSING
https://presidio-ui.sqprod.co/search?search=application:%22cloud-persister%22%20no%20enum%20constant&instance=staging&window=1h
:eyes:
1






13 replies
Last reply 1 year agoView thread


senth
  3:28 PM
Taking over Ledger staging for an hour for some testing.


senth
  5:29 PM
Deployed latest SHA 35c18696ea1b1e7db8eeed8872fd5f9cacbdfb97 to Ledger staging


zzhang
  10:30 AM
Hi team, a question: we are testing a scenario when the seller has a SQ checking balance ($100) which is not enough to cover a repayment ($200), both transactions go through Ledger as settlement. We expect the behavior be debit $100 from SQ checking and the remaining $100 from the linked bank account. But it seems Regulator shows it debits the full $200 from the linked bank account. Is this how Ledger settle a payment? When there is no enough balance to cover the payment, it debits the full amount externally? Thanks! cc: 
@markl
 regulator link (edited) 



5 replies
Last reply 1 year agoView thread


winniewang
  11:57 AM
hey all, the disputes team is noticing that there are a few payments where ledger has refunded entries even though the status in the refunds table in regulator seems to indicate these refunds have failed. Example payment: https://regulator.sqprod.co/n/payments/PFRBiB6UmmEmJEaMU2o3jtBfpZGZY should the refund entries on ledger’s end have gone through successfully or are they there in error?
:eyes:
1




13 replies
Last reply 1 year agoView thread


hoyi
  4:04 PM
Deploying latest (2fb0e4d7aec) to staging


rartecona
  9:38 PM
FYI a ledger shard appears stuck, and it’s backing up various feeds / throwing various alerts.





+2
16 replies
Last reply 1 year agoView thread


mgp
:baby:  9:46 PM
@brianip
 we need help with a Ledger DB shard… can you join https://meet.google.com/mih-pwuh-jfc?authuser=0 when online?


brianip
:palm_tree:  9:46 PM
was added to #ledger by mgp
.


kcrane
:coolfingergun:  9:50 PM
host is: pd-mysql-ledger-011-humanro.prod.srv.sjc3b.square


awernick
:spiral_calendar_pad:  9:57 PM
Sharing for visibility.
Acknowledged #2089097: System Status Check: Critical gringotts / sjc2b / production / feed-consumer-ledgerChangeRequestFeed by Alan Wernick (
@awernick
) |  Jump


skaltenbach
  9:58 PM
:wave: teller received an alert that seems related to the ledger issue. Sharing for vis
https://square.slack.com/archives/C02FMBNQ2/p1646026533041929
Acknowledged: #2089105 Failed to parse return file (filename=/ledger/barclays-sepa-ack-files/camt.054.001.02.rdd_D20220228_R6195595.F202000): null
Assigned: Suzanne Kaltenbach
↑︎ High Urgency
Service: Banking Connections PagerDuty API
Acknowledged by <https://square.pagerduty.com/users/PNZZUCA?utm_campaign=channel&amp;utm_source=slack|Suzanne Kaltenbach> (<@UKHHEHD3M>)Acknowledged by Suzanne Kaltenbach (
@skaltenbach
) | Feb 27th, 2022


mgp
:baby:  10:06 PM
select `settled_ledger_entry_feed_entries`.`id`, `settled_ledger_entry_feed_entries`.`feed_sync_id`, `settled_ledger_entry_feed_entries`.`shard`, `settled_ledger_entry_feed_entries`.`ledger_settled_ledger_entry_id`, `settled_ledger_entry_feed_entries`.`mint_squared_ledger_entry_id`, `settled_ledger_entry_feed_entries`.`created_at`, `settled_ledger_entry_feed_entries`.`updated_at` from `settled_ledger_entry_feed_entries` where (`settled_ledger_entry_feed_entries`.`feed_sync_id` > ? and `settled_ledger_entry_feed_entries`.`shard` >= ? and `settled_ledger_entry_feed_entries`.`shard` < ?) order by `settled_ledger_entry_feed_entries`.`feed_sync_id` limit ?


awernick
:spiral_calendar_pad:  10:19 PM
Got paged again after a brief (~20mins) resolution a few minutes ago (edited) 
Acknowledged: #2089246 System Status Check: Critical gringotts / sjc2b / production / feed-consumer-ledgerChangeRequestFeed
Assigned: Alan Wernick
↑︎ High Urgency
Service: BAAPI : gringotts
Acknowledged by <https://square.pagerduty.com/users/PZRS3FB?utm_campaign=channel&amp;utm_source=slack|Alan Wernick> (<@U01BZT6NS79>)Acknowledged by Alan Wernick (
@awernick
) | Feb 27th, 2022


brianip
:palm_tree:  10:20 PM
@hoyi
 https://wiki.sqprod.co/display/ProdEng/MySQL+Stored+Procedures+and+Views#MySQLStoredProceduresandViews-killwheredbadmin.killwhere to kill queries


hoyi
  10:32 PM
set the channel topic: One Ledger database host degraded | Discussion for https://registry.sso.global.square/apps/ledger | Contact @oncall for questions | Emergency page the entire team: https://go/ledger911


senth
  10:33 PM
https://docs.google.com/document/d/1Lwo2_L8n5c-dG2OBY3lBsF3uQef8MrZVdP4cLZiOxWQ/edit#
G Suite Document
 

2022-02-27 ALERT-9586 A long running query in one of the Ledger SQL shards is failing requests and feeds
Google Doc


songlin
  8:29 AM
was added to #ledger by rartecona
.


akwan
:spiral_calendar_pad:  11:53 AM
Hello from pay prod growth! I have a question about CreateFreeze -
Is it possible to create two Freezes of the same FreezeType (e.g. CREDIT_RISK)?
If not, what is the response for the second CreateFreezeResponse?
If yes, will the two freezes of the same type be reflected in GetFreezesResponse?
Thanks!


3 replies
Last reply 1 year agoView thread


hoyi
  12:42 PM
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-93377
(ledger @ 2fb0e4d7aec to production)



5 replies
Last reply 1 year agoView thread


hoyi
  1:10 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-93377…
staging checks pass
:chocobo-face: canary start
View newer replies


hoyi
  1:38 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-93377…
canary deploy checks pass
:rolling_kirby: rolling forward


hoyi
  1:40 PM
set the channel topic: Stable | Discussion for https://registry.sso.global.square/apps/ledger | Contact @oncall for questions | Emergency page the entire team: https://go/ledger911


bta
  1:40 PM
Taking over ledger staging for an hour for testing


emilyl
  5:02 PM
deploying 87338d941fd (latest) to staging


awernick
:spiral_calendar_pad:  10:48 AM
Bumping ledger/enable_fail_and_unlink_bank_account_via_instruments to 1% in production
Context: https://square.slack.com/archives/C7K0TCTNF/p1640192071255600


hoyi
  12:31 PM
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-93435
(ledger @ 87338d941fd to production)


4 replies
Last reply 1 year agoView thread


hoyi
  12:34 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-93435…
staging checks pass
:canary: canary start
View newer replies


hoyi
  1:12 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-93435…
canary deploy checks pass
:rolling_kirby: rolling forward

root
APP  4:17 PM
ODS host apd1430.iad3a.square (pd-odsgroup84) is down
No action is needed from you. ODS oncall will try to successover metaclusters if they are active on this host.
Please see the #situation channel for more information.
apps affected: ledger
metaclusters affected for these apps:
- stage-pd-mysql-ledger-001
- stage-pd-mysql-ledger-002
- stage-pd-mysql-ledger-003
- stage-pd-mysql-ledger-004
- stage-pd-mysql-ledger-005
Cc: 
@oncall

oncall
APP  4:17 PM
ODS host apd1430.iad3a.square (pd-odsgroup84) is down
No action is needed from you. ODS oncall will try to successover metaclusters if they are active on this host.
Please see the #situation channel for more information.
apps affected: ledger
metaclusters affected for these apps:
- stage-pd-mysql-ledger-001
- stage-pd-mysql-ledger-002
- stage-pd-mysql-ledger-003
- stage-pd-mysql-ledger-004
- stage-pd-mysql-ledger-005
Cc: 
@oncall


senth
  5:38 PM
Deploying Ledger staging with latest sha db70c479388514e2ad53e50e5cf1628ec048150c


ankit
  8:54 AM


ankit
Cross posting - can someone help in finding the source for Type ?
Thread in payments-data-aggregation | Mar 2nd, 2022 | View message
:eyes:
1




13 replies
Last reply 1 year agoView thread


bforehand
  10:02 AM
@oncall
 list

oncall
APP  10:02 AM
Primary: @rartecona (Ryan Artecona) & @hoyi (Ho-Yi Fung), Secondary: @hoyi (Ho-Yi Fung) [Note: Call or page for emergencies!]


hoyi
  12:24 PM
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-93493
(ledger @ db70c479388 to production)



7 replies
Last reply 1 year agoView thread


hoyi
  12:27 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-93493…
staging checks pass
:canary: canary start
View newer replies


hoyi
  12:57 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-93493…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


hoyi
  2:12 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-93493…
we’re out on prod
deploy checks pass


bta
  4:01 PM
deploying Ledger staging with latest sha 55a41998065e5bf1f31d4349f1f18cc49bb5bfdc


mqchen
  11:00 AM
qq: is the type of a tender (https://prototype.sqprod.co/#/docs/squareup.bills.Tender.Type) sufficient to determine whether it will be settled by ledger & will publish a SettledLedgerEntry feed record?

2 replies
Last reply 1 year agoView thread


bta
  11:43 AM
Taking over ledger staging for an hour for testing


awernick
:spiral_calendar_pad:  1:51 PM
Bumping ledger/enable_fail_and_unlink_bank_account_via_instruments to 5% in production
Context: https://square.slack.com/archives/C7K0TCTNF/p1640192071255600


hoyi
  4:04 PM
Deploying latest (4302c98ef46) to staging


senth
  5:19 PM
Deploying newer build b33268f8d2100a415e174f82ddf29f200d6b44fb to staging.


justinroberts
:funkyfish:  8:04 AM
:wave: What does it mean when there is a deposit token on the settled Ledger entry? For context, we have some potentially fraudy ACH refunds that appear to have already moved money. What would be the consequences of writing an undo to those ledger refund entries? Would we get the money back? Would we be vulnerable to chargebacks for that taking back?
cc: 
@ahdoot
 
@janis




28 replies
Last reply 1 year agoView thread


cchan
  9:03 AM
Hello! :wave:  I'm looking at a particular payment and see that there a couple of pending outbound transfers as seen here. https://regulator.sqprod.co/n/users/B0R7W4W78C5H1. I can't see too much information regarding this payment on the deposits side and wanted to see if Ledger had more information regarding it?
:eyes:
1



cchan
  9:06 AM
https://rqm.iad1.sqprod.co/index/payment#/query/payment/xS35kZnXLegw3487svl2r2L1ZDQZY seems to have some info here where Ledger seems to be delayed 2 days



10 replies
Last reply 1 year agoView thread


aivener
:spiral_calendar_pad:  9:19 AM
Hello! I’m an engineer on Payroll working on a SEV related to ATOs. Is there a way I can query for when specific units were frozen? And is that information somewhere in Regulator? Thanks!


11 replies
Last reply 1 year agoView thread


senth
  10:01 AM
Taking over Ledger staging for some testing for an hour.


lbrown
:palm_tree:  10:01 AM
was added to #ledger by cchan
.


dinesh
:spiral_calendar_pad:  10:55 AM
Hello! We are currently fetching user freeze related data from web.raw_oltp.audit_logs . I have noticed some cases where,  for a user we have both true and false values created at the same time. From Regulator comments i can see that the freezing and unfreezing happened with the same second, but unfreezing happened later. But from the audit logs both the records have same time stamp and it is not possible to figure out what happened first. Is there any other table that i can use to find out the exact status of the user.
Please find one sample user id below, happy to provide some more ids if needed
user_id : 12998186
user_token: 2XWNGJK85MGQD
Screen Shot 2022-03-03 at 3.11.28 PM.png
 
Screen Shot 2022-03-03 at 3.11.28 PM.png


2 replies
Last reply 1 year agoView thread


cwagner
:bulb:  11:33 AM
Hey ledger crew, I’m looking to get a list of merchants that were settled during a pipeline run (specifically the UK Barclays pipeline this morning), what would be the best way to do that?



8 replies
Last reply 1 year agoView thread


ppemberton
:spiral_calendar_pad:  2:22 PM
@oncall
 Paul from Payroll here, we would like to see how we can get access to hit Ledger endpoints, particularly looking for a way to look up frozen unit status via an API/RPC call.  We are dealing with a SEV on our side of things and need a way to block frozen accounts from using payroll to move money.



10 replies
Last reply 1 year agoView thread

oncall
APP  2:22 PM
@oncall
 Paul from Payroll here, we would like to see how we can get access to hit Ledger endpoints, particularly looking for a way to look up frozen unit status via an API/RPC call.  We are dealing with a SEV on our side of things and need a way to block frozen accounts from using payroll to move money.


cstead
:palm_tree:  2:23 PM
was added to #ledger by ppemberton
. Also, thanhthanh
 joined.


hoyi
  3:00 PM
set the channel topic: ALERT-9622 | Discussion for https://registry.sso.global.square/apps/ledger | Contact @oncall for questions | Emergency page the entire team: https://go/ledger911


hoyi
  3:47 PM
set the channel topic: Stable | Discussion for https://registry.sso.global.square/apps/ledger | Contact @oncall for questions | Emergency page the entire team: https://go/ledger911


senth
  10:17 AM
Forgot staging deploy yesterday due to the SEV chaos, deploying now with latest master 707e6655d91107bfe2934ffda1aea143e2dffca3 (there's only just one Ledger related commit)
:thankyoublob:
1



kcrane
:coolfingergun:  2:04 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-93653
(ledger @ 707e6655d91107 to production)
:stamp:
1



6 replies
Last reply 1 year agoView thread


kcrane
:coolfingergun:  2:12 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


kcrane
:coolfingergun:  2:35 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


kcrane
:coolfingergun:  4:04 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we're out on prod
deploy checks pass


bta
  4:29 PM
Deploying latest to staging: 2a8983da4d4a82780477ed7e4281c76bfa6aaa21
:rocket:
2



sagar
  7:43 AM


sagar
Hi team, we (billing service) call the CreateBalanceChange RPC when billing a merchant for a SaaS subscription in ledger (merchant level ledger balance). We also pass in the external_source as BILLING. However, we do not send any information about where this SaaS revenue should be deposited into. How does this SaaS fee get into Square’s bank account? In other words, how does Ledger know in which Square bank account should this SaaS revenue be deposited into?
Posted in accounting-eng | Mar 4th, 2022 | View message





40 replies
Last reply 1 year agoView thread


senth
  12:26 PM
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-93718
(ledger @ 2a8983da4d4a82780477ed7e4281c76bfa6aaa21 to production)

4 replies
Last reply 1 year agoView thread


senth
  1:42 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-93718…
staging checks pass
:canary: canary start
View newer replies


senth
  2:28 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-93718…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


senth
  3:30 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-93718…
:shipitparrot: we're out on prod
deploy checks pass


bta
  4:19 PM
Deploying latest to staging: b91aebd6ef237718e38718449e16fa3963e29065
:+1:
1



dskarbek
  5:31 PM
Deploying latest to staging: 4b98827311c2984a13a6202edc5e1a6b958502e1


carolina
  11:31 AM
Hi there :wave::skin-tone-2: I’m working on migrating ConnectedUsers off of SqWeb’s AuditLogs feed and consume freeze events from Ledger’s FreezeFeed instead as per this doc. I’d like to eyeball some data being stored into Snowflake by FreezeFeed in order to confirm that the fields between FreezeFeed and SqWeb’s AuditLog currently match. Which Snowflake table can I check for this?
minghua
 | G Suite Document
 

[ACTENG] SqWeb out of Ledger
Google Doc


2 replies
Last reply 1 year agoView thread


andreyg
  12:46 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-93782
(ledger @ 4b98827311c2984a13a6202edc5e1a6b958502e1 to production)
:+1:
2






6 replies
Last reply 1 year agoView thread


senth
  1:44 PM
replied to a thread:
Ledger ROLL:…
We're skipping prod deployment today. Looks like feed fetch is failing in staging due to not being able to parse an enum introduced with canary build during testing yesterday.
As a result, we dont have sufficient staging coverage for changes that include feed optimization as part of this ROLL, therefore, we're skipping prod deployment. Fix has been merged and will deploy shortly to staging to unblock the feeds https://github.com/squareup/java/pull/238241
View newer replies


sbobba
  1:55 PM
was added to #ledger by bta
.


senth
  2:42 PM
Deploying Ledger staging with latest master SHA 61eab7d271301791527e151552cc33be1438e25f to pick up a fix for failing feed fetch.
:pray:
1


1 reply
1 year agoView thread


andreyg
  4:05 PM
Deploying latest to staging: 0de50f4bc1b1554dbfa18d4d7de87427865cd138
:+1:
1



mnovich
  10:12 AM
Hey everyone, I am going to be putting ledger transaction funds into a database table, but I couldn't find funds with id 2 and 7. Were they skipped or removed?

1 reply
1 year agoView thread


akwan
:spiral_calendar_pad:  10:14 AM
Hello! Looking at freeze related RPC’s (CreateFreeze, DeleteFreeze, for example), it seems like regulator calls those with the unit_token (e.g.), even though the proto field name is merchant_token.  How does it work once it reaches Ledger? e.g.
is the merchant_token a legacy name that is actually the unit token?
is Ledger flexible and if it can’t find a matching merchant token (since unit token is supplied), it’ll find the merchant token that matches the supplied unit token?
And finally, the “Freeze” is applied at the merchant level right? Like, funds from ALL units can no longer be transferred out.
Thank you!! (edited) 


2 replies
Last reply 1 year agoView thread


mgp
:baby:  11:06 AM
@hoyi
 — 
@mnovich
 is adding a new table to the master shard of Ledger in https://github.com/squareup/java/pull/238352 as part of SOOL
How should he run the Shift? Like he shouldn’t be running this for all Ledger metaclusters should he?
#238352 [BCON-11271] Adding MarketMigrationState table to Ledger
As per this SPADE  
we need a new Table in Ledger to track market migration.  
Please note : This table is added to master shard only
Labels
accounting-engineering
Comments
3
<https://github.com/squareup/java|squareup/java>squareup/java | Mar 10th, 2022 | Added by GitHub



4 replies
Last reply 1 year agoView thread


mnovich
  11:19 AM
Any reason autodeploys are disabled on ledger staging?


2 replies
Last reply 1 year agoView thread


andreyg
  1:26 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-93845
(ledger @ 0de50f4bc1b1554dbfa18d4d7de87427865cd138 to production)
:+1:
4




15 replies
Last reply 1 year agoView thread


andreyg
  1:45 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


andreyg
  2:23 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


mnovich
  3:03 PM
I'll be performing a SHIFT on Ledger. It adds a new table to the master shard, thus it is safe to perform on all stages.
https://square-console.sqprod.co/app/ledger/databases/shift/request/15536


20 replies
Last reply 1 year agoView thread


andreyg
  3:57 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass


mnovich
  4:00 PM
Hey everyone, I am planning to run an insert for all stages for my new table. The impact is non existant since the table is not in use.
https://jira.sqprod.co/browse/ROLL-93857
:ack-red:
2


2 replies
Last reply 1 year agoView thread


andreyg
  4:05 PM
deploying e94a8f4fc29112d236655edc6264521bc4c83351 to staging


mnovich
  4:19 PM
replied to a thread:
Hey everyone, I am planning to run an insert for all stages for my new table. The impact is non existant since the table is not in use.…
Roll successfully complete


emilyl
  4:04 PM
deploying 689bb7352b3 (latest) to staging


hoyi
  8:53 PM
set the channel topic: ALERT-9673 | Discussion for https://registry.sso.global.square/apps/ledger | Contact @oncall for questions | Emergency page the entire team: https://go/ledger911


hoyi
  8:54 PM
We’re seeing issues with Books, cascading into Ledger.  We’re investigating





44 replies
Last reply 1 year agoView thread


hoyi
  12:18 AM
set the channel topic: Stable | Discussion for https://registry.sso.global.square/apps/ledger | Contact @oncall for questions | Emergency page the entire team: https://go/ledger911


awernick
:spiral_calendar_pad:  8:26 AM
Bumping ledger/enable_fail_and_unlink_bank_account_via_instruments to 10% in production
Context: https://square.slack.com/archives/C7K0TCTNF/p1640192071255600


emilee
  10:21 AM
Hi - Wondering if someone here can review my PR that adds a new freeze type to ledger? https://github.com/squareup/java/pull/238629


5 replies
Last reply 1 year agoView thread


ahdoot
:spiral_calendar_pad:  10:21 AM
:wave: ,
a seller is trying to figure out why specific refunds of theirs were rejected, and according to RefundsArbiter the rejection reason is COULD_NOT_BE_APPROVED_WITHIN_TIME_WINDOW , which happens when there is no settled ledger entry for the refund and the refund is outside of the processing window.
Looking at the payment in RQM in order to explain why this issue happened, I notice that it says Merchant is unsettleable due to NO_VERIFIED_BANK_ACCOUNT .
Is the solution here to simply tell the seller to link a bank account, or is there another issue?
Potentially related - I noticed that the merchant’s current balance is 43 cents, which is less than the amount for both rejected refunds.
:blob-thanks:



10 replies
Last reply 1 year agoView thread


emilyl
  1:05 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-93928
(ledger @ 689bb7352b3 to production)


5 replies
Last reply 1 year agoView thread


emilyl
  1:38 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


emilyl
  2:07 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


songlin
  2:13 PM
Deploying d24659090ccbef54e823479eae8912111bf8726b to staging, taking over for 1 ~ 2 hours (edited) 


songlin
  2:43 PM
Rolling back to 689bb7352b3f2b956d9dea0ec754f1d97b0bf430 on staging

1 reply
1 year agoView thread


emilyl
  3:00 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass


emilyl
  4:03 PM
deploying bfcd5bdf456 (latest) to staging


janis
  4:30 PM
hello! would it be possible for you to update disputed_amount_cents  in ledger.pd_mysql_ledger_001__ledger_production.pending_balance_snapshots  to reflect successful recalls for user B78389MR6F8Q7 as per 
@hur
 https://square.slack.com/archives/C0P2PV2JY/p1646759712345509?thread_ts=1645644702.711329&cid=C0P2PV2JY? as a result the disputed_amount_cents  should show 4,007,500


hur
Yep let me follow up with WF again, as I only received confirmation that 3 of the recalls were successful ($25,000, 15,000, $75)
From a thread in treasury | Mar 8th, 2022 | View reply


dskarbek
  5:05 PM
Taking over staging just briefly with bbf55b6ebbcf05a8d4d7a444118c4c58734593aa, will revert shortly.


dskarbek
  5:31 PM
releasing staging, deploying back to latest bfcd5bdf456


dskarbek
  8:59 AM
Taking over staging for a half hour or so.


dskarbek
  9:23 AM
Done with staging, putting bfcd5bdf456 back.


emilyl
  1:39 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-93978
(ledger @ bfcd5bdf456 to production)


6 replies
Last reply 1 year agoView thread


emilyl
  1:54 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


emilyl
  2:47 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


emilyl
  3:41 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass


emilyl
  4:09 PM
deploying 60930df70d3 (latest) to staging


emilyl
  12:57 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-94036
(ledger @ 60930df70d3 to production)




10 replies
Last reply 1 year agoView thread


tianyu
  12:58 PM
was added to #ledger by emilyl
.


emilyl
  1:37 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


emilyl
  2:07 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


emilyl
  3:05 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass


emilyl
  4:11 PM
deploying 71d5913557b (latest) to staging


carolina
  12:56 PM
Hi there :wave::skin-tone-2: I’m from the GPlat team and we are migrating the freeze events ConnectedUsers consumes from SqWeb AuditLogs, to use Ledger’s FreezeFeed instead. We’re at a point where we can test in staging. What’s the latest cursor in FreezeFeed in staging that we can update to?
:eyes:
1



3 replies
Last reply 1 year agoView thread


trupti
  1:53 PM
Is there Ledger successover or DR exercise going? Feemo is not able to consume ledger feeds in sjc2b https://app.signalfx.com/#/chart/v2/Enid57cAgAE?groupId=EnidyVzAYAE&configId=Enid9WOAYAA&startTime=-3h&endTime=Now
ledger Items Consumed
Added by SignalFx (11 kB)
https://app.signalfx.com/#/chart/v2/Enid57cAgAE?groupId=EnidyVzAYAE&configId=Enid9WOAYAA&startTime=-3h&endTime=Now




60 replies
Last reply 1 year agoView thread


awernick
:spiral_calendar_pad:  2:29 PM
Bumping ledger/enable_fail_and_unlink_bank_account_via_instruments to 25% in production
Context: https://square.slack.com/archives/C7K0TCTNF/p1640192071255600
:ack:
1



emilyl
  4:04 PM
deploying 2188c2c3e4f (latest) to staging


cherry
:spiral_calendar_pad:  4:18 PM
@oncall
 theres a recent company wide incident and a lot of services were impacted (including us) and we are still seeing stale payments on our end, wanted to reach out and see if ledger has/had any issues with that outage


10 replies
Last reply 1 year agoView thread

oncall
APP  4:18 PM
@emilyl
 a recent company wide incident and a lot of services were impacted (including us) and we are still seeing stale payments on our end, wanted to reach out and see if ledger has/had any issues with that outage


zifan
:spiral_calendar_pad:  9:08 AM
@oncall
 Can I take over Ledger in staging with 74c1d4c for an hour or so?

oncall
APP  9:08 AM
@oncall
 Can I take over Ledger in staging with 74c1d4c for an hour or so?



5 replies
Last reply 1 year agoView thread


zifan
:spiral_calendar_pad:  9:57 AM
Taking over Ledger with canary (72dc6ec) for testing (~ an hour).


zifan
:spiral_calendar_pad:  10:53 AM
Test completed. Redeploying version 2188c2c3


mmontgomery
:palm_tree:  12:05 PM
CISM here, we just rotated the vault storage keypair in staging. The new key information is:
ID: 895EAC81BD470672
Fingerprint: 0eab7bce5514235881170694895eac81bd470672
It looks like Ledger configures the key here:
https://github.com/squareup/java/blob/5e62e63a6cb1ecf081988f7346f2f9531e4acc71/settlements/ledger/src/main/resources/ledger-staging-common.yaml#L194

1 reply
1 year agoView thread


carolina
  2:21 PM
Hey folks, quick question about Ledger FreezeFeed: how many shards does it currently have on staging and in prod? It seems like we have to use an RpcFeedConsumer for it so I need to setup the shardCount on our side, would be good to know how many shards on the publishing side


songlin
  3:01 PM
@oncall
 Can I test something on staging for about an hour?


2 replies
Last reply 1 year agoView thread

oncall
APP  3:01 PM
@oncall
 Can I test something on staging for about an hour?


songlin
  3:06 PM
taking over ledger staging with c5da0d628e1650a1a03f5b3119a51b30a2fa1862 for an hour.


songlin
  3:40 PM
rolling back to 2188c2c3e4fc06aeed78cff6ad25ea5168e2bcc7


hoyi
  4:11 PM
Deploying latest (3c91230056b) to staging


jlazarus
  8:12 AM
@oncall
, I'm investigating an oncall ticket where a bill was voided due to insufficient funds. However, the screenshot of the customer's bank account in the ticket shows the charge being made and that there were funds. Do you all have any idea what could cause this?
More info:
select b.payment_status, b.invoice_number, ca.charge_status, ca.status, ca.payment_token, ca.omnibus_bill_token, ca.failure_reason, i.type, i.external_token
from "BILLING"."RAW_OLTP"."BILLS" b
inner join "BILLING"."RAW_OLTP"."CHARGE_ATTEMPTS" ca on ca.id = b.current_charge_attempt_id
inner join "BILLING"."RAW_OLTP"."INSTRUMENTS" i on ca.instrument_id = i.id
where b.token = '7c278d14-3efe-4210-bee2-148fc5b0ce4a'

PAYMENT_STATUS	INVOICE_NUMBER	CHARGE_STATUS	STATUS	PAYMENT_TOKEN	OMNIBUS_BILL_TOKEN	FAILURE_REASON	TYPE	EXTERNAL_TOKEN
voided	SPS-US-0007112145	failed	charged			Insufficient Funds	LedgerInstrument	MLGREC52QXZVS





11 replies
Last reply 1 year agoView thread

oncall
APP  8:12 AM
@oncall
, I'm investigating an oncall ticket where a bill was voided due to insufficient funds. However, the screenshot of the customer's bank account in the ticket shows the charge being made and that there were funds. Do you all have any idea what could cause this?
More info:
select b.payment_status, b.invoice_number, ca.charge_status, ca.status, ca.payment_token, ca.omnibus_bill_token, ca.failure_reason, i.type, i.external_token
from "BILLING"."RAW_OLTP"."BILLS" b
inner join "BILLING"."RAW_OLTP"."CHARGE_ATTEMPTS" ca on ca.id = b.current_charge_attempt_id
inner join "BILLING"."RAW_OLTP"."INSTRUMENTS" i on ca.instrument_id = i.id
where b.token = '7c278d14-3efe-4210-bee2-148fc5b0ce4a'

PAYMENT_STATUS    INVOICE_NUMBER    CHARGE_STATUS    STATUS    PAYMENT_TOKEN    OMNIBUS_BILL_TOKEN    FAILURE_REASON    TYPE    EXTERNAL_TOKEN
voided    SPS-US-0007112145    failed    charged            Insufficient Funds    LedgerInstrument    MLGREC52QXZVS


mmontgomery
:palm_tree:  11:08 AM
replied to a thread:
CISM here, we just rotated the vault storage keypair in staging. The new key information is:…
We have also rotated the production keypair. The key info is:
Key ID: E17592E2C539A11A
Fingerprint: 7b6c3f9b86d6c84e0bd30059e17592e2c539a11a


hoyi
  1:52 PM
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-94186
(ledger @ 3c91230056b to production)





8 replies
Last reply 1 year agoView thread


hoyi
  1:57 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-94186…
staging checks pass
:chocobo-face: canary start
View newer replies


hoyi
  2:25 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-94186…
canary deploy checks pass
:rolling_kirby: rolling forward


amuldowney
  4:02 PM
Hey Ledger folks,
Risk infra here, we are doing research on a major riskarbiter exodus, changing how we do payment captures and auths. One point of contention are the dummy scored payments (and risk assessments) that are made for things like square internal merchants and the like. In a perfect world we would want to work with you, our downstream customer on how to best deal with these kinds of merchants so that we aren’t generating dummy data in the pipelines. In that vein, are there any features we could take advantage of in Ledger to ignore certain merchants when it came to risk clearance? Risk is happy to own the list of merchants who would fall under this category, just looking for ways to not publish dummy risk assessments / magistrate risk state events.

1 reply
1 year agoView thread


hoyi
  4:05 PM
Deploying latest (1710648fa84) to staging


ahdoot
:spiral_calendar_pad:  7:36 AM
Hey :wave: ,
Somehow a refund for a really old payment went through (we’re triaging it), but in the meanwhile, I wanted to know what we should do (if anything) from a ledger entry side, as there is currently a refund ledger entry (that hasn’t settled) for this refund. Would it be alright for us to call Ledger’s cancelRefundLedgerEntry, or would we be better off leaving it as-is? (edited) 


2 replies
Last reply 1 year agoView thread


zifan
:spiral_calendar_pad:  9:04 AM
@oncall
 Can I take over ledger in staging for some testing? (~1h)

1 reply
1 year agoView thread

oncall
APP  9:04 AM
@oncall
 Can I take over ledger in staging for some testing? (~1h)


zifan
:spiral_calendar_pad:  9:14 AM
Taking over ledger staging with canary 8959c65 for testing.


zifan
:spiral_calendar_pad:  9:56 AM
^ done. Putting 1710648fa84 back.


zifan
:spiral_calendar_pad:  12:12 PM
@oncall
 Mind if I do another test in ledge staging with a canary build?


2 replies
Last reply 1 year agoView thread

oncall
APP  12:12 PM
@oncall
 Mind if I do another test in ledge staging with a canary build?


zifan
:spiral_calendar_pad:  12:13 PM
Taking over ledger staging with canary 54f3fa3 for testing.
:doneee:
1


1 reply
1 year agoView thread


hoyi
  1:42 PM
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-94259
(ledger @ 1710648fa84 to production)



5 replies
Last reply 1 year agoView thread


hoyi
  2:03 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-94259…
staging checks pass
:canary: canary start
View newer replies


hoyi
  2:30 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-94259…
canary deploy checks pass
:rolling_kirby: rolling forward


mnovich
  3:51 PM
@oncall
 running a SHIFT on staging first then prod.
https://square-console.sqprod.co/app/ledger/databases/shift/request/15841
:+1:
1


2 replies
Last reply 1 year agoView thread

oncall
APP  3:51 PM
@hoyi
 a SHIFT on staging first then prod.
https://square-console.sqprod.co/app/ledger/databases/shift/request/15841


emilyl
  5:01 PM
deploying 7e03bd9d87a (latest) to staging


sshahriar
  7:35 AM
https://square.slack.com/archives/C7K0TCTNF/p1648045750900139
Cross posting here, I wasn't sure where to ask. cc: 
@oncall


sshahriar
Hi team, we are seeing an increasing number of errors in our pipelines due to NULL values for file_transmission_token  in the BankSettlementEntry records. Could someone look into why this is the case? Thanks
Thread in accounting-eng | Mar 23rd, 2022 | View message

oncall
APP  7:35 AM
https://square.slack.com/archives/C7K0TCTNF/p1648045750900139
Cross posting here, I wasn't sure where to ask. cc: 
@oncall


songlin
  8:37 AM
@oncall
 Can I take over ledger on staging for about an hour?
:+1::skin-tone-3:
1
:ok_hand::skin-tone-2:
1


oncall
APP  8:37 AM
@oncall
 Can I take over ledger on staging for about an hour?


songlin
  10:04 AM
Rolling back to 7e03bd9d87a (latest)


kushan
  1:01 PM
Hello ledger folks, I work for invoices team and recently found an issue in Regulator where tips are not shown correctly. Talking to Regulator foundation team (context https://square.slack.com/archives/C022YKL0EUE/p1648059018186529 )  they suggested I talk here regarding this line of code which is possibly managed by your team.


kushan
Hey team I found a problem in regulator where the tip field shows $0 when it should be showing some amount. Is this the right place to raise an issue like this?
Thread in regulator-help | Mar 23rd, 2022 | View message

1 reply
1 year agoView thread


zzhang
  1:07 PM
Hi 
@oncall
, could you take a look at this payment, it was settled as a ledger entry before and then it failed. I am not sure why this happens, it seems there are several entries related to this payment, could you help explain what these entries mean and is there any action we should take? Thanks!
:eyes:
1





17 replies
Last reply 1 year agoView thread

oncall
APP  1:07 PM
Hi 
@oncall
, could you take a look at this payment, it was settled as a ledger entry before and then it failed. I am not sure why this happens, it seems there are several entries related to this payment, could you help explain what these entries mean and is there any action we should take? Thanks!


hoyi
  1:39 PM
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-94321
(ledger @ 7e03bd9d87a to production)

4 replies
Last reply 1 year agoView thread


hoyi
  1:51 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-94321…
staging checks pass
:canary: canary start
View newer replies


hoyi
  2:17 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-94321…
canary deploy checks pass
:rolling_kirby: rolling forward


hoyi
  4:09 PM
Deploying latest (90375520efd) to staging


songlin
  7:46 AM
@oncall
 can I take over ledger staging for an hour?
:+1::skin-tone-3:
1
:ok_hand::skin-tone-2:
1


oncall
APP  7:46 AM
@deni
 I take over ledger staging for an hour?


songlin
  8:50 AM
Rolling back to 90375520efd (latest)


sshahriar
  9:25 AM
:wave: Hey team, just a heads up, Recon Eng will be performing a Labrador disaster recovery exercise this Friday from 10:00 AM to 11:00 AM PST. The preemptive SEV can be found here . Our expectation is that there will be no impact to downstream teams given our chosen time for this exercise, but please let us know in the #recon-help channel if you see otherwise.


4 replies
Last reply 1 year agoView thread


zzhang
  11:56 AM
Hi 
@oncall
 could you help take a look at this transaction? We are not sure why this was auto initialized as the account is frozen. Thanks!


5 replies
Last reply 1 year agoView thread

oncall
APP  11:56 AM
Hi 
@hoyi
could you help take a look at this transaction? We are not sure why this was auto initialized as the account is frozen. Thanks!


hoyi
  4:21 PM
Deploying latest (39aed42f1aa) to staging


zifan
:spiral_calendar_pad:  3:43 PM
@oncall
 Can I take over ledger staging? I can deploy the latest version for today when done with the canary testing.


3 replies
Last reply 1 year agoView thread

oncall
APP  3:43 PM
@oncall
 Can I take over ledger staging? I can deploy the latest version for today when done with the canary testing.


zifan
:spiral_calendar_pad:  3:50 PM
Taking over ledger staging with canary 7974f48 for testing.


zifan
:spiral_calendar_pad:  4:58 PM
Deploy ccd52a1a883 (latest) to staging.
:thank:
1



tmahoney
  11:45 AM
hey 
@oncall
, just noticed that LedgerCountryConfigurationTest#confirmEffectiveAtUnchanged appears to be failing on master. I’m only pinging because there’s a comment on this test describing how it’s intended to avoid repeating a past SEV0 - so wanted to let you all know just in case this indicates something worthy of attention.



16 replies
Last reply 1 year agoView thread

oncall
APP  11:45 AM
hey 
@oncall
, just noticed that LedgerCountryConfigurationTest#confirmEffectiveAtUnchanged appears to be failing on master. I’m only pinging because there’s a comment on this test describing how it’s intended to avoid repeating a past SEV0 - so wanted to let you all know just in case this indicates something worthy of attention.


nsomavarapu
:spiral_calendar_pad:  6:07 AM
Hi 
@oncall
 looking for an approval on this soon expiring dependency request, https://registry.sqprod.co/app_dependency_requests/20582 :prayforstamp:

1 reply
1 year agoView thread

oncall
APP  6:08 AM
Hi 
@mgp
looking for an approval on this soon expiring dependency request, https://registry.sqprod.co/app_dependency_requests/20582 :prayforstamp:


awernick
:spiral_calendar_pad:  9:15 AM
Bumping ledger/enable_fail_and_unlink_bank_account_via_instruments to 50% in production
Context: https://square.slack.com/archives/C7K0TCTNF/p1640192071255600


mengen
  1:43 PM
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-94448
(ledger @ ccd52a1a8832b8d21bea5a8ef4d1ac7321f17e7f to production)




8 replies
Last reply 1 year agoView thread


mengen
  1:51 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-94448…
staging checks pass
:canary: canary start (edited) 
View newer replies


mengen
  2:32 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-94448…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


mengen
  3:34 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-94448…
:shipitparrot: we’re out on prod
deploy checks pass


zifan
:spiral_calendar_pad:  3:45 PM
@oncall
 FYI - I’m going to execute this ROLL to update 2 entries of ledger.ledger_entry_batches_to_payout table.
:doneee:
1



2 replies
Last reply 1 year agoView thread

oncall
APP  3:45 PM
@oncall
 FYI - I’m going to execute this ROLL to update 2 entries of ledger.ledger_entry_batches_to_payout table.


mengen
  4:46 PM
Deploy a6f4ea306ff (lateset) to staging


mengen
  8:38 AM
Taking over ledger staging with canary 2daf8b1 for testing

1 reply
1 year agoView thread


sshahriar
  8:39 AM
replied to a thread:
:wave: Hey team, just a heads up, Recon Eng will be performing a Labrador disaster recovery exercise this Friday from 10:00 AM to 11:00 AM PST. The preemptive SEV can be found here . Our expectation is that there will be no impact to downstream teams given our chosen time for this exercise, but please let us know in the #recon-help channel if you see otherwise.
Hi team, unfortunately we were unable to conduct the Labrador disaster recover exercise at the time mentioned above. We have rescheduled it, and will be performing it this Wednesday (March 29th) from 10:00 AM to 11:00 AM PST instead. Apologies for any inconveniences.
View newer replies


zifan
:spiral_calendar_pad:  9:27 AM
:wave: Can I deploy the latest deployable version (9f5f1b1) to staging after current canary testing?


5 replies
Last reply 1 year agoView thread


mengen
  9:57 AM
replied to a thread:
Taking over ledger staging with canary 2daf8b1 for testing
Deploy a6f4ea306ff back to staging


steffano
:spiral_calendar_pad:  10:12 AM
hello :pikachu-wave:  we’re getting the following error from the ledger disputes service
Squareup::ledger::mega::DisputeService#create_dispute received status 404 with error No CardPayment loaded for merchantToken HSYTF670MREA0 and paymentToken Fot3RwxA0orNZ9KZOsvSmC5svaB: NOT_FOUND
and haven’t been able to identify any clear issues with the data we’re sending on our end. this payment token leads to the correct user page in regulator as well. wondering if you all are able to take a look at this on your end of things and provide any insight?


14 replies
Last reply 1 year agoView thread


mengen
  10:29 AM
Taking over ledger staging with canary 2daf8b1 for testing again.

1 reply
1 year agoView thread


mengen
  10:53 AM
replied to a thread:
Taking over ledger staging with canary 2daf8b1 for testing again.
Deploy a6f4ea306ff back to staging


mengen
  12:00 PM
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-94501


5 replies
Last reply 1 year agoView thread


mengen
  12:36 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-94501
staging checks pass
:canary: canary start
View newer replies


mengen
  1:10 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-94501
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


mengen
  1:57 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-94501
:shipitparrot: we’re out on prod
deploy checks pass


zifan
:spiral_calendar_pad:  2:10 PM
Deploying latest version 89e79df to staging.


tmahoney
  2:51 PM
how far negative is a seller’s square balance allowed to go? (for refund purposes specifically, if that makes a difference.) I’m pretty sure it’s true that a “nightly transfer” can be “negative” i.e. a debit (so it’s allowed to go some amount negative), but obviously there must be an upper bound too… and does this number differ per-merchant?



7 replies
Last reply 1 year agoView thread


mengen
  4:34 PM
Deploy canary d493789 to staging


mengen
  5:21 PM
Deploy a new canary 56c6c92 to staging


mengen
  6:15 PM
Deploy 102481a5ae6(latest) to staging


zifan
:spiral_calendar_pad:  9:37 AM
@oncall
 Can I take over ledger in staging with a canary build for ~ an hour?

1 reply
1 year agoView thread

oncall
APP  9:37 AM
@oncall
 Can I take over ledger in staging with a canary build for ~ an hour?


zifan
:spiral_calendar_pad:  10:17 AM
Deploying canary edae5f1 to staging.

1 reply
1 year agoView thread


hunersen
  12:25 PM
Hi team -- do you handle the "Credit Balance" action in regulator? Want to confirm that issuing a credit on a specific Unit Token will credit an amount to the bank account associated with that unit token.




27 replies
Last reply 1 year agoView thread


mengen
  12:56 PM
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-94562

5 replies
Last reply 1 year agoView thread


mengen
  1:08 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-94562
staging checks pass
:canary: canary start
View newer replies


mengen
  1:27 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-94562
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


cwagner
:bulb:  1:56 PM
:wave: curious if folks know any bash hacker tricks to run a (safe, indexed) query on all nodes of ledger and print out a list of the joined results. In my case, the return of the query is just a list of merchant tokens. 
@hoyi
 maybe?



13 replies
Last reply 1 year agoView thread


mengen
  2:24 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-94562
:shipitparrot: we’re out on prod
deploy checks pass


songlin
  3:48 PM
@oncall
 can I take over staging for half an hour?


3 replies
Last reply 1 year agoView thread

oncall
APP  3:48 PM
@mengen
 & 
@mengen
 I take over staging for half an hour?


smartin
  4:19 PM
@oncall
 Can I deploy a canary in staging for ~30 mins?

1 reply
1 year agoView thread

oncall
APP  4:19 PM
@oncall
 Can I deploy a canary in staging for ~30 mins?


smartin
  4:30 PM
Deploying canary 489e09b to staging.

1 reply
1 year agoView thread


mengen
  5:50 PM
Deploy 00c9350194c (latest) to staging


mengen
  12:39 PM
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-94633


6 replies
Last reply 1 year agoView thread


mengen
  1:04 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-94633
staging checks pass
:canary: canary start
View newer replies


mengen
  1:21 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-94633
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


jyenbamroong
:ms-teams-jeans:  1:29 PM
hi team! i'm trying to test ledger's FreezeService.SetActivationFreeze endpoint that was put in a while ago, and since that RPC requires a balance token, I have to first do ShardMapperService.GetBalanceTokenForUnitToken . I tried using ledger's staging admin console to do this but i'm not an authorized user. is there a registry group my team could be added to to test these endpoints in staging? or would you prefer we pair with someone on your team?
for context: my team (payment permissions) owns the app paymentactivator and we are trying to use this ledger endpoint to freeze units until they are fully activated! so i just wanted to test out what the freeze would currently look like on a unit :blob-smile: thank you for your help!



8 replies
Last reply 1 year agoView thread


zifan
:spiral_calendar_pad:  1:47 PM
@mengen
 (since on-call bot has been dead for a while :D) Can I take over ledger staging for some tests? Should be less than an hour.


2 replies
Last reply 1 year agoView thread


zifan
:spiral_calendar_pad:  1:49 PM
Deploying 9bd1f8c (canary build) to ledger staging
:doneee:
1


2 replies
Last reply 1 year agoView thread


mengen
  2:34 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-94633
:shipitparrot: we’re out on prod
deploy checks pass


smartin
  2:47 PM
@oncall
 Can I take over staging for ~1 hour for testing?


2 replies
Last reply 1 year agoView thread

oncall
APP  2:47 PM
@oncall
 Can I take over staging for ~1 hour for testing?


smartin
  2:52 PM
Deploying canary afb0396 to staging

1 reply
1 year agoView thread


zifan
:spiral_calendar_pad:  3:44 PM
:sweat_smile: Sorry I need one more quick test in staging once :point_up: is done. 
@mengen
 I’ll deploy the latest version for today once I’m done with the test.

1 reply
1 year agoView thread


zifan
:spiral_calendar_pad:  3:51 PM
Deploying a7fe5d4 (canary) to ledger staging
:doneee:
1



mnovich
  4:00 PM
@mengen
 if you are planning to deploy latest to ledger staging. would you mind waiting while I test with my canary? I can deploy the latest afterwards



10 replies
Last reply 1 year agoView thread


mnovich
  4:41 PM
deploying 65569cc(canary) to staging


mnovich
  5:07 PM
Deploying latest master (d4b63fc) to staging
:thank:
1



mnovich
  10:29 AM
@oncall
 Taking ledger staging for testing

oncall
APP  10:29 AM
@oncall
 Taking ledger staging for testing


mnovich
  10:30 AM
@mgp
 manual ping since the bot is borked
:+1:
1



dpotvin
:spiral_calendar_pad:  11:32 AM
hi 
@mgp
 could you please take a look at https://github.com/squareup/java/pull/240645 at some point? This is the follow-up from our conversation yesterday.
This PR adds a daytime pager for both Teller and Ledger through banking-partners and putting it in the Pager class so classes that currently consume a Pager instance can switch to daytime paging by changing the method called from the consumed Pager. The Teller daytime pager is actually configured to do daytime pages and the Ledger daytime pager is actually the Ledger 24/7 pager for now. The intention is for ACTENG to be able to move to a daytime pager if/when you want daytime paging for some Ledger features.
The next step on my side is actually using the daytime pager for returns file processing failures, but I have some production testing I want to do first before making that change


8 replies
Last reply 1 year agoView thread


mnovich
  11:46 AM
@mgp
 Deploying d4b63fc back to staging
:+1:
1



smartin
  12:33 PM
@oncall
 primary can I take over ledger staging for testing for a bit?

oncall
APP  12:33 PM
Primary: 
@emilyl
 (Emily Li) [Note: Call or page for emergencies!]


emilyl
  12:34 PM
go ahead
:thank:
1



smartin
  12:35 PM
Deploying 720f68d to staging (edited) 

1 reply
1 year agoView thread


carolina
  12:53 PM
Hi there :wave::skin-tone-2: Quick question: ConnectedUsers is migrating away from SqWeb’s AuditLog feed for freeze events and instead consuming them from Ledger’s FreezeFeed. What would be the ideal maximum number of items and interval of consumption, plus backoff latency threshold for the feed consumer? This is what we were going to start with:
ledgerFreezes-sharded:
  maxItems: 200
  interval: PT1S
  backoffLatencyThreshold: PT5S


2 replies
Last reply 1 year agoView thread


markl
:spiral_calendar_pad:  1:12 PM
we (credit/capital) are looking into an issue with refunds and our assessment flow. We have a question regarding the REFUND LedgerEntry type and payment_token. In the case of a refund, is this refund ledger entry only associated with one CAPTURE with the same payment_token? Or could there be many ledger entries with the same payment token?


7 replies
Last reply 1 year agoView thread


lex
:musical_keyboard:  2:18 PM
@oncall
 can you assist with an incident? https://meet.google.com/vue-pqxo-kay


3 replies
Last reply 1 year agoView thread

oncall
APP  2:18 PM
@emilyl
 you assist with an incident? https://meet.google.com/vue-pqxo-kay


smartin
  3:38 PM
replied to a thread:
Deploying 720f68d to staging
Deploying d4b63fc back to staging


emilyl
  4:15 PM
deploying f2b560ef8a9 (latest) to staging


hoyi
  4:36 PM
FYI there’s a known issue with the test LedgerCountryConfigurationTest.confirmEffectiveAtUnchanged that has a scary comment about a SEV0 that is likely going to be failing this weekend.  We’re aware and working on it


mnovich
  10:02 AM
@oncall
 taking ledger staging for testing


4 replies
Last reply 1 year agoView thread

oncall
APP  10:02 AM
@emilyl
 & 
@bjoseph
 ledger staging for testing


emilyl
  12:43 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-94724
(ledger @ f2b560ef8a9 to production)
:+1::+1::skin-tone-2:
5






12 replies
Last reply 1 year agoView thread


emilyl
  12:49 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


emilyl
  1:51 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


emilyl
  2:41 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass
:yay-clap:
2



emilyl
  4:23 PM
deploying 98917005043 to staging


emilyl
  6:46 PM
deploying 6f7637836d0 (latest) to staging


janis
  5:44 AM
good morning! could you advise on how disputed_amount_cents in table ledger.pd_mysql_ledger_001__ledger_production.pending_balance_snapshots  is calculated - what is included and when the value is updated? thank you


7 replies
Last reply 1 year agoView thread


jcook
:spiral_calendar_pad:  8:30 AM
Hi all!  My name is Jackson and I am a member of the Fraud Risk team here at Square.  I was looking into a feed my team consumes from your team called:
ledgerInstantDepositAttempts
A legacy service/use case of ours consumes this feed and enqueues to a sharded job queue IF:
instantDepositAttemptFeedEntry.getEligibilityBlocker() == UNSETTLEABLE
but I noticed today that we have not seen an entry that meets this criteria in ~3 months.
Has something changed on Ledger’s end in the past 4 years where this is no longer a valid feed entry state?  An explanation I can think of is we do not expose the instant deposit button in the case that a sellers is unsettlable?


2 replies
Last reply 1 year agoView thread


zifan
:spiral_calendar_pad:  9:13 AM
@oncall
 Primary can I take over staging with a canary build for a 30min testing?


2 replies
Last reply 1 year agoView thread

oncall
APP  9:13 AM
Primary: 
@emilyl
 (Emily Li) & 
@bjoseph
 (Brandon Joseph) [Note: Call or page for emergencies!]


mnovich
  9:18 AM
Hey Ledger folks, I have a question regarding some ledger internals which lead to my tests failing.
why does the interface description for LedgerTransacterFactory.create() specifies that it should throw a MerchantNotMappedException :
https://github.com/squareup/java/blob/bf30b606fc9213a6f2e59c1f23524e2aa8c5a0d9/set[…]squareup/ledger/sharding/datastore/LedgerTransacterFactory.java
But the MockLedgerTransacterFactory implementation does not do that and it goes all the way down to MerchantStore.getUnique() to throw  EntityNotFoundException
https://github.com/squareup/java/blob/f2476b590a9fab6b1de671b4c58c35dc699bd8c3/set[…]ledger/sharding/datastore/mock/MockLedgerTransacterFactory.java (edited) 
LedgerTransacterFactory.java
<https://github.com/squareup/java|squareup/java>squareup/java | Added by GitHub
MockLedgerTransacterFactory.java
<https://github.com/squareup/java|squareup/java>squareup/java | Added by GitHub


4 replies
Last reply 1 year agoView thread


jpowers
  9:23 AM
Hello Team! I have a question related to Subscription charges and was advised to reach out here.
When CS is seeing a Voided out subscription  charge, but the merchant is seeing a posted charge on their bank statement -- is this related to their bank's speed or our system? We have seen this come up a lot recently, and can only suggest to file a claim with their bank if it doesn't drop off after some time. TIA!


jpowers
Hello Team, if a merchant received a "payment receipt" for square services (and is seeing posted charges on their bank statement) - but it's showing as already voided out for the last billing in regulator - is their only option to contact their bank to remove the posted charge(s) or will this self correct since we've "voided through regulator"? TIA (edited) 
Thread in saas-help | Apr 4th, 2022 | View message


8 replies
Last reply 1 year agoView thread


zifan
:spiral_calendar_pad:  9:24 AM
Deploying 2b4cb8f2a5(canary) to staging.
:doneee:
1


1 reply
1 year agoView thread


ejamison
  11:06 AM
:wave:  
@oncall
 We over in Payments API got a page for cannot create ledger entry for refund which seems to be caused by ledger is returning a failure reason of PAYMENT_NOT_FOUND (see 2nd entry for this search). Refund ID is Ruj6TnpTcpaO2fRGkzSLiUGjvaB_cVMyPq4PqNk78vZI9Hr5S and payment is Ruj6TnpTcpaO2fRGkzSLiUGjvaB. Not sure if possibly related to the current issue with Appointments for Pay with CashApp since this is a CashApp appointments payment.  Can you help/provide any insight into what might be happening on the ledger side? Thanks!


nreyna
cross-posting - We’re seeing an issue with missing pricing on Appointments for Pay with CashApp payments cc 
@ayan
 
@lishahe
Thread in appointments | Apr 5th, 2022 | View message


4 replies
Last reply 1 year agoView thread

oncall
APP  11:06 AM
:wave:  
@emilyl
 & 
@bjoseph
We over in Payments API got a page for cannot create ledger entry for refund which seems to be caused by ledger is returning a failure reason of PAYMENT_NOT_FOUND (see 2nd entry for this search). Refund ID is Ruj6TnpTcpaO2fRGkzSLiUGjvaB_cVMyPq4PqNk78vZI9Hr5S and payment is Ruj6TnpTcpaO2fRGkzSLiUGjvaB. Not sure if possibly related to the current issue with Appointments for Pay with CashApp since this is a CashApp appointments payment.  Can you help/provide any insight into what might be happening on the ledger side? Thanks!


dpotvin
:spiral_calendar_pad:  11:13 AM
Hi 
@emilyl
,
I'm following up with some PR feedback for setting up a daytime pager changes in banking-partners. My team requested I move the daytime pager Guice wiring out of banking-partners and into pagerduty. Mike said he was discussing this with you so I think you have context on it. Could you please review https://github.com/squareup/java/pull/240709?
Thanks,
Daniel

2 replies
Last reply 1 year agoView thread


carolina
  11:31 AM
Hi there :wave::skin-tone-2: Could you provide me with the latest prod cursor for Ledger’s FreezeFeed? We just deployed ConnectedUsers consuming from this feed and would like to update the cursor

1 reply
1 year agoView thread


emilyl
  12:35 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-94796
(ledger @ 6f7637836d0 to production)
:+1::+1::skin-tone-2::+1::skin-tone-5:
7






+1
14 replies
Last reply 1 year agoView thread


dpotvin
:spiral_calendar_pad:  12:36 PM
Hello Ledger cc 
@bhargava
,
The feeds_freezes_health detector in the Square Web part of the monitoring repo can currently send pages to BCON. The feed is to mark merchants as frozen in the Web database if the merchant is performing some kind of illegal activity. BCON thinks this detector should belong to ACTENG rather than BCON, are you ok with me updating the paging credentials and email contact in this detector to point to ACTENG?
BCON hasn't been paged for this detector but we did get paged for a separate BAAPI detector and are going through an audit of the Square Web detectors that point to BCON.
Thanks,
Daniel



6 replies
Last reply 1 year agoView thread


bhargava
  12:36 PM
was added to #ledger by dpotvin
. Also, sid
 joined.


emilyl
  12:55 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


emilyl
  1:28 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


zifan
:spiral_calendar_pad:  1:54 PM
Taking over staging for a canary (cfa7401) test for ~30 min. cc. 
@oncall
 primary
:ack:
1
:doneee:
1


3 replies
Last reply 1 year agoView thread

oncall
APP  1:54 PM
Taking over staging for a canary (cfa7401) test for ~30 min. cc. 
@emilyl
 & 
@bjoseph
primary


emilyl
  2:27 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass


emilyl
  4:04 PM
deploying d6caf28e3aa (latest) to staging


dskarbek
  4:08 PM
ah... I just merged a PR.  I'll deploy again in 30 or so when the build with it is available.


dskarbek
  4:35 PM
deploying b0fb66a3dbaeb3b919b881ec5faa58198d118b71 (latest) to staging


mnovich
  9:05 AM
@oncall
 taking ledger staging for testing
:ack:
1


oncall
APP  9:05 AM
@emilyl
 & 
@bjoseph
 ledger staging for testing

1 reply
1 year agoView thread


lfelberg
  9:26 AM
Morning all - not sure if this is getting addressed, but I’ve got a failing test: confirmEffectiveAtUnchanged.
:eyes:
1



6 replies
Last reply 1 year agoView thread


emilyl
  12:53 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-94879
(ledger @ b0fb66a3dba to production)
:+1::+1::skin-tone-2:
4






+1
10 replies
Last reply 1 year agoView thread


emilyl
  1:12 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


emilyl
  2:04 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


dpotvin
:spiral_calendar_pad:  2:10 PM
Is this something that ACTENG handles: https://jira.sqprod.co/browse/ONCALL-132679 ? cc 
@sarve
 
@hsilverio


2 replies
Last reply 1 year agoView thread


emilyl
  3:08 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass


emilyl
  4:09 PM
deploying 38a33e8d6e7 (latest) to staging


skloder
:spiral_calendar_pad:  4:34 PM
Can someone show me where we track JP settlement fees? I’m looking into rate patterns for different account type, GPV, etc. Thanks.


2 replies
Last reply 1 year agoView thread


awernick
:spiral_calendar_pad:  8:19 AM
Bumping ledger/enable_fail_and_unlink_bank_account_via_instruments to 75% in production
Context: https://square.slack.com/archives/C7K0TCTNF/p1640192071255600


zandt
:spiral_calendar_pad:  8:35 AM
Any known issues with ledger in staging this week? We were seeing some of our acceptance tests occasionally fail and a common theme appears to be this error in ledger:
ledger_shard_6 - Connection is not available


4 replies
Last reply 1 year agoView thread


zifan
:spiral_calendar_pad:  8:59 AM
@oncall
 primary can I take over ledger in staging for a canary test?

oncall
APP  8:59 AM
Primary: 
@dskarbek
 (Dan Skarbek) [Note: Call or page for emergencies!]


zifan
:spiral_calendar_pad:  9:30 AM
Deploying f4e7f6a (canary) to staging. cc. 
@oncall
 primary
:doneee:
1


4 replies
Last reply 1 year agoView thread

oncall
APP  9:30 AM
Deploying f4e7f6a (canary) to staging. cc. 
@emilyl
 & 
@bjoseph
primary


mlevy
:spiral_calendar_pad:  11:47 AM
Hi team! Does this channel own ledger as a data source? It looks like something went wrong with a recent edit - see the below snowflake screenshot:
Screen Shot 2022-04-07 at 11.46.49 AM.png
 
Screen Shot 2022-04-07 at 11.46.49 AM.png



7 replies
Last reply 1 year agoView thread


sid
  1:36 PM
Hello! Can I get a +1 from someone from accounting-eng on this PR? Declared a feature flag in Ledger bc its being used in banking-partners so just need an approval. https://github.com/squareup/java/pull/240638



8 replies
Last reply 1 year agoView thread


emilyl
  4:04 PM
deploying 7c2835307b3 (latest) to staging


ayan
  7:55 PM
Hi 
@oncall
, just as an fyi we are investigating a missing fee for 3P0pspYAqknbJVbrPIRzsfb7vaB
:+1:
1


3 replies
Last reply 1 year agoView thread

oncall
APP  7:55 PM
Hi 
@oncall
, just as an fyi we are investigating a missing fee for 3P0pspYAqknbJVbrPIRzsfb7vaB


kcrane
:coolfingergun:  4:44 PM
deploying 8ce5ec79c45 (latest) to staging


rohitdinakar
:spiral_calendar_pad:  9:46 PM
@oncall
 FYI, magistrate had a stuck node resulting in risk stale payments and I have restarted the node. Seeing a slow recovery
:ack:
1


oncall
APP  9:46 PM
@oncall
 FYI, magistrate had a stuck node resulting in risk stale payments and I have restarted the node. Seeing a slow recovery


zzhang
  9:26 AM
replied to a thread:
Hi @oncall, could you take a look at this payment, it was settled as a ledger entry before and then it failed. I am not sure why this happens, it seems there are several entries related to this payment, could you help explain what these entries mean and is there any action we should take? Thanks!
@oncall
 Hi, sorry to bring this up again, I am trying to understand how to handle this case on our side. According to the code comment, this Ledger entry should transfer from SETTLED to RETRYING, right? However, our log indicates that the entry is still SETTLED. Should we record the original payment as a failure on Seller’s dashboard? Does Ledger create a new entry for settling against their SQ card balance afterwards or just retrying the existing entry?
View newer replies


mdickenson
  10:27 AM
@oncall
 list

oncall
APP  10:27 AM
Primary: @kcrane (Kevin Crane), Secondary: @rartecona (Ryan Artecona) & @kcrane (Kevin Crane) [Note: Call or page for emergencies!]


apagtakhan
  12:24 PM
Hello, I am looking to query this table/view ledger.pd_mysql_ledger_001__ledger_production.pending_balance_snapshots , but am getting the following error message: did the schema change / what is the best way to resolve so we can use this table? Thank you :pray::skin-tone-3:
image.png
 
image.png

1 reply
1 year agoView thread


kcrane
:coolfingergun:  12:53 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-95041
(ledger @ 8ce5ec79c to production)
:+1:
4





8 replies
Last reply 1 year agoView thread


kcrane
:coolfingergun:  1:20 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:chocobo-face: canary start
View newer replies


kcrane
:coolfingergun:  1:42 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


kcrane
:coolfingergun:  2:58 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we're out on prod
deploy checks pass
:tada-hyper:
1



kcrane
:coolfingergun:  4:03 PM
deploying fe68e9d2362 (latest) to staging


sunny
  4:08 PM
hi! I was curious about how difficult it would be to get a FreezeFeed cursor from X days/weeks/months ago ? are cursor values stored somewhere that can be queried?
context: we’d like to replay FreezeFeed events when our vendor goes down
thank you!


3 replies
Last reply 1 year agoView thread


awernick
:spiral_calendar_pad:  8:34 AM
Bumping ledger/enable_fail_and_unlink_bank_account_via_instruments to 100% in production
Context: https://square.slack.com/archives/C7K0TCTNF/p1640192071255600


kcrane
:coolfingergun:  2:37 PM
@songlin
 
@dpotvin
 
@bta
 I'm thinking about bumping the prod deploy to tomorrow because we just got back from a BS lunch. Are your changes important to get in today? Or can they wait til tomorrow?




5 replies
Last reply 1 year agoView thread


kcrane
:coolfingergun:  2:39 PM
replied to a thread:
@songlin @dpotvin @bta I'm thinking about bumping the prod deploy to tomorrow because we just got back from a BS lunch. Are your changes important to get in today? Or can they wait til tomorrow?
bumping today's prod deploy til tomorrow since nothing is urgent and we're starting late


kcrane
:coolfingergun:  4:04 PM
deploying d61f658f692 (latest) to staging


mnovich
  4:42 PM
@oncall
 as part of https://jira.sqprod.co/browse/BCON-10171 and
https://jira.sqprod.co/browse/KEYWHIZ-1263
we will be transferring ownership of zengin-staging-pubring.gpg and zengin-staging-secring.gpg from ledger staging to JBA staging

oncall
APP  4:42 PM
@kcrane
 part of https://jira.sqprod.co/browse/BCON-10171 and
https://jira.sqprod.co/browse/KEYWHIZ-1263
we will be transferring ownership of zengin-staging-pubring.gpg and zengin-staging-secring.gpg from ledger staging to JBA staging


mnovich
  4:42 PM
should not have any effect, but just letting you know


mnovich
  5:02 PM
complete no disruptions
:ok_hand::skin-tone-3:
1



mgp
:baby:  9:15 AM
@oncall
 I just merged https://github.com/squareup/java/pull/241638 which will re-shard booksJournalEntryBankSettlementEntriesFeed from 64 to 256 shards. I’ll take care of the staging deploy this afternoon and re-shard that feed in the process.
#241638 Increase books JE BSE feed to 256 shards
This will be executed by ROLL-95078.
ACTENG-4526
Labels
accounting-engineering
Comments
2
<https://github.com/squareup/java|squareup/java>squareup/java | Apr 12th, 2022 | Added by GitHub

oncall
APP  9:15 AM
@oncall
 I just merged https://github.com/squareup/java/pull/241638 which will re-shard booksJournalEntryBankSettlementEntriesFeed from 64 to 256 shards. I’ll take care of the staging deploy this afternoon and re-shard that feed in the process.


mgp
:baby:  9:16 AM
@oncall
 :point_up:
:ack:
1


oncall
APP  9:16 AM
@kcrane
:point_up:
9:16
@kcrane
:point_up:


mnovich
  9:51 AM
So yesterday I realized that JBA staging and prod were making the calls to the same zengin IP's.
https://github.com/squareup/java/blob/master/settlements/jba/src/main/resources/jba-nrt1-staging.yaml
https://github.com/squareup/java/blob/master/settlements/jba/src/main/resources/jba-nrt1-production.yaml
Currently I am migrating JBA staging to IAD3A. We will not be able to call zengin endpoints from that region without a proxy in japan.
does ledger need the capability in staging or you don't really utilize it in any integration tests?
jba-nrt1-staging.yaml
<https://github.com/squareup/java|squareup/java>squareup/java | Added by GitHub
jba-nrt1-production.yaml
<https://github.com/squareup/java|squareup/java>squareup/java | Added by GitHub


kcrane
:coolfingergun:  12:32 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-95181
(ledger @ d61f658f6 to production)
:checkmark:
7






12 replies
Last reply 1 year agoView thread


kcrane
:coolfingergun:  12:41 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


apagtakhan
  12:52 PM
Hi, in ledger.ledger__ledger_production.pending_balance_snapshots , it looks like there is no data for our new markets (FR, IE, and ES), and a small number of merchant records for AU, CA, and GB. Is there a doc on what records are included/excluded in this table? I am looking to understand if this is expected. Thank you! Query in :thread: (edited) 





14 replies
Last reply 1 year agoView thread


kcrane
:coolfingergun:  1:18 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


kcrane
:coolfingergun:  2:24 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we're out on prod
deploy checks pass


kcrane
:coolfingergun:  4:10 PM
deploying 9b3304de8c7 (latest) to staging

1 reply
1 year agoView thread


sxiong
  8:44 AM
Hi, my team is getting an error from this feed on staging: capital-settled-ledger-entries-feed
Squareup::Feedsync::Service::FeedSourceService#fetch received status 500 with error java.lang.IllegalArgumentException: Invalid UUID string: DGInP2npTVmqMbblrFfFFA
The error is currently blocking our consumer from consuming the feed.
How do we fix this? (edited) 


5 replies
Last reply 1 year agoView thread


mgp
:baby:  12:40 PM
@oncall
 deploying https://jira.sqprod.co/browse/ROLL-95231 and performing the feed re-sharding (https://jira.sqprod.co/browse/ROLL-95104 and https://jira.sqprod.co/browse/ROLL-95078) on prod
:stamp:
1


oncall
APP  12:40 PM
@kcrane
 https://jira.sqprod.co/browse/ROLL-95231 and performing the feed re-sharding (https://jira.sqprod.co/browse/ROLL-95104 and https://jira.sqprod.co/browse/ROLL-95078) on prod


mgp
:baby:  12:44 PM
Starting deploy… feeds are paused


mgp
:baby:  12:54 PM
Deploying from canary, feeds are still paused… (edited) 


kcrane
:coolfingergun:  1:06 PM
@mgp
 what's the ETA on this? SJC2B is lookin mighty grumpy


3 replies
Last reply 1 year agoView thread


kcrane
:coolfingergun:  1:07 PM
oh lol i think you just finished the re-shard about 1 minute ago because the number of errors jumped from 64 to 320 lmao


mgp
:baby:  1:09 PM
SJC2B is coming up…
1:09
waiting on the deploy to IAD
1:09
the feeds are paused and the new cursors are ready… just need to wait for the IAD deploy to complete and then we can re-enable these feeds
:ok_hand::skin-tone-3:
1



mgp
:baby:  1:19 PM
Almost there… :sonic-waiting:
1:21
enabled pendingBalanceBankSettlementEntriesFeed
1:24
enabled booksJournalEntryBankSettlementEntriesFeed
1:27
This is done :+1: (edited) 
1:27
cc 
@kcrane
 :point_up:


kcrane
:coolfingergun:  1:28 PM
:bless:


mgp
:baby:  1:29 PM
looks like all system status checks have cleared: https://square.signalfx.com/#/chart/v2/FBID5AXAcAE?groupId=EFz-tuCAgAU&configId=FBID6fNAcAE&startTime=-30m&endTime=Now
System Status Errors
Errors from SystemStatusChecks
Added by SignalFx (11 kB)
https://square.signalfx.com/#/chart/v2/FBID5AXAcAE?groupId=EFz-tuCAgAU&configId=FBID6fNAcAE&startTime=-30m&endTime=Now



kcrane
:coolfingergun:  4:46 PM
deploying 110dd5bc76e (latest) to staging


kcrane
:coolfingergun:  1:23 PM
Experiencing issues in Ledger right now due to a situation with CloudProxy, so all requests to Books and the AQ are super impacted. Stay tuned for updates


rartecona
  1:47 PM
^ this is over now


20 replies
Last reply 1 year agoView thread


minghua
:bulb:  12:43 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-95312
(ledger @ 110dd5bc76e12c151d796f263ee1e0a5babcce1b to production) (edited) 
:+1:
4






14 replies
Last reply 1 year agoView thread


ahdoot
:spiral_calendar_pad:  12:47 PM
:wave: ,
We’re not seeing ledger entries appear in RQM or in Regulator for unlinked refunds.
Here’s an example: Regulator, RQM
We’ve confirmed they exist by looking at the user’s page on Regulator, but what would be the correct way to query for ledger entries in this case?


11 replies
Last reply 1 year agoView thread


steckel
:ablobwave:  12:57 PM
Hey ledger friends, I'm trying to corral documentation so I can best understand "what happens to a merchant's money when they get deactivate by risk vs close their own account."
From what I piece together merchant-units can be "frozen," preventing money from exiting Square which means ledger and teller. Is this correct?
Similarly, if a customer "closes their account," does anything change or does their money regularly exit Square via normal nightly transfer schedules?
Is this the right place to track down this information and if not can anyone help point me in the right direction. :thanks_so_much:

1 reply
1 year agoView thread


minghua
:bulb:  1:18 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


minghua
:bulb:  2:05 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


mgp
:baby:  2:33 PM
Deploying build 85ea967 to Ledger staging as part of re-sharding


minghua
:bulb:  2:41 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we're out on prod
deploy checks pass


mgp
:baby:  3:14 PM
Deploying build 85ea967 to Ledger sandbox as part of re-sharding…


mgp
:baby:  3:28 PM
This is done.
:thank:
1



minghua
:bulb:  3:37 PM
deploying 2f7981545ab89a23e729fe89abb2bc50b953c4f1 to staging


mgp
:baby:  9:41 PM
starting https://jira.sqprod.co/browse/ROLL-95266
9:42
pausing feeds now
9:46
re-deploying ledger in iad (edited) 


mgp
:baby:  9:54 PM
re-deploying ledger to sjc


mgp
:baby:  10:03 PM
unpausing the balance feed
10:08
balance feed is caught up. unpausing risk feed (edited) 
10:11
we’re all caught up :tada:


keldwin
  9:18 AM
Hi! Can anyone help with the following: Where does data on unit tokens that have been frozen by civil process live in snowflake?https://square.slack.com/archives/CS8HQP751/p1650384427077889


keldwin
:wave::skin-tone-4: Where does data on unit tokens that have been frozen by civil process live in snowflake? I was redirected to this channel, but please let me know if there is a more appropriate place for this question
Thread in justice-eng | Apr 19th, 2022 | View message


16 replies
Last reply 1 year agoView thread


ahdoot
:spiral_calendar_pad:  10:29 AM
replied to a thread:
:wave: ,…
Friendly ping on this :slightly_smiling_face:
:eyes:
1

View newer replies


ahdoot
:spiral_calendar_pad:  10:47 AM
If a refund ledger entry is created on a weekend and the merchant’s bank account needs to be debited because the merchant doesn’t have enough in their Square balance, do those debits get queued up over the weekend and then get sent out on the next available business day?
In other words, is there a difference if the refund ledger gets created on a Saturday or a Sunday, or even the next Monday with respect to how long it will take for the debit to occur?
I’m trying to determine how sensitive we should make RefundsArbiter’s pages with respect to calls to createLedgerEntry and cancelRefundLedgerEntry (i.e. if we can page only during business hours) while keeping in mind the 14-day SLA for refunds. (edited) 


7 replies
Last reply 1 year agoView thread


minghua
:bulb:  12:24 PM
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-95373
(ledger @ 2f7981545ab89a23e729fe89abb2bc50b953c4f1 to production)




16 replies
Last reply 1 year agoView thread


cheister
  12:28 PM
oncall, can you do a canary deploy of ledger with Java 17 to staging? https://github.com/squareup/java/pull/242284
:eyes:
1
:+1:
1



4 replies
Last reply 1 year agoView thread


minghua
:bulb:  12:40 PM
replied to a thread:
oncall, can you do a canary deploy of ledger with Java 17 to staging? https://github.com/squareup/java/pull/242284
Starting canary deploy to staging https://square-console.sqprod.co/app/ledger/deploy/p2
View newer replies


eblaine
  12:40 PM
Hello! I'm an engineer on Messages, and we'd like to use GetFreezes to prevent spammers whose accounts are frozen from sending messages to buyers. Can I get some :eyes:  on this associated ACL PR? https://github.com/squareup/java/pull/242315 Thank you!



19 replies
Last reply 1 year agoView thread


ewr
  1:12 PM
was added to #ledger by minghua
. Also, mdall
 joined.


minghua
:bulb:  2:05 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-95373…
staging checks pass
:canary: canary start
View newer replies


minghua
:bulb:  2:21 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-95373…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


zifan
:spiral_calendar_pad:  2:24 PM
Hi 
@oncall
 ! Can I take over ledger staging for a quick canary test?

oncall
APP  2:24 PM
Hi 
@minghua
! Can I take over ledger staging for a quick canary test?


11 replies
Last reply 1 year agoView thread


minghua
:bulb:  3:00 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-95373…
:shipitparrot: we're out on prod
deploy checks pass


minghua
:bulb:  3:17 PM
deploying 4b0d292e785d1b7abd22d5e126de2128ab9afdcc to staging


zifan
:spiral_calendar_pad:  3:58 PM
@oncall
 FYI - deploying ledger staging with canary build (188782d ) for testing.

1 reply
1 year agoView thread

oncall
APP  3:58 PM
@oncall
 FYI - deploying ledger staging with canary build (188782d ) for testing.


senth
  4:24 PM
Going to take over Ledger staging for 30 mins, will rollback to the latest master once I'm done.


mnovich
  6:03 PM
@oncall
 taking staging for a spin for 30 min or less

oncall
APP  6:03 PM
@emilyl
 staging for a spin for 30 min or less


mnovich
  6:13 PM
done with ledger


bhargava
  8:42 AM
Hey folks :wave:, 
@ewr
 just merged a PR to move banking-partners to feature flags from dynamic flags. With that change, both ledger and teller share the same value for barclays_max_number_retries_at_minute_interval flag. We currently increase the value of that flag during barclays downtime and set it back to default 10 after the downtime. Is that okay with ledger? If not, we could define a separate rule for ledger to leave the value at default 10. Let me know.


mgp
:baby:  9:20 AM
I think in general we take the same strategy to deal with Barclays downtime… although honestly I don’t remember the last time we set this flag :blob_think_close:
When was the last time y’all set this flag in Teller for Barclays downtime?


bhargava
  9:44 AM
March 2022 according to go/dynamicflags
9:44
You all seem to have stopped setting it since Sept 2021. So just wanted to confirm if something changed on your side.
9:44
If noting changed, then having a common flag setting for both teller and ledger doesn't sound like a problem.


hoyi
  9:47 AM
It should be fine, I think?  Our only pipeline is the nightly one, and maintenance usually doesn’t hit during those hours
9:47
(I think, in contrast, teller also has one which runs every few minutes, which is why you need it on your side?)
:yes:
1



bhargava
  9:47 AM
yea maintenance is usually during the weekends. Maybe that's why you all didn't have to touch that flag.


hoyi
  9:48 AM
Yeah, given that, and that we evidently haven’t touched the flag on our end in forever, it should be fine to keep them at the same value
:+1:
1



emilyl
  9:49 AM
I think it’s fine that the value is set by a shared flag. Historically, it’s set by BCON anyways to match teller’s value (edited) 


divyesh
:spiral_calendar_pad:  10:30 AM
Hi Team, we are making a request to resolve a dispute by using the endpoint ledger.service.ResolveDisputeRequest and passing dispute_token = dis-f4d27979-de79-4219-b971-4abb203c7e52 and unit_token=HSYTF670MREA0 but receiving the following error -
Squareup::Ledger::Service::DisputeService#resolve_dispute received status 404 with error No Dispute matched query: DisputeQuery{id=null, token=EqualityQuery{sample value=dis-f4d27979-de79-4219-b971-4abb203c7e52, negate=false, withNull=false}, paymentToken=null, merchantToken=null} Associations: Association{entity=class com.squareup.ledger.model.disputes.Dispute, associations=[Association{entity=class com.squareup.ledger.model.disputes.DisputeVersion, associations=[Association{entity=class com.squareup.ledger.model.AuditLog, associations=[]}]}]}
Can you please look into it? Thanks!


5 replies
Last reply 1 year agoView thread


mnovich
  10:46 AM
@oncall
 taking ledger staging for testing
:+1:
1



3 replies
Last reply 1 year agoView thread

oncall
APP  10:46 AM
@minghua
 ledger staging for testing


minghua
:bulb:  12:27 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-95441
(ledger @ 4b0d292e785d1b7abd22d5e126de2128ab9afdcc to production)

5 replies
Last reply 1 year agoView thread


minghua
:bulb:  12:37 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


minghua
:bulb:  1:13 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


minghua
:bulb:  1:43 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we're out on prod
deploy checks pass


minghua
:bulb:  3:10 PM
deploying 0534ebdbd1d60f2819602ce6e580e1ac7a293edf to staging


zifan
:spiral_calendar_pad:  3:41 PM
@oncall
 Going to take over staging with 594fc68 for a quick test. (It has rebased latest master, won’t remove any current commits)
:+1:
1




4 replies
Last reply 1 year agoView thread

oncall
APP  3:41 PM
@oncall
 Going to take over staging with 594fc68 for a quick test. (It has rebased latest master, won’t remove any current commits)


zjungmann
:palm_tree:  7:26 AM
Hey, was looking for a bit of advise on transfer tags if someone could assist. I wanted to know if they work if a merchant is using 'manual transfers'? Or if they should only apply if M is using automatic ones? Any guidance would be appreciated! Thanks

1 reply
1 year agoView thread


ssopp
  2:07 PM
Hiya, for a given payment that has a HOLD LedgerEntry, will there always be a RELEASE LedgerEntry that follows eventually?  I'm wondering if it's possible to be in HOLD as a terminal state.

2 replies
Last reply 1 year agoView thread


minghua
:bulb:  4:25 PM
deploying d812acbee4822da3bba9e3af92fa5dc7aaede294 to staging (edited) 


minghua
:bulb:  3:38 PM
deploying 839fcedef9483a1361846cf75eb5af8d95e86399 to staging
:thank:
2


root
APP  8:48 PM
ODS host fpd1529.sjc3b.square (pd-odsgroup381) is down
No action is needed from you. ODS oncall will try to successover metaclusters if they are active on this host.
Please see the #situation channel for more information.
apps affected: ledger
metaclusters affected for these apps:
- pd-mysql-ledger-008
Cc: 
@oncall

oncall
APP  8:48 PM
ODS host fpd1529.sjc3b.square (pd-odsgroup381) is down
No action is needed from you. ODS oncall will try to successover metaclusters if they are active on this host.
Please see the #situation channel for more information.
apps affected: ledger
metaclusters affected for these apps:
- pd-mysql-ledger-008
Cc: 
@oncall


jengel
:spiral_calendar_pad:  9:03 PM
Hey 
@oncall
, we saw an error when calling ledger listPendingBalances . Are there any known issues in production? Sentry


2 replies
Last reply 1 year agoView thread

oncall
APP  9:03 PM
Hey 
@oncall
, we saw an error when calling ledger listPendingBalances . Are there any known issues in production? Sentry
RuntimeException
error getting next deposits from ledger (see log for details)
SKEPTIC-PRODUCTION-49K8SKEPTIC-PRODUCTION-49K8 | Apr 24th, 2022 | Added by Sentry
Select Assignee...


andrewsantos
:palm_tree:  11:14 AM
Hi Ledger team!  I'm working on adding dispute support for our new Bill Pay product.  One outstanding question we have is regarding how to hold funds for our sellers in this product.  For most chargebacks, CBMS uses the create dispute endpoint, but I don't believe this will work for this new transaction because there is no ledger entry created.  Would anyone know if it would be technically possible to create a new endpoint in Ledger to hold funds even if there is no ledger entry?





27 replies
Last reply 1 year agoView thread


emilyl
  12:29 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-95619
(ledger @ 839fcedef94 to production)





13 replies
Last reply 1 year agoView thread


bhargava
  12:33 PM
was added to #ledger by emilyl
.


emilyl
  12:49 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


tochi
  1:17 PM
Hi 
@oncall
, I have a quick question regarding this deactivated seller 17NV97443D3T5. Their account was taken over and they received a loan deposited into their SQ checking account. The unit has now been deactivated but we would like to clear out the ledger balance without initiating an ACH.
My assumption is that simply creating a Capital CEFE for $3,800 (which will create a loan repayment Ledger entry of the same amount) will net out the current Ledger balance to $0 and no ACH debit will go out. Is this a correct assumption to make?

1 reply
1 year agoView thread

oncall
APP  1:17 PM
Hi 
@oncall
, I have a quick question regarding this deactivated seller 17NV97443D3T5. Their account was taken over and they received a loan deposited into their SQ checking account. The unit has now been deactivated but we would like to clear out the ledger balance without initiating an ACH.
My assumption is that simply creating a Capital CEFE for $3,800 (which will create a loan repayment Ledger entry of the same amount) will net out the current Ledger balance to $0 and no ACH debit will go out. Is this a correct assumption to make?


emilyl
  1:30 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


emilyl
  2:30 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass


emilyl
  4:01 PM
deploying ed005cda4ea (latest) to staging


wstewart
  11:58 AM
was added to #ledger by rartecona
.


emilyl
  12:10 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-95678
(ledger @ ed005cda4ea to production)



8 replies
Last reply 1 year agoView thread


emilyl
  12:25 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


emilyl
  1:01 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


emilyl
  1:52 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass


emilyl
  4:22 PM
deploying 3aa0897f59b (latest) to staging


emilyl
  5:23 PM
@acastberg
 why are you canarying to ledger staging? If you need to take over, please ask for permission from our oncall (edited) 



28 replies
Last reply 1 year agoView thread


emilyl
  6:11 PM
replied to a thread:
@acastberg why are you canarying to ledger staging? If you need to take over, please ask for permission from our oncall
@acastberg
 is taking over staging
View newer replies


emilyl
  12:23 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-95750
(ledger @ 3aa0897f59b to production)


6 replies
Last reply 1 year agoView thread


emilyl
  12:25 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


tochi
  12:25 PM
Hi all, I have a quick question about Ledger's retrying mechanism for ACH debit failures. As I understand it, Ledger will retry a ledger entry that failed with a "returned ledger entry" and will retry twice (or thrice?) before unlinking the customer's bank account. My question is will Ledger continue to retry the failed ACH debit if the customer should relink their bank account?





8 replies
Last reply 1 year agoView thread


emilyl
  12:52 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


emilyl
  2:01 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass
:rolling_kirby:
1



emilyl
  4:04 PM
deploying 8e61efe76d3 (latest) to staging


aferrante
  8:29 AM
:wave: hey team, we’re seeing some failed jobs in Skeptic due to gRPC call to squareup.ledger.service.DepositSettingService/GetDepositSchedule failed: INTERNAL: java.lang.IllegalStateException: 1) Each deposit cutoff must be at least an hour after the previous one (presidio trace). Can someone point me to how I can see the deposit schedules for a given merchant myself? Also, what deposit schedule is the error message referring to and how is it determined?


2 replies
Last reply 1 year agoView thread


cheister
  10:19 AM
oncall, can you do a canary deploy of ledger on java 17 for me?  https://github.com/squareup/java/pull/242284


4 replies
Last reply 1 year agoView thread


emilyl
  11:11 AM
deploying 75a2ae71267 (canary) to staging


emilyl
  4:04 PM
deploying 9b68b79911a (latest) to staging


dskarbek
  1:03 PM
deploying b9c7c61d709607919cd46a904ae8ce7b84db171e (latest) to staging


deni
  5:54 PM
deploying 641b736ef797ecc3285461f90357f0931cb9255e to staging


deni
  12:47 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-95909
(ledger @ 641b736ef79 to production)





12 replies
Last reply 1 year agoView thread


minghua
:bulb:  1:20 PM
fwd: New Flag: ledger/enable_payment_balances_payout_backfill working in staging. Enabling for Prod.


2 replies
Last reply 1 year agoView thread


dchung
:spiral_calendar_pad:  1:22 PM
Hello, can someone help me understand why a ledger entry could could take 11 days to settle after being created?
I’m looking at the entry with ledger_entry_token dtLTb4nOuKm1xy52pb-rfinTSOs . In capital, the ledger entry was created on Apr 8 but the settlement wasn’t recorded until 19th.


9 replies
Last reply 1 year agoView thread


deni
  1:32 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


deni
  1:58 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


andreyg
  2:36 PM
@oncall
 can I take over staging for ~1hr to do some testing?

1 reply
1 year agoView thread

oncall
APP  2:36 PM
@deni
 I take over staging for ~1hr to do some testing?

1 reply
1 year agoView thread


deni
  2:45 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass
:+1:
1



bgerson
:ooo_1:  3:03 PM
hi there - we've rolled out envoy SAFE enforcement of RPC traffic on staging, and ledger looks like it has a few missing routes according to these logs. can you add those to your route configurations?
we'll reach out soon about gradually increasing enforcement on prod - thank you!


andreyg
  3:47 PM
replied to a thread:
@deni I take over staging for ~1hr to do some testing?
done, I’ve reverted staging to the original SHA
:+1:
1



deni
  4:36 PM
deploying ef6d69376c2 to staging


deni
  6:04 PM
deploying 7f00147da91 to staging


ellenc
  12:45 AM
Hi team, I was directed to post this enquiry here
Background is, a seller processed a partial refund twice against this payment, so contacted to have one partial refund cancelled. As the option was still available to do so, the advocate initiated the rejection of 1 partial refund ($220). However the debit had already initiated against the seller's BA. I'm concerned this will cause an issue of multiple debits to the BA, I can see a debit from the seller's BA has already initiated for both refund amounts ($430.32 total). Do you know what will happen from here, do we need to freeze and place a debit block? Will the refund rejection trigger further debits given the change in amount?  Thanks in advance and apologies if this is not the correct channel :slightly_smiling_face:


4 replies
Last reply 1 year agoView thread


jensheng
:no_entry:  7:30 AM
hi team, im from #frameworks. We will be migrating feature service to launchdarkly soon and launchdarkly does not support getOverrides. Looking at the ledger/jobs/ClearUnscoredPaymentsJob.java repo, there's a function that calls getOverrides here but there is no override value in the feature service here. Is it ok if we remove the function? thanks!


deni
  12:05 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-95935
(ledger @ 7f00147da91 to production)





18 replies
Last reply 1 year agoView thread


deni
  12:15 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


deni
  1:01 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


deni
  1:54 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we're out on prod
deploy checks pass


deni
  4:08 PM
deploying 94fd7630c0e to staging


malonso
  6:04 PM
Hey, someone is reporting changes to the behavior in Regulator for the transfer data being displayed to agents. https://square.slack.com/archives/C022YKL0EUE/p1651624245046839 anyone aware of changes to ledger data?


cweber
Hi, I was pointed in the direction of this channel while looking into pending manual transfers on AU seller accounts, as discussed in this JIRA. You'll see an example on this account today. These transfers appearing as "Pending" in Regulator is new to me and the rest of the Advanced Support team in AU. I wanted to ask about when this change in reporting on the Dashboard was implemented, and anything else you can let me know about this!
Thread in regulator-help | May 3rd, 2022 | View message


3 replies
Last reply 1 year agoView thread


mgp
:baby:  6:40 PM
@oncall
 I’m deploying Ledger staging to sneak in a SPOOL change for tomorrow’s deploy… I’ll keep an eye on it :+1:

oncall
APP  6:40 PM
@oncall
 I’m deploying Ledger staging to sneak in a SPOOL change for tomorrow’s deploy… I’ll keep an eye on it :+1:
:ack-red:
1



4 replies
Last reply 1 year agoView thread


jensheng
:no_entry:  8:27 AM
bump. can someone pls take a look at this? thanks :)


jensheng
hi team, im from #frameworks. We will be migrating feature service to launchdarkly soon and launchdarkly does not support getOverrides. Looking at the ledger/jobs/ClearUnscoredPaymentsJob.java repo, there's a function that calls getOverrides here but there is no override value in the feature service here. Is it ok if we remove the function? thanks!
Posted in ledger | May 3rd, 2022 | View message


2 replies
Last reply 1 year agoView thread


ahdoot
:spiral_calendar_pad:  11:04 AM
:wave: ,
We’ve recently created a new bot, PayswingBot, that will post in channels when a payments swing is happening.
e.g. for swinging traffic: https://square.slack.com/archives/C1HG08E4S/p1651683184663309
e.g. for restoring normal traffic: https://square.slack.com/archives/C1HG08E4S/p1651686635830499
We’ve added it to #situation already, but wanted to put it out there in case y’all wanted to get notified here as well (we have it in our runbook to notify y’all on most payment swings anyways).
If y’all want to add it to this (or any other) channel, it’s as simple as mentioning PayswingBot in the channel and then adding it. And we’ll add it to the yaml files on Payswing’s end. (edited) 

PayswingBot
Evacuating payments traffic from WEST datacenters (swinging EAST) in production has been initiated by fgross
Posted in payment-acceptance (archived) | May 4th, 2022 | View message

PayswingBot
Restoring normal payments traffic (unswinging) in production has been initiated by fgross
Posted in payment-acceptance (archived) | May 4th, 2022 | View message
:+1::skin-tone-3:
1



deni
  12:04 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-96036
(ledger @ 1249c209071 to production)




11 replies
Last reply 1 year agoView thread


deni
  1:05 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


deni
  1:44 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


deni
  2:49 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we're out on prod
deploy checks pass


deni
  4:13 PM
deploying 39d37f1afeb to staging

PayswingBot
APP  9:22 AM
was added to #ledger by ahdoot
.


deni
  12:18 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-96102
(ledger @ 39d37f1afeb to production)


5 replies
Last reply 1 year agoView thread


deni
  12:32 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


deni
  1:12 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


deni
  2:16 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we're out on prod
deploy checks pass


markl
:spiral_calendar_pad:  3:26 PM
we (capital) just realized our failed payment logic isn’t reversing the ledger balance like it should be to net out the balance. Spot checking some transfers looks like the customers reached out to stop payments on transfers like:
https://regulator.sqprod.co/n/users/4FT3CQ0ZXB026/transfers/741a10db-5326-11ec-ab20-02420a140002?section=transfers
Does the failure reason mean that we don’t debit for this amount, or does it mean the transfer failed and the negative balance will net out against future transactions?




5 replies
Last reply 1 year agoView thread


deni
  3:58 PM
deploying b6dfa097da0 to staging


hoyi
  8:53 AM
@jhwang
 why did you freeze ERBGTH0D122YS in staging?


6 replies
Last reply 1 year agoView thread


jhwang
:spiral_calendar_pad:  8:54 AM
was added to #ledger by hoyi
.


emilyl
  5:14 PM
deploying 62c85c02bfb (latest) to staging (edited) 
:bless:
1



trandall
  5:21 PM
I have an MCA repayment that was effective on 5/3 at 11:35am PT was part of a series of payment and refunds. But the settlement of the final refund happened about 5 hours later than the settlement of the other parts that were effective at the same time.
Is anyone able to help me understand why this happened?

1 reply
1 year agoView thread


reilly
:headphones:  8:59 AM
Hi team, we have this ledger entry that shows in SENT state (via get_ledger_entry_settlement_state), but the most recent associated returned ledger entry transfer seems to be marked SUCCESS.  Is this original ledger entry expected to change to SETTLED soon since this most recent transfer occurred recently?


2 replies
Last reply 1 year agoView thread


reilly
:headphones:  10:54 AM
Hello again, can anyone help me find the customer ID for this transfer? The line is blank on the transfer page
https://regulator.sqprod.co/n/users/4FT3CQ0ZXB026/transfers/4e8ecdbd-8c46-4b53-aa19-24d4fd031240?section=ledger-entries
https://square.slack.com/archives/C0P2PV2JY/p1652111635720959


reilly
Hello :wave:  is there a way to confirm that we have actually received the funds from this transfer? https://regulator.sqprod.co/n/users/4FT3CQ0ZXB026/transfers/4e8ecdbd-8c46-4b53-aa19-24d4fd031240?section=ledger-entries
Thread in treasury | May 9th, 2022 | View message


15 replies
Last reply 1 year agoView thread


ahdoot
:spiral_calendar_pad:  11:27 AM
Hey 
@oncall
, following up today regarding a page that we received over the weekend during which RefundsArbiter was struggling to create a refund ledger entry for this refund: HN7hJNiZ0LC0PvNN4ggl73LJqQ7YY_J0GEKRP1auw9bM3Rj6tdN6P8QcyE2nCzT9Be4frEIlL
RQM, logs
It ultimately resolved itself after a while, but was there an issue going on with this payment on your end?



7 replies
Last reply 1 year agoView thread

oncall
APP  11:27 AM
Hey 
@oncall
, following up today regarding a page that we received over the weekend during which RefundsArbiter was struggling to create a refund ledger entry for this refund: HN7hJNiZ0LC0PvNN4ggl73LJqQ7YY_J0GEKRP1auw9bM3Rj6tdN6P8QcyE2nCzT9Be4frEIlL
RQM, logs
It ultimately resolved itself after a while, but was there an issue going on with this payment on your end?


bjoseph
  12:30 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-96225
(ledger @ 62c85c02bfb304ca661d159f157e5eb45bcf1605 to production)


9 replies
Last reply 1 year agoView thread


bjoseph
  12:37 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


bjoseph
  1:27 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


bjoseph
  2:22 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we're out on prod
deploy checks pass
:niiice:
1



reilly
:headphones:  2:24 PM
Sorry for spamming with questions but one more Q: we have this ledger entry that failed, so a RETURNED LEDGER ENTRY was created, which I can see here. The question is why were these created in December but never settled, is that because there is no linked bank or debit card?


2 replies
Last reply 1 year agoView thread


bjoseph
  3:59 PM
deploying 41114ecd57b to staging


jamoah
  6:10 AM
swinging payments from IAD for network maintenance

PayswingBot
APP  6:12 AM
Evacuating payments traffic from EAST datacenters (swinging WEST) in production has been initiated by jamoah


zlin
:spiral_calendar_pad:  9:26 AM
Hi team, I have this ledger call in staging for releasing credit risk reserves that look successful from the logs, but afterwards the ledger entry could not be seen in regulator and the ledger balance was not updated (current balance in Reserves section still showing $9.4 vs $0). Could someone help me understand why this is happening? cc: 
@yskhoo
 
@priyanka
 
@jthomas
:eyes:
1





13 replies
Last reply 1 year agoView thread


bjoseph
  12:11 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-96282
(ledger @ 41114ecd57bddeaeb0d62226ee280a7db929927c to production)
:+1:
4




9 replies
Last reply 1 year agoView thread


bjoseph
  12:23 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


bjoseph
  12:54 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


bjoseph
  1:45 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we're out on prod
deploy checks pass


senth
  2:03 PM
Taking over Ledger in staging for a canary test, will put the original SHA back on once I'm done.
LTaking


jamoah
  2:20 PM
unswinging payments from IAD after network maintenance

PayswingBot
APP  2:23 PM
Restoring normal payments traffic (unswinging) in production has been initiated by jamoah


kataria
  3:26 PM
Hi team, We found that https://regulator.sqprod.co/n/payments/1obcFMPkZQ1kDPpPeosFQBNRn6XZY this payment resulted  into 2 automated savings sweep (2 SFS folders). Is there a reason why we do not see a Bookkepper_adjustment here?
This is a Checking seller. CC: 
@abhishekg
@swapnil
 - do you know?


8 replies
Last reply 1 year agoView thread


bjoseph
  4:01 PM
deploying a8a163b1261 to staging


lance
  4:05 PM
Hi folks, in staging, we called ledger from tm-attribution (Presidio) to get the processing fee for a payment. At that time, the answer seems to have been $4.59, but in Regulator and RQM, the amount appears to be $5.28. Is it possible to figure out why this changed? Is this something that we expect to happen regularly in production?

1 reply
1 year agoView thread


senth
  5:02 PM
Taking over Ledger staging for about 30 mins for some testing, will put original SHA back on once I'm done

PayswingBot
APP  5:47 PM
Evacuating payments traffic from EAST datacenters (swinging WEST) in production has been initiated by rothlisberger

PayswingBot
APP  5:57 PM
Restoring normal payments traffic (unswinging) in production has been initiated by rothlisberger

PayswingBot
APP  5:51 AM
Evacuating payments traffic from WEST datacenters (swinging EAST) in production has been initiated by jamoah


janis
  8:57 AM
hello! could you help me understand our process of sweeping ledger and checking balances? looking at this user LVA02J1NJM9KW which too ach payment, then exited funds via sq card, and we also had a dispute open which drove ledger balance negative. the seller could continue exiting funds via sq card because the checking balance is positive while ledger balance is negative.


2 replies
Last reply 1 year agoView thread


zlin
:spiral_calendar_pad:  10:24 AM
replied to a thread:
Hi team, I have this ledger call in staging for releasing credit risk reserves that look successful from the logs, but afterwards the ledger entry could not be seen in regulator and the ledger balance was not updated (current balance in Reserves section still showing $9.4 vs $0). Could someone help me understand why this is happening? cc: @yskhoo @priyanka @jthomas
bringing up this thread again since I didn't get a result
View newer replies


bjoseph
  12:06 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-96329
(ledger @ a8a163b12616c07f7d7e6029d709d2b4eac587cb to production)




13 replies
Last reply 1 year agoView thread


bjoseph
  12:22 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


bjoseph
  12:55 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


mnovich
  1:29 PM
Can someone please approve a promotion request for API access. This is for Payouts migration
https://square-console.sqprod.co/app/ledger/security/route-permissions/promotion-requests
:stamp3:
1



kokazaki
:no_entry:  1:33 PM
Hi team - I have a seller that is having difficulty seeing the refund credit that was approved in regulator on 3/29/2022 (i.e. they'd like to know exactly when the funds were deposited and if they were bundled with daily deposits). Would there be anything we can provide that helps show that the refund was credited? (and where do refunds typically appear in seller's accounts?) Any guidance would be appreciated, thank you! 
@oncall

1 reply
1 year agoView thread

oncall
APP  1:33 PM
Hi team - I have a seller that is having difficulty seeing the refund credit that was approved in regulator on 3/29/2022 (i.e. they'd like to know exactly when the funds were deposited and if they were bundled with daily deposits). Would there be anything we can provide that helps show that the refund was credited? (and where do refunds typically appear in seller's accounts?) Any guidance would be appreciated, thank you! 
@oncall


pcarmichael
:ooo_1:  1:42 PM
Hi folks :wave:
My understanding is the Ledger is the source of truth for unit frozen state. If I would like to query the frozen state of a unit is this the correct method to do so?
https://prototype.sqprod.co/#/docs/squareup.ledger.service.GetFreezesRequest

1 reply
1 year agoView thread


bjoseph
  2:01 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we're out on prod
deploy checks pass


rafe
  2:37 PM
hello, just put up a PR (https://github.com/squareup/java/pull/244566) to update Ledger ACLs to allow a new Ledger entry feed consumer, payno. working on replacing the consumer in web with payno!
:stamp3:
1
:thank:
1


PayswingBot
APP  3:23 PM
Restoring normal payments traffic (unswinging) in production has been initiated by rothlisberger

PayswingBot
APP  3:48 PM
Evacuating payments traffic from WEST datacenters (swinging EAST) in production has been initiated by rothlisberger


bjoseph
  4:00 PM
deploying f3e4bfab96c to staging


tmahoney
  4:20 PM
:wave: if we (refunds API) wanted to write some code to query Ledger for cumulative amount of unlinked refunds that a merchant/unit has processed [maybe in the past N days], is there a suitable RPC we could call for that?



10 replies
Last reply 1 year agoView thread

PayswingBot
APP  9:02 AM
Restoring normal payments traffic (unswinging) in production has been initiated by jamoah


bjoseph
  11:48 AM
Taking over ledger staging with 52d4f6a698e


bjoseph
  12:18 PM
Done with ledger staging


jschaeffer
:ooo_1:  2:19 PM
Hi Team, not sure if this is the correct channel so feel free to direct me elsewhere if needed. I'm working with an Enterprise seller who is trying to figure out what account a deposit is associated too.
This file was not found.


5 replies
Last reply 1 year agoView thread


ramin
:spiral_calendar_pad:  3:08 PM
:wave: Hi, I'm hoping to have a ledger owner review this PR to add a new PayWithSquareEntryMethods (for Afterpay payments on Invoices):
https://github.com/squareup/java/pull/244713
#244713 Add PayWithSquareEntryMethods for Afterpay on Invoices
Context: Invoices is preparing to support Afterpay (online) payments. We were doing some testing on staging and noticed we need to add a new PayWithSquareEntryMethod:
https://square.slack.com/archives/C917J30J2/p1652129992327979
I modeled a lot of these changes after this recent change:  
#234618  
A few changes to eero I modeled after this other change:  
#214103
Labels
accounting-engineering
Comments
1
<https://github.com/squareup/java|squareup/java>squareup/java | May 11th, 2022 | Added by GitHub
:stamp3:
1
:thankyou:
1



bjoseph
  4:11 PM
deploying 65e68012d94 to staging


senth
  9:29 AM
Taking over Ledger staging for some testing, will put the original build back on once I'm done.


markl
:spiral_calendar_pad:  12:18 PM
@emilyl
 
@deni
 question about a ledger inbound transfer for merchant CENFVA5RVFGJS. We (capital) debited back the $1000.00 capital loan that ended up in their ledger processing balance after their checking was ATO DA’d. At the time, they had a $950.29 ledger balance, and we assumed our ($950.29) net debit amount would offset against that. However, it appears to have debited the seller’s BA in this transfer instead.
Our question is why didn’t the ($950.29) ledger entries offset against their ledger balance? Is it because the merchant was frozen at time we debited?
cc 
@benny
 
@marzan
 
@npadilla
 (edited) 




8 replies
Last reply 1 year agoView thread


cstatzula
  12:28 PM
was added to #ledger by marzan
. Also, achampa
 joined.


mqchen
  3:28 PM
@oncall
 list

oncall
APP  3:28 PM
Primary: @bta (Brian Ta), Secondary: @rartecona (Ryan Artecona) & @bta (Brian Ta) [Note: Call or page for emergencies!]


jschaeffer
:ooo_1:  4:06 PM
Hi Team, working with an Enterprise and they have a deposit that was sent through on their merchant token rather than the location token. They are trying to balance their books but since the funds were sent via their merchant token it's not showing in their dashboard. Would anyone know why the funds would be send via the merchant token and how best to explain that to the seller since there's no record on their dashboard? https://regulator.sqprod.co/n/merchants/ML5XD87A4MBS4
:eyes:
1
:checkmark:
1




6 replies
Last reply 1 year agoView thread


bta
  4:11 PM
deploying 294ad4c2bbe to staging


amuldowney
  4:38 PM
Hi friends, I have a small PR proposal to increase the poll rate for Ledger’s RiskState consumption, (5s to 1s), added some graphs to show the latencies we see regularly.
https://github.com/squareup/java/pull/244990
#244990 [Ledger] Magistrate RiskStateFeed poll rate to 1s from 5s
Ledger is often 5+ seconds behind on consumption, with weekly spikes past 10s. Ledger already listens to Esperanto at a 1s poll rate and Magistrate/Risk is sending the same volume of data. Also the utilization charts are extremely minimal.  
Screen Shot 2022-05-13 at 4 23 04 PM  
Screen Shot 2022-05-13 at 4 23 19 PM
Labels
accounting-engineering
Comments
1
<https://github.com/squareup/java|squareup/java>squareup/java | May 13th, 2022 | Added by GitHub (56 kB)
https://github.com/squareup/java/pull/244990

:eyes:
1
:checkmark:
1





11 replies
Last reply 1 year agoView thread

root
APP  2:35 AM
ODS host fpd1823.sjc3b.square (pd-odsgroup383) is down
No action is needed from you. ODS oncall will try to successover metaclusters if they are active on this host.
Please see the #situation channel for more information.
apps affected: ledger
metaclusters affected for these apps:
- pd-mysql-ledger-010
Cc: 
@oncall

oncall
APP  2:35 AM
ODS host fpd1823.sjc3b.square (pd-odsgroup383) is down
No action is needed from you. ODS oncall will try to successover metaclusters if they are active on this host.
Please see the #situation channel for more information.
apps affected: ledger
metaclusters affected for these apps:
- pd-mysql-ledger-010
Cc: 
@oncall


bta
  12:28 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-96496
(ledger @ 294ad4c2bbec2576b172fcd77db21cec7d01a61b to *production*)




7 replies
Last reply 1 year agoView thread


ramin
:spiral_calendar_pad:  12:31 PM
was added to #ledger by bta
. Also, rafe
 joined.


senth
  1:03 PM
Taking over Ledger staging to test with a canary build, will put the original one back on once I'm done in about an hour.


fadi
  1:23 PM
was added to #ledger by marzan
.


bta
  1:52 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


danielp
  2:46 PM
Hi Team, I’m working with an Enterprise seller who is trying to figure out what account a deposit is associated too. They have over 80+ accounts. See attached screenshot with transfer info.
This is going into a Wells Fargo account ending in 4384 according to the seller.
Screen Shot 2022-05-16 at 5.45.07 PM.png
 
Screen Shot 2022-05-16 at 5.45.07 PM.png
:eyes:
1
:checkmark:
1




6 replies
Last reply 1 year agoView thread


bta
  3:23 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we're out on prod
deploy checks pass


bta
  4:10 PM
deploying 92f1159b179 to staging


bta
  12:31 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-96551
(ledger @ 92f1159b17997de062a020c41e04a7881e7ef52e to production)


12 replies
Last reply 1 year agoView thread


bta
  12:48 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:chocobo-face: canary start
View newer replies


bta
  1:57 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


emilee
  2:10 PM
Hi Ledger team – I created a new freeze type a couple of months ago (PR). My team is getting a 404 when we call it, wondering if someone here could update the Ledger Envoy SAFE routes? Will add logs in the thread with more context
:eyes:
1
:checkmark:
1



8 replies
Last reply 1 year agoView thread


lishahe
:spiral_calendar_pad:  2:42 PM
@oncall
 can you please stamp this PR https://github.com/squareup/java/pull/243772? we rename the feeplan gateway bucket mapping and would like to deploy the change. Thanks!
#243772 Refactor gateway bucket converter and move the payment methods mappin…
…ng out of gateway name mapping
Labels
accounting-engineering
Comments
1
<https://github.com/squareup/java|squareup/java>squareup/java | May 3rd, 2022 | Added by GitHub
:eyes:
1
:checkmark:
1
:pray:
1


1 reply
1 year agoView thread

oncall
APP  2:42 PM
@bta
 you please stamp this PR https://github.com/squareup/java/pull/243772? we rename the feeplan gateway bucket mapping and would like to deploy the change. Thanks!


bta
  2:45 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we're out on prod
deploy checks pass


senth
  3:17 PM
Taking over Ledger staging to test with a canary build, will put the latest master SHA once I'm done in about an hour.


senth
  4:43 PM
Deploying staging Ledger with newer master SHA of 08d4b754906355383b8b6545f4e4900f689b51e1


senth
  5:42 PM
Doing one more staging deployment with newer SHA e8ce84148ec1000d6c36b9cb34480ba5cbe8f1df to pick up some changes


bta
  12:31 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-96612
(ledger @ e8ce84148ec1000d6c36b9cb34480ba5cbe8f1df to production)




7 replies
Last reply 1 year agoView thread


bta
  12:50 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:chocobo-face: canary start
View newer replies


bta
  1:25 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


bta
  2:27 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we're out on prod
deploy checks pass


bta
  4:06 PM
deploying 33ad590b51f (latest) to staging


behineh
:waning_crescent_moon:  5:40 AM
Hi, I'm trying to clear a suspicion on a seller (unit token: L673BJTD9NVG8). I think there might be a pending risk decision on a payment that isn’t being update. Can you tell me what payment token is suspected for this user so I can clear it? Many thanks!
:eyes:
1
:checkmark:
1



2 replies
Last reply 1 year agoView thread


rafe
  11:14 AM
hey folks, can you help me pull up a recent feed sync ID for ledger entries in staging and production? doesn't need to be exactly current, just trying to get payno (replacement for payment_notice emails in web) to start at the head of the Ledger entry feed so it doesn't cause a bunch of noise paging through old entries. right now our consumer does nothing, so it should be easy for us to blast through a few weeks of data, I just don't see a point in going through the full history :slightly_smiling_face:
:eyes:
1
:checkmark:
1



12 replies
Last reply 1 year agoView thread


bta
  4:14 PM
deploying 12984f465a1 (latest) to staging


mlevy
:spiral_calendar_pad:  7:23 AM
Did LEDGER.LEDGER__LEDGER_PRODUCTION.PENDING_BALANCE_SNAPSHOTS  run yesterday? The Risk SEV ETL is pending without new data, and it seems to be due to not getting the completion signal from ledger. Thanks!
:eyes:
1
:checkmark:
1



2 replies
Last reply 1 year agoView thread


rfutrell
  9:56 AM
Howdy folks! I have a ledger charge that failed with a No Account/Unable to Locate Account failure reason. I'm just looking for general info about how ledger handles retries internally? And are retries different if the user updates their bank account between retries?
:eyes:
1



7 replies
Last reply 1 year agoView thread


senth
  4:22 PM
Deploying Ledger staging with newer master SHA of 602d8dc81420395bdd3bd93eb8139ddfa546be75


tmahoney
  10:52 AM
hey Ledger folks :wave: kinda random question, but, does cashflow violation errors for Japan refunds due to disputes ring a bell as something you see somewhat regularly?
I noticed recently that our sync refund risk review library (which Pago+Omnibus call, before deciding to send a refund request to Esperanto) still uses a very outmoded means of checking for disputes on Japan payments — namely, it checks Ledger holds for the hashtag #jpcbinit. (correspondingly, there’s a very old TODO there about cleaning up that code “once JP disputes are in CBMS”. spoiler alert: they are, now.)
I kinda suspect that CS/risk-ops types aren’t even doing that magic hashtag thing anymore, thus I suspect this library is never successfully rejecting JP refunds where a chargeback has already occurred. If that’s true, then I think they’d be making it to Ledger and finally failing there, in Ledger’s cashflow violation.
so, just curious, any of this sound familiar to anyone here?





+1
25 replies
Last reply 12 months agoView thread


senth
  11:53 AM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-96722
(ledger @ 602d8dc81420395bdd3bd93eb8139ddfa546be75 to production)



7 replies
Last reply 1 year agoView thread


senth
  12:26 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:chocobo-face: canary start
View newer replies


senth
  1:06 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


senth
  2:09 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we're out on prod
deploy checks pass


senth
  4:40 PM
Deploying Ledger staging with latest master SHA of fed3216f62e62304de4d43d216f89f4308ae2787


senth
  8:46 AM
I'll be deploying canary build with SHA b50639cc0f70b040e0abd984268975c9313e69c1 to Ledger Sandbox to test settlement pipeline changes. The worse case impact is settlement pipeline breaking, but it's already not running in Sandbox anyways, so this won't make it any worse. (relevant ROLL ticket: https://jira.sqprod.co/browse/ROLL-96750)


ehenry
  11:56 AM
quick question (if this is the right place to ask): what is the difference between Captured and Successful when viewing Payments in Regulator?
:eyes:
1


1 reply
1 year agoView thread


senth
  12:08 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-96789
(ledger @ fed3216f62e62304de4d43d216f89f4308ae2787 to production)


6 replies
Last reply 1 year agoView thread


senth
  12:46 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


senth
  1:24 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


senth
  1:50 PM
Deploying RQM prod with 063a69f4651504a286ea1816938eefa2ce681eac , https://jira.sqprod.co/browse/ROLL-96794


2 replies
Last reply 1 year agoView thread


senth
  2:19 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we're out on prod
deploy checks pass

root
APP  2:40 PM
ODS host fpd1536.sjc3b.square (pd-odsgroup384) is down
No action is needed from you. ODS oncall will try to successover metaclusters if they are active on this host.
Please see the #situation channel for more information.
apps affected: ledger
metaclusters affected for these apps:
- pd-mysql-ledger-011
Cc: 
@oncall

oncall
APP  2:40 PM
ODS host fpd1536.sjc3b.square (pd-odsgroup384) is down
No action is needed from you. ODS oncall will try to successover metaclusters if they are active on this host.
Please see the #situation channel for more information.
apps affected: ledger
metaclusters affected for these apps:
- pd-mysql-ledger-011
Cc: 
@oncall


senth
  4:14 PM
Deploying Ledger staging with latest master SHA of aaa1024f14f0d4be7a16e5d827a575d544cd60f0


bforehand
  9:14 AM
Looks like there is some issue with regular AU merchant settlement that is causing an incorrect error mapping. Here's an example, ticket, but there are several more:
https://jira.sqprod.co/browse/SBT-239550



19 replies
Last reply 1 year agoView thread


senth
  11:45 AM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-96844
(ledger @ aaa1024f14f0d4be7a16e5d827a575d544cd60f0 to production)



6 replies
Last reply 1 year agoView thread


senth
  12:11 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


zifan
:spiral_calendar_pad:  12:43 PM
Hi team! I enabled file transmission for barclays in staging since they started supporting CAT environment for SUN testing. Changes of explicitly specifying SUN in files are behind this feature flag. This has been fully tested in Teller (both staging and prod) and now I want to test this with Ledger. Can anyone help me with the right process to generate test barclays transmission files (I need debit mandate, debit and credit) to check if SUN is set correctly? :messenger-thanks:



29 replies
Last reply 1 year agoView thread


senth
  12:54 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


mgp
:baby:  1:56 PM
@oncall
 I have some SHIFTs I’d like to run to add a table in MySQL:
staging: https://square-console.sqprod.co/app/ledger/databases/shift/request/17232
sandbox: https://square-console.sqprod.co/app/ledger/databases/shift/request/17233
prod: https://square-console.sqprod.co/app/ledger/databases/shift/request/17234
LMK when the deploy is done and I have the go-ahead to proceed? :bless:

oncall
APP  1:56 PM
@oncall
 I have some SHIFTs I’d like to run to add a table in MySQL:
• staging: https://square-console.sqprod.co/app/ledger/databases/shift/request/17232
• sandbox: https://square-console.sqprod.co/app/ledger/databases/shift/request/17233
• prod: https://square-console.sqprod.co/app/ledger/databases/shift/request/17234
LMK when the deploy is done and I have the go-ahead to proceed? :bless:


mgp
:baby:  1:56 PM
@oncall
 :point_up:

oncall
APP  1:56 PM
@senth
:point_up:
:eyes:
1



senth
  2:00 PM
Deployment completed, let me quickly run checks and i'll ping you back shortly


mgp
:baby:  2:01 PM
np — thanks


senth
  2:01 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we're out on prod
deploy checks pass


senth
  2:02 PM
@mgp
 you're good to go!

2 replies
Last reply 1 year agoView thread


senth
  5:03 PM
Deploying Ledger staging with latest master SHA of e75fdaa2fa9b755ebefc8016c270d34c3b71604f

1 reply
1 year agoView thread


senth
  5:48 PM
replied to a thread:
Deploying Ledger staging with latest master SHA of e75fdaa2fa9b755ebefc8016c270d34c3b71604f
Had to rollback as app is failing to start, following up here https://square.slack.com/archives/C0110GCEA3H/p1653525193093939


senth
  8:49 AM
Taking over Ledger staging for some testing, will put the build back once I'm done.


ahdoot
:spiral_calendar_pad:  11:58 AM
:wave:, we seem to have a bunch of refunds in RefundsArbiter staging that can’t be processed due to being unable to find the ledger entry corresponding to the token: https://presidio-ui.sqprod.co/search?search=application:refundsarbiter%20%22Processing%[…]unds%20failed%20for%20refund%22&instance=staging&window=1h
Some of these refunds were created over a month ago, plus we have retries on these calls out to Ledger, so this is a bit weird :hmm:
Could we get some help looking into this when y’all get the chance? :thank: (edited) 
:eyes:
1






64 replies
Last reply 1 year agoView thread


senth
  12:08 PM
Deploying Ledger sandbox with a canary build to fix an issue with one of the feeds (this way, we can avoid rollback of 2 days of prod deployment prior to long weekend), here's the ROLL ticket for more context: https://jira.sqprod.co/browse/ROLL-96882,


3 replies
Last reply 1 year agoView thread


mparmet
:spiral_calendar_pad:  1:00 PM
@rartecona
 
@dskarbek
 Back in April you spoke to me and some teammates in Payment Acceptance about the work you do in ledger to accommodate new payment methods like Afterpay. You said it wasn't much. I was mining Jira for some details. I found one 3-point Jira ticket with no details. Is that all there is? Was there maybe a roll plan for a DB change? I'm just trying to fill in some more of the story. (edited) 

1 reply
1 year agoView thread


markl
:spiral_calendar_pad:  5:06 PM
@mgp
 
@dskarbek
 
@emilyl
 (non-urgent) tagging you because I think you may know or know someone who would be able to answer this question. Capital is in currently scoping how we will migrate away from our bespoke assessment integration directly with ledger (via capital-events feed) to use Moneysweeper instead.
There’s a piece of code in ledger that looks back for 5min to see if there are any MCA_REPAYMENT ledger entries. In the Moneysweeper world, these ledger entries will cease to exist since we will no longer create the capital-events records, so I’m wondering if we need to port this code to use a different data point?
JooqLedgerEntryStore.java
  private boolean hasRecentAssessment(
      Id<Merchant2> merchantId) {
    DateTime captureCreatedAtBound = clock.currentDateTime().minus(CAPITAL_ASSESSMENT_LAG);

    // Look for the presence of a payment record with an MCA_REPAYMENT.
Show more
<https://github.com/squareup/java|squareup/java>squareup/java | Added by GitHub




14 replies
Last reply 1 year agoView thread


bjoseph
  10:59 AM
Deploying 7cff525d796  (latest) to staging


zlin
:spiral_calendar_pad:  2:03 PM
Hi team, I'm wondering if there is an SLA for the latency of async ledger update. Specifically I'm looking for the max time it could take from ledger call returns to the change get reflected on ledger balance. If it helps the entry type I care about is RISK_RESERVE_HOLD and RISK_RESERVE_RELEASE. cc: @credit-risk-engineering 
@jthomas


2 replies
Last reply 1 year agoView thread


hoyi
  3:15 PM
Doing an emergency deploy to try to get feed consumption lag under control: https://jira.sqprod.co/browse/ROLL-96951


hoyi
  4:51 PM
Deploying latest (cc4a7d1640b) to staging


bforehand
  5:21 PM
Need someone from accounting-eng to review this banking-partner change since it touches #ledger:
https://github.com/squareup/java/pull/246057


kkelly
:no_entry:  10:19 AM
Hey 
@oncall
, we're getting a few reports in the UK of sellers not yet receiving their transfers. Usually transfers in the UK is sent at 4pm and sellers will receive them around 6pm. There may not be any cause for concern yet since depending on the processing speed, sellers may not see them tomorrow but I just want to double-check that the transfer today went out okay and on time for the UK?
For vis, the sellers reporting this are:
LGF7A3A8DJRR4 — Starling Bank
LDXWD6Q8CM7FQ — Starling Bank
LDXWD6Q8CM7FQ - Starling Bank
:eyes:
1



6 replies
Last reply 1 year agoView thread

oncall
APP  10:19 AM
Hey 
@oncall
, we're getting a few reports in the UK of sellers not yet receiving their transfers. Usually transfers in the UK is sent at 4pm and sellers will receive them around 6pm. There may not be any cause for concern yet since depending on the processing speed, sellers may not see them tomorrow but I just want to double-check that the transfer today went out okay and on time for the UK?
For vis, the sellers reporting this are:
• LGF7A3A8DJRR4 — Starling Bank
• LDXWD6Q8CM7FQ — Starling Bank
• LDXWD6Q8CM7FQ - Starling Bank


ahdoot
:spiral_calendar_pad:  10:15 AM
I opened up a PR to Ledger to log the request/responses are for when we call CreateRefundLedgerEntry/CancelRefundLedgerEntry in the logs, if y’all don’t mind taking a look when you get the chance. RefundsArbiter is the only application that calls these two endpoints, per our understanding, so we don’t believe this will add any significant load log-wise. :prayforstamp:
#246241 Add request-response logging to Create/CancelRefundLedgerEntry RPCs
We'd like to see the request/response bodies for the CreateRefundLedgerEntry and CancelRefundLedgerEntry RPCs.  
RefundsArbiter is the only application that calls these two endpoints, per our understanding, so we don't believe this will add any significant load log-wise.
Labels
accounting-engineering
Comments
1
<https://github.com/squareup/java|squareup/java>squareup/java | May 27th, 2022 | Added by GitHub
:stamp3:
1
:thank:
1



ejamison
  10:17 AM
swinging payments east at 13:20 ET as part of the payments DR exercise. Payments will be unswung tomorrow. Please report any issues in #payment-dr

PayswingBot
APP  10:20 AM
Evacuating payments traffic from WEST datacenters (swinging EAST) in production has been initiated by ejamison


zifan
:spiral_calendar_pad:  2:14 PM
Hi team. Sorry for the late notification. barclays_specify_explicit_sun flag was turned on during 9:02AM ~ 9:05 AM PST today for the prod SUN specification tests. The flag is under teller but have impact on both teller and ledger BARCLAYS pipelines. (I guess no pipeline was scheduled for ledger during this window though)

1 reply
1 year agoView thread


bforehand
  3:02 PM
Can I get a review of this PR for switching WEB debits to use the correct ST (Standing) authorization code?
https://github.com/squareup/java/pull/246057


thanan
:knife_fork_plate:  4:26 PM
Hi team, I opened a PR to add reputationaide app to ACL of Ledger’s FeedSourceService ACL. reputationaide needs to consume Freezes feed to send SMS notification when the unit account is frozen (for CREDIT_RISK freeze type). Can I get a review for this PR? Thank you :thank:
#246451 [SHEALTH-124] ledger: add reputationaide to Ledger's FeedSourceService ACL.
SHEALTH-124
Add reputationaide to Ledger's FeedSourceService ACL to allow  
reputationaide to consume the Freezes feed.
reputationaide needs to consume the Freezes feed to send SMS  
notification when the Freeze is placed on the unit account.
Eng Design Doc: https://docs.google.com/document/d/1r4bduCTAlhkJTIWTEhM47TrwirMyseO5FiPi2Q7MXDg/edit#heading=h.ntuudif99zyx
Labels
accounting-engineering
Comments
2
<https://github.com/squareup/java|squareup/java>squareup/java | May 31st, 2022 | Added by GitHub
:stamp3:
1
:ty-bouncy-green:
1



senth
  5:03 PM
Deploying Ledger staging with latest master SHA of c8b7d93fc26606a66153dca574fc782c500469b2


thanan
:knife_fork_plate:  8:47 AM
Hi team, can I deploy the latest master (SHA a474b4b7fa297c28441a6cc0f947a370b9a16166) to staging? (cc 
@senth
)
:eyes:
1



hoyi
  9:03 AM
Deploying latest (7e01d524808) to staging


4 replies
Last reply 1 year agoView thread


hoyi
  11:11 AM
FYI Ledger is seeing some 500s caused by #situation #alert-10173_large_number_of_services_displaying_high_latency_and_500


emilyl
  11:13 AM
:information_source: Due to the above alert, ledger is temporarily pausing consumption of some feeds. We will continue to monitor and update as needed


hoyi
  11:24 AM
:information_source: We have resumed all feeds which we have paused


bastien
  11:59 AM
Hi team - a Strategic Seller had an issue within their custom app using ReaderSDK which caused a refund to be issued twice against the same payment (two partials). Can we cancel one of these? https://regulator.sqprod.co/n/payments/VW0JbHvVrdf9vU51lrE6PWeauaB


4 replies
Last reply 1 year agoView thread


douglaschau
  2:44 PM
qq: when we process a refund for a seller (i.e. https://jira.sqprod.co/browse/ONCALL-127464) how would the seller confirm that their refund was processed? (i.e. is it shown as a Bill in their Pricing & Subscriptions page?)





34 replies
Last reply 1 year agoView thread


zifan
:spiral_calendar_pad:  2:51 PM
Hi team, I’m going to turn on barclays_specify_explicit_sun flag in prod. This will impact ledger BACLAYS pipelines (specifying SUN field when generating transmission files). We do not expect any alerts/errors since this has been fully tested.


tianyu
  3:25 PM
Hi, may I get a deployment of Ledger please? My team fixed a metrics bug on Kafka Feeds and I want to use the fixed metrics to debug a performance related issue.
Thank you


hoyi
  4:17 PM
Deploying latest (a4f453a9362) to staging


bforehand
  4:28 PM
Bump on this PR review which impacts ledger:


bforehand
Can I get a review of this PR for switching WEB debits to use the correct ST (Standing) authorization code?
https://github.com/squareup/java/pull/246057
Posted in ledger | May 31st, 2022 | View message
:stamp3:
1



2 replies
Last reply 1 year agoView thread


douglaschau
  9:14 AM
replied to a thread:
qq: when we process a refund for a seller (i.e. https://jira.sqprod.co/browse/ONCALL-127464) how would the seller confirm that their refund was processed? (i.e. is it shown as a Bill in their Pricing & Subscriptions page?)
bumping this
View newer replies


thanan
:knife_fork_plate:  10:11 AM
Hi team, can I get the current feed cursor for freezes feed in both staging and production? Thank you!


3 replies
Last reply 1 year agoView thread


ericz
:spiral_calendar_pad:  1:03 PM
Restoring normal payment traffic (unswinging) at 4:10 PM ET as part of the payments DR exercise. Please report any issues in #payment-dr

PayswingBot
APP  1:11 PM
Restoring normal payments traffic (unswinging) in production has been initiated by ericz


hoyi
  1:32 PM
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-97108
(ledger @ a4f453a9362 to production)


5 replies
Last reply 1 year agoView thread


hoyi
  1:56 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-97108…
staging checks pass
:chocobo-face: canary start
View newer replies


hoyi
  2:19 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-97108…
Seeing an issue; rolling back :rollback_kirby:


jasonlee
  3:06 PM
hey team. Hoping this is the right place to ask - do you know what the data source is for payments-raw-production.feeds.ledger_entries_raw_records? Looks like this feeds data into the payments_dw.public.payment_revenue_fees table, the source for which I'm ultimately trying to understand (edited) 


2 replies
Last reply 1 year agoView thread


mnovich
  9:11 AM
@oncall
 are you planning to deploy staging today?

oncall
APP  9:11 AM
@hoyi
 you planning to deploy staging today?


kcrane
:coolfingergun:  9:49 AM
yee but usually later in the afternoon. is there something urgent you want out?


mnovich
  9:51 AM
nope. Just wanted to test something today


senth
  11:27 AM
:annouce: @here - just a heads up that we are planning on running Ledger DR exercise next Tuesday (6/7th) and Wednesday (6/8th). https://jira.sqprod.co/browse/ROLL-96973. Let us know here if you have any questions or concerns. Ledger didn't participate in Payment wide DR this week due to a SEV, so we're targeting the DR next week instead.
:+1::skin-tone-2:
1



3 replies
Last reply 1 year agoView thread


lugo
  11:34 AM
was added to #ledger by jschaeffer
. Also, mcapizzi
 joined.


kcrane
:coolfingergun:  4:19 PM
Deploying latest (0497f9376de) to staging

PayswingBot
APP  6:17 AM
Evacuating payments traffic from EAST datacenters (swinging WEST) in production has been initiated by davidsmith

PayswingBot
APP  11:05 AM
Restoring normal payments traffic (unswinging) in production has been initiated by davidsmith


kcrane
:coolfingergun:  1:14 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-97216
(ledger @ 0497f9376de to production)


5 replies
Last reply 1 year agoView thread


kcrane
:coolfingergun:  1:20 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:chocobo-face: canary start
View newer replies


kcrane
:coolfingergun:  1:53 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward


hoyi
  3:49 PM
Taking over ledger-staging


hoyi
  4:03 PM
releasing ledger-staging


bforehand
  4:36 PM
Would it be possible to get the largest merchant settlement amount for JPY merchants over the last year or similar? I'm assuming given we pay out for a full week in some cases this may be quite large for some JPY merchants. Pring is wanting to restrict us to 1M JPY per day per payee, so we need to know if this is too low of a limit or not.



12 replies
Last reply 1 year agoView thread


christianadam
  4:51 PM
@oncall
 hi, we have a need to update the mysql-connector due to a SEV0 from last week and ran into some issues with the cucumber tests. Could we get eyes on https://github.com/squareup/java/pull/246929/commits/662e1db67116a45468ec550bcbcaa38dccc477b1#?




20 replies
Last reply 1 year agoView thread

oncall
APP  4:51 PM
@kcrane
, we have a need to update the mysql-connector due to a SEV0 from last week and ran into some issues with the cucumber tests. Could we get eyes on https://github.com/squareup/java/pull/246929/commits/662e1db67116a45468ec550bcbcaa38dccc477b1#?
:eyes:
1



kcrane
:coolfingergun:  4:55 PM
Deploying latest (c4539086740) to staging


jameso
:spiral_calendar_pad:  7:04 AM
Hi all. Apologies if this is not the correct channel, but I was wondering if someone could help me understand why the debits (Inbound transfers) are failing on this Spanish account. Unit token: LDTE0QYNFGS7J
https://regulator.sqprod.co/n/users/LDTE0QYNFGS7J/transfers/627b762a-dd23-11ec-8a11-02420a0482f6
https://regulator.sqprod.co/n/users/LDTE0QYNFGS7J/transfers/1169a4f1-d6da-11ec-8a11-02420a0482f6
The debits by Square seem to be related to refunds by the Seller, however these refunds all appear to be successful, despite the debits failing, and the Sellers account being in a negative balance of €23,300.81
We now appear to be attempting to debit the Sellers bank account to value of €7,918.81 for further refunds that have been processed by the Seller, despite a current negative balance of €23,300.81. https://regulator.sqprod.co/n/users/LDTE0QYNFGS7J/transfers/114fd921-e4ff-11ec-8a11-02420a0482f6
I suspect this debit will also fail, and this will increase the negative balance on the Seller's Square account.
Can someone explain why the debits are actually failing, and why the refunds are not being rejected as a result of this? Are we only able to attempt to debit a Sellers bank account once for refunds processed by a Seller?
@hsilverio
 
@dcollins
 
@leah
 
@lpierrez
 fyi





9+
109 replies
Last reply 12 months agoView thread


senth
  11:17 AM
@here, just a heads up that the Ledger DR activities will begin shortly at 12:15 PM PT: https://jira.sqprod.co/browse/ROLL-96973


senth
:annouce: @here - just a heads up that we are planning on running Ledger DR exercise next Tuesday (6/7th) and Wednesday (6/8th). https://jira.sqprod.co/browse/ROLL-96973. Let us know here if you have any questions or concerns. Ledger didn't participate in Payment wide DR this week due to a SEV, so we're targeting the DR next week instead.
Posted in ledger | Jun 3rd, 2022 | View message
:ack:
4






+1
29 replies
Last reply 1 year agoView thread


cierraw
  12:43 PM
Hi Team! Is there any documentation/data dictionary on how Free Processing Adjustment fee type is calculated. It looks like payments_dw.public.payment_revenue_fees sources from Ledger but we just wanted to check if there are any calculations being done on the Ledger side

1 reply
1 year agoView thread


senth
  1:06 PM
replied to a thread:
@here, just a heads up that the Ledger DR activities will begin shortly at 12:15 PM PT: https://jira.sqprod.co/browse/ROLL-96973
FYI, Ledger has successfully failed over from sjc2b to iad2b as part of this DR exercise.
We will be resuming the unswing back to SJC2b tomorrow around the same time.
:+1::skin-tone-2::+1:
5

View newer replies


senth
  1:57 PM
Deploying a canary build to Ledger sandbox as part of https://jira.sqprod.co/browse/ROLL-97222


bforehand
  2:25 PM
replied to a thread:
Would it be possible to get the largest merchant settlement amount for JPY merchants over the last year or similar? I'm assuming given we pay out for a full week in some cases this may be quite large for some JPY merchants. Pring is wanting to restrict us to 1M JPY per day per payee, so we need to know if this is too low of a limit or not.
@oncall
: ping on this. Could I get an estimate for the largest single Japan merchant settlement. We need to know in the next few days if we need to push Pring on this amount (edited) 
View newer replies


kcrane
:coolfingergun:  4:27 PM
Deploying latest (8e7e8f7c95c) to staging


aferrante
  5:59 AM
:wave: hi team, fraud-risk-eng oncall here - could someone please look up all outstanding suspected payment tokens and their dates for unit 6EX0ZA2790WFZ? I’m expecting there to be at least one around 5/5 or 5/6 that hasn’t reached a terminal state
:eyes:
1






21 replies
Last reply 1 year agoView thread


senth
  11:04 AM
@here - heads up that we'll be resuming the Ledger DR activities to unswing the service back to sjc2b at 12:15 PM PT today: https://jira.sqprod.co/browse/ROLL-96973


senth
@here, just a heads up that the Ledger DR activities will begin shortly at 12:15 PM PT: https://jira.sqprod.co/browse/ROLL-96973
Thread in ledger | Jun 7th, 2022 | View message
:ack-rbg:
4


1 reply
1 year agoView thread


joelee
  11:31 AM
Hi, I got this oncall ticket concerning a refund that we're trying to figure out and it was suggested that I ask here - the refund looks complete from our end but it seems like something is preventing ledger from moving money, could someone take a look?
https://regulator.sqprod.co/n/payments/xK71GSOlhxDCPiJBmMceUfpGVNWZY
https://rqm.sjc2b.sqprod.co/index/payment#/query/payment/xK71GSOlhxDCPiJBmMceUfpGVNWZY




5 replies
Last reply 1 year agoView thread


senth
  12:58 PM
replied to a thread:
@here - heads up that we'll be resuming the Ledger DR activities to unswing the service back to sjc2b at 12:15 PM PT today: https://jira.sqprod.co/browse/ROLL-96973
Ledger has swung back to and active in sjc2b now. Let me know if anyone sees any issues. Metrics look good so far!


jqiu
  12:59 PM
Hello! I'm wondering if you know where we track custom close of day. Hoping to do some analysis on the UK sellers. Thank you!


4 replies
Last reply 1 year agoView thread


kcrane
:coolfingergun:  1:06 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-97313
(ledger @ 8e7e8f7c95c to production)


9 replies
Last reply 1 year agoView thread


kcrane
:coolfingergun:  1:12 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


kcrane
:coolfingergun:  1:56 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


kcrane
:coolfingergun:  3:09 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we're out on prod
deploy checks pass


kcrane
:coolfingergun:  4:41 PM
Deploying latest (e48f8ef6cae) to staging


fernandoa
:no_entry:  2:11 AM
was added to #ledger by jameso
.


eyung
  3:47 AM
:wave: I pushed out a small PR to make expiration dates optional in LinkCardV2 in order to support visa plus cards in Canada. Technically this is an endpoint that we own, but looks like I’ll need a stamp from a ledger owner anyways. Would appreciate a look from anyone here, thanks! https://github.com/squareup/java/pull/247288


jameso
:spiral_calendar_pad:  4:36 AM
Hi All, is there any chance anybody could help with this on the Ledger side? https://square.slack.com/archives/CAMN0UWMS/p1654610698710959


jameso
Hi all. Apologies if this is not the correct channel, but I was wondering if someone could help me understand why the debits (Inbound transfers) are failing on this Spanish account. Unit token: LDTE0QYNFGS7J
https://regulator.sqprod.co/n/users/LDTE0QYNFGS7J/transfers/627b762a-dd23-11ec-8a11-02420a0482f6
https://regulator.sqprod.co/n/users/LDTE0QYNFGS7J/transfers/1169a4f1-d6da-11ec-8a11-02420a0482f6
The debits by Square seem to be related to refunds by the Seller, however these refunds all appear to be successful, despite the debits failing, and the Sellers account being in a negative balance of €23,300.81
We now appear to be attempting to debit the Sellers bank account to value of €7,918.81 for further refunds that have been processed by the Seller, despite a current negative balance of €23,300.81. https://regulator.sqprod.co/n/users/LDTE0QYNFGS7J/transfers/114fd921-e4ff-11ec-8a11-02420a0482f6
I suspect this debit will also fail, and this will increase the negative balance… Show more
Thread in ledger | Jun 7th, 2022 | View message


xinlin
:spiral_calendar_pad:  6:54 AM
Hi folks, I have a question about ACH debit for this payment. It looks like there is a open_dispute  ledger entry on 3/13/22 and the debit is successful. And there is another open_dispute  ledger entry for the same payment on 5/30/22, which is also successful. Since the first debit is successful, I am wondering why ledger started the 2nd one for the same dispute? Thank you!


7 replies
Last reply 1 year agoView thread


luisp
  9:00 AM
hello team! I’m Luis Perez TPM for the financial crimes technology team, I have a request from our Sanctions team to “OFAC hold” some identified transactions from RU issued banks (more details in this ticket) however the closest thing we have to hold these transactions and transfer the funds to a new account would be to make an adjustment on the overall balance, causing the transactions to be shown in regulator under the ledger section as “settled” when in fact they weren’t. e.g. I’m a merchant with $100 in funds pending settlement (currently frozen) and there’s one $32.12 transaction we need to hold, we would execute a negative adjustment and when the merchant’s balance is unfrozen only $67.88 will be settled. Do you see an issue (or know of someone who might) with the transaction to be shown as settled if reviewed in regulator:
ledger entries.png
 
ledger entries.png


4 replies
Last reply 1 year agoView thread


jqiu
  9:14 AM
bump^


jqiu
Hello! I'm wondering if you know where we track custom close of day. Hoping to do some analysis on the UK sellers. Thank you!
Posted in ledger | Jun 8th, 2022 | View message
:eyes:
1



cherry
:spiral_calendar_pad:  12:40 PM
@oncall
 trying to debug (some) payments that didnt get its risk_review_state updated and am seeing these type of warnings on presdio Truncated incorrect DOUBLE value: '1wvigW1M9DW1P8Z9Me6Siesp4yGZY' wanted to see if this is a concern/red herring, thanks :thanks_so_much:


10 replies
Last reply 1 year agoView thread

oncall
APP  12:40 PM
@kcrane
 to debug (some) payments that didnt get its risk_review_state updated and am seeing these type of warnings on presdio Truncated incorrect DOUBLE value: '1wvigW1M9DW1P8Z9Me6Siesp4yGZY' wanted to see if this is a concern/red herring, thanks :thanks_so_much:


kcrane
:coolfingergun:  1:08 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-97377
(ledger @ e48f8ef6cae to production)
:+1::+1::skin-tone-3:
2
:stamp3:
2



7 replies
Last reply 1 year agoView thread


kcrane
:coolfingergun:  1:09 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


kcrane
:coolfingergun:  1:44 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


marlon
:ooo_1:  1:50 PM
Hello, my team is running into an odd negative ledger balance situation and I was hoping to speak to someone who has experience working with our settlements/ledger system: https://jira.sqprod.co/browse/ONCALL-135514 - Is this the right place for someone to help investigate what's going on?
:resolved2:
1



kcrane
:coolfingergun:  3:06 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we're out on prod
deploy checks pass
:hands-up:
1
:+1:
1



kcrane
:coolfingergun:  4:13 PM
Deploying latest (cb740da9676) to staging


bjoseph
  9:08 AM
taking over ledger staging for a bit


bjoseph
  9:17 AM
releasing ledger staging


kanagawa
:spiral_calendar_pad:  9:40 AM
hi - I'm from the accounting team and working with 
@laurenp
 
@svanbrunt
 
@jyue
 on ALERT 9923 related to the payroll tip reimbursement issue
Our understanding is that the current proposal is to refund through the Credit Adjustment tool in Regulator (screenshot below)
I'm trying to determine how this will be accounted for. Does anyone know if this tool works the same way as free processing adjustments (i.e. it goes through ledger)?
image.png
 
image.png
:checkmark:
1




6 replies
Last reply 1 year agoView thread


laurenp
:baby:  9:40 AM
was added to #ledger by kanagawa
. Also, svanbrunt
 and jyue
 joined.


andreyg
  4:03 PM
deploying 73d6b42301e (latest master) to staging (edited) 
:atlassian_error:
1



10 replies
Last reply 1 year agoView thread


andreyg
  4:35 PM
deployment has failed, I’ve rolled back to the Thursday’s build


andreyg
deploying 73d6b42301e (latest master) to staging (edited) 
Thread in ledger | Jun 10th, 2022 | View message


andreyg
  6:41 PM
deploying 9fe25866c88 (latest master) to staging
:checkmark:
1



andreyg
  12:21 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-97468
(ledger @ 9fe25866c88 to production)



10 replies
Last reply 1 year agoView thread


andreyg
  1:01 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


andreyg
  1:40 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


andreyg
  2:21 PM
replied to a thread:
Ledger ROLL:…
production deploy checks fail (HA metrics issue)
:build-failed: rolling back
View newer replies


andreyg
  3:08 PM
replied to a thread:
Ledger ROLL:…
:green: we’re rolled-back on prod
deploy checks pass


andreyg
  4:06 PM
deploying dc5b7850edc to staging
:checkmark:
1



hoyi
  2:21 AM
set the channel topic: ALERT-10239 | Discussion for https://registry.sso.global.square/apps/ledger | Contact @oncall for questions | Emergency page the entire team: https://go/ledger911


dpochowski
  6:56 AM
was added to #ledger by ncunningham
.


zijun
:spiral_calendar_pad:  7:02 AM
Hi everyone! Good morning! I hope to ask 2 questions to understand the flow of chargeback debit better.
In case of a seller who has only the ledger account (no external bank linked), if there is no/negative balance when we try to debit money from their ledger account, do we directly count that as a failed debit?
If a seller has ledger and also SQ checking/saving (no external bank linked), how does the chargeback debit work in this case? Is it also from ledger first and then SQ checking/saving? Will debiting from SQ checking/saving different from external bank?
Thank you!
FYI 
@nan
 
@nmavani
:checkmark:
1




12 replies
Last reply 1 year agoView thread


njain
  7:44 AM
Hi team, this morning between 2:18am-2:34am PT we saw delay in processing of Capital Feed Events by ledger. Was there any issue going on with Ledger at the time that would explain this?
:checkmark:
1


1 reply
1 year agoView thread


xz
  8:20 AM
Hi team, could you help check if this nightly settlement was sent to the bank? ~20 sellers have contacted about their nightly settlement not show up on the bank while they are “success” status in dashboard / regulator. Examples: AV0SB46SEZBQ8, NDZXFQDAAMQH3 (edited) 
:sub:
1
:checkmark:
1



2 replies
Last reply 1 year agoView thread


nkaspi
  8:54 AM
was added to #ledger by charlesyu
.


smartin
  9:32 AM
@oncall
 Can I take over staging for testing?

oncall
APP  9:32 AM
@oncall
 Can I take over staging for testing?


andreyg
  9:33 AM
@smartin
 :+1:
:thank:
1



smartin
  9:36 AM
Deploying d303430 to staging
:done:
1


1 reply
1 year agoView thread


hoyi
  10:05 AM
FYI swapping over from the webMerchantFeed to the new seller-bank-account-link-events feed.  In theory, there should be no impact, but if you see issues wth bank accounts being linked, let us know


ewaller
  10:57 AM
Hi team, I put up a PR that adds two new entry methods for virtual terminal, TERMINAL_QR_CODE, and TERMINAL_REDIRECT. Was wondering if I could get sign off from someone on this team to verify that things look good.
https://github.com/squareup/java/pull/247654
#247654 Add support for new entry methods TERMINAL_QR_CODE and TERMINAL_REDIRECT
These changes are so the product can be sent to TERMINAL instead of ECOMMERCE_API for afterpay and cashapp payments that run through virtual terminal -> square online checkout
TERMWEB-4713
Labels
accounting-engineering
Comments
2
<https://github.com/squareup/java|squareup/java>squareup/java | Jun 13th, 2022 | Added by GitHub


hoyi
  11:04 AM
set the channel topic: Stable | Discussion for https://registry.sso.global.square/apps/ledger | Contact @oncall for questions | Emergency page the entire team: https://go/ledger911


jagarbut
  12:18 PM
Hi folks I have a random question: is there any plan to migrate the freeze feed to kafka feeds?

1 reply
1 year agoView thread


andreyg
  12:31 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-97541
(ledger @ dc5b7850edc to production)





14 replies
Last reply 1 year agoView thread


andreyg
  1:05 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


senth
  1:08 PM
Taking over Ledger staging for an hour, will put the original SHA back on when I'm done.
:greendone:
1



andreyg
  1:41 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


andreyg
  2:43 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass


andreyg
  4:08 PM
deploying 7199aac04f9 to staging
:checkmark:
1



nan
:spiral_calendar_pad:  7:44 AM
Hi Team, I have some questions regarding to seller balance and debit amount. Hope you can help me to understand the reason behind the debit amount.
First case: debit amount is different as negative balance https://regulator.sqprod.co/n/users/3PVVAZ2H7NN57?section=transfers
Second case: seller has negative balance but not debit
https://regulator.sqprod.co/n/users/LVP64H4DW3XJ8?section=transfers
Third case: no negative balance in regulator but ledger table shows a negative balance. The debit amount is different as negative balance
https://regulator.sqprod.co/n/users/3ECPKHVD65Q0X?section=transfers
:eyes:
1





9 replies
Last reply 1 year agoView thread


andreyg
  11:49 AM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-97609
(ledger @ 7199aac04f9 to production)

6 replies
Last reply 1 year agoView thread


andreyg
  12:37 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


andreyg
  1:14 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


andreyg
  2:20 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass


acastberg
  2:20 PM
:blob-wave: hey from transfers looking to deploy a canary on staging, is the ledger deploy finished?
:+1:
1



15 replies
Last reply 1 year agoView thread


andreyg
  5:12 PM
deploying a0dae0359bc to staging
doing 50% rollout to speed up and finish by 5:30
:checkmark:
1



mnovich
  1:32 PM
Hey everyone. I'm getting a 504 when calling:
GetSettlementJobAmountPercentiles
 in InternalSettlementService any idea why? (edited) 
:checkmark:
1




4 replies
Last reply 1 year agoView thread


skaltenbach
  1:57 PM
:wave: Hey team - I have a PR for some Change Request related refactoring that touches a little bit of ledger code.  Not urgent at all, just a nice to have - would appreciate an ActEng review when possible :thank:
:eyes:
2




9 replies
Last reply 1 year agoView thread


andreyg
  4:06 PM
deploying 3261798ddb8 to staging
:checkmark:
1



xz
  4:31 PM
Hi team, could you help investigate why this seller’s 6/15 payments are scheduled to be deposited on 6/16, i.e. nightly settlement batch seem to have 1 day delay for payments on 6/15 and 6/16?
:eyes:
1






+1
20 replies
Last reply 1 year agoView thread


mparmet
:spiral_calendar_pad:  10:57 AM
As we're working our PR to remove the old edje PaymentRecord, a question came up about support for "legacy refunds". Does anyone know, is this method isLegacyFullRefund effectively dead code and always false? https://github.com/squareup/java/blob/master/settlements/ledger/src/main/java/com/[…]umers/payments/processors/CardRefundPaymentRecordProcessor.java
CardRefundPaymentRecordProcessor.java
  private boolean hasLegacyFullRefund(PaymentRecord record) {
    PaymentToken paymentToken = PaymentToken.of(record.getPaymentId());

    // Legacy refund does not have the refund UUID in its external source.
    ExternalSourceProtos.ExternalSource externalSource = ExternalSourceHelper.fromNameIdList(
Show more
<https://github.com/squareup/java|squareup/java>squareup/java | Added by GitHub

1 reply
1 year agoView thread


bastien
  12:08 PM
was added to #ledger by xz
.


mengen
  4:24 PM
deploying 092fe74b471f2dc0608ae1845faf2b00c40960f4  to staging


ehennenfent
  7:13 PM
Hi, the privacy infrastructure team is planning to perform disaster recovery (DR) exercises for consentsys and privacyvault starting Thursday, June 23rd at 11am PT. We’ll be swinging all traffic from SJC to IAD, then swinging back 24 hours later. We expect a short period of increased latency and possibly some 500’s as we transition between datacenters. For more details, please see our DR Plan
You’re receiving this notice because one or more of your services lists privacyvault and/or consentsys as a dependency. For specifics, please see this spreadsheet.
Please consider sending a representative to #privacy-eng during the exercise, where we’ll be posting real-time updates. Don’t hesitate to reach out to me or our oncall if you notice anything unusual.
:ack-green:
1



agoldsmith
  9:30 AM
:wave: I’ve been tagging Ryan Artecona on tickets related to Ledger SOX compliance and haven’t gotten a hold of him (looks like he’s no longer at the company). Who is a good EM for me to use as a point of contact for these things going forward? Thanks in advance for any help, we are overdue on the review of 2 months worth of these SOX items so would appreciate a response today :heart:



5 replies
Last reply 1 year agoView thread


tmahoney
  11:25 AM
not sure if this is the best channel to ask this in, but, what happens generally when a seller’s balance goes negative, and there’s no linked bank account so nightly settlements can’t settle out to zero (i.e. the seller continues to owe SQ money)?
also how common is this? do we generally have checks today that prevent that from happening?



14 replies
Last reply 1 year agoView thread


douglaschau
  12:04 PM
hey team, re: https://square.slack.com/archives/CAMN0UWMS/p1654282403465479?thread_ts=1654119867.120229&cid=CAMN0UWMS
thanks for processing the first set of adjustments :thankx: i just created a second ONCALL ticket with the same instructions and script that was run from the first time. I know this get’s triaged to 
@oncall
 but was wondering if we could possibly get this next set of adjustments run in the next 2 days because sellers are getting a weary of when then their reimbursements will be processed.




5 replies
Last reply 1 year agoView thread


mengen
  12:27 PM
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-97789
(ledger @092fe74b471 to production)




21 replies
Last reply 1 year agoView thread


sborden
:ooo_1:  12:58 PM
:meow-wave: - I'm looking to find (in snowflake) all sellers who currently have > $0 in their Square balance; a couple of questions:
Is ledger.raw_oltp.pending_balance_snapshots the right table to find this (e.g. filtering for outstanding_amount_cents > 0)?
If so, the snapshot language makes me think I need some "is current snapshot" filter? Can you point to how best I can filter for the latest/current snapshot?
Does ledger in general "play nicely" with all the different products the #banking team is building out (Square Card, Checking, Savings, etc.)?


9 replies
Last reply 1 year agoView thread


mengen
  1:16 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-97789…
staging checks pass
:canary: canary start
View newer replies


mengen
  1:59 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-97789…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


mengen
  3:05 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-97789…
:shipitparrot: we’re out on prod
deploy checks pass
:tada:
2



mengen
  4:44 PM
deploying f796412d213 to staging


jensheng
:no_entry:  6:42 AM
hi team, im from #frameworks. We will be migrating feature service to launchdarkly soon and launchdarkly does not support getOverrides. Looking at the ledger/jobs/ClearUnscoredPaymentsJob.java repo, there's a function that calls getOverrides. here's the guide on how to copy the flags over to LD: http://go/ld-get-overrides


4 replies
Last reply 1 year agoView thread


tmahoney
  11:36 AM
:wave: small PR here to prevent Ledger entries from being created for unlinked refunds to gift card: https://github.com/squareup/java/pull/248477
a bit more context in PR desc. if any Ledger experts could read that and make sure I’m not making any faulty assumptions, I’d appreciate it :bless:
#248477 [ledger] ignore unlinked refunds to gift card
when testing unlinked-refunds-to-gift-card in prod the other day, I noticed that my seller balance went negative, because Ledger created an entry for it:  
https://regulator.sqprod.co/n/users/GG54ETAKZJMT2?section=ledger-entries
but, I don't think that should happen? if I'm a seller, and someone returns an item worth $20 (and they bought it before I adopted Square so it's an unlinked refund), and I issue them a $20 gift card in exchange, then there's not really any money movement. they gave me a $20 item, I gave them a $20 voucher for other items, we're even. no Ledger entry should happen, no?
so this PR should prevent that.
Labels
accounting-engineering
Comments
1
<https://github.com/squareup/java|squareup/java>squareup/java | Jun 22nd, 2022 | Added by GitHub
:eyes:
1
:stamp:
2





26 replies
Last reply 12 months agoView thread


mengen
  12:20 PM
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-97861
(ledger @f796412d213 to production)





+1
26 replies
Last reply 1 year agoView thread


mengen
  12:58 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-97861…
staging checks pass
:canary: canary start
View newer replies


mengen
  1:34 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-97861…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


mengen
  3:25 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-97861…
:shipitparrot: we’re out on prod
deploy checks pass
View newer replies


mengen
  4:14 PM
deploying 64a37816158 to staging


fernandoa
:no_entry:  9:58 AM
Hi team, posting this message here in case somebody is able to help me figure out. Those three type of payments come out daily from our Seller account at Barclays EU x8302 and they represent the credits to our merchants. Would anybody be able to explain why they are split in three and not in only one payment batch? Thanks!


fernandoa
Hi team, I am trying to figure out several transfers’ descriptions from our Barclays bank accounts in Germany.  Taking into account the descriptions are barely identifiable, would anybody in the team be able to recognise the type of flow? In general, they would be our daily batched payouts to sellers from our x8302 Barclays account but, would you  know why we process three batches a day and what is the reason for the split?  See examples bellow:
This file was not found.
Thread in banking-connections | Jun 21st, 2022 | View message



14 replies
Last reply 1 year agoView thread


coglander
  10:32 AM
Hi team i have 2 credit balance adjustments i submitted on the 16th and I wanted to see progress on the approval! If this is not the right channel please let me know where to go :slightly_smiling_face: Case 1 and Case 2 $379.54 each
:eyes:
1



2 replies
Last reply 1 year agoView thread


pbastos
  12:47 PM
Hi Team, I have a seller that had a transfer sent to a different account that they don’t own. They are not familiar with this account number and is the first time this happened. Can someone take a look please?



13 replies
Last reply 1 year agoView thread


mengen
  1:00 PM
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-97964
(ledger @64a37816158 to production)





17 replies
Last reply 1 year agoView thread


mengen
  1:07 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-97964…
staging checks pass
:canary: canary start
View newer replies


mengen
  1:31 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-97964…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


mengen
  2:35 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-97964…
:shipitparrot: we’re out on prod
deploy checks pass
:party-furby:
1



cheister
  5:08 PM
Can someone help me with a canary deploy of a jemalloc update for ledger to staging? https://github.com/squareup/java/pull/248726 and artifact ledger_el7_37e0d91ab62e2cbd339533f836167e7f869e4cf2.tar.gz (edited) 



11 replies
Last reply 1 year agoView thread


mengen
  5:08 PM
deploying 0d247b3d767 to staging


rafe
  9:19 AM
hello, could someone grab a recent feed sync ID for the ledger entry feed in production? I thought I set up the payno consumer to consume from the HEAD of the feed but I guess not :sads:
:thankss:
1



3 replies
Last reply 1 year agoView thread


minghua
:bulb:  2:42 PM
replied to a thread:
Can someone help me with a canary deploy of a jemalloc update for ledger to staging? https://github.com/squareup/java/pull/248726 and artifact ledger_el7_37e0d91ab62e2cbd339533f836167e7f869e4cf2.tar.gz
deploying canary 37e0d91ab62 to staging
View newer replies


minghua
:bulb:  3:59 PM
deploying 62da8dc78cb to staging


yelson
:spiral_calendar_pad:  7:25 AM
Hi team, we would love to get some help to understand what fee_type = UNDO means in payments_dw.public.payment_revenue_fees table.
cc. 
@vinicius
image (2).png
 
image (2).png
:eyes:
1
:checkmark:
1



2 replies
Last reply 1 year agoView thread


mparmet
:spiral_calendar_pad:  8:48 AM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-97861…
By now it looks like this version you deployed is stable and unlikely to be rolled back. If that's the case I will continue the code cleanup I was doing in payments libraries.
:+1:
3



pcarmichael
:ooo_1:  10:18 AM
Hi Team :wave:
Could someone please provide a recent Ledger Freeze Feed cursor token from production? (edited) 
:eyes:
1
:checkmark:
1





7 replies
Last reply 1 year agoView thread


vinicius
  11:58 AM
was added to #ledger by yelson
. Also, yingxi
 joined.


bjoseph
  12:04 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-98081
(ledger @ 62da8dc78cbc21c783d60c585132b69f381a6e56 to production)



8 replies
Last reply 1 year agoView thread


bjoseph
  12:39 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


bjoseph
  1:09 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


bjoseph
  2:14 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we're out on prod
deploy checks pass


bjoseph
  3:59 PM
deploying 5b80e018cc4 to staging


lugo
  6:57 AM
MT MLQ2A39JJC072 Strategic Account Hi Team! I was directed to this room. Deposit Inquiry: Seller wants to know why payments collected on 6/19 are showing up on two separate transfers via the dashboard > balance
$12,790.26 Transfer - 6/21.  Shows payment collected 6/20 and 6/19
6/19 payments not showing up via reg Ledger Entries section JIRA https://jira.sqprod.co/browse/ONCALL-136185
:eyes:
2
:checkmark:
1



7 replies
Last reply 1 year agoView thread


zijun
:spiral_calendar_pad:  10:54 AM
Hi team. Does anyone know if the following tables have payment_token?
ledger.raw_feeds.bank_settlement_entry
ledger.raw_feeds.bank_settlement_return
Thanks!
:eyes:
1
:checkmark:
1



4 replies
Last reply 1 year agoView thread


bjoseph
  12:04 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-98146
(ledger @ 5b80e018cc43b32aaea0172f4d1570e4b2acc1cc to production)




19 replies
Last reply 1 year agoView thread


bjoseph
  12:26 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


bjoseph
  1:16 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


ewaller
  1:42 PM
Hi team, virtual terminal has gotten some feedback from risk that we need to make calls to ledger to figure out if a merchant is frozen. I put in a request in registry for terminal to get access to the ledger app so we can hit that endpoint, was wondering if someone here is able to approve? https://registry.sqprod.co/app_dependency_requests/23364
:eyes:
1
:checkmark:
1




5 replies
Last reply 1 year agoView thread


bjoseph
  2:15 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we're out on prod
deploy checks pass


prabhjot
:no_entry:  3:44 PM
Hey team, I have a PR that touches ledger code and updates the PSS feed to include transfer tag/deposit tag, would appreciate your review - https://github.com/squareup/java/pull/249017
:eyes:
1
:speech_balloon:
1



bjoseph
  4:00 PM
deploying dca693ce62b to staging


bjoseph
  12:16 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-98210
(ledger @ dca693ce62bba651e309c1f4396aa678238a9eec to production)



7 replies
Last reply 1 year agoView thread


bjoseph
  12:22 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


bjoseph
  12:57 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


bta
  1:31 PM
Taking over ledger staging with a canary for ~30min

1 reply
1 year agoView thread


bjoseph
  1:53 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we're out on prod
deploy checks pass


bta
  4:10 PM
deploying c913ff0839fb26a22ef072c305e76b6fe394cac3 to staging
:bless:
1



cpopescu
:spiral_calendar_pad:  6:47 PM
Hi folks, can you share what is the process to set up a new Square owned magic merchant that is exempt from the settlement process in Ledger? cc 
@carrie



9 replies
Last reply 1 year agoView thread


carrie
  9:57 AM
replied to a thread:
Hi folks, can you share what is the process to set up a new Square owned magic merchant that is exempt from the settlement process in Ledger? cc @carrie
:wave: hi, can anyone help with this question? i’m the PM for the new Bill Pay/ Accounts Payable product. and we are looking into the right process to set up a new Square owned magic merchant so that sellers can pay into Square, for us to then deliver the payment to their vendors. we need to bypass the Ledger settlement process, i.e., when a seller pays us $100, we get $100, and are not charged the Square processing fee. thanks a lot for your help!
View newer replies


bta
  12:32 PM
Taking over ledger staging with a canary for a bit

1 reply
1 year agoView thread


ewaller
  1:34 PM
hi team, was wondering if ledger was planning to deploy today. want to make sure the ACL change I made is in place before terminal does our deploy
:eyes:
1
:checkmark:
1




10 replies
Last reply 1 year agoView thread


prabhjot
:no_entry:  1:47 PM
Hi, I addressed comments on this PR, would appreciate another review - https://github.com/squareup/java/pull/249017
:eyes:
1
:stamp3:
1



bjoseph
  4:02 PM
deploying d390ca5ee16 to staging

ODS Insights
APP  5:02 PM
This is a monthly reminder from ODS. Databases for one or more apps associated with this Slack channel (#ledger) have Best Practices issues. Review the issues in the databases/best-practices screen in Square Console.
https://square-console.sqprod.co/app/ledger/databases/best-practices (695 cases)
See https://wiki.sqprod.co/display/ProdEng/ODS+Insights+MySQL+Best+Practices for explanations of issue types.


kcraft
:spiral_calendar_pad:  5:07 PM
@oncall
 Looks like your help might be needed: https://square.slack.com/archives/C03MPCFUKUJ/p1656632906946609?thread_ts=1656625416.422449&cid=C03MPCFUKUJ


plee
@carol
 is this something that your team can help us with? it seems that we need to make bulk adjustments across many units in AU - https://square.slack.com/archives/C03MPCFUKUJ/p1656628401907479?thread_ts=1656625416.422449&cid=C03MPCFUKUJ
From a thread in alert-10317_afterpay_in_person_pricing_not_being_applied_properly | Jun 30th, 2022 | View reply
:ack-green:
1


2 replies
Last reply 1 year agoView thread


lugo
  8:56 AM
Strategic Account MT MLH0F20Y2Q6WR - Question - Hi team - Please re-direct me if I am in the wrong place. Seller is wants to know if refunds are always debited from net sales from the previous day or if this is due to their transfer time which is set to 2nd business day. Example referenced
:eyes:
1
:checkmark:
1




47 replies
Last reply 10 months agoView thread


pulkit
:waning_crescent_moon:  9:00 AM
:wave::skin-tone-3: 
@oncall
, looking to understand what does instrument_token="check-source"  mean for Ledger::BankSettlementEntry token="712985FB-E6FF-4057-A0E1-D432F5723B27" .
Context: one of the dossiers (used by counsel to respond to subpoenas) is failing as we expect instrument_token to be present in instruments service.
:eyes:
2
:checkmark:
1






+1
17 replies
Last reply 1 year agoView thread


escates
  12:42 PM
was added to #ledger by lugo
.


bjoseph
  3:58 PM
deploying 2a9715962f3 to staging


zijun
:spiral_calendar_pad:  10:02 AM
Hi team. Does anyone know if we could query in snowflake how much money was reversed from Ledger account per payment token or debit token for Chargebacks? Thanks! cc 
@nmavani
 (edited) 
:eyes:
1
:checkmark:
1



10 replies
Last reply 1 year agoView thread


mnovich
  1:00 PM
does anyone know snowflake good enough to answer a question for me?
So I have this query:
SELECT aggregates.*, 
FLOOR(IFF(Transfer_Count_april >0, (Transfer_Count_april + Transfer_Count_may)/2, Transfer_Count_may)) as average_transfer_count
FROM (SELECT MERCHANT_TOKEN, 
 Floor(AVG(AMOUNT_AMOUNT)) as Average_Transfer_Amount, 
 COUNT_IF(CREATEDAT_INSTANTUSEC <= 1651365835000000) AS Transfer_Count_april,
 COUNT_IF(CREATEDAT_INSTANTUSEC > 1651365835000000) AS Transfer_Count_may
FROM "LEDGER"."RAW_FEEDS"."BANK_SETTLEMENT_ENTRY"
WHERE AMOUNT_CURRENCYCODE = 'GBP'
AND Settlementtype = 'ACH'
AND CREATEDAT_INSTANTUSEC > 1648687435000000
and AMOUNT_AMOUNT > 0
GROUP BY MERCHANT_TOKEN) as aggregates
WHERE (Transfer_Count_april > 3 or Transfer_Count_may > 3)
AND Transfer_Count_may > 0
Order by AVERAGE_TRANSFER_AMOUNT DESC
it gives me around 56k rows.
If I import those into Google sheets and filter on AVERAGE_TRANSFER_AMOUNT < 12000 and  average_transfer_count >15 I get some 25k results,
but If I add those same constrains to Snowflake it gives me back 10k results only? Any idea how come?
SELECT aggregates.*, 
FLOOR(IFF(Transfer_Count_april >0, (Transfer_Count_april + Transfer_Count_may)/2, Transfer_Count_may)) as average_transfer_count
FROM (SELECT MERCHANT_TOKEN, 
 Floor(AVG(AMOUNT_AMOUNT)) as Average_Transfer_Amount, 
 COUNT_IF(CREATEDAT_INSTANTUSEC <= 1651365835000000) AS Transfer_Count_april,
 COUNT_IF(CREATEDAT_INSTANTUSEC > 1651365835000000) AS Transfer_Count_may
FROM "LEDGER"."RAW_FEEDS"."BANK_SETTLEMENT_ENTRY"
WHERE AMOUNT_CURRENCYCODE = 'GBP'
AND Settlementtype = 'ACH'
AND CREATEDAT_INSTANTUSEC > 1648687435000000
and AMOUNT_AMOUNT > 0
GROUP BY MERCHANT_TOKEN) as aggregates
WHERE (Transfer_Count_april > 3 or Transfer_Count_may > 3)
AND Transfer_Count_may > 0
and average_transfer_count > 15
and Average_Transfer_Amount < 12000
Order by AVERAGE_TRANSFER_AMOUNT DESC
:eyes:
1
:checkmark:
1



5 replies
Last reply 1 year agoView thread


minghua
:bulb:  3:41 PM
deploying 24348ef4441 to staging

PayswingBot
APP  6:00 AM
Evacuating payments traffic from EAST datacenters (swinging WEST) in production has been initiated by davidsmith


ahdoot
:spiral_calendar_pad:  6:38 AM
hey 
@oncall
, RefundsArbiter keeps getting paged for being unable to create a refund ledger entry for the following payment: https://rqm.iad1.sqprod.co/index/payment#/query/payment/96MNpbpn9EKbYDCTDHniyU1wvaB, with the error being PAYMENT_NOT_FOUND .
:eyes:
1
:checkmark:
1




10 replies
Last reply 1 year agoView thread


ewaller
  12:54 PM
hi team, will there be a ledger deploy today?

1 reply
1 year agoView thread


minghua
:bulb:  1:11 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-98390
(ledger @ 24348ef444178a9c2f83a2f31876d0b62f81cdd4 to production)


14 replies
Last reply 1 year agoView thread


minghua
:bulb:  3:13 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we're out on prod
deploy checks pass
3:18
deploying bde495d823d to staging

PayswingBot
APP  3:42 PM
Restoring normal payments traffic (unswinging) in production has been initiated by davidsmith

root
APP  12:22 AM
ODS host fpd1823.sjc3b.square (pd-odsgroup383) is down
No action is needed from you. ODS oncall will try to successover metaclusters if they are active on this host.
Please see the #situation channel for more information.
apps affected: ledger
metaclusters affected for these apps:
- pd-mysql-ledger-010
Cc: 
@oncall
:eyes:
1


1 reply
1 year agoView thread


akwan
:spiral_calendar_pad:  12:09 PM
hello! If there are two separate freezes of the same type placed on a merchant, and I call GetFreezes, will I get both back?
:checkmark:
1



8 replies
Last reply 1 year agoView thread


minghua
:bulb:  1:06 PM
Ledger ROLL:
No deployment today: No changes


kcrane
:coolfingergun:  1:06 PM
we did it everyone, good deploy
:+1:
2
:taco-dance:
2
:joy:
1



ssopp
  2:09 PM
hiya :wave:  Curious if ya'll would be aware of why in some situations a payment never receives a RESOLVED_DISPUTE after an OPEN_DISPUTE is filed? Here is an example of one such payment from a while back (2020): https://regulator.sqprod.co/n/payments/NTsmDDJmzSTmSvsytk6BqxMF
I could find a more recent example if need be.
:checkmark:
1



8 replies
Last reply 1 year agoView thread


minghua
:bulb:  2:43 PM
deploying b025ef8aa00 to staging


emilee
  4:59 PM
Hi, cross posting this here https://square.slack.com/archives/C032WTK377A/p1656692362388559


pulkit
:wave::skin-tone-3: Hi 
@oncall
,
Looking to get some insight in this transfer. Wanted to confirm if INITIAL_BALANCE_CHANGE and RECOVERY_OFFSET_ADJUSTMENT entries can exist in same transfer?
Context: One of the dossiers is failing as MagnumPII didn't expect both entries present together in a transfer, so looking to understand the use case in order to fix our code
Thanks
Thread in transfers | Jul 1st, 2022 | View message
:eyes:
1
:speech_balloon:
1



14 replies
Last reply 1 year agoView thread


pkhanna
:spiral_calendar_pad:  3:48 AM
was added to #ledger by dcollins
.

PayswingBot
APP  5:59 AM
Evacuating payments traffic from EAST datacenters (swinging WEST) in production has been initiated by davidsmith


yskhoo
:no_entry:  8:32 AM
[not urgent] does anyone know why automatic transfers in AU typically happen between 11am to 1pm (vs. "end of day" / 5pm in US) ?
:checkmark:
1






7 replies
Last reply 1 year agoView thread


adoty
  10:04 AM
Hi, team -- was sent from #transfers with this question:
One of our Strategic Sellers, Tucson Rolling Shutters & Screens's bank account ending in 632 was marked as failed and unlinked from several of their locations with reason bank_account_unlinked_non_compliance. Could someone explains what that means and how can avoid this going forward?
@oncall
 (edited) 
:eyes:
1






25 replies
Last reply 1 year agoView thread


minghua
:bulb:  12:34 PM
Ledger ROLL:
No deployment today: No changes
:bugcat_dj:


minghua
:bulb:  3:49 PM
deploying e0b8d8a795f to staging

PayswingBot
APP  3:56 PM
Restoring normal payments traffic (unswinging) in production has been initiated by davidsmith


heisel
:ooo_1:  6:09 AM
was added to #ledger by cberda
. Also, diego
 and 3 others joined.

PayswingBot
APP  6:15 AM
Evacuating payments traffic from EAST datacenters (swinging WEST) in production has been initiated by davidsmith


dcorcoran
  7:01 AM
was added to #ledger by dcollins
.

root
APP  9:26 AM
ODS host fpd1475.sjc2b.square (pd-odsgroup372) is down
No action is needed from you. ODS oncall will try to successover metaclusters if they are active on this host.
Please see the #situation channel for more information.
apps affected: ledger
metaclusters affected for these apps:
- pd-mysql-ledger-027
- pd-mysql-ledger-030
Cc: 
@oncall
:+1:
1


1 reply
1 year agoView thread

PayswingBot
APP  2:58 PM
Restoring normal payments traffic (unswinging) in production has been initiated by davidsmith


emilyl
  4:11 PM
deploying 3648fa7f182 (latest) to staging


hoyi
  6:24 PM
Restarting ledger in case it’s impacted by #alert-10375_approx_half_of_services_cgroup_metrics_are_missing

PayswingBot
APP  7:05 AM
Evacuating payments traffic from WEST datacenters (swinging EAST) in production has been initiated by colten


tli
:no_entry:  9:20 AM
hello folks, wanted to see what impact you guys experienced for ALERT-10381 (facts doc). would appreciate if you can add insight into the facts doc. thank you.


emilyl
  12:56 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-98613
(ledger @ 3648fa7f182 to production)


5 replies
Last reply 1 year agoView thread


emilyl
  1:01 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:chocobo-face: canary start
View newer replies


emilyl
  1:30 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


emilyl
  2:39 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass

PayswingBot
APP  2:52 PM
Restoring normal payments traffic (unswinging) in production has been initiated by colten


rsasson
:no_entry:  3:56 PM
quick dependency cleanup PR for ledger https://github.com/squareup/java/pull/249641
:stamp:
1



emilyl
  4:07 PM
deploying 5024b240a8b (latest) to staging


emilyl
  12:36 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-98680
(ledger @ 5024b240a8b to production)


5 replies
Last reply 1 year agoView thread


emilyl
  12:45 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


zzhang
  1:06 PM
Hi Ledger team, we have a question about these $6550 Ledger entries on this plan.
Transfer 1 on 6/27/22, how exactly this one is net to zero?
Transfer 2 on 7/6/22 should be the record_payment_and_settle action taken by Ops agent
Transfer 3 on 7/7/22, what exactly happened to this one? Is this because of BankC transfer out?
This is from the case when Ops agent tried to cancel a loan and get the fund back, it looks like we should have retrieved the fund from the borrower’s checking account instead of debiting their external linked bank account. Could you help explain why Ledger behaves this way? Thanks!
cc: 
@rpon
:eyes:
1
:checkmark:
1



7 replies
Last reply 1 year agoView thread


rpon
:sheepy:  1:06 PM
was added to #ledger by zzhang
.


emilyl
  1:07 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


emilyl
  3:01 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass


emilyl
  4:10 PM
deploying 20ab72ebb7e (latest) to staging

PayswingBot
APP  6:00 AM
Evacuating payments traffic from WEST datacenters (swinging EAST) in production has been initiated by davidsmith


bforehand
  7:32 AM
Can I get someone from ACTENG to review this PR since it touches some ledger code via banking partners?
https://github.com/squareup/java/pull/250277

1 reply
1 year agoView thread


ericz
:spiral_calendar_pad:  9:21 AM
Hey team, can I get someone from ACTENG to approve this PR? It is just an acl change to allow a new service the payments api team is building out to access "GetPendingBalance" https://github.com/squareup/java/pull/249472





34 replies
Last reply 12 months agoView thread


jthomas
  10:00 AM
Hi! (not urgent) Do ya’ll have some recommended docs I can check out on Ledger decomposition? Generally interested in learning more about decomposition plans and also specifically interested in plans around ledger entries and if it makes sense to introduce new types or not.



5 replies
Last reply 1 year agoView thread


emilyl
  12:24 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-98740
(ledger @ 20ab72ebb7e to production)


6 replies
Last reply 1 year agoView thread


bhargava
  12:24 PM
was added to #ledger by emilyl
.


emilyl
  12:34 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


emilyl
  1:00 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


emilyl
  2:10 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass


tmahoney
  2:48 PM
replied to a thread:
:wave: small PR here to prevent Ledger entries from being created for unlinked refunds to gift card: https://github.com/squareup/java/pull/248477…
@mengen
 thanks! I found some time to circle back to this, and I have this draft PR now…
basically, I just iterated on Kotlin editorconfig rules, using the payment-balances project as a test case. I think I found a good set of sensible defaults; the resulting code looks fine to me, and it results in almost zero diff to your project :slightly_smiling_face:
PTAL when you can (not urgent ofc!), and thanks for agreeing to play guinea-pig here :guineapig: :editorconfig:
#250409 Tmahoney/payment balances editorconfig autoformat
First stab at a Kotlin editorconfig (thanks @mengen-square for volunteering as a guinea pig!!)
I don't have super strong opinions on Kotlin styling, because I don't work in the language. I did some looking around & researching on what Cash teams do, read about ktlint, read some JetBrains recommendations, etc... to synthesize a bit of context... but mostly I arrived at the conclusion that the payment-balances styling is already pretty sensible.
I landed on a set of rules that produce almost zero diff in payment-balances code (note the first commit is just optimizing imports, which caused the majority of the diff noise here; consider reviewing just the second commit).
if this PR looks good, I… Show more
<https://github.com/squareup/java|squareup/java>squareup/java | Jul 13th, 2022 | Added by GitHub
:+1:
1

View newer replies


dawilson
  3:45 PM
Hi folks, I'm in a situation where I want to migrate some Freeze calls from Regulator that use the deprecated "FROZEN" freeze type to a more specific value. I found this document in the protobuf comment, which describes the migration.


dawilson
  3:46 PM
My question for all of you is: has anyone here migrated one of these fields before? If so, i want to talk to you about how you went about mitigating potential downstream issues from changing the FreezeType. The change itself is trivial, but who knows what it might break.
:checkmark:
1



4 replies
Last reply 1 year agoView thread


emilyl
  4:04 PM
deploying 99642b75e07 (latest) to staging

PayswingBot
APP  7:30 PM
Restoring normal payments traffic (unswinging) in production has been initiated by davidsmith


emilyl
  4:07 PM
deploying e9a21e73dcc (latest) to staging


zzhang
  1:20 PM
Hi Ledger team, we got an error when we try to cancel a plan, when we were refunding the repayments, Ledger throws
Settlement::Ledger::API::InvalidStateError: Money movement not allowed for customer unit: LCTC6GP621P3V.
Could you give us some info on why it does that? Logs: https://presidio-ui.sqprod.co/search?instance=production&search=application:capital%202112629&window=4h
For some context, this plan was created by bad ATO, but the loan deposit failed too, so we are trying to cancel it and refund the seller for any repayment done through assessment. https://jira.sqprod.co/browse/ONCALL-136901
cc: 
@rpon
 (edited) 
:eyes:
1
:checkmark:
1




20 replies
Last reply 12 months agoView thread


bta
  6:19 PM
ledger deployed to c110a9ae1a7ddad36e2870477139e40cfd4c23f6 (latest) in staging

1 reply
12 months agoView thread


bta
  12:41 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-98911
(ledger @ c110a9ae1a7ddad36e2870477139e40cfd4c23f to production)


5 replies
Last reply 12 months agoView thread


bta
  1:53 PM
replied to a thread:
Ledger ROLL:…
Resending message into ledger slack for broader view. Deploy today is being delayed until tmr.
:+1:
1



senth
  4:20 PM
Deploying latest SHA ea511605a463d38083ef46bb1207b64f0f4fd0b0 to Ledger staging


miranda
:no_entry:  7:51 AM
was added to #ledger by dcollins
.


sxiong
  11:01 AM
Hello, what is the settlement time for payments? For example, I have this payment here on staging: https://regulator.stage.sqprod.co/n/payments/LhIVi7vgzQ7JlSOtx2QaJMUmeofZY
It seems to be taking a day or 2 for payments on staging to settle. Is this correct?
Is the settlement time different on production? I was told it can be very quick (just a few minutes) for the payment to settle



6 replies
Last reply 12 months agoView thread


julianne
:outofoffice:  11:12 AM
was added to #ledger by hsilverio
. Also, kayceseifert
 and coyne
 joined.


senth
  12:13 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-98967
(ledger @ 89c4a6c2a0afaaef5213fda00e1fd6746a7240f3 to production)


6 replies
Last reply 12 months agoView thread


senth
  12:45 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


senth
  1:24 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


senth
  2:46 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we're out on prod
deploy checks pass


bta
  4:05 PM
Deploying ledger to 355b44489c2b0b4e119bdfd4ad634edf32d832df latest in staging


lugo
  7:38 AM
Merchant Token: J265MT831A98Q
Unit Token: TTTXVY8KBSZES
HI team - Not sure if this is the right place. Seller changed bank account back on May 31.
Deposits are still depositing to old bank account even though the new bank info is showing in dashboard. JIRA https://jira.sqprod.co/browse/ONCALL-137077


4 replies
Last reply 12 months agoView thread


bta
  12:39 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-99039
(ledger @ 355b44489c2b0b4e119bdfd4ad634edf32d832df to production)


6 replies
Last reply 12 months agoView thread


bta
  1:34 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


bta
  1:56 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


bta
  3:02 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we're out on prod
deploy checks pass


senth
  4:07 PM
Deploying Ledger staging with latest master SHA of e00e4defbcc5c477cfc9459c8d5492bbffa461c9


jmah
  5:22 PM
Hi, I'm investigating https://jira.sqprod.co/browse/ONCALL-137105 where a manual seller is seeing $0 balance. I've traced it back to BalanceService.GetClearedBalance returning 0 as the amount. Maybe it's because the merchant settlement state?
*************************** 1. row ***************************
                   id: 29174417
       merchant_token: AP9VX5NKZADSB
             start_at: 2022-07-20 21:09:21
               end_at: NULL
           settleable: 1
            debitable: 1
has_suspected_payment: 0
      bank_account_id: 8364761
               reason: NULL
                shard: 485
  transaction_fund_id: 1
          deposit_tag: NULL
*************************** 2. row ***************************
                   id: 29174415
       merchant_token: AP9VX5NKZADSB
             start_at: 2022-07-20 21:09:02
               end_at: 2022-07-20 21:09:21
           settleable: 0
            debitable: 1
has_suspected_payment: 0
      bank_account_id: 8364761
               reason: BIZBANK_ACCOUNT
                shard: 485
  transaction_fund_id: 1
          deposit_tag: NULL
Does row 1 represent a manual seller? I'm not too familiar with mss, but I think row 2 is what a manual seller's state should look like. Advice appreciated! (edited) 
:checkmark:
1




15 replies
Last reply 12 months agoView thread


zeke
  10:45 AM
Hi team, wanted to share the design doc for the backstop system Risk Infra is building into Magistrate. The goal of the system is to provide backup risk evaluations to clear payments on time, in the event of an upstream outage in ML systems. It should require no changes in Ledger, as we’ll be using the existing external risk states on the Magistrate risk state feed. Let me know if you have any comments/questions, thanks!
https://docs.google.com/document/d/120fdHdMhdI1L3YNO4EKpXp_zHWkFR8ylH3TCMd5s4WM/edit#
G Suite Document
 

Risk Backstop Eng Design
Google Doc
:tada:
1



bta
  4:04 PM
Deploying latest 3cc486f9bef8b25f08c185e90a6603046028f529 to ledger staging
:thank:
1



janis
  10:09 AM
hello! could you please check why user token LPSQ3Q0N2QG91 balance has not been updated in ledger to reflect ach return?
select *
from ledger.ledger__ledger_production.pending_balance_snapshots
where merchant_token = 'LPSQ3Q0N2QG91';
:eyes:
1
:checkmark:
1




14 replies
Last reply 12 months agoView thread


rfutrell
  2:44 PM
Hi everyone! Provided a specific ledger entry, is there a way to reverse-engineer the bank account's token that corresponds to the merchant's account? For example, ledger entry 8x-QzmFP9NNxX4bJz6FRx2MrHQs. This was an ACH debiting a US merchant's account.


hoyi
  4:03 PM
Deploying latest (e7afc61ff8a) to staging


rho
  10:19 AM
Hi, over the weekend Risk infra got paged for 2 payments (bX7zOb0hLuWXG7pucDCtmpY7vaB and 33KoLVg5gedeH07kK5x3if42vaB) that were marked as waiting risk review on Ledger but cleared from Magistrate’s side. Not urgent but I’m curious if you know anything on your side that’s changed recently.

1 reply
12 months agoView thread


kcrane
:coolfingergun:  1:25 PM
no Ledger deploy today, still investigating a potential issue we're seeing in staging


kcrane
:coolfingergun:  7:07 PM
Deploying latest 0a6fb3aa251 to ledger staging
:bless:
1



atsai
:spiral_calendar_pad:  11:36 AM
@oncall
 - I'm trying to follow up on a SEV from a couple months ago.  Summary is that our team (Customers Engagement - Marketing) creates and issues coupons for sellers, but a bug allowed some sellers to issue coupons that did not match their configuration.  We calculated/estimated how much the incorrectly configured coupons would have impacted relevant bills, and would like to credit/refund sellers accordingly.  I've filed https://jira.sqprod.co/browse/ONCALL-137329 but would like to know if there is anything else we need to do to help get this resolved.  :thank:

1 reply
12 months agoView thread


hoyi
  12:00 PM
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-99255
(ledger @ 0a6fb3aa251 to production)


6 replies
Last reply 12 months agoView thread


hoyi
  12:52 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-99255…
staging checks pass
:canary: canary start
View newer replies


hoyi
  1:16 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-99255…
canary deploy checks pass
:rolling_kirby: rolling forward

PayswingBot
APP  3:11 PM
Evacuating payments traffic from EAST datacenters (swinging WEST) in production has been initiated by davidsmith


bjoseph
  5:15 PM
deploying latest a393c75bab7  to staging
:+1:
1



jcui
  5:23 PM
Hi ledger team, I have a situation where we were supposed to debit plan funds from a merchant's ledger balance (due to ATO) but we are debiting from the merchant's linked bank account instead. here is the merchant info: https://regulator.sqprod.co/n/users/2HK5XYRD4GZN7
if we unfreeze the merchant, would the existing debit debit from the ledger balance?

1 reply
12 months agoView thread

PayswingBot
APP  7:27 PM
Restoring normal payments traffic (unswinging) in production has been initiated by lyall


sheryll
  11:50 AM
hi team, I need some help figuring out this oncall ticket. basically,  this seller tried to refund their client but it got rejected, but the seller never got their funds back into their account despite regulator saying it was released. the corresponding rqm says the settlement was blocked due to NO_VERIFIED_BANK_ACCOUNT,BIZBANK_ACCOUNT. our friend from refunds says that from a refunds standpoint, the money should still be in their account since it had nowhere to go. however you can see in the screenshot that it looks like that amount is still on hold. can you check if the funds are still on hold and if this should be something your team handles? cc: 
@abhishekg
Screen Shot 2022-07-26 at 2.55.12 PM.png
 
Screen Shot 2022-07-26 at 2.55.12 PM.png
:eyes:
1


1 reply
12 months agoView thread


kcrane
:coolfingergun:  1:25 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-99324
(ledger @ a393c75bab7 to production)


5 replies
Last reply 12 months agoView thread


kcrane
:coolfingergun:  1:29 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


kcrane
:coolfingergun:  2:02 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies

PayswingBot
APP  2:08 PM
Evacuating payments traffic from WEST datacenters (swinging EAST) in production has been initiated by hbonnen
:goodbye2:
1



kcrane
:coolfingergun:  3:58 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we're out on prod
deploy checks pass


kcrane
:coolfingergun:  4:50 PM
deploying latest a1ba7125284 to staging

PayswingBot
APP  7:40 PM
Restoring normal payments traffic (unswinging) in production has been initiated by lyall


hoyi
  11:23 AM
Taking over ledger-staging

1 reply
12 months agoView thread


ecolocillo
:bulb:  12:52 PM
:wave::skin-tone-2: Hi! I have 2 questions I'm hoping this channel  can answer :slightly_smiling_face:
What does "current holds" refer to? (see screenshot #1)
If a customer's transfer balance is 0, this means they don't currently have any funds sitting with Square, correct? (see screenshot #2)
Thank you!
2 files
 
image.png
image.png


hoyi
  4:01 PM
replied to a thread:
Taking over ledger-staging
Releasing ledger-staging
4:05
Deploying latest (30af1c7147a) to staging


lugo
  1:09 PM
Hi Team! Strat Seller UT: ECY916P5TNJYC Please redirect me if I am in the wrong spot. Seller wants to know where the funds “Other” $157.43 on the transfer are coming from. I took a look but can not account for the total $157.43. (
@kylecarriere
 AM for transparency)
Transfer in question:
https://regulator.sqprod.co/n/users/ECY916P5TNJYC/transfers/e16c8992-f758-11ec-9879-02420a140002?section=transfers
Screen Shot 2022-07-29 at 12.50.16 PM.png
 
Screen Shot 2022-07-29 at 12.50.16 PM.png
:checkmark:
1



3 replies
Last reply 11 months agoView thread


kylecarriere
  1:09 PM
was added to #ledger by lugo
.


mengen
  4:52 PM
Deploying latest (6c5374d0658) to staging


emilyl
  4:02 PM
deploying a1f4dc03811 (latest) to staging


mengen
  12:52 PM
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-99578



5 replies
Last reply 11 months agoView thread


ecolocillo
:bulb:  1:28 PM
Hi all! Reposting my questions from a few days ago :slightly_smiling_face:


ecolocillo
:wave::skin-tone-2: Hi! I have 2 questions I'm hoping this channel  can answer :slightly_smiling_face:
What does "current holds" refer to? (see screenshot #1)
If a customer's transfer balance is 0, this means they don't currently have any funds sitting with Square, correct? (see screenshot #2)
Show more
2 files
 
image.png
image.png
Posted in ledger | Jul 28th, 2022 | View message
:checkmark:
1




5 replies
Last reply 11 months agoView thread


hoyi
  4:14 PM
Deploying latest (5d69d66bcef) to staging


ryantai
:spiral_calendar_pad:  7:20 AM
was added to #ledger by ecolocillo
. Also, kbreiz
 joined.


mengen
  12:43 PM
Ledger prod ROLL: https://jira.sqprod.co/browse/ROLL-99632


5 replies
Last reply 11 months agoView thread


mengen
  12:46 PM
replied to a thread:
Ledger prod ROLL: https://jira.sqprod.co/browse/ROLL-99632
staging checks pass (Yesterday’s issue is fixed by https://jira.sqprod.co/browse/ROLL-99589)
:canary: canary start (edited) 
View newer replies


mengen
  1:37 PM
replied to a thread:
Ledger prod ROLL: https://jira.sqprod.co/browse/ROLL-99632
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


mengen
  2:50 PM
replied to a thread:
Ledger prod ROLL: https://jira.sqprod.co/browse/ROLL-99632
:shipitparrot: we’re out on prod
deploy checks pass


mengen
  4:07 PM
Deploying latest (e790df3689d) to staging


coltonw
  7:33 AM
Hello team
I'm working on adding a feature to envoy control plane. I was told told that your team might be able to benefit from this new feature. I'm still in the early parts of the design phase and I wanted to reach out to potential users of this new feature to help ensure I can design it as generally useful as possible.
The super high-level idea is to enable service owners to have fine grained control over which cluster that requests from client applications are routed to.
For example, the ability to say "I want 90% of requests made by beemoreporter -> ledger::ListLedgerEntries, to go to cluster-b". If anyone is interested in adding some input for a feature like this, reach out for a short informal chat.
Thanks


2 replies
Last reply 11 months agoView thread


ishvydchenko
  9:15 AM
Hey Ledger team, I was wondering if there are any tables in snowflake that store the entries published to the ledger-entries feed?


7 replies
Last reply 11 months agoView thread


ewalls
  3:43 PM
We're seeing a spike in Ledger delay. What could be causing it?
Acknowledged: #2207182 ControllerHealth::HealthError: No recent change to feed cursors. Check for problems in Business::AssessmentJob as well as issues...
Assigned: Emily Walls
↑︎ High Urgency
Triggered by: sentry
Service: Credit Servicing Record
Acknowledged by <https://square.pagerduty.com/users/PAQMVSM?utm_campaign=channel&amp;utm_source=slack|Emily Walls> (<@U3PV2MW9L>)Acknowledged by Emily Walls (
@ewalls
) | Aug 4th, 2022

1 reply
11 months agoView thread


hoyi
  4:20 PM
Deploying latest (692006e29e4) to staging


douglaschau
  9:51 AM
not sure if this is the right place, but one of my staging accounts was just flagged for review while i was testing payments in staging (regulator), what do I have to do to unflag my account? :lolsob2:

1 reply
11 months agoView thread


yingxi
:spiral_calendar_pad:  12:18 PM
Hi team, I am pretty new to ledger and would like to get some help from this channel.  Is there any bigquery/snowflake table that contains the transaction settlement time for each payment token? thanks
:eyes:
1
:checkmark:
1



16 replies
Last reply 11 months agoView thread


emilyl
  4:04 PM
deploying d0809f36322 (latest) to staging


jthomas
  1:26 AM
Hi, is it fair to say that if a ledger entry has settled then it’s not part of a pending inbound transfer?
Specifically I’m trying find a way to check that there are no pending inbound transfers containing RECOVERY_OFFSET_ADJUSTMENT entries, given a unit token. I’m wondering if I can use list ledger entries and check for unsettled entries with type RECOVERY_OFFSET_ADJUSTMENT as a proxy. Thanks!
:eyes:
1
:checkmark:
1



7 replies
Last reply 11 months agoView thread


sarve
  9:25 AM
@oncall
 FYI - We are updating the migration state for GB in Ledger to MIGRATING from NOT_MIGRATING . This should have no real effect until pipeline run tomorrow





+1
11 replies
Last reply 11 months agoView thread


minghua
:bulb:  12:56 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-99783
(ledger @ d0809f36322df08d6bdae17782d0e0202eec1374 to production)



11 replies
Last reply 11 months agoView thread


alexhancock
  1:13 PM
was added to #ledger by minghua
.


minghua
:bulb:  1:19 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


minghua
:bulb:  2:12 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


minghua
:bulb:  3:02 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we're out on prod
deploy checks pass


minghua
:bulb:  3:08 PM
deploying 5f66747f94a635edd6290a55188aec68c24fcf31 to staging


rho
  3:19 PM
@oncall
 we’re seeing a repeat of this situation. Could you check if there are any pending review payments for unit 6EX0ZA2790WFZ? Also as a feature request if we could filter by unit token in ListPendingManualReviewPayments we wouldn’t have to bother you for this.


jcook
Hi all, I was wondering if someone could tell me why this seller 6EX0ZA2790WFZ is suspected in ledger?
For context, this seller is a Square Ecom SAAS US and should not be getting marked as suspected.  
@rho
 noticed there are a couple of compliance cases and I wonder if that is related?
https://regulator.sqprod.co/n/cases/110399778
https://regulator.sqprod.co/n/cases/109534392
Show more
Thread in accounting-eng | Jun 16th, 2022 | View message
:eyes:
1
:checkmark:
1






+2
39 replies
Last reply 10 months agoView thread


janis
  6:29 AM
hello! user 5E0YSS1JX2RHW has a positive sq card balance and negative ledger balance because of chargebacks. the user is frozen and suspected for fraud. we are currently showing a chargeback loss of 19,566 for this user because the ledger balance is not accounting for sq card balance. will the ledger balance be updated?
:eyes:
1
:checkmark:
1



4 replies
Last reply 11 months agoView thread


conner
  8:40 AM
hi! is it possible to know when a particular transfer succeeded? specifically https://regulator.sqprod.co/n/users/DTS4CC2XFXTB8/transfers/39b6eca1-146c-11ed-bf24-02420a140002
:checkmark:
1



2 replies
Last reply 11 months agoView thread


njacobson
:meseeks:  9:18 AM
Hello, owners of: ledger
Your service was identified as using mTLS MTTs and a good target for early adoption of a new feature called Square Tokens. The plan is to replace MTTs for authenticating requests between Square services with something that is more secure and easier to use, among other improvements.
Early adoption means that we will update your service with your guidance to use Square Tokens and migrate away from MTTs, resulting in less overall time and effort from your team to migrate to what will eventually be the preferred auth mechanism for first-party Square applications. We will also work together to refine the product requirements for the upcoming SDK that everyone will use to interact with Square Tokens.
If this sounds interesting to you, please add a threaded reply or reach out in #account-security for more information.
G Suite Document
 

Square Tokens - Proposal
Google Doc


skaltenbach
  10:10 AM
Hey 
@oncall
 just a heads up, we are copying over the enable_initiate_payout_requests feature flag that currently only exists in staging to prod so that we can move forward with payouts testing. Link to flag for reference: https://square-console.sqprod.co/feature-editor/production/group/ledger/feature/enable_initiate_payout_requests (edited) 
:+1::+1::skin-tone-2:
2


2 replies
Last reply 11 months agoView thread


smartin
  11:26 AM
@oncall
 I’m going to enable two complete-payout-event kafka consumers in prod using large darkly

1 reply
11 months agoView thread


emilyl
  12:13 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-99841
(ledger @ 5f66747f94a to production)
:+1:
2




10 replies
Last reply 11 months agoView thread


emilyl
  12:32 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


mgp
:baby:  12:42 PM
@oncall
 is it okay for me to do a canary deploy to staging for 30m or so? For a hack-week thing? Then will roll back :+1:



3 replies
Last reply 11 months agoView thread


emilyl
  1:12 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


emilyl
  2:14 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass


mnovich
  2:24 PM
does anyone know why Ledger does not have kafka tools in its dependencies?



4 replies
Last reply 11 months agoView thread


mnovich
  2:24 PM
https://coda.io/d/_dhYbSVi6Zdk/General-Onboarding_sudKp#_luP-S


emilyl
  4:18 PM
deploying 84cb78c3376 (latest) to staging


bderosa
  12:02 PM
:ablobwave: Hi team, we are working on a hack week idea with pricingcenter and we would like to be able to hit the ListLedgerEntries endpoint in ledger,  anyway we could get a registry request for this?


6 replies
Last reply 11 months agoView thread


emilyl
  12:33 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-99906
(ledger @ 84cb78c3376 to production)
:+1:
1



6 replies
Last reply 11 months agoView thread


emilyl
  12:35 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


emilyl
  12:41 PM
deploying 071c83e5456 (latest) to staging

1 reply
11 months agoView thread


emilyl
  1:08 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


emilyl
  2:14 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass
:thank:
2



emilyl
  4:05 PM
deploying 665b2c6f917 (latest) to staging


dax
:palm_tree:  9:24 AM
:wave: I’m from business identities team. Low urgency, but I’m looking into why we got 50K requests for the same legal entity pv8N4PzKHWD3GfNjO in 2 hours on 8/2 (https://presidio-ui.sqprod.co/search?search=pv8N4PzKHWD3GfNjO&instance=production&window=5h&until=20220802.17:56:10). It looks like the beginning of this was a call to Ledger.GetFreezes: https://presidio-ui.sqprod.co/search?search=02AA5T82BC72M&instance=production&window=1m&until=20220802.14:56:10 for the corresponding unit token 02AA5T82BC72M. Any idea what could have happened here?


mqchen
  9:27 AM
anything going on? got some pages for a lot of timeouts in bankc
@oncall
:heavy_plus_sign:
1






+2
14 replies
Last reply 11 months agoView thread


minghua
:bulb:  9:28 AM
replied to a thread:
anything going on? got some pages for a lot of timeouts in bankc…
Yes, we are seeing increased latencies. Investigating still
:+1:
1

View newer replies


hoyi
  9:35 AM
set the channel topic: ALERT-10563 | Discussion for https://registry.sso.global.square/apps/ledger | Contact @oncall for questions | Emergency page the entire team: https://go/ledger911


hoyi
  10:23 AM
set the channel topic: Stable | Discussion for https://registry.sso.global.square/apps/ledger | Contact @oncall for questions | Emergency page the entire team: https://go/ledger911


minghua
:bulb:  10:24 AM
replied to a thread:
anything going on? got some pages for a lot of timeouts in bankc…
The latencies have been stabilized now


paxton
  2:21 PM
Hi team- looking for some direction on stored balances in Square: https://jira.sqprod.co/browse/ONCALL-137284. Can someone point me to the right place?
:eyes:
1
:checkmark:
1



17 replies
Last reply 11 months agoView thread


ginac
  2:36 PM
was added to #ledger by paxton
.


rfutrell
  12:01 PM
How does ledger determine the bank account to debit for a merchant or unit? Is it always the same as the linked_bank_account value returned by SellerBankAccountService.get_pending_and_linked_bank_accounts_for_users ?
:checkmark:
1


1 reply
11 months agoView thread


bta
  1:50 PM
taking over ledger staging for a bit


bjoseph
  4:44 PM
deploying 1ba68bfb6b4 to staging


sarve
  10:07 AM
:wave::skin-tone-4: Any pointers on who to reach out to get our test account unfrozen


2 replies
Last reply 11 months agoView thread


senth
  12:06 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-100031
(ledger @ 1ba68bfb6b404b5533bb38528ad125c8d41ab27a to production)





+1
15 replies
Last reply 11 months agoView thread


senth
  12:30 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


senth
  12:59 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


ahenning
:knife_fork_plate:  2:44 PM
Hey folks, #frameworks is looking into flags that are currently out of sync in go/feature. We’ve found many flags that have been edited in LaunchDarkly since they were created; in these cases, automatic flag synchronizations from go/feature to LD are failing.
Here’s our ask of you:
Look for flags your apps/services use in this spreadsheet
Reconcile any differences between feature-editor and LaunchDarkly by editing the flag in go/feature
Let us know on a thread here when that’s done so we can force migrate them and bring them into sync. Once we force migrate (via a script), all changes made to the flag in LaunchDarkly will be overwritten by the current flag state from go/feature.
Thank you! Let us know if you have any questions.
:eyes:
1




5 replies
Last reply 11 months agoView thread


bta
  2:50 PM
taking over ledger staging for a bit

1 reply
11 months agoView thread


senth
  3:01 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we're out on prod
deploy checks pass
View newer replies


ena
:spiral_calendar_pad:  3:12 PM
replied to a thread:
Ledger ROLL:…
heya! we are seeing a lot of timeouts for calls that depend on ledger endpoints, do y’all know if it’s related to this deploy? cc 
@sheryll
:eyes:
1

View newer replies


bjoseph
  4:03 PM
deploying cfbcf12e8a8 to staging
:thank:
1



bjoseph
  11:59 AM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-100088
(ledger @ cfbcf12e8a81cda64aa82b2de948db109132419b to production)



9 replies
Last reply 11 months agoView thread


yskhoo
:no_entry:  12:24 PM
cc 
@aarohi
hi 
@oncall
 is there a way to undo/delete a ledger entry. specifically a RISK_RESERVE_RELEASE ledger entry for unit J87Z24EGXHS29 whose ledger entry token is nC_fs9aVcBS453pjAdyC-eLArVQ . this ledger entry occurred around 11:09am pdt today
Screen Shot 2022-08-16 at 12.20.09 PM.png
 
Screen Shot 2022-08-16 at 12.20.09 PM.png



6 replies
Last reply 11 months agoView thread


aarohi
:spiral_calendar_pad:  12:24 PM
was added to #ledger by yskhoo
.


bjoseph
  12:38 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


bjoseph
  1:10 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
:shrekroll:
1

View newer replies


bjoseph
  2:23 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we're out on prod
deploy checks pass
:party-furby:
4



bjoseph
  4:04 PM
deploying be7f77cae0a to staging


bjoseph
  4:24 PM
deploying latest 1850e93f62c to staging to get PR that was missed the first time
:thank:
2



tmahoney
  8:23 AM
:wave: hi friends, I’m looking to get a second opinion on some old code in RefundsArbiter, from someone with a bit more Ledger knowledge than my team has. looking at this on the heels of ALERT-10579 Tip/Refund fraud costs Square 1MM doc here where malicious actors exploited high overcaptures and our refunds flow to extract money from Square.
the bit of RefundsArbiter logic I’m looking at today essentially says, for refunds associated with frozen merchants specifically, auto-approve the refund if the corresponding payment capture has not settled in Ledger. (if you want to look in code, it’s FrozenSuspiciousMerchantHandler#decideRefundsForFrozenMerchant)
this was written way back in 2015. (the original author is still at Square, but they’ve long moved on to other things so I’ll refrain from tagging them for now.)
I assume the idea here was, “if we have not yet paid out the merchant, then it’s safe to ‘negate’ the payment by approving the refund.” there is no adjacent code in RefundsArbiter for explicitly canceling the Ledger payment entry; I guess there must be an implicit assumption here that Ledger does the right thing, and would not pay out the merchant if it got the message in time. does that sound right? (though, even still, the approval decision needs to travel from refundsarbiter->omnibus->esperanto->payments feed->ledger… so, seems a bit race-y). basically it seems like it must’ve been intended to get money back in the hands of legit buyers for the case where the seller was fraudulent, right? but I’m thinking this behavior might be undesirable for the case we saw in #pay-incident-211, where the “buyer” and “seller” were both coordinated by the same malicious actor.
it seems like we could shoot ourselves in the foot here, if we had some refunds (like from those fraudsters) that were sitting in refundsarbiter, gated behind so-and-so logic, but then a Risk-Ops person froze the seller, and refundsarbiter said “ah, you’re frozen now, all clear to approve!”
it’s all a bit complex and I am not a Ledger expert, so looking for a gut check here… thanks for the time, and apologies for the long post :wink:


3 replies
Last reply 11 months agoView thread


bjoseph
  12:12 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-100177
(ledger @ 1850e93f62c96c59a234e1994d25a6b4106f2680 to production)




8 replies
Last reply 11 months agoView thread


bjoseph
  12:27 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


bjoseph
  1:00 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


bjoseph
  2:04 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we're out on prod
deploy checks pass
:bugcat_cheer:
1



bforehand
  2:46 PM
I know folks are working on an ALERT, but could anyone help me out?
Is there something that I've done wrong here?
https://github.com/squareup/java/pull/254041
I can't seem to figure out why the kochiku build is failing:
https://kochiku.sqprod.co/squareup/java/builds/5870293
It does seem related to my change because it fails locally and gives me an error like this:
1) [Guice/MissingImplementation]: No implementation for DatasourceConfig annotated with @Named("ledger_shard_0") was bound.
I'm assuming this means I broke the schema somehow.
but the migration and the jooq rebuild seemingly worked?



19 replies
Last reply 11 months agoView thread


bjoseph
  4:03 PM
deploying 40243267ee5 to staging


mnovich
  4:15 PM
Hey Everyone, I’d appreciate a look at this PR. I am new to Ledger backfills so any input is appreciated.
https://github.com/squareup/java/compare/mnovich/backfill-null-values-in-settle-using-payouts?expand=1


2 replies
Last reply 11 months agoView thread


cqin
:spiral_calendar_pad:  8:31 AM
Hi team, please redirect me if I post in the wrong channel:thank: I received an oncall question which the seller showing an upcoming debit for $400. Is there any suggestions to make the ledger settle and M won't be debited for this case? Thank you:thank: (regulator)


ncampbell
182N9RRXPBK9M - Hey this seller doesn't have a negative balance but they're showing an upcoming debit for $400.  is there a way of resolving this out so that the ledger settles and the M isn't debited? 
@oncall
Thread in checking | Aug 18th, 2022 | View message
:eyes:
1





37 replies
Last reply 11 months agoView thread


tmahoney
  2:01 PM
:wave: I’m working on wiring up unlinked refunds to process through refundsarbiter (up to now they’ve been skipping RA entirely and just auto-approving). this will mean that we issue CreateRefundLedgerEntryRequests, and occasionally, CancelRefundLedgerEntryRequests for them. (the payment_token field in those requests would still be specified as the payment_id for the unlinked refund payment record.)
any concerns with us doing this? do we think Ledger will handle these fine? (mainly wondering if it tries to “match up” to an existing capture ledger entry based on payment_id. that would likely fail, since URs by definition are refunds that are not associated with a past Square payment.)
:eyes:
1
:checkmark:
1






+3
34 replies
Last reply 10 months agoView thread


bforehand
  2:18 PM
replied to a thread:
I know folks are working on an ALERT, but could anyone help me out?…
So, I think I've gotten the error message to change, but now I'm seeing the following error:
FUNCTION ledger_shard_1_test.migration_checksum does not exist
Has anyone seen this before? (edited) 
View newer replies


andreyg
  4:22 PM
deploying 66462df82f4 to staging
:thank:
1



njain
  12:57 PM
Hey 
@oncall
, my team is seeing some really old ledger entries show up for a loan in the ledger feed that we consume. These entries are from 2020 and 2021. Could you please help investigate why such old entries are showing up?
:checkmark:
1





40 replies
Last reply 11 months agoView thread


jlandin
:no_entry:  4:02 PM
Hi team :wave:  I'm from #frameworks and recently refreshed an elderly PR that now somehow via merges/etc has me removing 4 extraneous spaces from  settlements/ledger/src/test/java/com/squareup/ledger/services/internal/UpdateMerchantMigrationFlagActionTest.java in ledger.  :facepalm:  I tried several times to remove the change without success (happy to take suggestions :thinking_face:). I'm blocked by the owner-owl :owl:, so at this point I'm hoping to just get a stamp from you folks for that one file, and move on. :thanks_so_much: Thanks for any help!
:checkmark:
1



4 replies
Last reply 11 months agoView thread


andreyg
  4:52 PM
andreyg  [4:05 PM]
deploying a12fdc26f08 to staging
initially posted to the wrong channel :facepalm:
:checkmark:
1



bforehand
  5:31 PM
replied to a thread:
I know folks are working on an ALERT, but could anyone help me out?…
It appears this is related to TranslationManager and its TranslationManagerConfig. If you create a new master-only table you need to add it to the list of TABLES_USED_ONLY_IN_MASTER_DB or the Guice binding fails. Clearly the error messages aren't helpful in this scenario, but that's the short version of the story. Also, if you add a new non-master table, you need to add it to the list of TABLES_EXEMPTED_FROM_TRANSLATION unless you've defined a translation implementation. (edited) 
View newer replies


zifan
:spiral_calendar_pad:  10:02 AM
:meow-wave: Hi team! Anyone who is familiar with JP pipelines know that if I need a special account to create money transfer for Mizuho transfers? I’m testing sendZenginFile to Mizuho from new JBA DC (nrt1b) using Teller Mizuho pipeline, which currently processes 0 transfers (I believe all Mizuho traffic goes through Ledger). So it would be less risky to test it from Teller.
I have used the bank account linked to this merchant to test SMBC and it went well. But from our JP IRO, he mentioned As for Mizuho, we only send money from Mizuho to Mizuho account.. So I’m looking for some help here to figure out the correct account I can use. Or same account I used to test SMBC works as well? :messenger-thanks:
:eyes:
1





9 replies
Last reply 11 months agoView thread


bta
  12:39 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-100336
(ledger @ a12fdc26f0835a7534610652f7613256dc5da88f to production)





10 replies
Last reply 11 months agoView thread


bta
  1:18 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


shigeki
  1:20 PM
was added to #ledger by zachs
.


bta
  2:18 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


lcheung
:spiral_calendar_pad:  3:00 PM
@oncall
, got a some rejected transfers from Wells Fargo via their secure message portal. I compiled them in this ticket. One of them is a Ledger transfer. Can you take care of failing that transfer?
:checkmark:
1






27 replies
Last reply 11 months agoView thread


bta
  3:17 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we're out on prod
deploy checks pass


andreyg
  4:04 PM
deploying fd34bee684c to staging
:checkmark:
1



tochi
  9:29 AM
Hi 
@oncall
, I am responding to a Capital alert and need some assistance.
I would like to confirm whether this refund LE was indeed deposited to the customer's bank account. I believe our system created this LE to net out this returned LE to prevent a retry debit from being initiated. However, it looks like the refund LE wasn't created quickly enough, so a credit ACH attempt was initiated. The customer recently relinked a bank account after a few years and new returned LEs have been created to retry failed debits.
Would you be able to help me confirm whether the funds were deposited to the merchant's bank account, or point me to who could help with that? It would help us decide whether this customer actually owes us more money than we have accounted for.
:checkmark:
1




5 replies
Last reply 11 months agoView thread


mnovich
  9:46 AM
Hey folks, is there a procedure for running backfills in Ledger?
:checkmark:
1




8 replies
Last reply 11 months agoView thread


andreyg
  11:28 AM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-100394
(ledger @ fd34bee684c to production)


7 replies
Last reply 11 months agoView thread


mnovich
  11:43 AM
@oncall
 I will be turning SPOOL back on now. It should not have any effect on ledger except some writes to the DB from kafka backlog
:+1:
2


1 reply
11 months agoView thread


mnovich
  11:53 AM
Roll to perform the backfill
https://jira.sqprod.co/browse/ROLL-100386
:eyes:
1




20 replies
Last reply 11 months agoView thread


bforehand
  12:01 PM
Can someone please take a look at this PR from the ledger team? I've resolved all the build issues back on Friday. Also, I can't actually create the SHIFTs because I don't have write permissions on the Ledger DB, so could someone create the SHIFTs for this and link them in the PR?
https://github.com/squareup/java/pull/254041



4 replies
Last reply 11 months agoView thread


petercrawford
  12:19 PM
Hey not sure this is the right channel for this question (still new / trying to navigate my way around :noobnoob:)...
I am working with the compliance and product teams on both the donations and fundraising products. A concern from the Compliance team is whether we would be able to tag transactions within regulator if they relate to a donation or fundraiser.
From discussions with regulator experience I was told it would depend on how data was represented in ledger/spot. Hoping someone here could advise
:eyes:
1





4 replies
Last reply 11 months agoView thread


andreyg
  12:31 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


andreyg
  1:31 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
(some metrics were impacted by a risks sev during this time but they have already recovered)
View newer replies


andreyg
  2:50 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass


mnovich
  2:55 PM
@oncall
 starting backfill ( will start with 1 merchant)
:ack-red:
2





33 replies
Last reply 11 months agoView thread


andreyg
  4:04 PM
deploying 488a292d6c3 to staging
:checkmark:
1



zifan
:spiral_calendar_pad:  5:27 PM
Hi team! Teller JP_MIZUHO_WEEKDAY is completed: https://square.slack.com/archives/C02UYAWD4L9/p1661300112703489. Since it has one transaction in it, it has sent 1 file to Mizuho. The Ledger pipeline runs at 5:35 PM PST will create and transmit the second file to Mizuho. We have notified Mizuho ahead of time, but please ping me if anything unexpected pops up.
:eyeballs:
2



2 replies
Last reply 11 months agoView thread


tochi
  10:54 AM
Hi team, is it normal for a RELEASE and REFUND Ledger entry to be created with the same timestamp as in the case of this payment?
:eyes:
2




13 replies
Last reply 11 months agoView thread


mnovich
  11:07 AM
@oncall
 i’m going to run a shift on staging.
:ack-red:
2




5 replies
Last reply 11 months agoView thread


andreyg
  12:14 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-100461
(ledger @ 488a292d6c3 to production)



8 replies
Last reply 11 months agoView thread


andreyg
  12:32 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


mnovich
  1:24 PM
@oncall
 i’m going to run a shift on sandbox
:ack-red:
1



2 replies
Last reply 11 months agoView thread


andreyg
  1:31 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


andreyg
  2:34 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass


mnovich
  2:37 PM
@oncall
 i’m going to run a shift on prod
:ack-red:
1



2 replies
Last reply 11 months agoView thread


mnovich
  2:41 PM
Hey Everyone, so as you may notice I’m running a shift to make settle_using_payouts non null. After it is done I will merge the PR with the schema change.
The problem is there are no more prod deployments this week.
Our guidance is to deploy the schema change ASAP after shift.
My question which risk is more tolerable to ledger - waiting on the deploy  until Monday or having 1 extra?
:checkmark:
1




20 replies
Last reply 11 months agoView thread


andreyg
  4:02 PM
deploying 6c8ae44e487 to staging
:checkmark:
1



bforehand
  9:31 AM
Can I please get someone to review and approve this PR? It's a simple addition of a new table for safeguarding to replace the existing ledger functionality: https://github.com/squareup/java/pull/254041 :pleasecat::pleasecat::pleasecat:
:eyes:
1



3 replies
Last reply 11 months agoView thread


mnovich
  9:51 AM
FYI - I am going to enable regular Payouts pipeline starting tomorrow at 7 30 am PST


sergey
  10:54 AM
hi #ledger! i have a config acl change PR here. can you take a look, please?
:eyes:
1
:checkmark:
1



2 replies
Last reply 11 months agoView thread


andreyg
  4:03 PM
deploying b0ac7fcfa75 to staging
:checkmark:
1



bforehand
  4:04 PM
replied to a thread:
I know folks are working on an ALERT, but could anyone help me out?…
I created the following PR to add documentation about this TranslationManagerConfig requirement for ledger:
https://github.com/squareup/java/pull/255496
:pray:
1
:stamp3:
1



amygertig
  4:35 PM
Hi, I'm looking to see if it's possible to query a report from Ledger showing total Net GPV and Net Processing Revenue for a given month and how much of that relates to ACH. Currently, F&S is using a Snowflake query to pull this information in which the source is ledger-entries, but I'm wondering if it's easy enough to get it straight from ledger. Thank you!
:checkmark:
1


1 reply
11 months agoView thread


sdixit
:no_entry:  8:00 AM
Hi Team,
I was looking at the CAPTURE records for FELICA payments in JP in the payment_revenue_fees in BQ from 2022-08-09 to today and found that for 8-23 there is a massive jump in the number of captures. Here’s the link with the output and the query I have used https://docs.google.com/spreadsheets/d/1Jl7EW0YqZA1gz18VgEy4s6pruDOYPC0A0DikE4hYhvc/edit?usp=sharing
Is this expected? Please let me know, if I am in the wrong channel for this.
3 files
 
image.png
image.png
PNG
image.png
image.png
PNG

FELICA payments
Google Sheet
:eyes:
1



2 replies
Last reply 11 months agoView thread


andreyg
  4:02 PM
deploying d622295991f to staging
:checkmark:
1



skaltenbach
  4:03 PM
:wave: Hi Team, I'm looking to get some context on what we use a TransactionFund for in the settlement process? It's my understanding that each SquareBankAccount has a single TransactionFund, but for example, It looks like there is only 1 GB transaction fund, GB_DEFAULT, which in ledger configuration is mapped to the general barclays PLATFORM account, so would this be the transaction fund used for any barclays BankAccount ? Asking as I see TransactionFunds used in ledger code, but not in Teller, so wondering what purpose it serves. Thanks :thank:
GbLedgerConfiguration.java
<https://github.com/squareup/java|squareup/java>squareup/java | Added by GitHub
GbBarclaysConfiguration.java
<https://github.com/squareup/java|squareup/java>squareup/java | Added by GitHub
:eyes:
1



7 replies
Last reply 11 months agoView thread


bforehand
  9:54 AM
:pleasecat: Can I get someone to approve this request so I can run the shifts for creating new tables in ledger: https://registry.sqprod.co/access_requests/234638
:stamp3:
1



bforehand
  10:28 AM
Any objections to me beginning to do the staging SHIFTs in this PR:
https://github.com/squareup/java/pull/254041
cc: 
@oncall
:ok_hand::skin-tone-3::ok_hand:
2




8 replies
Last reply 10 months agoView thread


bforehand
  11:17 AM
replied to a thread:
Any objections to me beginning to do the staging SHIFTs in this PR:…
Staging SHIFTs are complete. Proceeding to sandbox SHIFTs.
:ack-red:
1

View newer replies


andreyg
  11:29 AM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-100607
(ledgerhttps://jira.sqprod.co/browse/ROLL-100607 @ d622295991f to production)





+1
13 replies
Last reply 10 months agoView thread


andreyg
  12:37 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


bforehand
  1:14 PM
replied to a thread:
Any objections to me beginning to do the staging SHIFTs in this PR:…
Sandbox SHIFTs are complete. Any objections to proceed to production?
View newer replies


andreyg
  1:35 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


andreyg
  2:35 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass


bforehand
  3:10 PM
replied to a thread:
Any objections to me beginning to do the staging SHIFTs in this PR:…
Proceeding with production SHIFTs.
:ack-red:
1

View newer replies


andreyg
  4:03 PM
deploying aa84ca5357f to staging
:checkmark:
1



fernandoa
:no_entry:  7:51 AM
Hi team, could we get the dry run figure for today’s UK merchant settlement?



10 replies
Last reply 10 months agoView thread


kevink
:spiral_calendar_pad:  9:06 AM
Hello team - I’m working on a ticket where merchant is stuck on “Japan Acquirer Freeze” (ticket). Would ledger know how to remove the freeze?
:eyes:
1



2 replies
Last reply 10 months agoView thread


mgp
:baby:  9:19 AM
@oncall
 Okay if I run the OSCs on Ledger to add the merchant_features and merchant_feature_updates tables? The PR is at https://github.com/squareup/java/pull/255737 and its Shifts have been approved (edited) 
#255737 Add tables for merchant features
This adds the tables for merchant features using the schema from  
https://docs.google.com/document/d/1DqUWd9X3WlepyR4GJsqjTp763PPdVXVFyseQbZzmVeg/edit
ACTENG-4901
Labels
accounting-engineering
Comments
4
<https://github.com/squareup/java|squareup/java>squareup/java | Aug 29th, 2022 | Added by GitHub
:ok_hand:
1




7 replies
Last reply 10 months agoView thread


mgp
:baby:  11:51 AM
@oncall
 okay to run OSC https://github.com/squareup/java/pull/255893 on prod? It’s run on staging and sandbox successfully
#255893 Update table to merchant_features_history
This changes the table so that:
1. the table is named merchant_features_history
2. the feature name is now a varchar(30)
Labels
accounting-engineering
Comments
2
<https://github.com/squareup/java|squareup/java>squareup/java | Aug 30th, 2022 | Added by GitHub


2 replies
Last reply 10 months agoView thread


tianyu
  11:51 AM
Hi, I am from Payment Data Aggregation team and in the past week we ran into some issues with loading Ledger entry raw records into our BigQuery table due to changes made to this proto: https://prototype.sqprod.co/#/docs/squareup.ledger.TaxGroup.
The breaking changes are changing the type of fields from optional to repeated . Our data pipeline produces some pretty important data for #business-intelligence team and usually it takes 1-2 hours to fix the issue when such things happen. In the past week, we had 2 occurrences and it’s not ideal.
My ask is: is it possible to add my team or @tianyu , @fasih and @lucasc as owners of that Proto file (maybe using owner-owl) so that changes mades to that proto file need our approval to go through?
Thank you
:eyes:
1



27 replies
Last reply 10 months agoView thread


kcrane
:coolfingergun:  12:43 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-100668
(ledger @ aa84ca5357f to production)



6 replies
Last reply 10 months agoView thread


awelton
  12:44 PM
was added to #ledger by kcrane
.


kcrane
:coolfingergun:  12:50 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


kcrane
:coolfingergun:  1:20 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


mgp
:baby:  2:22 PM
@oncall
 now that Ledger is deployed is it okay to run OSC at https://github.com/squareup/java/pull/255911? It’s run on staging and sandbox successfully
#255911 Update table merchant_features
This re-creates the table using the updated schema decided on.
Labels
accounting-engineering
Comments
2
<https://github.com/squareup/java|squareup/java>squareup/java | Aug 30th, 2022 | Added by GitHub
:ok_hand:
1



2 replies
Last reply 10 months agoView thread


ishvydchenko
  2:48 PM
Hey team!
Our understanding is that Ledger will unlink a merchants linked bank account if they have 1 "hard" ACH failure or 3 "soft" ACH failures.
We had a few questions about this to help us make an informed decision:
Are any stats on how many merchants with a negative ledger balance never re-link a bank account again (so the funds are never pulled)?
Are any safeguards or procedures in this case?
(edited)
:checkmark:
1




27 replies
Last reply 10 months agoView thread


escates
  2:50 PM
Hi Team! This Strategic Seller/MLH0F20Y2Q6WR is very frustrated that some of their refunds are pulling from the next day's sales (example refund).  In this example, the payment processed before our 7pm CST cut off time, but the payment settled after that timeframe, causing the refund associated with that payment to pull from the following day's sales.
How can I find out more about the cutoff time that is established for processed payments to be included in the current day's deposit/transfer? I've always been told this was due to banking regulations that we must adhere to but the seller is questioning that this is true.
Which team can I speak with to better understand the amount of time it takes us to settle payments? I know that Risk has to review payments but it's unlcear why a payment processed at 5:46pm CST (like the above example) would take 2 hrs to settle when other payments settle in less time.
(for reference: link to earlier thread here in #ledger) (edited) 


lugo
Strategic Account MT MLH0F20Y2Q6WR - Question - Hi team - Please re-direct me if I am in the wrong place. Seller is wants to know if refunds are always debited from net sales from the previous day or if this is due to their transfer time which is set to 2nd business day. Example referenced
Thread in ledger | Jul 1st, 2022 | View message
:checkmark:
1
:eyes:
1



7 replies
Last reply 10 months agoView thread


kcrane
:coolfingergun:  3:30 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we're out on prod
deploy checks pass


bforehand
  3:53 PM
Under what circumstances is LEDGER_ENTRY_BATCHES.TRANSACTION_FUND_ID.isNull() true for a ledger entry?
:eyes:
1





33 replies
Last reply 10 months agoView thread


kcrane
:coolfingergun:  4:14 PM
deploying 2ec5645aef9 to staging


ishvydchenko
  5:27 PM
Hey team! Another quick question, can merchants with deactivated or frozen Ledger balances still take payments/will they still have captures? (edited) 
:eyes:
1



16 replies
Last reply 10 months agoView thread


jlazarus
  8:33 AM
@oncall
, I'm trying to track down some refunds which should have been issued. The seller claims to have not received them. Are you all able to help me find information regarding them? I didn't see anything useful in the SaaS data that we have.
This is for https://jira.sqprod.co/browse/ONCALL-138534
:eyes:
1





20 replies
Last reply 10 months agoView thread


andreyg
  12:00 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-100725
(ledger @ 2ec5645aef9 to production)


5 replies
Last reply 10 months agoView thread


andreyg
  12:33 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


rho
  1:03 PM
replied to a thread:
@oncall we’re seeing a repeat of this situation. Could you check if there are any pending review payments for unit 6EX0ZA2790WFZ? Also as a feature request if we could filter by unit token in ListPendingManualReviewPayments we wouldn’t have to bother you for this.
@oncall
 once again seeing payments not cleared by Ledger for this internal Square merchant 6EX0ZA2790WFZ. Can you provide a list of pending review payment tokens and I can re-feed the clears? Still haven’t had time to investigate the root cause  :confused:
:eyes:
1

View newer replies


bforehand
  1:12 PM
Are there manual scheduled UK (or SEPA) merchants? Do we know if MoneySweeper is ever used with UK (or SEPA) merchants? If so, I think MoneySweeper will break safeguarding for these merchants.


andreyg
  1:33 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


andreyg
  2:37 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass


andreyg
  4:05 PM
deploying f9aafc65369 to staging
:checkmark:
1



lindac
:baby-baby:  4:16 PM
Hello Ledger team! I work on the Investigations team and am trying to reconcile our loss on LBVSHF1G39X5E. I see two entries on the Ledger for Initial Balance Change. Is anyone able to explain what these adjustments mean? Thanks in advance for the help! :thank:
:pray9:
1
:eyes:
1




5 replies
Last reply 10 months agoView thread


shivin
:palm_tree:  12:59 PM
Hi Ledger Team - We are facing an issue where fraudsters are accessing dormant accounts through compromised emails. We were thinking of building a solution that detects dormant accounts and freezes settlements (money flowing out of Square accounts). Would freezes on settlements also include sellers' issued debit/credit cards? We'd like to stop the flow of money out of these dormant square accounts.
:eyes:
2




11 replies
Last reply 10 months agoView thread


kcrane
:coolfingergun:  4:17 PM
deploying 35c040af9df to staging


dskarbek
  6:03 PM
deploying 018d1188a91 to staging.  This is the build that has our multiple tax-on-fee changes in it.


parkjane
  3:40 PM
Hi Team :wave: may I get this PR reviewed? It's to add a service to ACL to call ShardMapperService https://github.com/squareup/java/pull/256440 . Also added dependency to ledger from the service: https://registry.sqprod.co/app_dependency_requests/26538
The service, actions, is a cloud-based (AWS) replacement of original Regulator action, in which the lambdas need to have access to these services to replicate freeze action. Please let me know if you need more details! Thank you.


2 replies
Last reply 10 months agoView thread


emilyl
  4:03 PM
deploying 16fbd07f6db (latest) to staging


mengen
  12:42 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-100867
(ledger @ 16fbd07f6dbf25608c50c8b08602bd71e0c40d13 to production)





+3
34 replies
Last reply 10 months agoView thread


mengen
  1:18 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


zzhang
  1:24 PM
Hi Ledger team, there is a case when a transaction is flagged for a temp hold by Risk and then released, the assessment ends up debiting the seller’s external account which fails, could you take a look at this and see how we can fix it? https://jira.sqprod.co/browse/ONCALL-138716 cc: our current oncall 
@jcui
 and requester 
@rzoltek




9 replies
Last reply 10 months agoView thread


rzoltek
  1:51 PM
was added to #ledger by zzhang
.


mengen
  2:24 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


mengen
  3:44 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass


dskarbek
  4:19 PM
Deploying f8ed7a1c482 to STAGING

root
APP  7:23 AM
ODS host fpd1529.sjc3b.square (pd-odsgroup381) is down
No action is needed from you. ODS oncall will try to successover metaclusters if they are active on this host.
Please see the #situation channel for more information.
apps affected: ledger
metaclusters affected for these apps:
- pd-mysql-ledger-008
Cc: 
@oncall

1 reply
10 months agoView thread


mnovich
  9:26 AM
which semantics are we using to add indexes is ledger ?
CREATE INDEX IF NOT EXIST or ALTER TABLE ADD INDEX?


mnovich
  11:55 AM
Hey everyone. Can someone approve these shifts:
https://square-console.sqprod.co/app/ledger/databases/shift/request/20831
https://square-console.sqprod.co/app/ledger/databases/shift/request/20832
https://square-console.sqprod.co/app/ledger/databases/shift/request/20833
PR approved by 
@mgp
 but he is out (edited) 
:eyes:
1
:stamp:
1





14 replies
Last reply 10 months agoView thread


mnovich
  11:56 AM
image.png
 
image.png


emilyl
  12:22 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-100920
(ledger @ f8ed7a1c482 to production)




10 replies
Last reply 10 months agoView thread


emilyl
  12:39 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


emilyl
  1:16 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


mnovich
  1:57 PM
@emilyl
 is it safe for me to run a sandbx shift ?




19 replies
Last reply 10 months agoView thread


parkjane
  2:33 PM
Hi Team :wave: I was wondering if I could get the canary build f84a07f deployed to staging? Thank you!


emilyl
  2:40 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass


emilyl
  4:04 PM
deploying 5108a30b53b (latest) to staging


emilyl
  6:21 PM
deploying 09efa638211 (latest) to staging


dskarbek
  11:12 PM
deploying 09efa638211 (latest) to staging


mnovich
  9:16 AM
@oncall
 can I run a production shift?
https://square-console.sqprod.co/app/ledger/databases/shift/request/20833




16 replies
Last reply 10 months agoView thread


mnovich
  9:58 AM
replied to a thread:
@oncall can I run a production shift?…
starting production SHIFT
View newer replies


mnovich
  11:09 AM
replied to a thread:
@oncall can I run a production shift?…
We have an ability to increase the speed of the SHIFT on slow clusters. Does anyone have experience with it? Is it a good idea?
image.png
 
image.png
View newer replies


sxiong
  11:31 AM
Hello, am I able to access merchant settlement states through Snowflake instead of the RPC client? Is "LEDGER"."RAW_FEEDS"."MERCHANT_SETTLEMENT_STATE" the right Snowflake table?
I’m trying to create a dashboard that shows all merchants that have a certain loan type and have an unlinked bank account: CANDEBIT == false
:checkmark:
1



6 replies
Last reply 10 months agoView thread


mengen
  1:12 PM
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-100997 (ledger @ 66a74a43743889720c61f4a59d8e0457c3c65c18 to production)



7 replies
Last reply 10 months agoView thread


mengen
  1:23 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-100997 (ledger @ 66a74a43743889720c61f4a59d8e0457c3c65c18 to production)
staging checks pass
:canary: canary start
View newer replies


mengen
  2:47 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-100997 (ledger @ 66a74a43743889720c61f4a59d8e0457c3c65c18 to production)
:shipitparrot: we’re out on prod
deploy checks pass


emilyl
  4:08 PM
deploying c149f0fd5d0 (latest) to staging


tmahoney
  4:26 PM
is MerchantSettlementState still actively maintained/not-deprecated? and (if so) what’s the difference between checking for MerchantSettlementState.Reason.FROZEN/SUSPECTED through Ledger, and querying Roster/Kases respectively for the same?


16 replies
Last reply 10 months agoView thread


bforehand
  5:08 PM
@oncall
: Can someone look up the file transmission details for this ledger transfer? As part of ONCALL-139069, I've been asked to collect a "Proof of Transfer" from Barclays, but I'm assuming they will need the relevant file details to produce this.
:ack-green:
1





18 replies
Last reply 10 months agoView thread


parkjane
  10:20 AM
Hi Team :wave: I was wondering if I could get this PR approved. It's to add actions service to ACL to call Freeze-related services that are called by Regulator. [Related info/PR] Please let me know if you need more information. Thank you!

1 reply
10 months agoView thread


escates
  2:33 PM
Hi Team, can someone confirm what this $0.33 fee is that's listed on ledger entry for this payment? Could it be related to VISA FANF?


3 replies
Last reply 10 months agoView thread


carol
:spiral_calendar_pad:  10:27 AM
Hi team, there is a new UK banking holiday on 9/19 for the Queen’s funeral.  
@prabhjot
 has already made the code change (PR here).  Could you please make sure it’s rolled out this week?  Thank you!
:eyes:
1


1 reply
10 months agoView thread


parkjane
  10:46 AM
Hi Team :wave: What's the deployment schedule like? Not urgent but I was wondering if I could get the canary build 5a665b1 deployed to staging. Thank you!


3 replies
Last reply 10 months agoView thread


senth
  11:35 AM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-101075
(ledger @ c149f0fd5d0718f62f33bec69056b369558d700c to production)



7 replies
Last reply 10 months agoView thread


senth
  12:22 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


senth
  12:55 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
:pray:
3

View newer replies


senth
  2:28 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we're out on prod
deploy checks pass
:tada:
1



bforehand
  3:19 PM
Does anyone know where there are so many instances of this log item for a single pipeline run?
https://square-console.sqprod.co/presidio/search?endpoint=combined-prod&query=diagnostic_context.com.squareup.logging.SpeleoTraceId:zERHeDTaKbbSc+%22Safeguard+batches+inserted+per+transaction+fund%22&timerange=-86400%7Enow

3 replies
Last reply 10 months agoView thread


senth
  4:14 PM
Deploying latest master (158c77465a63a193e7fe5032e733d1b800039526) in Ledger staging


senth
  11:21 AM
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-101126
(ledger @ 158c77465a63a193e7fe5032e733d1b800039526 to production)
:bugcat_thanks:
1



6 replies
Last reply 10 months agoView thread


alicezhang
  11:24 AM
was added to #ledger by senth
.


senth
  12:18 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-101126…
staging checks pass
:canary: canary start
View newer replies


senth
  12:45 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-101126…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


zeke
  12:50 PM
Hi all, just an FYI that risk infra is planning on rolling out our new backstop evaluation system (ROLL-101107) in Magistrate tomorrow at 10:30AM PT. There should be no noticeable change from Ledger’s perspective, but please let us know if you see anything strange with the risk state feed.
:ack-red:
2



smartin
  2:33 PM
@oncall
 can I take staging for a few to test a canary?


2 replies
Last reply 10 months agoView thread


smartin
  2:36 PM
deploying fb4cc06756a6 to staging
:done:
1


1 reply
10 months agoView thread


senth
  3:00 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-101126…
:shipitparrot: we're out on prod
deploy checks pass


senth
  4:25 PM
Deploying Ledger stating with latest master SHA of 28878db87df80dfb9d631b9b74c3e2ce5b8cbb33, will probably do another deployment later today once another change we're tracking is merged and built.


senth
  5:10 PM
Deploying Ledger staging with 9d1ef5079f80cc7919c35af0d8ea397009c76ec7 to pick up a fix


andrewsantos
:palm_tree:  8:43 AM
Hi 
@oncall
 :wave:. CBMS got some errors when calling createDispute in ledger regarding invalid payment tokens. Squareup::ledger::service::DisputeService#create_dispute received status 404 with error No CardPayment loaded for merchantToken FJS9X82NTJW2Z and paymentToken blscKk08wyUgqQVr9N5OKwG3vaB: NOT_FOUND and Squareup::ledger::service::DisputeService#create_dispute received status 404 with error No CardPayment loaded for merchantToken FJS9X82NTJW2Z and paymentToken 3fsZUnsmX7qzEDZDRCM0gKuLvaB: NOT_FOUND.  When I search for these paymentTokens in Spot, I do see them exist with that merchant token however.  Would someone be able to help me figure out what is going on?



5 replies
Last reply 10 months agoView thread


raul
:spiral_calendar_pad:  9:45 AM
Hey all! Just want to confirm that the merchant_token in this RPC is in fact referring to a MASTER_MERCHANT and not a UNIT . Thanks in advance! (Also if this is not the correct place to ask please let me know!) :frogparty:
:eyes:
1
:checkmark:
1




5 replies
Last reply 10 months agoView thread


escates
  11:05 AM
[Strategic Account] Hey Team, MLH0F20Y2Q6WR has their transfers set to 2nd Business Day w/ COD at 11pm CST. If they process a transaction today at 6pm CST and issue a refund tomorrow at 10am CST, for example, we will pull the refund from tomorrow's sales. They're questioning why we aren't able to pull refunds from the same day the original transaction processed since their transfer schedule is set to 2nd business day. Can someone clarify?
They're aware of our 7pm CST cutoff time but believe that their transfer schedule should determine when we're settling their transactions.
cc: 
@lugo
:eyes:
2



7 replies
Last reply 10 months agoView thread


mnovich
  11:38 AM
@oncall
 I’d like to run 2 ROLLS on ledger prod to clean corrupted payouts data before status check update today.
https://jira.sqprod.co/browse/ROLL-101156
https://jira.sqprod.co/browse/ROLL-101181
both were run on staging shard 6 and verified to work correctly.
Additionally I ran an explain on prod shard 16 to verify it will not do a full table scan.
I do have a question if we have an ability to run a --rw query on all shards
:eyes:
2






31 replies
Last reply 10 months agoView thread


songlin
  12:02 PM
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-101186
(ledger @ 9d1ef5079f80cc7919c35af0d8ea397009c76ec7 to production)




7 replies
Last reply 10 months agoView thread


songlin
  12:13 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-101186…
staging checks pass
:canary: canary start
View newer replies


songlin
  12:54 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-101186…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


songlin
  2:30 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-101186…
:shipitparrot: we're out on prod
deploy checks pass
:dance_and_wear_sunnies:
1

View newer replies


mnovich
  3:05 PM
replied to a thread:
@oncall I’d like to run 2 ROLLS on ledger prod to clean corrupted payouts data before status check update today.…
Starting ROLL https://jira.sqprod.co/browse/ROLL-101181
View newer replies


mnovich
  3:23 PM
replied to a thread:
@oncall I’d like to run 2 ROLLS on ledger prod to clean corrupted payouts data before status check update today.…
we are done. Status check is clear now.
https://ledger.sqprod.co/_system_status/stuck-payouts
:clap-clap:
5



senth
  4:51 PM
Deploying Ledger staging with sha ab1165a0934e5776846a043920a95ec72d0ba9bb
:bugcat_thanks:
1



rfutrell
  6:36 AM
This is a pretty vague question, but the SaaS team has noticed ledger ACH transactions have been slower to resolve the past couple of weeks. Might there be a reason for this, or maybe it's just coincidental? I don't quite have a good query to prove this other than for the past couple of weeks, the number of SaaS bills pending for > 3 days has spiked. Is ACH turnaround time a metric that gets tracked?


2 replies
Last reply 10 months agoView thread


fernandoa
:no_entry:  9:57 AM
Hi team, regarding the upcoming bank holiday in the UK on Monday 19th, could you please confirm that no payment batch will be sent via Barclays Gateway on that day? cc
@mgp
 
@akowalsky
 (edited) 
:checkmark:
1



3 replies
Last reply 10 months agoView thread


mgp
:baby:  10:41 AM
@oncall
 Am I good to run the Shifts defined by https://github.com/squareup/java/pull/257673 ? :bless:
#257673 Create SJQ tables for dry run
These were generated by running
shardedjobqueue/sql_template/create-migration.sh complete_payout_events_dry_run
Labels
accounting-engineering
Comments
3
<https://github.com/squareup/java|squareup/java>squareup/java | Sep 15th, 2022 | Added by GitHub
:ack:
2




7 replies
Last reply 10 months agoView thread


mnovich
  11:25 AM
@oncall
 is there a possibility we can deploy ledger to Prod today? the changes in the pipes are crucial to resolving the stuck-payouts check without the need to run ROLLS and bd updates. This message was sponsored by 
@mgp
 (edited) 
:this3:
1






+1
26 replies
Last reply 10 months agoView thread


mgp
:baby:  11:51 AM
@oncall
 Am I good to run another round of Shifts, this time for https://github.com/squareup/java/pull/257699? (They are similar to the ones run about an hour ago — just inserting tables…)
#257699 Create SJQ tables for live run
These were generated by running
shardedjobqueue/sql_template/create-migration.sh complete_payout_events_live_run
Labels
accounting-engineering
Comments
2
<https://github.com/squareup/java|squareup/java>squareup/java | Sep 15th, 2022 | Added by GitHub




11 replies
Last reply 10 months agoView thread


songlin
  12:01 PM
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-101241
(ledger @ ab1165a0934e5776846a043920a95ec72d0ba9bb to production)

7 replies
Last reply 10 months agoView thread


songlin
  12:02 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-101241…
deploy to prod today to fix stuck-payouts  issue, will start after 
@mgp
’s migration done
View newer replies


kdavis
:baby:  12:05 PM
was added to #ledger by songlin
.


songlin
  12:13 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-101241…
staging checks pass
:canary: canary start
View newer replies


songlin
  12:55 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-101241…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


sarve
  1:57 PM
@oncall
 FYI - We have enabled the dead letter queue for complete-payout-feed consumer in Ledger, the policy has been set to retry_all
:nice:
2
:ack:
1


1 reply
10 months agoView thread


jensheng
:no_entry:  2:00 PM
:wave: team, any chance that y'all are looking to fix the getOverrides flag for feature-editor per the ticket here: https://jira.sqprod.co/browse/ACTENG-4763? it would be great if it will be fixed by end of Q3


2 replies
Last reply 10 months agoView thread


songlin
  2:20 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-101241…
:shipitparrot: we're out on prod
deploy checks pass
:party-cat:
3
:taco-dance:
2



senth
  3:57 PM
Deploying Ledger staging with latest master sha of ba03e7232c20a38e1101aff358d1bb2cb4d91c71
:thank:
1



sarve
  7:07 AM
@oncall
 FYI - There may be a stuck transfer alert for payouts in COMPLETING status in a few minutes. As long as the reference id is 3ec9c969-e794-4a5a-9032-0c2c3d134909 , it can be ignored.
Feel free to transfer the page to Banking Connections
:ack:
1


1 reply
10 months agoView thread


hoyi
  9:15 AM
Deploying a56e065e35c8a0569e2e2418694947ede1d55be3 (latest) to staging
:ack:
1



rho
  10:34 AM
replied to a thread:
@oncall we’re seeing a repeat of this situation. Could you check if there are any pending review payments for unit 6EX0ZA2790WFZ? Also as a feature request if we could filter by unit token in ListPendingManualReviewPayments we wouldn’t have to bother you for this.
Hi, I got a report that it’s happening again for the same ecom merchant 6EX0ZA2790WFZ . Any ideas? https://square.slack.com/archives/CB4RY3R2B/p1663348739999109?thread_ts=1654289846.797989&cid=CB4RY3R2B
:eyes:
1

View newer replies

root
APP  10:48 AM
ODS host fpd1529.sjc3b.square (pd-odsgroup381) is down
No action is needed from you. ODS oncall will try to successover metaclusters if they are active on this host.
Please see the #situation channel for more information.
apps affected: ledger
metaclusters affected for these apps:
- pd-mysql-ledger-008
Cc: 
@oncall

1 reply
10 months agoView thread


hoyi
  5:13 PM
Deploying latest (98fae6de0e8) to staging

root
APP  9:50 PM
ODS host fpd1516.sjc3b.square (pd-odsgroup374) is down
No action is needed from you. ODS oncall will try to successover metaclusters if they are active on this host.
Please see the #situation channel for more information.
apps affected: ledger
metaclusters affected for these apps:
- pd-mysql-ledger-001
- pd-mysql-ledger-012
Cc: 
@oncall

1 reply
10 months agoView thread


hoyi
  9:54 PM
:eyes:
9:55
Master database going down most likely took Ledger offline for a few minutes (edited) 
9:57
no RPCs were returning 200 from ~00:45 EDT to ~00:55 EDT (~21:45 PDT to ~21:55 PDT; ~04:45 UTC to ~04:55 UTC)
9:57
Looks like we’re back though


bjoseph
  12:08 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-101311
(ledger @ 98fae6de0e8a8a6bc96317dad9f4c6ee35f720b4 to production)
:+1:
4



5 replies
Last reply 10 months agoView thread


bjoseph
  12:29 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


ssopp
  12:43 PM
Hey folks, is there a means for creating arbitrary LedgerEntry in staging? I'm an eng on Capital, and 
@reilly
 and I are trying to figure out how to test more complex payment scenarios that involve events like disputes, risk holds, etc. We have virtual terminal for capture and refunds, but haven't anything that allows us to easily create other events. (edited) 


2 replies
Last reply 10 months agoView thread


bjoseph
  1:00 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies

PayswingBot
APP  1:06 PM
Evacuating payments traffic from WEST datacenters (swinging EAST) in production has been initiated by davidsmith

PayswingBot
APP  1:41 PM
Restoring normal payments traffic (unswinging) in production has been initiated by davidsmith


bjoseph
  2:04 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we're out on prod
deploy checks pass


bjoseph
  4:02 PM
deploying 1698da4d04b to staging


mykola
:spiral_calendar_pad:  5:18 PM
Hey Team,
It looks like ledger may be using account_number_suffix field from BankAccount proto produced by BAAPI.
We are currently evaluating a possibility of returning two characters long suffix for some customer bank accounts linked through Plaid (usually it is three characters long).
Is it possible to check if this will cause any issues on your side? (whether you specifically rely on having three characters in it?)
Thanks!
:eyes:
1



7 replies
Last reply 10 months agoView thread


hoyi
  10:10 AM
set the channel topic: ALERT-10779 | Discussion for https://registry.sso.global.square/apps/ledger | Contact @oncall for questions | Emergency page the entire team: https://go/ledger911


hoyi
  10:41 AM
set the channel topic: Stable | Discussion for https://registry.sso.global.square/apps/ledger | Contact @oncall for questions | Emergency page the entire team: https://go/ledger911


bjoseph
  12:09 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-101378
(ledger @ 1698da4d04b04225844fccdfd0511b0dded43f1a to production)
:+1:
2



5 replies
Last reply 10 months agoView thread


bjoseph
  12:24 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


bjoseph
  12:58 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


sarve
  1:54 PM
@oncall
 I am doing some CompletePayout calls from the Admin Console to clear up the status
:ack:
1






23 replies
Last reply 10 months agoView thread


bjoseph
  2:05 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we're out on prod
deploy checks pass
:celeryman3:
1



mgrab
:spiral_calendar_pad:  3:26 PM
Hi team, I’m starting work on a feature for Billpay that has to do with respecting freezes on units. We will also need to take some action when a freeze is lifted. I was thinking of listening to the ledger freeze feed, but from looking at the proto I’m not sure that it publishes an entry when a freeze is lifted. Is that correct?
:eyes:
1
:checkmark:
1



5 replies
Last reply 10 months agoView thread


bjoseph
  4:02 PM
deploying a086f745913 to staging


ishvydchenko
  9:14 AM
Hey team, quick question - We were wondering if a merchant is frozen or deactivated would we still get their full ledger balance from the ClearedBalanceV2 endpoint? or would we see 0 balance because of their status?
:eyes:
1
:checkmark:
1



8 replies
Last reply 10 months agoView thread


chansen
  12:04 PM
Hey team, quick question: if we see that a merchant has NO_VERIFIED_BANK_ACCOUNT - is it possible for them to have any linked bank accounts at all, or does this specifically mean that they have none?
:eyes:
1



3 replies
Last reply 10 months agoView thread


bjoseph
  12:37 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-101440
(ledger @ a086f7459131f8f60b062b80481253a5a6cb6fbd to production)
:+1:
4




9 replies
Last reply 10 months agoView thread


agajardo
:spiral_calendar_pad:  12:45 PM
Hello team.  Could I get eyes on this Pull Request to add our service riskproxy  to ledger’s access control list config files.  We make a call to the ListMerchantSettlementStates endpoint. (edited) 
#258307 [ledger] Add riskproxy to ledger acl ymls
Adding service riskproxy to Access Control Files since we call ledger's ListMerchantSettlementStates endpoint to get whether a merchant has been frozen or suspected.
PR for adding LedgerClient to riskproxy
Labels
accounting-engineering
Comments
2
<https://github.com/squareup/java|squareup/java>squareup/java | Sep 21st, 2022 | Added by GitHub
:stamp3:
1



bjoseph
  12:54 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


bjoseph
  1:26 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


bjoseph
  2:28 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we're out on prod
deploy checks pass
:celeryman3:
1



bjoseph
  4:02 PM
deploying 728019520bf to staging


rohitdinakar
:spiral_calendar_pad:  10:32 AM
Hi Team, we (magistrate) are seeing 1 stale payment that ledger is yet to clear. Magistrate has already published the terminal risk state for this payment. Any thoughts on why ledger still hasn't cleared this payment? https://rqm.iad1.sqprod.co/index/payment#/query/payment/NoXpDwMKzSnY1Vs11eui41ssuaB
:eyes:
1
:checkmark:
1


1 reply
10 months agoView thread


bjoseph
  4:03 PM
deploying ac71b3da26b to staging


dchung
:spiral_calendar_pad:  7:24 AM
Hi folks, what’s the best way to identify the tip and tax information for a given transaction?
The ultimate goal is to understand how we exclude those amounts from being included in hold rate assessment. Currently, that calculation is done (I believe) on LedgerEntry’s to_user_amount, which is inclusive of tax and tip.

1 reply
10 months agoView thread


cierraw
  11:06 AM
Hi Team! I’m not sure if this is the right channel. Due to the internal_public snowflake deprecation, these Sales roles lost access to the snowflake LEDGER database, which is referenced in Sales reporting. Could we have long term read-only access restored for these roles in go/registry please? Thanks!
https://registry.sqprod.co/roles/sales_lead
https://registry.sqprod.co/roles/sales-analyst
https://registry.sqprod.co/roles/sales-developer
https://registry.sqprod.co/roles/accountexec
https://registry.sqprod.co/roles/sales-account-management-lead
:eyes:
1
:checkmark:
1



9 replies
Last reply 10 months agoView thread


kasia
:palm_tree:  11:21 AM
was added to #ledger by cierraw
.


andreyg
  4:02 PM
deploying 0074a1999f5 to staging
:checkmark:
1



mnovich
  9:42 AM
Hey everyone. Can someone assist here? The transfers are all ledger and are marked succeed. Bank delays?


zjungmann
Hi there! We seem to have a problem with IE transfers to AIB bank accounts from over the weekend. Issue may only be a delay but had four separate merchants contact CS this morning about it. See jira. Let me know if I'm better off flagging this with #treasury or I'm in the wrong place!
Posted in banking-connections | Sep 26th, 2022 | View message
:checkmark:
1


1 reply
10 months agoView thread


atyansh
:spiral_calendar_pad:  10:43 AM
Hey folks, we’re getting paged for errors being thrown from our PrivacyVault.protect service where the calling app is Ledger.
https://sentry.io/organizations/square-inc/issues/3445162279/?project=1224914&query=is%3Aunresolved
The error seems to be IllegalArgumentException: token doesn't look like valid token: p5-BkQF9SyGM_J59gKi4uA
This is not a valid token format so we think something is off with Ledger here as it’s sending an invalid token to the Protect service. Could you folks help investigate this? 
@oncall
Ledger has been repeating this request on loop since 1am PT today.
IllegalArgumentException
token doesn't look like valid token: p5-BkQF9SyGM_J59gKi4uA
PRIVACY-VAULT-PRODUCTION-1M8VPRIVACY-VAULT-PRODUCTION-1M8V | Sep 26th, 2022 | Added by Sentry
Select Assignee...
:eyes:
2
:checkmark:
1





11 replies
Last reply 10 months agoView thread


bta
  12:48 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-101568
(ledger @ 0074a1999f581e9c27343fc8fe63830ae12150a6 to production)


5 replies
Last reply 10 months agoView thread


bta
  1:12 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


bta
  1:55 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


bta
  2:54 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we're out on prod
deploy checks pass


bforehand
  3:49 PM
PR to make column nullable prior to removing it:
https://github.com/squareup/java/pull/258861
This table is currently empty, but it is only used by the new payouts code for safeguarding, so this should not be impactful to ledger. I've also created the SHIFT that needs reviewing here as well:
https://square-console.sqprod.co/app/ledger/databases/shift/request/21243
:stamp3:
1



andreyg
  4:03 PM
deploying af734b1665e to staging
:checkmark:
1



smartin
  10:06 AM
@oncall
 Ok if I run the following roll in prod: https://jira.sqprod.co/browse/ROLL-101613? (edited) 
:+1:
1
:checkmark:
1




9 replies
Last reply 10 months agoView thread


andreyg
  11:32 AM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-101646
(ledger @ 88b4b3e98de to production)
:+1:
3




6 replies
Last reply 10 months agoView thread


andreyg
  12:32 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


andreyg
  1:11 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


ishvydchenko
  1:13 PM
Hey team! Any change there is existing metrics on how long it takes for  pending balances to clear and become available (for non automatic transfer sellers since I think those only clear with the nightly settlement process)?
:eyes:
1



7 replies
Last reply 10 months agoView thread


andreyg
  2:14 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass


bforehand
  2:44 PM
Another stub endpoint PR: https://github.com/squareup/java/pull/258977
:stamp:
1



andreyg
  4:06 PM
deploying 0f749fb43cc to staging
:checkmark:
1



greddiar
  12:13 PM
Hello Team! I am from Customer Success Analytics and I am reaching out to see if you can grant this access request as we're using tables in the 'Ledger' database in our ETLs. We sent a request earlier which expired as the access was not granted on time. CC: 
@nisheeth
 (edited) 
:eyes:
1
:checkmark:
1



3 replies
Last reply 10 months agoView thread


nisheeth
  12:13 PM
was added to #ledger by greddiar
.


bta
  12:30 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-101703
(ledger @ 0f749fb43cc578247549a437ccfa8bb8a91e002a to production)
:+1:
2





6 replies
Last reply 9 months agoView thread


bta
  1:17 PM
replied to a thread:
Ledger ROLL:…
Cancelling deployment today due to guard against an issue found this morning


shuwei
  2:55 PM
Hello, is anyone available to assist with Snowflake access for myself (Shuwei Hu) and Ashley Whitehall from Sanctions Ops?
After the clean up , our old queries no longer work. We use Snowflake to search for merchant token numbers for our Partner Acquirer escalations
:eyes:
1


1 reply
9 months agoView thread


lishahe
:spiral_calendar_pad:  3:51 PM
Hi, I am working on Costplus that consume the LedgerEntryFeed. I am wondering is it possible to add cardType to the feed ( credit vs debit), that information will save us querying BQ.
:eyes:
1
:checkmark:
1




11 replies
Last reply 9 months agoView thread


andreyg
  4:03 PM
deploying 15f89962911 to staging


mengen
  6:31 PM
deploying 53f8d798866  to staging


tmahoney
  7:20 AM
:wave: can I request a staging deploy whenever someone’s online and has a moment? was working on testing the Refundsarbiter->CancelRefundLedgerEntry UR integration last night, seemed like there was an issue in staging around the undo amount sign, and it looks like https://github.com/squareup/java/pull/259238 fixes that but isn’t in staging yet
#259238 ACTENG-4895 fix undo unlinked refund amount sign
Labels
accounting-engineering
Comments
2
<https://github.com/squareup/java|squareup/java>squareup/java | Sep 28th, 2022 | Added by GitHub
:eyes:
1
:checkmark:
1
:bless:
1



2 replies
Last reply 9 months agoView thread


bta
  9:00 AM
deploying 56563ada793 to staging
:pray:
1



bforehand
  9:38 AM
Does anyone know why all the various (master-only) data stores are linked into MasterDataStore and classes rely on this even when they only need a single sub-datastore out of that massive class? This seems to be a huge centralization of dependencies for no apparent reason. I see lots of classes that get and use a single Data Store from the MasterDataStore, but @Inject the entire MasterDataStore meaning they incur dependencies on all the other random data store classes. I would consider the MasterDataStore object an anti-pattern in and of itself. The point of dependency injection is to name only the dependencies you truly need. Depending on "god-objects" like MasterDataStore is bad.
:cat-popcorn:
1




13 replies
Last reply 9 months agoView thread


eyung
  9:52 AM
hi, this code is sort of a no man’s land right now, but does anyone mind taking a look at this? the diff shouldn’t be too big, and the PR should be conceptually simple: https://github.com/squareup/java/pull/259309
:eyes:
1




5 replies
Last reply 9 months agoView thread


shuwei
  11:20 AM
Hello!  I've requested "ledger--snowflake__read_only" access be added to the Sanctions group
:eyes:
1
:checkmark:
1

11:21
Sanctions lost our access after the Snow Flake cleanup


shuwei
  11:21 AM
Please let me know once this request has been approved, thank you!
:checkmark:
1


1 reply
9 months agoView thread


prabhjot
:no_entry:  11:41 AM
Hi, Can someone please take a look this ROLL? We need to rewind the ledgerMerchantSettlementStateEntryFeed so we can backfill the updated_at field to PSS
:eyes:
1
:stamp:
1





34 replies
Last reply 9 months agoView thread


mgrab
:spiral_calendar_pad:  2:36 PM
Hi team, I have a design doc for a project that will integrate with ledger, feel free to take a look: https://docs.google.com/document/d/1ZIPNdrbA57zh9WNl8Pw_HRFCwl9bIIYY0YFWNXBfywE/edit?usp=sharing
G Suite Document
 

Billpay Server - Deactivation and freeze compliance
Google Doc


andreyg
  4:06 PM
deploying 4ae0c052f10 to staging
:checkmark:
1



prabhjot
:no_entry:  8:57 AM
replied to a thread:
Hi, Can someone please take a look this ROLL? We need to rewind the ledgerMerchantSettlementStateEntryFeed so we can backfill the updated_at field to PSS
@oncall
 starting this ROLL
View newer replies


bforehand
  11:38 AM
PR to add index to payout-related safeguarding table:
https://github.com/squareup/java/pull/259517
This table is currently empty, so modifying the schema should not be impactful to ledger. Here's the corresponding SHIFT to approve:
https://square-console.sqprod.co/app/ledger/databases/shift/request/21314


jarp
:no_entry:  11:58 AM
Hey all - was directed this way from the #refunds-api-help team, but I have a strategic seller (Convene, $30M GPV) who issued a handful of refunds on Monday that were all rejected. I’ve linked to the payment details below, but any reason these were rejected?
From the refunds team, it sounds like this looks like there was an issue pulling money out of the seller’s bank to cover the refunds. We see errors like Corporate Customer Advises Not Authorized on the ledger entries which sparked the rejections.
Anything the seller can do to issue these refunds ASAP? Seller is trying to reconcile things before EOQ today so please just keep me posted if you need anything else!
Refund 1
Refund 2
Refund 3
Refund 4
Refund 5
Refund 6
Refund 7


justinroberts
This looks like there was an issue pulling money out of the seller’s bank to cover the refunds. We see errors like Corporate Customer Advises Not Authorized on the ledger entries which sparked the rejections. I’d suggest following up with ledger over in #ledger. This may lead to a conversation with banking connections too, perhaps. (edited) 
From a thread in refunds-api-help | Sep 30th, 2022 | View reply





+1
31 replies
Last reply 9 months agoView thread


skaltenbach
  12:41 PM
Hey team, want to give a heads up that Barclays FileGateway will be unavailable starting today at 3pm through October 2 at 10AM PT. Normally, we run our GB_FPS_BARCLAYS pipeline at 8:45 am PT Sunday, however it will have to be run after the outage window. So customers that are expecting to get paid at 8:45AM will not get their funds until after maintenance downtime.
Also, UK cash transfers that we normally handle every 5 minutes will also be delayed during this outage. So customers expecting to see a transfer go through in < 5 minutes will have to wait ~2 days.
We are looking into if we'd be able to run the pipeline this afternoon before the 3pm start time for the outage to at least settle the current pending transfers.
I have filed a preemptive SEV for this here: https://jira.sqprod.co/browse/ALERT-10826 (edited) 
:ack-red:
1



bforehand
  1:14 PM
Ping on this since it is a tiny PR and quick review and I suspect it may have gotten buried with the other more recent messages:
https://square.slack.com/archives/CAMN0UWMS/p1664563108354829


bforehand
PR to add index to payout-related safeguarding table:
https://github.com/squareup/java/pull/259517
This table is currently empty, so modifying the schema should not be impactful to ledger. Here's the corresponding SHIFT to approve:
https://square-console.sqprod.co/app/ledger/databases/shift/request/21314
Posted in ledger | Sep 30th, 2022 | View message
:eyes:
1
:stamp:
1



3 replies
Last reply 9 months agoView thread


desirae
  4:14 PM
Hi team. LQDZA0GZE7T29 lien was resolved but M is still unable to get any sales processed to his available balance and reg is showing there is a negative balance for $4500. Is this accurate? Thanks for any insight.
:eyes:
1
:checkmark:
1




4 replies
Last reply 9 months agoView thread


kcrane
:coolfingergun:  6:08 PM
deploying 00b16512bb9 to staging


kcrane
:coolfingergun:  1:42 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-101857
(ledger @ 00b16512bb9 to production)


5 replies
Last reply 9 months agoView thread


kcrane
:coolfingergun:  1:49 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


kcrane
:coolfingergun:  2:23 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


kcrane
:coolfingergun:  3:53 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we're out on prod
deploy checks pass


emilyl
  5:03 PM
deploying 8b1e37cf491 (latest) to staging


jorgeh
  1:22 AM
Hello team,
I just wanted to know if the following refunds have been successful. It's an odd situation that I have never seen before. Where on M's Inbound Transfers they show as sent and successful but if you go on to the individual transaction regulators gives me an option to "approve refund".
The refunds in questions are :
£300.00 , £300.00 , £300.00 , £300.00 & £300.00 on all of these transactions regulator gives me an option to "accept refund" but on their Inbound Transfers  these refunds are marked as Sent and successful. Could anybody shed some light here?
:checkmark:
1


1 reply
9 months agoView thread


mgrab
:spiral_calendar_pad:  5:58 AM
Hi team, cross-posting this question in case anyone here knows: https://square.slack.com/archives/C01JRJS4U2F/p1664888302325119?thread_ts=1663771805.294239&cid=C01JRJS4U2F


mgrab
Hi 
@bwester
 I have a question regarding PROVISIONAL and OPTIMISTIC activation states: we were told that merchants in these states should be frozen, and I was wondering whether that means that a unit in these states will is guaranteed to have a freeze in Ledger, or if it is only treated like a freeze that is implied by the state; would you happen to know?
From a thread in payment-permissions | Oct 4th, 2022 | View reply
:checkmark:
1


1 reply
9 months agoView thread


prabhjot
:no_entry:  8:57 AM
replied to a thread:
Hi, Can someone please take a look this ROLL? We need to rewind the ledgerMerchantSettlementStateEntryFeed so we can backfill the updated_at field to PSS
@oncall
 I’d like to speed up the backfill a little, setting the maxItems to 400 and interval to 0.5s, let me know if there is any concern?
:ack:
1

View newer replies


bforehand
  12:02 PM
Is there going to be a staging deploy today?
:yes:
1


1 reply
9 months agoView thread


emilyl
  12:36 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-101901
(ledger @ 8b1e37cf491 to production)
:+1:
5



6 replies
Last reply 9 months agoView thread


emilyl
  12:46 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


emilyl
  1:17 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


emilyl
  2:25 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass


jfreeman
  3:51 PM
LQDZA0GZE7T29 - m calling in about his linked bank being debited for $10k. per previous escalations: The UCC lien has been resolved. Please contact #ledger regarding the negative balance. can you please review?
:checkmark:
1


1 reply
9 months agoView thread


kcrane
:coolfingergun:  4:19 PM
deploying aafb6b3d077 (latest) to staging


njain
  7:24 PM
Hey 
@oncall
, we saw an uptick in the Capital Events - Processing Latency for about an hour today: https://square.signalfx.com/#/chart/v2/EIPkB0dAgAA?groupId=EFz-tuCAgAU&configId=EIPj64vAYLg&startTime=-4h&endTime=Now.
Was their something wrong with Ledger during this time that would explain this increase in latency?
Capital Events - Processing Latency
Added by SignalFx (11 kB)
https://square.signalfx.com/#/chart/v2/EIPkB0dAgAA?groupId=EFz-tuCAgAU&configId=EIPj64vAYLg&startTime=-4h&endTime=Now


1 reply
9 months agoView thread


zandt
:spiral_calendar_pad:  12:05 PM
Hi all. I'm investing how we can use the Standard Payment Record in Ledger so that Ledger can be payment method agnostic and can more easily read the payment record.
I started working on a PR (not a real PR) to track my findings. I'd appreciate some feedback on it to address some gaps. Thanks!
#260020 [ledger] Investigate usage of standard payment record
Do not merge.
Intent of this PR is to investigate how we can utilize the Standard Payment Record in Ledger.
Labels
accounting-engineering
<https://github.com/squareup/java|squareup/java>squareup/java | Oct 5th, 2022 | Added by GitHub


kcrane
:coolfingergun:  12:40 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-101958
(ledger @ aafb6b3d077 to production)
:+1:
3
:stamp3:
1





18 replies
Last reply 9 months agoView thread


kcrane
:coolfingergun:  12:53 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


kcrane
:coolfingergun:  1:32 PM
replied to a thread:
Ledger ROLL:…
that's a high res prairie dog
View newer replies


kcrane
:coolfingergun:  1:33 PM
replied to a thread:
Ledger ROLL:…
what i meant to send to the channel was:
prairie dog deploy checks pass
:prairie-dog: rolling forward
:clap-clap:
1
:prairie-dog:
2

View newer replies


mgp
:baby:  2:01 PM
@oncall
 do you mind if I kick off a staging deploy to test something out? Then can follow up with our normal staging deploy later…


2 replies
Last reply 9 months agoView thread


emilyl
  5:23 PM
deploying e1c28cb7efd (latest) to staging


agajardo
:spiral_calendar_pad:  9:29 AM
Question on the MerchantSettlementState :  When it comes to the Reasons like FROZEN  and NO_VERIFIED_BANK_ACCOUNT  does it just take a long time for Ledger to sync on these statuses?  We are doing some testing in staging and toggled a merchant frozen, but our call to ledger is not picking it up.
cc: 
@chansen
 (edited) 
:checkmark:
1



12 replies
Last reply 9 months agoView thread


sarve
  9:36 AM
@oncall
 We are turning on stage 3 for UK migration on SPOOL. So, we are setting the settle_using_payouts flag for 1k UK merchants to true. This should have no impact right now, but we will be settling these merchants using Payouts starting tomorrow morning

1 reply
9 months agoView thread


sergey
  10:15 AM
hi #ledger! i see this error consuming from ledger feed: https://sentry.io/organizations/square-inc/issues/3632717250/?project=1224498&query=is%3Aunresolved, do you know if there are any recent proto updates that broke that feed?
Protobuf::FieldNotDefinedError
external_source_event_id
REWARDS-STAGING-HDREWARDS-STAGING-HD | Sep 30th, 2022 | Added by Sentry
Select Assignee...





+5
112 replies
Last reply 9 months agoView thread


tportfolio
:no_entry:  11:55 AM
Hey team, could I get a quick :stamp3: on this pull request? I made a small change to the setup for consumer shards on a feed-backed Kafka feed, which involved moving the shard count value from an annotation to a config YAML. Thanks!


emilyl
  12:23 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-102009
(ledger @ e1c28cb7efd to production)


6 replies
Last reply 9 months agoView thread


emilyl
  12:50 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


emilyl
  1:19 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


emilyl
  2:21 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass


rachit
  2:28 PM
@oncall
,
Hey, our costplus view relies on the aggregate_fee_detail column to filter on records from payments-raw-production.feeds.ledger_entries_raw_records.
We are no longer seeing data for our view. has anything changed with the column, if so what new column should we use instead?
This is our filter:
 AND (
         aggregate_fee_detail.fee_detail.cost_plus_fee_detail.margin_basis_points IS NOT NULL
      OR aggregate_fee_detail.fee_detail.cost_plus_fee_detail.margin_cents IS NOT NULL
    )
cc: 
@alicezhang
 (edited) 





+2
15 replies
Last reply 9 months agoView thread


mgp
:baby:  2:34 PM
@oncall
 going to deploy ledger staging now that the prod deploy is complete


2 replies
Last reply 9 months agoView thread


kcrane
:coolfingergun:  4:32 PM
deploying 5aa3fb470c2 (latest) to staging


mgp
:baby:  6:06 PM
Deploying d732bddf9b45a0b54f26d4e321a349314643551d to staging


markl
:spiral_calendar_pad:  9:29 AM
Hi ledger team! Wondering whether someone would be able to take a look at my access request for RO snowflake data (https://registry.sqprod.co/access_requests/250961)? Thank you (edited) 

1 reply
9 months agoView thread


tportfolio
:no_entry:  9:39 AM
Bumping this PR since this is the last stamp I need before merging :thank:


tportfolio
Hey team, could I get a quick :stamp3: on this pull request? I made a small change to the setup for consumer shards on a feed-backed Kafka feed, which involved moving the shard count value from an annotation to a config YAML. Thanks!
Posted in ledger | Oct 6th, 2022 | View message

1 reply
9 months agoView thread


xqi
:spiral_calendar_pad:  10:48 AM
Hi 
@oncall
 Reconciliation relies on the aggregated_fee_detail.entry_method for some of our pipelines, I see in earlier convos in this channel that aggregated_fee_detail has/is deprecated, where should we go to find this field now?




6 replies
Last reply 9 months agoView thread


mgp
:baby:  11:22 AM
@oncall
 going to do a dry run of the DEFAULT batches backfiller in production (which is a no-op) (edited) 
:ack-red:
1



3 replies
Last reply 9 months agoView thread


mgp
:baby:  11:28 AM
replied to a thread:
@oncall going to do a dry run of the DEFAULT batches backfiller in production (which is a no-op)
Nevermind — need https://github.com/squareup/java/pull/260145 to be deployed to prod before I can proceed. Punting this until next week.
#260145 Move allow_apps clause for ACLs
Apparently trying to DRY this in ledger-common.yaml in PR #260124 removed the authorization of Backfila. I am assuming it's how the merging logic works for arrays in YAML files. This reverts the change to DRY this.
Labels
accounting-engineering
Comments
1
<https://github.com/squareup/java|squareup/java>squareup/java | Oct 5th, 2022 | Added by GitHub


ahdoot
:spiral_calendar_pad:  1:36 PM
:wave: , quick question regarding ACH refunds: are refund ledger entries created for them only via a CreateRefundLedgerEntry call from RefundsArbiter, or can a refund ledger entry also be created via consumption of Esperanto’s payments feed? :thread:
:checkmark:
1



4 replies
Last reply 9 months agoView thread


senth
  4:02 PM
Deploying b7983e684bfe299d2626e740992b1a99f09718c7 to Ledger staging


rachit
  3:05 PM
@oncall
: Costplus is running behind on adjustment fees this time.We are reducing the sleep delay between batches to see if that can speed up the processing. Ledger may see an increase in QPS from costplus due to this change.
cc: 
@plee
 (edited) 
:ack:
1



2 replies
Last reply 9 months agoView thread

root
APP  9:00 AM
ODS host fpd1532.sjc3b.square (pd-odsgroup382) is down
No action is needed from you. ODS oncall will try to successover metaclusters if they are active on this host.
Please see the #situation channel for more information.
apps affected: ledger
metaclusters affected for these apps:
- pd-mysql-ledger-009
Cc: 
@oncall
:ack-red:
1


1 reply
9 months agoView thread


sarve
  10:00 AM
@oncall
 FYI - We are moving the next set of 2k UK merchants to be settled using payouts
:ack-red:
2


1 reply
9 months agoView thread


senth
  11:16 AM
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-102108
(ledger @ b7983e684bfe299d2626e740992b1a99f09718c7 to production)



34 replies
Last reply 9 months agoView thread


senth
  12:54 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-102108…
Found a regression in staging related to feed shard counts, offending change is being reverted and investigated, so we'll resume deployment tomorrow instead. Nothing critical to be deployed today anyways!
View newer replies


tportfolio
:no_entry:  2:38 PM
Taking ledger staging to deploy canary 9635eb2ffca8f61da11e27c5ea6ef07aa9e4f783
:ack:
1
:done1:
1


1 reply
9 months agoView thread


sdixit
:no_entry:  3:10 PM
@oncall
 I am looking at our logs and I see that on a daily basis few calls for createFeeLedgerEntry will fail with the following error message
java.util.concurrent.ExecutionException: RpcException (REQUEST_TIMEOUT): gRPC call to squareup.quotaservice.QuotaService/Allow failed: DEADLINE_EXCEEDED: deadline exceeded after 0.299935231s. [closed=[], open=[[remote_addr=/data/pods/costplus/envoy_sockets/egress.sock]]]
Is there anything we have to do on our end such as increase time out for the api call ?
Today this warning has occurred 18 times. Just curious if there is any recommendation about it. You can see details of the error here
QuotaServiceException
java.util.concurrent.ExecutionException: RpcException (REQUEST_TIMEOUT): gRPC call to squareup.quotaservice.QuotaService/Allow failed: DEADLINE_EXCEEDED: deadline exceeded after 0.299922462s. [closed=[], open=[[remote_addr=/data/pods/costplus/envoy_sockets/egress.sock]]]
COSTPLUS-PRODUCTION-8X3VCOSTPLUS-PRODUCTION-8X3V | Oct 10th, 2022 | Added by Sentry
Select Assignee...
:eyes:
1




5 replies
Last reply 9 months agoView thread


lishahe
:spiral_calendar_pad:  3:52 PM
Hi ledger team, can I get some light shed here? We have changed some pricing mapping for UK Appointments, and thought the change will be safe since all payments (including refunds) process before the change will get the old pricing. However, we got paged several times especially on refund on pricing not found. Here is an example. My understand is that Ledger will call AssessRefund in Feeplans, and the request contains feeplan_rate_id, so feeplans can still calculate the refund correctly based on the feeplan_rate_id that is used during capture. However, the exception comes when Ledger call feeplans BatchGetFeeRate for this payment.  My question is  when will ledger call BatchGetFeeRate for a refund payment?
:checkmark:
1






23 replies
Last reply 9 months agoView thread


senth
  8:31 PM
Deploying Ledger staging with 4a5343f85c28f7212fff53cef7e276e97e5c81cf


jarlan
  10:22 AM
Is there a programatic way to determine when the settlement pipeline for the day has completed (when all debit and credit transfers have been sent)?


6 replies
Last reply 9 months agoView thread


senth
  11:45 AM
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-102173
(ledger @ 4a5343f85c28f7212fff53cef7e276e97e5c81cf to production)


5 replies
Last reply 9 months agoView thread


senth
  12:08 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-102173…
staging checks pass
:canary: canary start
View newer replies
12:11
Taking over Ledger staging to deploy a canary build (
@tportfolio
) for another hour or two


senth
  12:42 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-102173…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


ahwang
  1:07 PM
was added to #ledger by sergey
.


senth
  2:11 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-102173…
:shipitparrot: we're out on prod
deploy checks pass


senth
  5:11 PM
Deploying 86357b40e64d77c6a720835fec4ffecf0c7c14cd to Ledger staging...


moisesm
:palm_tree:  8:23 AM
Hi team, could I please get some help with this refund? I basically need confirmation if this refund has been processed or not. as it's displaying on the main page as refunded but seems stuck in processing from the transaction specific page. Thanks in advance.
:checkmark:
1


1 reply
9 months agoView thread


mnovich
  9:44 AM
@oncall
 FYI - we are moving next set of 4k UK merchants to be settled by payouts This will finalize Stage 3 migration
:ack-red:
1
:+1:
1


1 reply
9 months agoView thread


lagarwal
  11:15 AM
Block has chosen Datadog as a strategic partner for observability tooling. Here is the full communication doc. Use the signup sheet to request help and help confirm  ETA on when you can migrate?  Be sure to include a way to contact you. RapDev consultants will be available starting October 24th. cc 
@tedwards
:ack-red:
1



tedwards
  11:15 AM
was added to #ledger by lagarwal
.


senth
  11:46 AM
No new changes in Ledger since yesterday's deployment, so we're skipping the prod deployment today.
11:49
Deploying Ledger staging with a canary build for testing. cc: 
@tportfolio


akwan
:spiral_calendar_pad:  2:28 PM
Hello - wondering if there were any changes related to free processing ledger entries sometime between mid-March to late May (2022)?
We've noticed that the beemo response with field free_processing_fee_money  became 0 even when it wasn't sometime in that time frame, but not seeing any beemo changes then. Beemo in turn gets that info from ledger so wondering if there were changes there.
 https://square.slack.com/archives/C026QC9U2TW/p1665506399977509 (edited) 


akwan
Hello from Rewards - we are debugging an issue where SPOS Transaction screen is no longer showing Free processing applied (circled in screenshot). The row should display whenever free_processing_fee_money from a beemo response (like this one) is not 0, but we have found some recent ones to be 0 even when we have confirmed that free processing was applied. In the sample linked, the only one that wasn't 0 was a transaction from March 17 (vs the other ones are from yesterday). We are wondering if anything changed recently on beemo's side in terms of how free_processing_fee_money is populated?
cc: 
@amirely
 
@jtempleman
 
@cmimms
image.png
 
image.png
Thread in orders-reporting-team | Oct 11th, 2022 | View message
:checkmark:
1






26 replies
Last reply 9 months agoView thread


senth
  4:17 PM
Deploying 2811a87dc9767a2986b49ee815eeb40e578187a5 to Ledger staging


jbambhra
  9:37 AM
Hi Team - I have a strategic seller (J7ZD4E4X6D35B) who has queried some transactions and is asking if they have been processed and sent to their account, they experienced a temporary freeze on their Tide bank account which has now been resolved. Can you anyone help?
image (4).png
 
image (4).png
:checkmark:
1



2 replies
Last reply 9 months agoView thread

PayswingBot
APP  11:30 AM
Evacuating payments traffic from EAST datacenters (swinging WEST) in production has been initiated by yanglin
:ack-red:
1



mgrab
:spiral_calendar_pad:  11:44 AM
Hi team, can I get a review on this please: https://github.com/squareup/java/pull/259745
#259745 Add billpay to ACL for Ledger::GetFreezes
Billpay needs to check whether a unit has freezes.  
Design document: https://docs.google.com/document/d/1ZIPNdrbA57zh9WNl8Pw_HRFCwl9bIIYY0YFWNXBfywE/edit#bookmark=id.c770ztxsa3tp  
Billpay PR: squareup/billpay#509  
Access request: https://registry.sqprod.co/app_dependency_requests/27463
Labels
accounting-engineering
Comments
1
<https://github.com/squareup/java|squareup/java>squareup/java | Oct 4th, 2022 | Added by GitHub
:stamp3:
1




8 replies
Last reply 9 months agoView thread

PayswingBot
APP  11:46 AM
Restoring normal payments traffic (unswinging) in production has been initiated by yanglin
:ack-red:
1



carrie
  11:58 AM
was added to #ledger by mgrab
.


senth
  4:04 PM
Deploying Ledger staging with 0f2e89e33b64e2fa027cb5ab80b671a9dc186e68


sdixit
:no_entry:  8:52 AM
@oncall
 Need your help to figure out why the cost plus adjustments were reported really high to a merchant when the cost plus adjustment seems low. I have added my input in the comments on this on call ticket. ONCALL-140516





34 replies
Last reply 9 months agoView thread


hoyi
  3:57 PM
Deploying latest (e7750f31b8d) to ledger-staging


bhargava
  8:00 PM
Hi folks :wave::skin-tone-4:, FYI: there's an upcoming Barclays downtime from 9 pm PT to 7 am PT tomorrow. Notifying you just in case you get paged so that you can mute until then.
:+1:
1


PayswingBot
APP  6:18 AM
Evacuating payments traffic from EAST datacenters (swinging WEST) in production has been initiated by colten

PayswingBot
APP  9:18 AM
Restoring normal payments traffic (unswinging) in production has been initiated by colten


minghua
:bulb:  12:41 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-102411
(ledger @ e7750f31b8da30297aeb5382462223cc92393856 to production)




9 replies
Last reply 9 months agoView thread


minghua
:bulb:  12:52 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


minghua
:bulb:  1:27 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


minghua
:bulb:  3:06 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we're out on prod
deploy checks pass
:celeryman3:
1



hoyi
  4:03 PM
Deploying latest (1c06eee8a2b) to ledger-staging


tochi
  7:03 AM
Hi team, does anyone here happen to know what Ledger entries are created when a seller receives a donation via this Dashboard "Ask for donation" button shown in the image below?
image.png
 
image.png
:checkmark:
1



16 replies
Last reply 9 months agoView thread


tochi
  10:49 AM
Got another inquiry. It's regarding this debit failure described in ONCALL-140692. Can someone here help interpret the "Return of Improper Debit Entry" failure reason, and "AMOUNT NOT DUE" description? (edited) 
:checkmark:
1




9 replies
Last reply 9 months agoView thread


dylanw
  11:31 AM
Hi team! There is currently a Registry dependency established between PayReporter and Ledger that is expiring soon. The last access request stated "METI rebate integration which is no longer needed but just in case". I've checked PayReporter's codebase and don't see any calls to the Ledger service anymore.
We'd like to remove this dependency ahead of its expiration so we can monitor for any errors that occur, and provide you all with the heads up in case you see anything on your end. We'll be deleting the dependency shortly, please let me know if there's any reason we should hold off!
cc: 
@oncall
:ack:
1



2 replies
Last reply 9 months agoView thread


minghua
:bulb:  12:43 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-102488
ledger @ 1c06eee8a2b825a6a36c7dd7ccad491e825cde31 to production (edited) 



8 replies
Last reply 9 months agoView thread


bjoseph
  1:01 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


bjoseph
  1:32 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


escates
  2:22 PM
Hi Team, this refund was issued to a closed bank account on 10/8/22 yet shows as completed in Regulator.
Is there a trace number that confirms the card-issuing bank received the refund?
Will the card-issuing bank return the funds to Square?
Do we get signals from the banks when refunding to closed accounts?
(let me know if I should reach out to a different team) (edited) 


bjoseph
  2:32 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we're out on prod
deploy checks pass


mgp
:baby:  3:44 PM
@oncall
 I can do the staging deploy today at 4:30pm PT. I just merged https://github.com/squareup/java/pull/261429 and would love to get it onto staging, but it won’t make the normal 4pm cut
#261429 Add feature flag to use optimistic locking
This adds the feature flag named  
enable_batch_creation_optimistic_locking. When enabled, the OpenBatches type will begin using the added  
LedgerEntryBatchCreationLockStore for optimistic locking.
To assist, this adds new type LedgerEntryBatchCreationLockManager which abstracts away whether the existing implementation in LedgerEntryStore or the new implementation in  
LedgerEntryBatchCreationLockStore is used to acquire and release the lock. Which implementation is used depends on the feature flag value for the merchant token. OpenBatches now delegates to the composed LedgerEntryBatchCreationLockManager to acquire and release the lock instead of performing these actions directly.
ACTENG-5040
Labels
accounting-engineering
Comments
3
<https://github.com/squareup/java|squareup/java>squareup/java | Oct 18th, 2022 | Added by GitHub
:ack-red:
1
:thank:
1



2 replies
Last reply 9 months agoView thread


mgp
:baby:  4:21 PM
replied to a thread:
@oncall I can do the staging deploy today at 4:30pm PT. I just merged https://github.com/squareup/java/pull/261429 and would love to get it onto staging, but it won’t make the normal 4pm cut
Deploying sha 0892890a49ce4df865dd059581763a4e03a3ecc2 to Ledger staging


andreyg
  11:35 AM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-102540
(ledger @ 0892890a49c to production)


6 replies
Last reply 9 months agoView thread


mnovich
  12:02 PM
Hi ledger team, I know this is a Payouts API problem which we will take care of, however just as an FYI for future mappings.
When ledger Payouts RPC are called with pbId token the mapping happens only one way, but it responds with unitToken  back which broke the newly migrated payouts logic.


mnovich
Stopping deployment for now, since there is a bug.
it seems like in production after payouts is sending initiatePayouts request with pbid - ledger responds with objects keyed with unitToken which breaks all of the later logic. I did not experience this in staging
Thread in payouts-service | Oct 19th, 2022 | View message
:ack-red:
1



andreyg
  12:55 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


andreyg
  1:37 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


andreyg
  2:33 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass
:bless:
1



mgrab
:spiral_calendar_pad:  2:39 PM
Hi team, can I have a review for this ACL PR? https://github.com/squareup/java/pull/261595
#261595 Add billpay to ACL for ledger feeds
Billpay will hold pending bills if a unit is frozen, and will refund the funds to the seller when the freeze is removed. Billpay will consume the leger freeze feed to achieve this. https://docs.google.com/document/d/1ZIPNdrbA57zh9WNl8Pw_HRFCwl9bIIYY0YFWNXBfywE/edit#bookmark=id.94ietly32ce8
Labels
accounting-engineering
Comments
1
<https://github.com/squareup/java|squareup/java>squareup/java | Oct 19th, 2022 | Added by GitHub
:checkmark:
1




11 replies
Last reply 9 months agoView thread


mgp
:baby:  4:40 PM
Deploying e28c4f7a535e70c73b3790777c23119b8c1723a1 to Ledger staging


mgrab
:spiral_calendar_pad:  1:02 PM
replied to a thread:
Hi team, can I have a review for this ACL PR? https://github.com/squareup/java/pull/261595
Related to this - can someone help me out with figuring out what feed name I should use when setting up the consumer for the freeze feed? https://github.com/squareup/billpay/pull/540/files#r1001059498
:checkmark:
1

View newer replies


andreyg
  4:12 PM
deploying 7c4b7727ff7 to staging

1 reply
9 months agoView thread

root
APP  4:47 PM
ODS host fpd1530.sjc3b.square (pd-odsgroup381) is down
No action is needed from you. ODS oncall will try to successover metaclusters if they are active on this host.
Please see the #situation channel for more information.
apps affected: ledger
metaclusters affected for these apps:
- pd-mysql-ledger-008
Cc: 
@oncall
:ack-red:
1


1 reply
9 months agoView thread


tochi
  4:53 PM
@oncall
 is Ledger having issues? Capital is seeing an increase in Ledger request failures. I'm assuming it might be related to the host referenced above being down.





7 replies
Last reply 9 months agoView thread


andreyg
  5:11 PM
replied to a thread:
deploying 7c4b7727ff7 to staging
deployment failed, rolling back to e28c4f7a535


andreyg
  10:54 AM
going to deploy laster master to staging to confirm issue we saw yesterday was fixed (edited) 
10:58
deploying bfa3732c16c to staging
:checkmark:
1



mnovich
  12:18 PM
@oncall
 We discovered a bug in AbortPayout  which we don’t understand yet so we are going to disable payouts for Monday.
:ack:
2


1 reply
9 months agoView thread


andreyg
  4:01 PM
deploying 25099a8a80b to staging (including payouts fix) (edited) 
:bless:
2


PayswingBot
APP  7:09 AM
Evacuating payments traffic from EAST datacenters (swinging WEST) in production has been initiated by adeel

PayswingBot
APP  7:20 AM
Evacuating payments traffic from WEST datacenters (swinging EAST) in production has been initiated by adeel

PayswingBot
APP  8:35 AM
Restoring normal payments traffic (unswinging) in production has been initiated by adeel


jonel
  11:33 AM
Hi team, I hope this is the proper channel to ask this - I have a strat seller who was credited 10k in free processing in Oct and is looking for info on what bank transfers the credit was applied to. I tried looking in the balance tab of their transactions to view this, but there was nothing pulling this info. Hoping to find an answer on how to gather this for them. Thank you!
:eyes:
1


4 replies
Last reply 9 months agoView thread


bjoseph
  12:15 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-102699
(ledger @ 25099a8a80b54822529c6069c7d940918e90601f to production)



8 replies
Last reply 9 months agoView thread


bjoseph
  12:34 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


bjoseph
  1:08 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


bjoseph
  2:11 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we're out on prod
deploy checks pass


mnovich
  3:20 PM
@oncall
 Payouts is back online for tomorrow’s settlement
:ack:
3


1 reply
9 months agoView thread


lucasc
  3:34 PM
Hi team! I’m working on the new Payment Methods report, which will be sourced out of Payplat Graph. The Payment Methods report displays to merchants all the available payment methods and for a given time frame the number and value of payments for each. The payments that are displayed are all payments that are in a state where Square can credit the value to the merchant. Do you have a term for this state for payments and do you know of a good time stamp we can use from the payment record that indicate when it entered this state?
:eyes:
1
:checkmark:
1



15 replies
Last reply 9 months agoView thread


andreyg
  4:04 PM
deploying 86d2f1f6286 to staging


mnovich
  9:27 AM
We are moving payouts to stage 4 of migration :alert-red: :alert-blue: :alert-green:


joelee
  10:15 AM
Swinging payments east at 1:15 ET as part of the payments DR exercise. Payments will be unswung tomorrow. Please report any issues in #payment-dr

PayswingBot
APP  10:15 AM
Evacuating payments traffic from WEST datacenters (swinging EAST) in production has been initiated by joelee


mgp
:baby:  10:37 AM
Just FYI, Ledger will not be participating in the DR exercise today. It will stay active in SJC: https://square.slack.com/archives/CG4055T7U/p1666717949234369


mgp
Sorry for the last minute notice but Ledger will not be participating in the DR exercise on account of a MySQL replica in IAD that failed a few days ago and is still awaiting a rebuild. What spreadsheets do I need to update? (edited) 
Thread in payment-dr | Oct 25th, 2022 | View message


andreyg
  11:41 AM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-102769
(ledger @ 86d2f1f6286 to production)


5 replies
Last reply 9 months agoView thread


andreyg
  12:30 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


andreyg
  1:05 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


andreyg
  2:01 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass


lucasc
  3:25 PM
replied to a thread:
Hi team! I’m working on the new Payment Methods report, which will be sourced out of Payplat Graph. The Payment Methods report displays to merchants all the available payment methods and for a given time frame the number and value of payments for each. The payments that are displayed are all payments that are in a state where Square can credit the value to the merchant. Do you have a term for this state for payments and do you know of a good time stamp we can use from the payment record that indicate when it entered this state?
Hi Team, bumping to see if you have any insight here.
:checkmark:
1

View newer replies


andreyg
  4:04 PM
deploying 31750d50e32 to staging


joelee
  12:17 PM
Restoring normal payment traffic (unswinging) at 3:20 PM ET as part of the payments DR exercise. Please report any issues in #payment-dr

PayswingBot
APP  12:20 PM
Restoring normal payments traffic (unswinging) in production has been initiated by joelee


joelee
  12:23 PM
Payments are unswung (payment traffic should be back to normal)


bjoseph
  12:32 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-102851
(ledger @ 31750d50e3291e38f541693ffb647cef19af5f79 to production)




10 replies
Last reply 9 months agoView thread


bjoseph
  12:47 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


bjoseph
  1:19 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


bjoseph
  2:34 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we're out on prod
deploy checks pass


mgp
:baby:  4:52 PM
Deploying c9a5539d528d40c202c8ebbffb4b3cda4b8eb518 to Ledger staging


chansen
  6:23 AM
Hey ledger folks :wave:  I'm looking to confirm a fix I currently have in staging/canary to fix riskStateFeed Unlinked refunds issue that was seen in ledger prod yesterday. Can someone check if this canary is working? Can provide more details in :thread:


rho
@oncall
 https://square.slack.com/archives/C01MST9645P/p1666737061711889
Thread in fraud-eng-oncall | Oct 25th, 2022 | View message
:eyes:
1
:checkmark:
1



7 replies
Last reply 9 months agoView thread


songlin
  12:16 PM
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-102920
(ledger @ c9a5539d528d40c202c8ebbffb4b3cda4b8eb518 to production)


7 replies
Last reply 9 months agoView thread


songlin
  12:29 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-102920…
signalfx charts not loading... checking out why that's happening
View newer replies


songlin
  12:57 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-102920…
staging checks pass
:canary: canary start
:bless:
1

View newer replies


songlin
  1:39 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-102920…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


songlin
  2:50 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-102920…
:shipitparrot: we're out on prod
deploy checks pass
:celeryman3:
1



dskarbek
  3:32 PM
@fasih
 Forking thread to separate this disccussion


fasih
@dskarbek
 So cloud-persister is simply persisting the feed entries as avro in GCS.
Feed config: https://github.com/squareup/java/blob/master/cloud-infra/cloud-persister/src/main/resources/feed-setup-production.yaml#L1507-L1510
Proto mapping: https://github.com/squareup/java/blob/master/cloud-infra/cloud-persister/src/main/[…]up/cloudinfra/cloudpersister/domain/ConsumerMapToFeedInput.java
From a thread in ledger | Oct 27th, 2022 | View reply



12 replies
Last reply 9 months agoView thread


bjoseph
  4:01 PM
deploying cb5b80b0d0b19ed1a1932d27bbe9353fba6b9d7a to staging


mnovich
  1:31 PM
Is there anyone who is familiar with BSE feed consumers and it’s code. We need a live consult on the repercussions of dropping an entry for a MT. (edited) 


4 replies
Last reply 9 months agoView thread


mnovich
  1:52 PM
@oncall
 We discovered a bug in CompletePayout which allows us to sometimes drop the BSE feed entries and not publish them. We will be turning Payouts off until the fix it deployed.
Pr is out:
https://github.com/squareup/java/pull/262809
#262809 Publish feed entries last
We were inserting the bank settlement entry feed entries to the ach_entry_feed_entries table before we updated the corresponding money transfer as publicly exposed.
Consequently when a bank settlement entry feed entry was consumed, there was a risk of consuming an entry for which the corresponding money transfer was not yet publicly exposed. The feed implementation BankSettlementEntryFeedImpl delegates to  
BankSettlementEntryApiStore to fetch the feed entries. The jOOQ implementation of this class fetches only bank settlement entries for publicly exposed money transfers:
Condition publiclyExposedCondition = MONEY_TRANSFERS.PUBLICLY_EXPOSED.isTrue()
    // TODO(rhall): remove this guard once we cle…
Show more
Labels
accounting-engineering
Comments
2
<https://github.com/squareup/java|squareup/java>squareup/java | Oct 28th, 2022 | Added by GitHub
:ack:
1


1 reply
9 months agoView thread


emilyl
  4:06 PM
deploying 77042a0eb2c (latest) to staging


mnovich
  4:09 PM
@oncall
 does ledger own  sq-ledger-prod-bank-settlement-entries GCP Bucket? (edited) 




4 replies
Last reply 9 months agoView thread


mathilde
  11:14 AM
Hi! The Term loans product uses Ledger to debit the monthly loan repayment obligations.
The behavior we've seen until now: we debit the Square Balance first. If there are not enough funds in the Balance, then we refund Balance and debit the external BA for the full amount.
Newly observed behavior with a seller: In this case, it seems we did not refund the Balance and debited the external BA for the difference instead.
In this new behavior? If not, in which case would this happen?




40 replies
Last reply 8 months agoView thread


bta
  1:22 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-103043
(ledger @ 77042a0eb2ce15b696832dbd0621139a1777bce5 to production)



6 replies
Last reply 8 months agoView thread


bta
  1:30 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


bta
  2:00 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


bta
  2:49 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we're out on prod
deploy checks pass
View newer replies


emilyl
  4:09 PM
deploying 975122828b2 (latest) to staging
:thank:
2



mnovich
  9:43 AM
@oncall
 do you have a prod deploy today?



3 replies
Last reply 8 months agoView thread


mgrab
:spiral_calendar_pad:  11:19 AM
Hello, could someone help me find a recent feed cursor value for the ledger freeze feed? We’re going to start consuming it in Billpay and don’t need to process historical entries, so I just want to update our cursor to start consuming from a recent point in the past.
:eyes:
1
:checkmark:
1



4 replies
Last reply 8 months agoView thread


emilyl
  1:18 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-103124
(ledger @ 975122828b2 to production)


9 replies
Last reply 8 months agoView thread


emilyl
  1:20 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


emilyl
  1:51 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


ishvydchenko
  1:52 PM
Hey team! I'm looking to cross reference some ledger data in a looker dashboard, but I don't see ledger in looker (granted I'm still learning how to use Looker), but I was wondering if there are any specific permissions I need for this, or if there are any pre-made ledger models in looker? I requested access to ledger--log_viewers here, but not positive if its the right one
:checkmark:
1



9 replies
Last reply 8 months agoView thread


yelson
:spiral_calendar_pad:  2:07 PM
Hi team, we noticed payment_revenue_fees in snowflake no longer provides fee_plan_product in the fee_rate_details field for fee_type = ‘FEE’. This field was previously provided (from ledger?), was there any recent change that would cause this to be missing? Attached a query in the thread.




16 replies
Last reply 8 months agoView thread


emilyl
  2:49 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass


fasih
  2:54 PM
was added to #ledger by yelson
.


emilyl
  4:04 PM
deploying f2a644cf64e (latest) to staging


jonchay
:spiral_calendar_pad:  11:27 PM
Hi team :wave: WebSPOS has an integration with Terminal API (aka CT2) to use a T2 device to accept payments. The underlying code leverages ReaderSDK but has REGISTER hardcoded as the product instead of associating the actual product that initiated the checkout (Virtual Terminal)
3rd party developers are also experiencing similar issues adopting ReaderSDK, more context on the thread here. I’ve been told that while it can be an easy fix on ReaderSDK side, it might be naive that affects revenue reporting downstream. Can someone share some insights to this?


jonchay
Hi there :wave:  WebSPOS (fka VT) has an integration with CT2 that has recently migrated to use reader SDK in the US. We’re hoping that this new approach will unblock accurate product association for WebSPOS orders paid on CT2 and it’s currently tagged as REGISTER
We’re wondering what’s the prioritization on this oncall ticket
From a thread in reader-sdk-help | Nov 1st, 2022 | View reply


12 replies
Last reply 8 months agoView thread


bta
  1:30 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-103207
(ledger @ f2a644cf64e12a3c94cfa38cb19ae065a8738fd7 to production)

4 replies
Last reply 8 months agoView thread


bta
  1:40 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


bta
  2:01 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


bta
  2:56 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we're out on prod
deploy checks pass


bforehand
  5:07 PM
PR to switch banking-partners encryption override flags from old dynamic flags to new feature flags:
https://github.com/squareup/java/pull/263419


3 replies
Last reply 8 months agoView thread


bforehand
  5:33 PM
replied to a thread:
PR to switch banking-partners encryption override flags from old dynamic flags to new feature flags:…
Note it looks like the accounting-eng check has been satisfied already on the PR; however, only Zifan has approved it, but apparently she is currently in the Ledger group (probably temporarily due to payouts work). Given this affects Ledger, I definitely want someone from here to review this code as well.
View newer replies


emilyl
  9:37 PM
deploying aa1ca30dc1d (latest) to staging

root
APP  1:03 AM
ODS host fpd1521.sjc3b.square (pd-odsgroup377) is down
No action is needed from you. ODS oncall will try to successover metaclusters if they are active on this host.
Please see the #situation channel for more information.
apps affected: ledger
metaclusters affected for these apps:
- pd-mysql-ledger-004
Cc: 
@oncall

1 reply
8 months agoView thread


bforehand
  9:08 AM
replied to a thread:
PR to switch banking-partners encryption override flags from old dynamic flags to new feature flags:…
Bump on this review:
https://github.com/squareup/java/pull/263419
I'd really like to get a ledger person to take a once over.
View newer replies


sarve
  9:27 AM
@oncall
 We are flipping UK migration state in Ledger to MIGRATED , so that all settlements in staging are handled by payouts
CC - 
@mgp
 
@emilyl
:ack:
2


1 reply
8 months agoView thread


alicezhang
  12:58 PM
@oncall
 Hi, we had a costplus related SEV recently and need to issue refunds to merchants. Wanted to put this on your radar https://jira.sqprod.co/browse/ONCALL-141456  cc 
@rachit
 
@plee





+1
32 replies
Last reply 7 months agoView thread


emilyl
  3:35 PM
deploying 380bc9a4485 (latest) to staging


mnovich
  10:09 AM
@oncall
 taking ledger staging for testing


2 replies
Last reply 8 months agoView thread


mnovich
  11:10 AM
replied to a thread:
@oncall taking ledger staging for testing
rolling Staging back to previous artifact
380bc9a4485


zandt
:spiral_calendar_pad:  12:39 PM
Does anyone know the history of LedgerPaymentFilter and why it would care about pay with square entry methods? Is there additional work in Ledger, beyond adding to the filter, in order to support a new entry method?
:eyes:
1




13 replies
Last reply 7 months agoView thread


cmendenhall
  3:46 PM
Hi :wave: This is in reference to this oncall ticket. It appears this merchant has been collecting payments on this unit since April 2021 with none of them settling. This is impacting the reporting on their loans dashboard because we only show loan payments associated with settled ledger payments. Was wondering if there was a reason why none of the payments have settled since April 2021?


6 replies
Last reply 8 months agoView thread


bta
  10:58 AM
deploying 66ae3c6f81e (latest) to staging


lcheung
:spiral_calendar_pad:  9:19 AM
Cross-posting this here since Ledger handles merchant settlement in the US.


bastien
Hi team - a strategic seller noticed some changes on their bank descriptions - does this appear to be something we changed or something on the bank end?
image.png
 
image.png
Thread in banking-connections | Nov 4th, 2022 | View message
:white_check_mark:
1



yelson
:spiral_calendar_pad:  10:15 AM
Hi team, trying to understand the following observation that a default feeplan was surfaced for a Custom priced seller transaction based on ledger entry. This is a potential issue since Custom priced seller should only be charged with custom feeplans.
Here is an example: https://rqm.sqprod.co/index/payment#/query/payment/101UCRmDOeuYhh3CYGNzJ2mtvaB
cc. 
@lishahe
:white_check_mark:
1



2 replies
Last reply 8 months agoView thread


kcrane
:coolfingergun:  12:36 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-103391
(ledger @ 66ae3c6f81e to production)



9 replies
Last reply 8 months agoView thread


tstukalova
:spiral_calendar_pad:  12:37 PM
was added to #ledger by kcrane
.


kcrane
:coolfingergun:  1:04 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:chocobo-face: canary start
View newer replies


kcrane
:coolfingergun:  1:36 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
:bless-frog:
2

View newer replies


bforehand
  2:25 PM
Does ledger normally have staging JP merchant settlements that run? Or should I assume that I need to create a fake JP merchant to trigger some traffic in staging?


kcrane
:coolfingergun:  3:44 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we're out on prod
deploy checks pass
View newer replies


zandt
:spiral_calendar_pad:  3:48 PM
replied to a thread:
Does anyone know the history of LedgerPaymentFilter and why it would care about pay with square entry methods? Is there additional work in Ledger, beyond adding to the filter, in order to support a new entry method?
I'm wanting to add some metrics to measure the cases where payments are skipped/filtered due to a variety of reasons. My main focus is on understanding the scenarios where payments are filtered by an unsupported entry method, but also interested in other cases that might not be needed anymore.
Possible to get some review of this PR to add these metrics?
#263788 [ledger] add metrics on ledger payment filter
Labels
accounting-engineering
Comments
2
<https://github.com/squareup/java|squareup/java>squareup/java | Nov 7th, 2022 | Added by GitHub
View newer replies


kcrane
:coolfingergun:  4:17 PM
deploying 97421726190 (latest) to staging


kcrane
:coolfingergun:  4:21 PM
deploying 8289126e474 (latest) to staging


sarve
  4:38 PM
@oncall
 We are turning on Stage 5 (all merchants settled by Payouts) for UK
:ack:
1


1 reply
8 months agoView thread


bforehand
  9:02 AM
FYI, 
@oncall
: I will be flipping the production feature flag: https://square-console.sqprod.co/feature-editor/production/group/teller/feature/encrypt_with_overrides to switch to the new JBA encryption keys today. The staging rotation was successful yesterday with no issues



4 replies
Last reply 8 months agoView thread


kcrane
:coolfingergun:  12:49 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-103511
(ledger @ 8289126e474 to production)


5 replies
Last reply 8 months agoView thread


kcrane
:coolfingergun:  12:56 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:chocobo-face: canary start
View newer replies


kcrane
:coolfingergun:  1:33 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


kcrane
:coolfingergun:  2:33 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we're out on prod
deploy checks pass


bbradley
  3:31 PM
Hi 
@oncall
 :wave:
Could you help me confirm my understanding of the Ledger Entries for payment Xnu88blQUiB3idEixWoIKDd0bKMZY, please?
November 2, entry token PeZj8NxYr9YNxjFHiYH0jvZ5iNc, this payment is successfully held
November 7, entry token C9TRTKwgHA_E0uCuPSz-aXElmMs, this hold on this payment is successfully released
November 9, entry token mRnsLamM8uvTkOVYBiDK2c9bfac, there's a second attempt to release a hold on this payment, but the eventually fails, and comes back as an Undo Release  event, entry token xWOuvhy-K6ECs4R5L9QjD7ZKoZ0
Thanks!

1 reply
8 months agoView thread


kcrane
:coolfingergun:  4:06 PM
deploying af98d544d7a (latest) to staging


mchiesa
  8:37 AM
:wave: Hello, we’re reaching out because your service ledger uses Envoy Logging (go/envoylogging) to log information about API Velocity endpoints. Envoy Logging is supported by our service api-observe, which your service’s Envoy sidecar asynchronously sends information to. Historically, api-observe has used endpoints_set.go to know which endpoints need to be logged and obtain information about those endpoints.
We’re replacing this functionality by instead having api-observe call your service’s SakeService.Schema endpoint, which is exposed via service container. We plan on calling this endpoint only once every hour or so. The frequency is determined by this feature flag.
Please approve this corresponding Registry dependency request from api-observe to your service. SakeService.Schema returns the information we need to log accurate information for your endpoints. The end result should not have any noticeable difference from before.
:stamp3:
1


5 replies
Last reply 2 months agoView thread


brenton
  10:57 AM
hi 
@oncall
, looking at a plan P-6E5KW9 with mismatch between loan balance and activities balance because of a series of unsettled ledger entries (mostly refunds). can you help me figure out why these haven't settled and what we can do to get this plan back into a normal state?
https://files.slack.com/files-pri/T01BAFDEXUP-F04AV4NUQFK/screen_shot_2022-11-10_at_4.41.08_pm.png
Screen Shot 2022-11-10 at 4.41.08 PM.png
 
Screen Shot 2022-11-10 at 4.41.08 PM.png
:eyes:
1






34 replies
Last reply 8 months agoView thread

PayswingBot
APP  6:10 PM
Evacuating payments traffic from EAST datacenters (swinging WEST) in production has been initiated by davidsmith


sarve
  7:43 AM
@oncall
 FYI - The Payouts workflow has settled the merchants in UK today. We saw the settled numbers off based on week-over-week comparison, so we have temporarily rolled back to Ledger to ensure that any delta is paid out with the Ledger run.

1 reply
8 months agoView thread


songlin
  12:36 PM
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-103671
(ledger @ af98d544d7ac72030af2e109f324de1361c2b60a to production)


7 replies
Last reply 8 months agoView thread


songlin
  12:52 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-103671…
staging checks pass
:canary: canary start
View newer replies


songlin
  1:32 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-103671…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


songlin
  2:47 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-103671…
:shipitparrot: we're out on prod
deploy checks pass


songlin
  4:56 PM
deploying d67843348a5da4c2d0a2a1ca5536efa8dbf32846 to staging
:bless:
1



ishvydchenko
  12:19 PM
Hey team! Is there a way to manually change a test accounts ledger balance on stage?


33 replies
Last reply 8 months agoView thread


songlin
  12:51 PM
Ledger ROLL https://jira.sqprod.co/browse/ROLL-103746
(ledger @ d67843348a5da4c2d0a2a1ca5536efa8dbf32846 to production)


6 replies
Last reply 8 months agoView thread


songlin
  1:13 PM
replied to a thread:
Ledger ROLL https://jira.sqprod.co/browse/ROLL-103746…
staging checks pass
:canary: canary start
View newer replies


awhitney
  1:40 PM
Does ledger limit the processing fees applied to low-value payments, so that they do not exceed the payment total? I had thought that sub-$1 might incur a loss for merchants, but at least in staging, it looks like processing fees might not exceed the payment total.


2 replies
Last reply 7 months agoView thread


songlin
  1:57 PM
replied to a thread:
Ledger ROLL https://jira.sqprod.co/browse/ROLL-103746…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


songlin
  3:17 PM
replied to a thread:
Ledger ROLL https://jira.sqprod.co/browse/ROLL-103746…
:shipitparrot: we're out on prod
deploy checks pass


sergey
  3:22 PM
hi #ledger! i have a question about this payment:
https://regulator.sqprod.co/n/payments/NAnFsEd4OaUlDwh6FbcoCtcXdkdZY
how come they have a separate ledger entry for square fee?


5 replies
Last reply 8 months agoView thread


mgp
:baby:  5:15 PM
Deploying 5ebf552f63d94b4e97d7ac339692434126792e05 to Ledger staging
:bless:
1



zandt
:spiral_calendar_pad:  7:25 AM
replied to a thread:
Does anyone know the history of LedgerPaymentFilter and why it would care about pay with square entry methods? Is there additional work in Ledger, beyond adding to the filter, in order to support a new entry method?
This has been running for a week now in production. So far, the only unsupported entry/method and country combo is coming from subscription_dashboard  in US.
https://square.signalfx.com/#/temp/chart/FhsaIOuAgAA
Does anyone know what this is about and why Ledger skips it? I do see one comment related to it, which makes me think this is intentional.
https://github.com/squareup/java/blob/4ad672d757ca361dc13efdc1b55e273837a8933c/set[…]ain/java/com/squareup/ledger/api/country/us/UsEntryMethods.java
UsEntryMethods.java
      SUBSCRIPTION_DASHBOARD); // US billing is set up differently from international so suppress this
<https://github.com/squareup/java|squareup/java>squareup/java | Added by GitHub
View newer replies


carol
:spiral_calendar_pad:  12:02 PM
@oncall
 - I have a handful (3 or 5?) old return files from 2016 that I need help decrypting - the assumption is that those keys are still on Ledger but for some reason not on Teller.  Can I get some help this week?




45 replies
Last reply 8 months agoView thread


mengen
  12:12 PM
Ledger ROLL https://jira.sqprod.co/browse/ROLL-103808
(ledger @ 5ebf552f63d94b4e97d7ac339692434126792e05 to production)
:+1:
3



5 replies
Last reply 8 months agoView thread


mengen
  12:23 PM
replied to a thread:
Ledger ROLL https://jira.sqprod.co/browse/ROLL-103808…
staging checks pass
:canary: canary start
View newer replies


mengen
  12:47 PM
replied to a thread:
Ledger ROLL https://jira.sqprod.co/browse/ROLL-103808…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


mengen
  1:57 PM
replied to a thread:
Ledger ROLL https://jira.sqprod.co/browse/ROLL-103808…
:shipitparrot: we’re out on prod
deploy checks pass
:celeryman3:
1



vlong
  3:20 PM
replied to a thread:
:wave: Hello, we’re reaching out because your service ledger uses Envoy Logging (go/envoylogging) to log information about API Velocity endpoints. Envoy Logging is supported by our service api-observe, which your service’s Envoy sidecar asynchronously sends information to. Historically, api-observe has used endpoints_set.go to know which endpoints need to be logged and obtain information about those endpoints.…
We’re now flipping the flag to enable diffs in staging for ledger. This will allow us to compare the logs/metrics between the new and old implementation to ensure nothing has changed.
View newer replies


mengen
  5:11 PM
Deploying 350ca487047b63c35ae19a37138053a15a6e502a to Ledger staging

PayswingBot
APP  4:28 AM
Restoring normal payments traffic (unswinging) in production has been initiated by davidsmith with message: ROLL-103429 complete


amariz
  8:28 AM
Hey Team!
Wondering if you could advise on a ledger entry from this seller failed debit. They attempted to reissue a refund, but we failed to debit their account reason: "No Account/Unable to Locate". The seller has been charged 0.60€ by "Returned Ledger Entry" due to this, would this be normal? I haven't seen before other sellers charged due to this. Thanks!!
Transfer details


4 replies
Last reply 8 months agoView thread

root
APP  2:06 PM
ODS host fpd1517.sjc3b.square (pd-odsgroup375) is down
No action is needed from you. ODS oncall will try to successover metaclusters if they are active on this host.
Please see the #situation channel for more information.
apps affected: ledger
metaclusters affected for these apps:
- pd-mysql-ledger-002
Cc: 
@oncall
:ack:
2


1 reply
8 months agoView thread


mengen
  5:11 PM
Deploying 2811a87dc9767a2986b49ee815eeb40e578187a5  to Ledger staging


jasonlee
  7:11 PM
hey team - I'm using the following query (see thread) to get our ACH settlement volumes. In the US, 90% of these volumes are processed with Chase. However upon talking with Chase it sounds like the number of settlements we do with them is only about half of what's implied by this query. Can you help verify if this query is accurate? :thank:


9 replies
Last reply 8 months agoView thread


ericz
:spiral_calendar_pad:  8:25 AM
Hey team, is there an easy way to search the ledger entry feed to tell if a payment is on the feed or not and what metadata the feed has about the payment?
:checkmark:
1



2 replies
Last reply 8 months agoView thread


andreyg
  4:04 PM
deploying 61c2876c58b39ef897078ac063c57980660ded84 to staging
:checkmark:
1



andreyg
  12:15 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-103973
(ledger @ 61c2876c58b39ef897078ac063c57980660ded84 to production)
:+1:
3
:bless:
1




13 replies
Last reply 8 months agoView thread


andreyg
  12:41 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


carolina
  12:45 PM
Hello 
@oncall
 :wave::skin-tone-2: connectedusers is being migrated to AWS with the new app name duplograph . I'd like to add duplograph to the ACL of the following Ledger-related endpoints that CU consumes from. Where can I make PR to add it?
/1/pending-balances
/1/freezes
:checkmark:
1





8 replies
Last reply 8 months agoView thread


andreyg
  1:17 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


andreyg
  2:18 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass


andreyg
  4:04 PM
deploying 7eeca3b72562f25a3935be442f5703385bd55be5 to staging
:bless:
1



jengel
:spiral_calendar_pad:  12:45 PM
Hey Team, What ledger endpoint would I call if I wanted to know the exit mechanisms a seller has on there account?
:checkmark:
1


1 reply
8 months agoView thread


minghua
:bulb:  12:48 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-104019
(ledger @ 7eeca3b72562f25a3935be442f5703385bd55be5 to production)
:+1:
1



9 replies
Last reply 8 months agoView thread


minghua
:bulb:  1:02 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


minghua
:bulb:  1:36 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


zandt
:spiral_calendar_pad:  2:23 PM
replied to a thread:
Does anyone know the history of LedgerPaymentFilter and why it would care about pay with square entry methods? Is there additional work in Ledger, beyond adding to the filter, in order to support a new entry method?
I've submitted a PR to remove some unused logic around the Uniqlo / JCB Japan partnership that is no longer needed. Would appreciate a review.
Some additional discussion (https://square.slack.com/archives/C013D2VHLF3/p1669154382266319)
https://github.com/squareup/java/pull/266019


zandt
Hey all. I'm looking at cleaning up some older code in Ledger related to a Uniqlo JCB partnership in Japan that used to be supported back in 2016. (related code
https://github.com/squareup/java/blob/master/settlements/ledger/src/main/java/com/[…]/ledger/feeds/consumers/payments/countries/JpPaymentFilter.java and
 https://github.com/squareup/java/blob/master/gateways/jcb-api/src/main/java/com/squareup/gateways/jcb/api/UniqloPredicate.java#L26-L36)
I found an old ONCALL ticket that mentions this is no longer supported and the associated Square bank account has been closed. I also found a thread from 2 years ago that mentions this ticket and seems to confirm that it's no longer a thing anymore.
Show more
Thread in methods-regional-help | Nov 22nd, 2022 | View message
#266019 [ledger] remove unused country payment filter skipping logic
According to ONCALL-46825, we no longer have Uniqlo processing activity  
in Japan. Consequently, Ledger has no evidence of skipping these  
payments based off a metric that was introduced recently with #263788.
This change removes the payment skipping logic related to Uniqlo, as  
well as the country payment filter since it always returns True now.
Labels
accounting-engineering
Comments
4
<https://github.com/squareup/java|squareup/java>squareup/java | Nov 22nd, 2022 | Added by GitHub
:eyes:
1
:+1:
1

View newer replies


minghua
:bulb:  2:27 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we're out on prod
deploy checks pass


minghua
:bulb:  2:48 PM
deploying 8548d578ac89018f18277d1c02cb29426ad80db8 to staging


andreyg
  4:03 PM
^ missed that we already did it ….
deploying 07df3c9f38b74ae8b64b3692a58e3240114bfb2f to staging (edited) 
:checkmark:
1
:bless:
1



bponedel
:blob-wizard-zoom:  11:39 AM
This may be a naive question but I am looking for a snowflake table that includes a historical daily snapshot of a merchant’s Ledger balance. Not sure what team would own that, whether there is a cleaned up table or if I can easily query this from the raw Ledger database. Appreciate being redirected if there is a better place to ask :thank: :thank: :thank:
:checkmark:
1



18 replies
Last reply 8 months agoView thread


devonh
:spiral_calendar_pad:  2:44 PM
Hey team, I’m trying to resolve a dispute with dispute_token: 'dis-7c954d99-715b-45cf-8dea-942e9666e273' and unit_token: 'LJ7RBHGDS384D' but I’m getting a BAD_CASHFLOW error. The settled_amount field is showing nil for the dispute. Do I need to wait for this field to populate before resolving the dispute?
:checkmark:
1



4 replies
Last reply 8 months agoView thread


andreyg
  4:15 PM
deploying 45db54dbccdd630fde2ca511d00376bf404ca888 to staging
:checkmark:
1



mnovich
  12:17 PM
Any Canadian folks around?


9 replies
Last reply 8 months agoView thread


prabhjot
:no_entry:  1:06 AM
Hi Team, Heads up - there is currently a Barclays FileGateway maintenance going on that will last until 1:30PM GMT. GBP_FPS_BARCLAYS pipeline is getting impacted and transfers may be delayed during this time.


annhuang
  11:18 AM
Hey team :wave:! Quick question on EVENTSTREAM2.CATALOGS.deposits_change_schedule - is there a way to identify merchants who have changed their close of business hours from their local default from this table?
:checkmark:
1



3 replies
Last reply 7 months agoView thread


jengel
:spiral_calendar_pad:  1:34 PM
Hey Team, which reasons from the listMerchantSettlementStates rpc should be used to determine if a seller has linked an exit method?
:checkmark:
1


1 reply
7 months agoView thread


snigdhak
:no_entry:  3:27 PM
was added to #ledger by hoyi
.


ahwang
  3:45 PM
hi! :wave: Is there a way to create an UNDO ledger entry for a payment on staging? I tried executing the "Reject Refund" action on regulator (this payment) but haven't seen any subsequent ledger entries besides the original Capture entry. Just wanted to confirm if this is the right way to create UNDO entries and I just need to wait, or is there another way?
:eyes:
1
:checkmark:
1




7 replies
Last reply 7 months agoView thread


bjoseph
  4:02 PM
deploying 9da2f5d5715ce7b968c9eda05147779d45565d56 to staging
:checkmark:
1



bjoseph
  11:53 AM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-104186
(ledger @ 9da2f5d5715ce7b968c9eda05147779d45565d56 to production)
:+1:
3


6 replies
Last reply 7 months agoView thread


bjoseph
  12:44 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


bjoseph
  1:19 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


bjoseph
  2:28 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we're out on prod
deploy checks pass


jasonlee
  2:45 PM
Hey team - is there a way to see the mix of banks among our US merchant accounts? For example, I'm trying to understand what % of our merchant accounts are with Wells Fargo



11 replies
Last reply 7 months agoView thread


jagarbut
  2:57 PM
Hey ledger folks. Can anyone confirm for me if the freeze feed is seeing a high number of entities being produced to it today? sfs-core has started to see latency consuming it but we are still successfully consuming entries afaict
:eyes:
1
:checkmark:
1



2 replies
Last reply 7 months agoView thread


bjoseph
  4:03 PM
deploying efb1312c5a3613b892af6d62ad1fe581cf24b756 to staging


akwan
:spiral_calendar_pad:  10:11 AM
Hello! Rewards is looking into potentially adding a field to FreeProcessingAdjustmentDetail, and I'm wondering how this is stored (e.g. which table has the current token field in there)? I found the migrations but what is the equivalent of structure.sql in java, if that's the place to look?
Thanks!





72 replies
Last reply 7 months agoView thread


lishahe
:spiral_calendar_pad:  10:56 AM
Hi, I am working on a new refund policy design that does not refund fees at all. There will be changes on Feeplans on the refund API. Whom I can talk to on the design update and impact to ledger? (edited) 



5 replies
Last reply 7 months agoView thread


bjoseph
  12:02 PM
There's no ledger changes from last night's staging SHA so there'll be no deploy today
:+1::skin-tone-2:
1



bjoseph
  4:03 PM
deploying 5a38db590a230dfa3a015043eb02aeb160130e9d to staging

ODS Insights
APP  4:16 PM
This is a monthly reminder from ODS. Databases for one or more apps associated with this Slack channel (#ledger) have Best Practices issues. Review the issues in the databases/best-practices screen in Square Console.
https://square-console.sqprod.co/app/ledger/databases/best-practices (1379 cases)
See https://wiki.sqprod.co/display/ProdEng/ODS+Insights+MySQL+Best+Practices for explanations of issue types.

root
APP  4:29 AM
ODS host fpd1558.iad3b.square (pd-odsgroup384) is down
No action is needed from you. ODS oncall will try to successover metaclusters if they are active on this host.
Please see the #situation channel for more information.
apps affected: ledger
metaclusters affected for these apps:
- pd-mysql-ledger-011
Cc: 
@oncall

1 reply
7 months agoView thread


ahdoot
:spiral_calendar_pad:  7:53 AM
Hey 
@oncall
, could you help us determine if the following unlinked refunds have ledger entries and whether they’re settled :thread:
:checkmark:
1




13 replies
Last reply 7 months agoView thread


mgp
:baby:  10:25 AM
@oncall
 deploying a canary build of Ledger to staging. Should be quick
:ack:
2




6 replies
Last reply 7 months agoView thread


vlong
  11:54 AM
replied to a thread:
:wave: Hello, we’re reaching out because your service ledger uses Envoy Logging (go/envoylogging) to log information about API Velocity endpoints. Envoy Logging is supported by our service api-observe, which your service’s Envoy sidecar asynchronously sends information to. Historically, api-observe has used endpoints_set.go to know which endpoints need to be logged and obtain information about those endpoints.…
The flag in staging has been flipped for some time with no issues. We will now be flipping the flag to enable diffs in sandbox/production for ledger, to compare results and log any diffs to Presidio. The source of truth will still be the old implementation.
:ack:
1

View newer replies


tcespedes
  1:21 PM
Hey there! My name is Tomas and I work for RapDev and am currently helping migrate over the SFX monitors for ledger into Datadog. I've been told to try to split up the PRs a bit so trying to stop where I am (have a decent amount done already :sweat_smile:) and PR it for you guys to review. The last thing I'm missing before opening the PR is your Pagerduty escalation names. Could anyone provide those for me please (I believe I saw a normal one and a _daytime one). Thanks!
:eyes:
1
:checkmark:
1






43 replies
Last reply 7 months agoView thread


ejacobs
:spiral_calendar_pad:  2:33 PM
Hello! Can someone please approve this registry request for ledger--snowflake__read_only? It's urgent for Audience Gen and the Hexagon migration. Link here
:eyes:
1
:checkmark:
1



2 replies
Last reply 7 months agoView thread


bjoseph
  4:01 PM
deploying 0872d9418939f8ff1df75a1a44b5a3e2e6a2e499 to staging


njain
  5:29 PM
Hey 
@oncall
, could you please help me figure what this Seller's Ledger balance is? https://regulator.sqprod.co/n/users/9QMGX9DCS0DT5
:checkmark:
1




3 replies
Last reply 7 months agoView thread


bjoseph
  9:08 AM
@oncall
 going to take over ledger staging with a canary for ~30 mins


2 replies
Last reply 7 months agoView thread


bjoseph
  9:25 AM
replied to a thread:
@oncall going to take over ledger staging with a canary for ~30 mins
releasing staging and deploying latest 5123fda5bab85c9bf9f3f1cddef737dc96517ff7


rsasson
:no_entry:  2:35 PM
I wanted to notify you about plans for removing the ledger -> oauth Registry dependency early next week (details at ROLL-104081), oauth was a historical dependency for API Velocity services but now API Velocity no longer has oauth service references (and I've already removed the GNS config). I will post again in #situation when I go forward with ROLL, let me know if there are any concerns.

1 reply
7 months agoView thread


emilyl
  4:09 PM
deploying 7b759bfb222 (latest) to staging
:thank:
1



dpotvin
:spiral_calendar_pad:  5:01 PM
FYI there is a Barclays outage happening from 7pm PDT tonight until 2am PDT tomorrow, UK transfers may be unavailable for this outage window. I filed a pre-emptive SEV for this outage.


bta
  12:24 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-104449
(ledger @ 7b759bfb222d26d6384b43e7d0d2263fa1c7b26e to production)
:+1:
4




7 replies
Last reply 7 months agoView thread


bta
  12:56 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:chocobo-face: canary start
View newer replies


rsasson
:no_entry:  1:19 PM
replied to a thread:
I wanted to notify you about plans for removing the ledger -> oauth Registry dependency early next week (details at ROLL-104081), oauth was a historical dependency for API Velocity services but now API Velocity no longer has oauth service references (and I've already removed the GNS config). I will post again in #situation when I go forward with ROLL, let me know if there are any concerns.
ICYMI https://square.slack.com/archives/C02FC00LF/p1670274899380179


rsasson
FYI planning to execute ROLL-104081 this afternoon ~2:30 pm pacific (removing unused oauth registry dependencies), please reach out to me or #account-security oncall in case of issues (I've already confirmed client side GNS configs are removed and no envoy traffic from at least a month ago)
Posted in situation | Dec 5th, 2022 | View message


bta
  1:20 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


bta
  2:15 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we're out on prod
deploy checks pass


tornubari
  3:53 PM
Hi team, I am working with a seller and I am a little puzzled here, Seller lost 1,844.95 in Bookkeeper Adjustment on 11/22/22 at 2:30pm EST.
To my understanding bookkeeper adjustments can mean a lot of different things. Seller wants a specific for reason for those funds being taken. Can anyone take a look at this for me?
UT: LZGHYARR8YP0G,  Regulator. (edited) 
:eyes:
1



5 replies
Last reply 7 months agoView thread


bta
  7:44 PM
deploying 36e3ba8c38cdb7ad571ad0d648a0c73ef5ca98e4 (lastest) to staging


hoyi
  12:48 PM
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-104510
(ledger @ 36e3ba8c38c to production)

3 replies
Last reply 7 months agoView thread


hoyi
  1:01 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-104510…
staging checks pass
:canary: canary start
View newer replies


hoyi
  1:27 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-104510…
canary deploy checks pass
:rolling_kirby: rolling forward


hoyi
  4:08 PM
Deploying latest (6d6478d8c01) to staging
:bless:
1



jachman
  9:06 AM
was added to #ledger by zachs
.


jachman
  9:24 AM
Hello :wave:  
@oncall

Vuln Management here. There are two vuln bundles (stage & prod) associated with the ledger-data app. These two bundles have breached SLA's. Any chance we could get eyes on these?
Thanks!
:eyes:
1



2 replies
Last reply 7 months agoView thread


markl
:spiral_calendar_pad:  9:45 AM
@mgp
 I'm looking at the APIs that moneysweeper uses and had a question about the amount swept. It looks like the SweepInternalTransferMoney doesn't guarantee the request swept amount, but does the ReverseSweepInternalTransferMoney guarantee the amount requested == amount swept?
SweepInternalTransferMoneyRequest#amount
ReverseSweepInternalTransferMoneyRequest#amount


bta
  12:47 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-104582
(ledger @ 6d6478d8c01774db355e042bae4fb48e9d491cba to production)
:+1:
3




6 replies
Last reply 7 months agoView thread


bta
  1:14 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


elan
:spiral_calendar_pad:  1:27 PM
@oncall
 I have a Strategic Seller MLCHW6RSNMN5S that I filed an oncall for but erroneously filed to Banking Connections, 
@markl
 has helped me steer traffic and the specific issue I'm encountering is regarding an adjustment. https://square.slack.com/archives/C01HJRZKMTK/p1670448355992059?thread_ts=1670444036.133399&cid=C01HJRZKMTK Here is the oncall JIRA - any additional :eyes: on it would be very much appreciated!


markl
from looking at the ledger entry, it seems to be an adjustment coming from Sqweb, which I have no idea what that is:
        "external_source": {
          "name": "SQWEB_ADJUSTMENT",
          "id": [
            "792468"
Show more
From a thread in money-movement | Dec 7th, 2022 | View reply



4 replies
Last reply 7 months agoView thread


bta
  1:42 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


bta
  2:35 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we're out on prod
deploy checks pass


zandt
:spiral_calendar_pad:  2:48 PM
replied to a thread:
Does anyone know the history of LedgerPaymentFilter and why it would care about pay with square entry methods? Is there additional work in Ledger, beyond adding to the filter, in order to support a new entry method?
One more PR to cleanup a field that hasn't been used in years.
https://github.com/squareup/java/pull/267475
#267475 [ledger] Remove unused payment skipping logic related to TIVO
Since the payments_filtered.by_tivo_replay.total metric was added a  
month ago, nothing has been recorded. Additionally, this tag had a  
description noting no new TiVo payments should be created after  
2016-11-01. It should be safe to remove this payment skipping logic when  
processing the esperanto payment feed. Ledger will no longer have a  
Show more
Labels
accounting-engineering
Comments
2
<https://github.com/squareup/java|squareup/java>squareup/java | Dec 7th, 2022 | Added by GitHub
:stamp3:
1

View newer replies


bta
  4:20 PM
deploying 0799f13dc11582fcb7f7c9abee669fe00acfbccd (latest) to ledger staging


carolina
  9:45 PM
@oncall
 Hello, Foundry was paged due to lag on this feed in prod: /1/pending-balances and ledger is the owner. Can someone check?


2 replies
Last reply 7 months agoView thread


zellyn
  9:58 AM
Hey folks, just checking in on Java PRs #258234 and #258235, to migrate ledger-acceptance and ledger from using Sake to using gRPC/Envoy as a client. Could y’all take a look, and let us know in #frameworks if you have any questions?
#258234 migrate sake to grpc over envoy for ledger-acceptance
<https://github.com/squareup/java|squareup/java>squareup/java | Sep 20th, 2022 | Added by GitHub
#258235 migrate sake to grpc over envoy for ledger
<https://github.com/squareup/java|squareup/java>squareup/java | Sep 20th, 2022 | Added by GitHub


lishahe
:spiral_calendar_pad:  10:52 AM
Hi, I have some questions on App fee - does ledger perform its own calculation on the actual amount of app fee a developer can get? What would happen when the Square fee = payment amount? ex. $0.20 payment with 2.9%+0.30. In this case does the developer get 0 app fee? would they just not receive it, or would the seller go negative?
:eyes:
1




21 replies
Last reply 7 months agoView thread


mnovich
  11:14 AM
@oncall
 can I take ledger staging for canary testing ( possibly for the whole day)?


2 replies
Last reply 7 months agoView thread


paxton
  11:24 AM
Hi Team- we have a Strategic Seller (Regulator) that is churning from Square, and needs to manually reconcile their closing balances (who owes whom what). One of the churn reasons being they are unwilling from a Corporate control level to allow Square debit access to the same bank account as credits, or to have one account owner responsible for linking bank accounts. Starting here, but looking for direction. Much appreciated! cc: 
@ginac


5 replies
Last reply 7 months agoView thread


ginac
  11:24 AM
was added to #ledger by paxton
.


mnovich
  11:33 AM
@oncall
 deploying canary (dbac6858be4f) to staging. Will rollback to 0799f13dc11 after I’m done



9 replies
Last reply 7 months agoView thread


zandt
:spiral_calendar_pad:  12:29 PM
replied to a thread:
Does anyone know the history of LedgerPaymentFilter and why it would care about pay with square entry methods? Is there additional work in Ledger, beyond adding to the filter, in order to support a new entry method?
I've submitted a PR to remove the ledger PayWithSquareEntryMethod filtering logic that occurs during processing of the Esperanto Payments Feed. Based off my analysis of how it's being used and its overall intent, I don't believe it is needed anymore. In the last month, there is only a single entry type that is being skipped related to SaaS card payments in the US. These can simply be filtered out by the merchant unit token instead (which there is already a yaml used).
Any chance I could get some eyes on it? https://github.com/squareup/java/pull/267612
#267612 [ledger] Remove payment skipping logic related to the PayWithSquareEntryMethod
Ledger maintains a mapping of supported pay with square entry methods to  
Country. Upon processing a payment from the Esperanto payments feed, if  
the entry method is not present in the known list then the payment is  
added to an ignore list. However, according to the  
payments_filtered.by_country_and_entry_method metric, the  
Show more
Labels
accounting-engineering
Comments
2
<https://github.com/squareup/java|squareup/java>squareup/java | Dec 8th, 2022 | Added by GitHub


mnovich
  2:48 PM
replied to a thread:
@oncall deploying canary (dbac6858be4f) to staging. Will rollback to 0799f13dc11 after I’m done
Done with  staging. Deploying 0799f13dc11 back


mnovich
  2:50 PM
Is there a procedure for copying a yet unused ( but tested in staging) feature flag to prod? Or I can just copy it?


3 replies
Last reply 7 months agoView thread


bjoseph
  4:46 PM
deploying d1cb5f3a464ef7f4856a952ecdf3520d7c51d37c (latest) to ledger staging


jdelaney
  3:03 AM
Hi team, hoping this is the right group. We have a large UK Strategic seller who processes a large amount of transactions and has reported some missing transactions in their transfers. After investigation, it looks like the payments were actually captured sometimes at much later dates than they were taken on originally (some more than 1 month), resulting in a reporting issue. We assume these are outliers but wanted to see if someone could take a quick look at a couple of the 6 transactions in this doc and confirm this isn't an issue with the way Square is writing them to the ledger. Thanks for your help!
@jbambhra
 
@amariz
G Suite Document
 

Delayed Capture Transactions for WZS7VZ3KCMAXS
Google Doc




19 replies
Last reply 7 months agoView thread


carolina
  9:15 AM
Hello 
@oncall
 :wave::skin-tone-2: I’m from the DAGG team. We now own cloud-persister and it often receives consumption lag alerts about the following feed: ledger-settled-ledger-entries_2
It looks like it’s lagging by 11hours right now (!)
Would you know why?
Fetch latency chart: https://square.signalfx.com/#/chart/v2/Fi2fx0aAgAA?groupId=Fi2fs-5AYAg&configId=Fi2f1Lu[…]ger-freezes_0%22,%22ledger-instant-deposit-attempt_2%22%5D
Consumption lag: https://square.signalfx.com/#/chart/v2/Fi2fuTxAYAA?groupId=Fi2fs-5AYAg&configId=Fi2f1Lu[…]edger-bank-settlement-entries_3%22,%22ledger-holds_1%22%5D


3 replies
Last reply 7 months agoView thread


mykola
:spiral_calendar_pad:  10:48 AM
Hey Team,
I am looking for help with this question:
Is there any specific logic in Ledger that adjusts number of retries for ACH debits based on returned SEC codes?
cc: 
@hsilverio
 (edited) 


kcrane
:coolfingergun:  12:45 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-104734
(ledger @ 2bf5177f10d to production)



6 replies
Last reply 7 months agoView thread


kcrane
:coolfingergun:  1:03 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:chocobo-face: canary start
View newer replies


bforehand
  1:04 PM
FYI, a host that is being used by JBA is going to be restarted:


stephen
@oncall
 primary I’ve been asked to restart apa1361.nrt1b.square which seems to be unresponsive. The jba application is on this host, so I need to confirm with you before bouncing this host. Is it alright if I restart? This host may come back up or it may have a more persistent issue that requires more extensive downtime. (edited) 
Thread in banking-connections | Dec 12th, 2022 | View message
:ok_hand::skin-tone-3:
1




7 replies
Last reply 7 months agoView thread


kcrane
:coolfingergun:  1:41 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


elopez
:spiral_calendar_pad:  2:17 PM
Hi all, I believe my team may have lost access to the LEDGER database in Snowflake during the recent Snowflake. Can someone confirm if this is the correct permission we should request access to? https://registry.sqprod.co/groups/ledger--snowflake__read_only. Or is there a different group we should be adding?


2 replies
Last reply 7 months agoView thread


kcrane
:coolfingergun:  3:28 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we're out on prod
deploy checks pass


akwan
:spiral_calendar_pad:  10:19 AM
is ledger staging autodeploy being off intentional? if not, is it ok to turn it back on? thanks!
:checkmark:
1


1 reply
7 months agoView thread


songlin
  12:35 PM
No deploy to ledger production today as we didn't do staging yesterday


bta
  5:14 PM
deploying ca40f3cb5ebac03a1e77d46b5cdcdf07c1412126 (latest) to ledger staging

root
APP  1:14 AM
ODS host fpd1482.iad3b.square (pd-odsgroup373) is down
No action is needed from you. ODS oncall will try to successover metaclusters if they are active on this host.
Please see the #situation channel for more information.
apps affected: ledger
metaclusters affected for these apps:
- pd-mysql-ledger-028
- pd-mysql-ledger-029
Cc: 
@oncall

1 reply
7 months agoView thread


ishvydchenko
  10:02 AM
Hey team! We haven't seen a capture event come in on staging in the last 6h from the cleared-transaction-events feed, wondering if there are any known issues? (edited) 
Screenshot 2022-12-14 at 9.51.01 AM.png
 
Screenshot 2022-12-14 at 9.51.01 AM.png




20 replies
Last reply 7 months agoView thread


carolina
  1:57 PM
@oncall
 Recently we added ACLs to settlements/ledger to have duplograph be able to hit the ledgerFreezes and ledgerPendingBalances feed endpoints: https://github.com/squareup/java/pull/265882/files#diff-6294b3846404f4a0bccaf2a84bc0cb809e47a18f8689b795753ae61989248bf6
But when we try to fetch feeds we get this message, which indicates some envoy misconfig on ledger side I think.
 "RpcException (SERVICE_UNAVAILABLE): gRPC call to squareup.feedsync.service.FeedSourceService/Fetch failed: UNAVAILABLE: envoy has no route for the specified Host header.
duplograph is currently able to access other feed publishers, and our container sq-cloud-envoy returns 200 when pinging the ledger GNS:
[2022-12-14T21:34:33.611Z] "POST /squareup.feedsync.service.FeedSourceService/Fetch HTTP/2" 200 14/- - "direct_response" 0 0 0 - - - - "grpc-java-netty/1.48.0" "0bc43aaa-9aab-4f5d-bd4d-9c5552f4216a" "staging-writer.ledger.gns.square" "zKeYJCcfPcWDA""-" "-"
Could you help us figure out what’s wrong?
:eyes:
1
:checkmark:
1




3 replies
Last reply 7 months agoView thread


songlin
  2:05 PM
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-104873
(ledger @ ca40f3cb5ebac03a1e77d46b5cdcdf07c1412126 to production)
:+1:
2



13 replies
Last reply 7 months agoView thread


songlin
  2:23 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-104873…
rotated out those two nodes
:bless:
1

View newer replies


songlin
  2:24 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-104873…
staging checks pass
:chocobo-face: canary start
View newer replies


songlin
  2:56 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-104873…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


songlin
  4:08 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-104873…
:shipitparrot: we're out on prod
deploy checks pass


songlin
  4:38 PM
deploying fc8e3bb30d0ad0b215bde17747002d2ca549e8cd to staging

root
APP  11:24 PM
ODS host fpd1482.iad3b.square (pd-odsgroup373) is down
No action is needed from you. ODS oncall will try to successover metaclusters if they are active on this host.
Please see the #situation channel for more information.
apps affected: ledger
metaclusters affected for these apps:
- pd-mysql-ledger-028
- pd-mysql-ledger-029
Cc: 
@oncall

1 reply
7 months agoView thread


ericz
:spiral_calendar_pad:  10:42 AM
@oncall
 I'm planning on shutting off the web consumer of the ledger-entry-feed and that might cause the feed lag to increase which might trigger this alarm and page. I wanted to let you know so that we can work together to make sure you don't get paged for this and are aware of what's going on. I'll probably shut it off in about an hour, will keep you posted!
:ack:
1




8 replies
Last reply 7 months agoView thread


markl
:spiral_calendar_pad:  2:57 PM
I have a chart that tracks deleted sweeps from moneysweeper. The largest subset comes from frozen or deactivated units that seems to happen daily around 8pm PST and is oddly roughly the same volume every day. Is there a job that clears transactions for these unit types daily around this time?
Graph showing the daily 8pm spike: https://square.signalfx.com/#/temp/chart/FkDaUPqAcAA (edited) 
moneysweeper.deleted-sweep
Added by SignalFx (11 kB)
https://square.signalfx.com/#/temp/chart/FkDaUPqAcAA



6 replies
Last reply 7 months agoView thread


songlin
  4:46 PM
deploying 8e78dc06f2af1f2b22f56011e254c38900c2647a to staging


ericz
:spiral_calendar_pad:  1:00 PM
Is any chance we could get https://jira.sqprod.co/browse/ACTENG-5169 prioritized? This leads to significant feed lag every Saturday and it makes it very hard for us to monitor for actual issues while this is ongoing



46 replies
Last reply 7 months agoView thread


andreyg
  4:21 PM
deploying e872073f1cd to staging
:checkmark:
1



zzhang
  8:36 PM
Hi team, we got paged for 6 Returned Ledger Entries were created 2 years after a plan was closed, could you advise why this could happen, and what should we do about them? https://regulator.sqprod.co/n/users/0ZA97V39A87EC?section=ledger-entries
:eyes:
1


2 replies
Last reply 7 months agoView thread


andreyg
  11:56 AM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-105006
(ledger @ e872073f1cd to production)
:+1:
2






10 replies
Last reply 7 months agoView thread


andreyg
  1:00 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:chocobo-face: canary start
View newer replies


andreyg
  1:59 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


andreyg
  2:59 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass
View newer replies


andreyg
  4:04 PM
deploying 38c09b099d4 to staging
:checkmark:
1



bjoseph
  11:22 AM
No ledger production deploy today since there's no changes in the staging SHA


tcespedes
  1:04 PM
Hey team, just finished the migrating the requested custom ledger dashboards from SFX. Feel free to take a look in the list below. A couple callouts that I should mention:
Was asked for MySQL Usage & Capacity Monitoring but those all use the nodes.percona metrics which don't appear to be in use in DD, I'd recommend using the MySQL standard dash for this
This also affects the Ledger Overview mysql section
Settlement Jobs Latency —> last 2 widgets don’t support rate in DD due to the metric type
Stale Risk --> Missing "Risk-skipped payments..." widget
Event Latency :
Missing balance_changing_events.latency_enqueue.* metrics
graphite() queries aren't supported in DD
Feeds Consumed went with the OOTB one on this one, it covers entire use case and more
Please don't hesitate to let me know if there are any questions whatsoever! Thanks.
https://square.datadoghq.com/dashboard/lists/manual/350884
:bless:
2



bjoseph
  4:08 PM
deploying 4360ad93b1adef4f24b11d9f61fefa7bd31ce73a  to staging
:checkmark:
1



kcrane
:coolfingergun:  1:35 PM
Skipping deploy today since the deploy freeze starts in like 12 hours and settlements can be risky.

root
APP  6:49 AM
ODS host fpd1482.iad3b.square (pd-odsgroup373) is down
No action is needed from you. ODS oncall will try to successover metaclusters if they are active on this host.
Please see the #situation channel for more information.
apps affected: ledger
metaclusters affected for these apps:
- pd-mysql-ledger-028
- pd-mysql-ledger-029
Cc: 
@oncall
:ack-red:
1


1 reply
7 months agoView thread


nbl
  9:03 AM
@oncall
 hopefully a simple question :crossed_fingers:
For legder payments, first we draw from square balance and then we draw the rest from linked bank account? That is my understanding but a capital loan seller called in wondering why we pulled everything from their bank account when they have a balance.
:eyes:
1





24 replies
Last reply 4 months agoView thread


zandt
:spiral_calendar_pad:  11:03 AM
Hey all. I'm trying to understand, between two sample payments that involved a Square Gift Card on SOS why only one of the payments has a THIRD_PARTY_FEE ledger entry. The only difference that I can see is the latter payment has an app fee for the refund and the other one does not. As long as there is an app fee on the original payment, shouldn't there be a THIRD_PARTY_FEE ledger entry?
Sample payments:
f7Q100xgXWmEW5d4iotf9kSiYLeZY
FCQ0Mpzr4LX3MCpeQlMSTRsTbxFZY
On a slightly related note, could I get access to Ledger's snowflake database to run some queries to verify some assumptions that I have about how payments are processed?
:eyes:
1






66 replies
Last reply 7 months agoView thread


andreyg
  4:15 PM
deploying 9e6182e42ca to staging

root
APP  12:33 AM
ODS host fpd1515.sjc3b.square (pd-odsgroup374) is down
No action is needed from you. ODS oncall will try to successover metaclusters if they are active on this host.
Please see the #situation channel for more information.
apps affected: ledger
metaclusters affected for these apps:
- pd-mysql-ledger-001
- pd-mysql-ledger-012
Cc: 
@oncall

1 reply
7 months agoView thread


ashtyn
  11:53 AM
Hello! I’m trying to troubleshoot ONCALL-143217 - basically, a settlement report is failing for unit F1M1HX9VTKHKA because they have some ledger entry that is of entry_type THIRD_PARTY_FEE or THIRD_PARTY_FEE_REFUND but is missing the entry.detail.third_party_fee.third_party_fee_amount_detail field.  I looked at the ledger entries for the payments included in this settlement report, and they all look as they should, so I’m guessing the issue is in one of the refunds - but I’m not sure how to look those up by refund token. Can someone please check these refunds and let me know if any have an entry type of THIRD_PARTY_FEE_REFUND and are missing that field?
p8recRb4Unyh8KoYNNwO1KWFpm6fTYphXkY6WNUDxeL
l8ykJ3Z11yHcakOk38TMbxHJycsDg1gOoLM0V6r0hkH
MqJjzVgd7BkkzgC3VW5P1KtkQZ8GbZUs3gkaJjQu3sd
2S3ln020QMFVbWRGtq6tv5ijed27VaD4naX9XSIXV4Y
VSkbUPalFjriXn8Zhs9JkjfbTcxhqLGfexNkK6T1uaD



9 replies
Last reply 6 months agoView thread


jcurry
  12:27 PM
Hey team,
I received this message from my customer who recently onboarded with our Staylist integration. I was informed by a member of our accounting eng team to reach out to this channel to flag this issue for potential remediation. We think this may have to do with the timing as to when they are pulling reports / pulling back of refunds, but can anyone on this channel clarify if thats the case and if there is any forward guidance here? TY in advance!
"Hello,
There is a discrepancy between what supposed to be deposited and what was actually deposited for 12-1-22.
Square reports a net total of $26,192.23, same as Staylist (our booking software) for transactions on 12-1-22. On 12-2-22 there was a direct deposit of $25,965.93 for a short of $226.30. Why ? Where is it?
If i add all the deposits into my account (from square) from 12-1-22 to 12-9-22, the sum never equals the sum of the sales of the transactions for the same time span.
Regard,
Michael Ho-Lung
Manager
Nova Family Campground"


3 replies
Last reply 6 months agoView thread


gkeyes
:spiral_calendar_pad:  11:00 AM
Hey yall, I was hoping you could help me understand why the refund ledger entry from "12/20/22 at 12:43pm EST" for https://regulator.sqprod.co/n/users/J7T62C0V6QR3F?section=ledger-entries hasn't been settled yet
:eyes:
1



5 replies
Last reply 6 months agoView thread


andreyg
  11:51 AM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-105277
(ledger @ 9e6182e42ca to production)


5 replies
Last reply 6 months agoView thread


andreyg
  12:23 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:chocobo-face: canary start
View newer replies


andreyg
  1:20 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


andreyg
  2:21 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass


ena
:spiral_calendar_pad:  2:50 PM
heya team! :helloblob: from transfers here!
[ONCALL-143239] we have a seller (LKYTRB7CBB8FQ) who is blocked from transferring due to UNSETTLEABLE blocker coming back from ledger’s merchant settlement state (BLOCKED_BY_ONBOARDING)
from the merchant + unit permissions standpoint, it look like they don’t have any onboarding permission blockers :thinkeyes: does anyone know how we can get this unit unblocked? :thanks_so_much::skin-tone-2:
:eyes:
1



8 replies
Last reply 6 months agoView thread


mnovich
  3:08 PM
can someone tell me what is ledgers datadog migration status?

1 reply
6 months agoView thread


andreyg
  4:03 PM
deploying 551065363cc to staging
:checkmark:
1



bastien
  5:41 PM
Hi team - are we able to tell what account this is related to?
I usually look for an L or T in the ID number but I dont see one here - I’m not 100% sure this is even related to Square
image.png
 
image.png
:checkmark:
1



3 replies
Last reply 6 months agoView thread


louisa
:spiral_calendar_pad:  10:22 AM
hi there, recon got a question from accounting about tracing some outbound transfers to cash, but we don’t currently have this data in our tables (i believe due to the migration of some settlements from ledger to payouts, and we don’t have a feed from payouts yet). can you help point us in the right direction on how to trace these transfers / who might be able to help? cc 
@huanl
 
@angelia


angelia
Happy New Year recon team, I am looking at regulator and saw two same set amounts showing in outbound transfers, however, our bank only shows we receiving one. (see highlight in the below screenshot), can you advise these are duplicate or we should receive all, if there are duplicate, is it due to the migration project? Please direct me to the right team if you are not. Thx (edited) 
2 files
 
image.png
image.png
Thread in recon-operations | Jan 4th | View message
:checkmark:
1




13 replies
Last reply 6 months agoView thread


mengen
  12:27 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-105365
(ledger @ 551065363cc781131237f777d5ee3d713a5619a1 to production)



7 replies
Last reply 6 months agoView thread


mengen
  12:48 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:chocobo-face: canary start
View newer replies


mengen
  1:38 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


mengen
  3:25 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass


mengen
  4:28 PM
deploying 3751414c74d0a280596e39a6d10fabb066ddcc73  to staging


mnovich
  1:51 PM
@oncall
 I may cause a stuck-payouts alarm in staging within next 30 minutes. Please ignore.

1 reply
6 months agoView thread


jcui
  2:05 PM
hi, i am investigating an issue where a seller's monthly payment to their term loan failed due to insufficient funds. the seller had enough funds in their ledger balance but we attempted to debit their bank account instead. is there a reason why the funds were not pulled from their ledger balance?
:eyes:
1




8 replies
Last reply 6 months agoView thread


tmahoney
  3:05 PM
would Ledger throw a CASHFLOW_VIOLATION if we attempted to refund (to the original payment card) a payment that had already been refunded to gift card?



27 replies
Last reply 6 months agoView thread


andreyg
  4:02 PM
deploying a85484b3068 to staging


emilyl
  11:53 AM
:information_source:  We will be conducting a Ledger DR exercise on Tuesday, January 10th as part of the wider Payments DR exercise. Updates will be posted here


zandt
:spiral_calendar_pad:  12:59 PM
:wave: Small pr to adjust how the payment feed listener checks for app fees. This was a followup from a previous pr. https://github.com/squareup/java/pull/269714
#269714 [ledger] Update Esperanto Feed Listener to use payment adapter for app fee check
Labels
accounting-engineering
Comments
2
<https://github.com/squareup/java|squareup/java>squareup/java | Jan 6th | Added by GitHub


26 replies
Last reply 6 months agoView thread


emilyl
  4:03 PM
deploying 6e7b3284320 (latest) to staging


kcrane
:coolfingergun:  4:51 PM
deploying 49f3fba3a89 (latest) to staging


chansen
  8:24 AM
Hey Ledger team :wave:   What are the merchant settlement states for L8X76D50F0AVT  in staging? 
@justinroberts
 are puzzled as to why we are receiving NO_VERIFIED_BANK_ACCOUNT  despite the seller having a linked bank account as per the linked bank accounts in regulator.
Note: this has was tested a few months ago, and everything worked as expected - no code changes since then
:eyes:
1
:checkmark:
1




7 replies
Last reply 1 month agoView thread


kcrane
:coolfingergun:  1:06 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-105521
(ledger @ 49f3fba3a89 to production)
:bless:
1





16 replies
Last reply 6 months agoView thread


kcrane
:coolfingergun:  1:22 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:chocobo-face: canary start
View newer replies


kcrane
:coolfingergun:  2:17 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


emilyl
  4:03 PM
deploying 71ee9e7ac48 (latest) to staging


kcrane
:coolfingergun:  4:39 PM
replied to a thread:
Ledger ROLL:…
(forgot to post this earlier)
:shipitparrot: we're out on prod
deploy checks pass


bforehand
  5:08 PM
FYI, we're unable to currently connect to the Barclays SFTP File Gateway. This is causing our UK pipeline to stall. I'm not sure if/when Ledger will see similar impact, but the issue appears to be ongoing.
:ok_hand::skin-tone-3:
1




6 replies
Last reply 6 months agoView thread

root
APP  8:47 AM
ODS host fpd1555.iad3b.square (pd-odsgroup383) is down
No action is needed from you. ODS oncall will try to successover metaclusters if they are active on this host.
Please see the #situation channel for more information.
apps affected: ledger
metaclusters affected for these apps:
- pd-mysql-ledger-010
Cc: 
@oncall


emilyl
  9:29 AM
Payments DR preemptive sev for ledger: https://jira.sqprod.co/browse/ALERT-11296 (edited) 

9 replies
Last reply 6 months agoView thread

PayswingBot
APP  10:22 AM
Evacuating payments traffic from WEST datacenters (swinging EAST) in production has been initiated by zandt with message: Payment DR 2023 Q1 Exercise

root
APP  11:02 AM
ODS host fpd1551.iad3b.square (pd-odsgroup381) is down
No action is needed from you. ODS oncall will try to successover metaclusters if they are active on this host.
Please see the #situation channel for more information.
apps affected: ledger
metaclusters affected for these apps:
- pd-mysql-ledger-008
Cc: 
@oncall

1 reply
6 months agoView thread


emilyl
  12:04 PM
replied to a thread:
Payments DR preemptive sev for ledger: https://jira.sqprod.co/browse/ALERT-11296
starting to swing ledger
View newer replies


emilyl
  12:16 PM
replied to a thread:
Payments DR preemptive sev for ledger: https://jira.sqprod.co/browse/ALERT-11296
pausing risk feeds
View newer replies


emilyl
  12:18 PM
replied to a thread:
Payments DR preemptive sev for ledger: https://jira.sqprod.co/browse/ALERT-11296
updating dns to iad
View newer replies


zellyn
  12:40 PM
Gentle ping… (edited) 


zellyn
Hey folks, just checking in on Java PRs #258234 and #258235, to migrate ledger-acceptance and ledger from using Sake to using gRPC/Envoy as a client. Could y’all take a look, and let us know in #frameworks if you have any questions?
Posted in ledger | Dec 8th, 2022 | View message


2 replies
Last reply 6 months agoView thread


emilyl
  12:48 PM
replied to a thread:
Payments DR preemptive sev for ledger: https://jira.sqprod.co/browse/ALERT-11296
ledger has swung to iad


grassadonia
:ooo_1:  2:52 PM
Hi team - does anyone know what "Square Sync Production Fee" is referring to in Ledger? One of our Enterprise sellers is asking about this $13.29 ACH debit from their bank account. See screenshot below and regulator link
Screenshot 2023-01-10 at 2.48.52 PM.png
 
Screenshot 2023-01-10 at 2.48.52 PM.png
:checkmark:
1



2 replies
Last reply 6 months agoView thread


emilyl
  4:13 PM
deploying e5a53b5157c (latest) to staging

PayswingBot
APP  11:21 AM
Restoring normal payments traffic (unswinging) in production has been initiated by zandt with message: Payments DR unswing


emilyl
  12:03 PM
:information_source:  starting to unswing ledger

11 replies
Last reply 6 months agoView thread


bforehand
  12:24 PM
I'm seeing some timeouts for InternalListsDeposits which calls Ledger for ListBankSettlementEntries.


3 replies
Last reply 6 months agoView thread


jonchu
  12:26 PM
Hey team! I had a quick question about the LedgerService.GetMerchantDepositTags endpoint call. We have a merchant who's tags used to include the date and looked like 1207 CCHE . However, as of ~Dec 8th, it looks like the tags have dropped the date to instead just be CCHE , for example. Testing using ledger admin's RPC with the unit token shows that the tag returned now is just CCHE :
{
      "merchant_token": "LXVDG48HTH62B",
      "deposit_tag": "CCHE"
    }
Were there any changes made around that time that might have caused the date to have been dropped? Thanks! :thx-blob:

2 replies
Last reply 6 months agoView thread


emilyl
  1:05 PM
replied to a thread:
:information_source: starting to unswing ledger
ledger is back to normal
:clap-clap:
2



lishahe
:spiral_calendar_pad:  3:45 PM
Hi, I have a small PR that add unit token to assess refund request, can I get a :stamp:? cc 
@mengen
#270295 Pass unit token for AssessRefundRequest - needed by the new refund po…
…licy feature
Labels
accounting-engineering
Comments
1
<https://github.com/squareup/java|squareup/java>squareup/java | Jan 11th | Added by GitHub
:stamp:
2
:pray:
1



emilyl
  4:07 PM
deploying f39a434498f (latest) to staging


stilden
  4:22 PM
Hey team! We’re hoping to finish rolling out RPC enforcement in Envoy SAFE. For ledger, we see that there are a couple RPC routes that are not yet defined in Envoy SAFE: https://presidio-ui.sqprod.co/search?search=application:ledger%20%22Envoy%20SAFE%20Diff%22&instance=staging&window=3d
Any chance someone on your team could define the following routes at go/routes/ledger ? We should then be able to roll out RPC enforcement for Envoy SAFE without breaking you!
/squareup.ledger.service.InstantDepositService/ReserveFundsForDeposit
/squareup.ledger.service.InstantDepositService/SettleFundsForDeposit
/squareup.ledger.service.BalanceService/FoldBalance
:checkmark:
1



2 replies
Last reply 4 months agoView thread


emilyl
  4:16 PM
deploying a50cda51d5a (latest) to staging


acastberg
  11:22 AM
:helloblob: Hello! I have a Initial Balance Change ledger entry in regulator where I'm not sure what the origin is. Does anyone know what might have caused the $164.31 adjustment here? :blob-thanks:
:eyes:
1
:checkmark:
1



3 replies
Last reply 6 months agoView thread


dchen
:spiral_calendar_pad:  12:43 PM
hi team, Ledger.ledger__ledger_production.pending_balance_snapshots . i am looking for a historical version (daily snapshot) of this one, since this table only stores the most recent snapshot. could someone help? :thankyou-rainbow:





7 replies
Last reply 4 months agoView thread


grassadonia
:ooo_1:  2:18 PM
Hi team - One of our enterprise sellers (Thrive) reached out about an unknown debit of ($1,562.12) on one of their 11/30/22 balance transfers. The debit is listed under "other" in the transfer report on dashboard and I took a look in regulator and the debit is listed as an "adjustment" but no further details are provided. Would anyone be able to help me identify what this debit is for? (edited) 
2 files
 
Screenshot 2023-01-13 at 2.06.03 PM.png
image002 (1).png
:checkmark:
1



2 replies
Last reply 6 months agoView thread


dfelixkim
:spiral_calendar_pad:  2:52 PM
Hi, I’m looking at a seller who has had 2 failed payments on a Term loan due to insufficient funds. They currently have a pending 3rd payment here. I’m newer to the servicing side, but I remember hearing about seller bank accounts getting unlinked after 3 failed payments. Will that happen to this seller if this pending payment fails as well?
:eyes:
1
:checkmark:
1



3 replies
Last reply 6 months agoView thread


bjoseph
  4:04 PM
deploying fd3110e77ae11b5fde6eb30ce7511f4d0d133349 (latest) to staging


christiew
  9:59 PM
Hi Team, There looks to be a bug or error in Balance reporting for some merchants in AU. Chargebacks with a lost resolution are being included in the Sellers outstanding balance. Can someone please assist in fixing this? We have seen this with a number of sellers. I am not sure what the total population is or what is causing it but here are some easy to see examples as almost all payments processed are lost chargebacks for these sellers however the transfers balance is still showing the lost payments as payable. LC4WG7MFB8F10, L9XC6Z90PVM77 and LWX3YXWXJSJM0


5 replies
Last reply 6 months agoView thread


obaltay
  10:27 AM
Hi Ledger Team! Just wanted to provide notice that the PayPCP team has updated our PagerDuty monitoring for the missing feeplan alert in staging only to notify with low urgency (page daytime only). This alert has caused strain for our oncall engineers in the past, and we hope to reduce this by lowering the urgency of this alert. The urgency will be unchanged in sandbox and prod. Thanks! cc: 
@plee
 
@zachs
yash
 | G Suite Document
 

FeePlans Runbook (go/feeplansrunbook)
Google Doc



5 replies
Last reply 6 months agoView thread


bjoseph
  12:06 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-105830
(ledger @ Sfd3110e77ae11b5fde6eb30ce7511f4d0d133349 to production)
:+1::+1::skin-tone-2::+1::skin-tone-3:
4






10 replies
Last reply 6 months agoView thread


bjoseph
  12:31 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


bjoseph
  1:05 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


bjoseph
  2:09 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we're out on prod
deploy checks pass


sokolik
:palm_tree:  4:03 PM
:wave:  is this the right channel to ask about the definition of "frozen" as it relates to a unit? My team (Customer Foundations) owns digital receipts and we're trying to prevent a bombardment of scams that have popped up recently. One lever we want to pull is to fail early on "frozen" accounts (we freeze accounts once we detect fraud/scams), but it appears that some sellers can be in frozen states while (1) still accepting payments and (2) having a frozen state for other reasons for which we might still want to send receipts.
:checkmark:
1



19 replies
Last reply 6 months agoView thread


bjoseph
  4:03 PM
deploying 6810d069238e2a39c728f4e6215dab460b6f2b1e (latest) to staging


bji
  9:08 AM
not sure if this is the correct channel but I'm trying payments for a new capital product on staging but the settlement has been stuck in pending status and im not sure why.
:eyes:
1
:checkmark:
1




10 replies
Last reply 6 months agoView thread


bjoseph
  12:07 PM
there's no ledger changes from yesterday's staging sha so no production deploy today


bjoseph
  4:03 PM
deploying 4e5b6b1f65b22c32e5264be739d3a23b6c167d9b (latest) to staging


skaltenbach
  4:32 PM
Hi team - for CA pipeline there is a cutoff of 19:00 PST and the ledger CA pipeline runs at 19:30 PST M-F, but on Sunday it runs at 19:05. And for AU, there is a cut-off time of 11:30 AET and the AU ledger pipeline runs at 11:05 AET. For payouts AU / CA step function runs, we cannot run the live run until the cut off time. However, having these ledger pipelines run just 5 minutes after the cutoff times means that there is no time to rollback to ledger during migration if needed. For example, with GB, payouts runs at 15:30 PST and ledger GB pipeline runs at 16:00 PST, which gave us 30 minutes to flip to 100% ledger if needed.
Would it be possible to push back the Sunday CA ledger pipeline run-time as well as the AU ledger pipeline run-times by ~ 30 minutes?


hikaru
  10:52 PM
Hi team! This chargeback was imported 5 hours ago but it is still not reflected in the balance. (The balance  of this seller is showing 3,080 JPY) Does anyone know why it is taking so long for the balance to reflect the chargeback?


2 replies
Last reply 6 months agoView thread


justinroberts
:funkyfish:  10:05 AM
Hi there! We’ve got an unlinked refund that got rejected at the gateway (so it failed, but after the payment record was marked completed, and there’s not a way for it to go back and update that PR state because of design decisions made long ago) with a ledger entry token of X6JRO8-0u17xBrfQXb27eGCh7xQ and we were hoping y’all could see what the state of that ledger entry is. We want it to be undone if it’s not already (and I think we might be able to do that with a call from refundsarbiter). Thread for more context.


bastien
@cberda
 - in the above thread with 
@cakinrinade
 he investigated this unlinked refund https://regulator.sqprod.co/n/payments/Lx0rmSCywq1WaVdDMQs3UAniA9BZY which was to an AMEX card. Shouldn’t this have been stopped since it’s AMEX?
I reached out to Rodrigo in #payment-partner-ops and he then reached out to AMEX who is now asking questions about the unlinked nature of the refund and the original transaction but then I remembered that AMEX should have not worked in the first place
Thread in unlinked-refunds-canada-powdr | Jan 13th | View message
:eyes:
1
:checkmark:
1



4 replies
Last reply 6 months agoView thread


brenton
  2:28 PM
is there a way to check if a merchant was frozen during a specific period of time? I have an oncall ticket for a merchant where repayments didn't go through from october through january, then showed up combined all at once in january
:checkmark:
1



28 replies
Last reply 6 months agoView thread


bjoseph
  4:07 PM
deploying b80550cbeb644d71202702c30d3e22b3b047a916 (latest) to staging


zandt
:spiral_calendar_pad:  8:18 AM
Hi all. I have a PR open to consolidate the capture payment record processors that are used during processing of the Esperanto Payment Feed. There should not be any behavior changes and I have left some comments for follow-ups once we can be confident that some remaining method specific details can be removed. I would appreciate some feedback :prayforstamp: .
#269638 [ledger] Merge the card and bank capture payment record processors by using the payment adapter
The intent of this change is to pave the way forward to remove payment  
method specific checks from the capture payment record processor. As a  
first step, the card and bank capture payment record processors have  
been merged. There are still some method specific checks, but only  
because there are dependencies to downstream apps or method specific  
Show more
Labels
accounting-engineering
Comments
4
<https://github.com/squareup/java|squareup/java>squareup/java | Jan 5th | Added by GitHub
:eyes:
1






14 replies
Last reply 6 months agoView thread


nan
:spiral_calendar_pad:  9:29 AM
Hi Team, have a question about this SEV (L0NR598Z0FFW5), from Regulator or CBMS (chargeback tables), we saw $649K chargeback. While we only see $319K disputed amount in ledger table. Can the team help to understand the discrepancy here? cc: 
@rpeterson
 
@klachance
 
@andreal

SELECT * FROM ledger.LEDGER__LEDGER_PRODUCTION.pending_balance_snapshots WHERE merchant_token = 'L0NR598Z0FFW5';
:eyes:
1





22 replies
Last reply 6 months agoView thread


klachance
:no_entry:  9:29 AM
was added to #ledger by nan
.


agu
:spiral_calendar_pad:  12:29 PM
Hi Team! I have a question about a Square Balance funded payroll run that failed with a 400 status, i see in presidio that we got
Found backwards incompatibility in calculation for merchant LKJWXP2KG2N2W: 1) outstanding deposit amounts disagree

2) outstanding deposit debit amounts disagree
here's the speleo trace id: CDN-6b356a06-4816-470a-a835-519900e2d41c
can anyone explain what this means? and if it would have bubbled up an error?
:eyes:
1




7 replies
Last reply 6 months agoView thread


songlin
  3:55 PM
deploying 194cd16d9ca707d52e26b6e18b13e1950e108889 to staging


hoyi
  5:16 PM
Deploying latest (11dedf5d998) to staging


ewalls
  7:37 AM
Hi Ledger team, I have a question about settlements: are they idempotent by external_source_id?


klachance
:no_entry:  9:25 AM
Hi team, Im trying to understand why the disputed_amount_cents doesn't line up with the total chargebacks for this user: L8FTYPA2ETYAV
In ledger the disputed_amount_cents is 2000 which represents this payment_token VWQLVL7klMJOMQe6odEnFGW1vaB but this payment_token appears to be missing in ledger J8aFXsTvddYiYUql53iXgJxtuaB but shows up in our chargeback table. Why doesn't this show up in the ledger table? Thanks for your help
cc: 
@evelynlee
 
@merrilyn
 
@mmargenot

SELECT user_token
    ,payment_token
    ,amount_cents
FROM cbms.raw_oltp.disputed_payments
WHERE user_token = 'L8FTYPA2ETYAV'
SELECT * FROM ledger.LEDGER__LEDGER_PRODUCTION.pending_balance_snapshots WHERE merchant_token = 'L8FTYPA2ETYAV';
(edited)
:eyes:
1


2 replies
Last reply 6 months agoView thread


songlin
  12:36 PM
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-106068
(ledger @ 11dedf5d99896ab10fa9941604b509f7c586da5c to production)
:+1:
4



6 replies
Last reply 6 months agoView thread


songlin
  12:55 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-106068…
staging checks pass
:canary: canary start
View newer replies


songlin
  1:36 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-106068…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


songlin
  2:42 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-106068…
:shipitparrot: we're out on prod
deploy checks pass


songlin
  4:05 PM
deploying ee7e2d0ab2e1d6404cefa5a8ddfe8d4e79082a2d to staging


acastberg
  9:29 AM
:wave: hello from transfers, could I deploy a canary on staging for this build today?


16 replies
Last reply 6 months agoView thread


acastberg
  12:14 PM
replied to a thread:
:wave: hello from transfers, could I deploy a canary on staging for this build today?
@bta
 starting deploy
:ack:
1

View newer replies


bta
  12:28 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-106147
(ledger @ ee7e2d0ab2e1d6404cefa5a8ddfe8d4e79082a2d to production)

5 replies
Last reply 6 months agoView thread


bta
  12:45 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


bta
  1:14 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
:+1:
1

View newer replies


bta
  2:12 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we're out on prod
deploy checks pass


bta
  4:06 PM
deploying 9ff3251730e0e9a5eab87a4dd77e65669f742d76 (latest) to staging


chansen
  11:55 AM
Hey :wave: What payment id is associated with ledger entry ftlyx67RTYi8quizwsp3xMF  in staging?
:eyes:
1



4 replies
Last reply 6 months agoView thread


songlin
  12:15 PM
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-106241
(ledger @ 9ff3251730e0e9a5eab87a4dd77e65669f742d76 to production)
:+1:
1



5 replies
Last reply 6 months agoView thread


songlin
  12:17 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-106241…
staging checks pass
:canary: canary start
View newer replies


bjoseph
  12:23 PM
taking over ledger staging with a canary for ~30 mins

2 replies
Last reply 6 months agoView thread


mitchkamman
  12:28 PM
Hey :wave:, from Justice Eng, CivilProcessor is already using SetCivilProcessFreeze to freeze funds. I'm looking to also freeze SFS savings funds, the SFS team told me they subscribe to Ledger's FreezeFeed to do the freezing/unfreezing.
I'm wondering if SetCivilProcessFreeze results in the merchant making it onto the FreezeFeed?
:eyes:
1


1 reply
6 months agoView thread


songlin
  1:05 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-106241…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


cqin
:spiral_calendar_pad:  1:19 PM
Hi team, can I have some help on this ticket please? The money is stuck in ledger, could anyone advise me what I should do to solve this? Thank you:thank:
:eyes:
1



4 replies
Last reply 6 months agoView thread


bjoseph
  2:07 PM
replied to a thread:
taking over ledger staging with a canary for ~30 mins
taking over ledger staging with a canary again for ~30 min


songlin
  2:13 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-106241…
:shipitparrot: we're out on prod
deploy checks pass
:+1:
1



mchiesa
  4:16 PM
:waves: Hi all, to address an alert for a longstanding discrepancy between the response codes returned to clients and the values we record to service container metrics, we have recently merged a PR in the Java monorepo that affects the framework.actions.service_api.response_codes metrics of all Java services that use API Velocity (APIV). Previously, APIV endpoints that returned responses containing V2 errors to clients could record a 200 code to these metrics while the client would receive an error status (4xx or 5xx depending on the V2 code). We have modified APIV to ensure that the recorded metric value reflects the status that is returned to the client. Please note that if you have any detectors on this metric, you may need to adjust their sensitivity to account for this change. Please reach out to #api-frameworks if you have any questions or concerns about this update.


bta
  4:27 PM
deploying d734784974c5b21ae73637d69d027c3030167504 (latest) to staging


bjoseph
  10:37 AM
deploying efb5ed561c6be32e2738f40bd9b247ffc80648b1  (latest) to staging


yelson
:spiral_calendar_pad:  11:24 AM
Hi team, we noticed UK ACH bank settlement for BACS and FASTER_PAYMENTS no longer has new records in the LEDGER.RAW_FEEDS.BANK_SETTLEMENT_ENTRY table after 12/08/2022. Is this the expected behavior? PayPCP team leverage this table to assess UK settlement fee, should we use other source instead? Please redirect me if I’m in heading to the wrong direction. Thank you!
Query attached in thread.



13 replies
Last reply 6 months agoView thread


acastberg
  12:10 PM
replied to a thread:
:wave: hello from transfers, could I deploy a canary on staging for this build today?
starting canary deploy (edited) 
:ack:
1

View newer replies


acastberg
  2:43 PM
:wave: hello, I was wondering if I could get some help in understanding why this settlement containing payments from 1/6 was sent on 1/8 for this seller?
I see a much larger AU weekend transfer(A$123k) went out on 1/6 and the seller is wondering why the other batch of payments for 1/6 wasn't included in this.
:eyes:
1





36 replies
Last reply 5 months agoView thread


bta
  4:09 PM
deploying 24ed4a29720dc27604aafa156ef45c0e67c90158 (latest) to stagin
:bless:
1



bji
  9:26 AM
Not sure if this is the correct channel but I'm doing some payment testing on staging and the ledger entry here shows a type of "mca repayment" but I'm testing with a flex loan. Should the type to be mca regardless of the product?

1 reply
6 months agoView thread


andreyg
  4:02 PM
deploying 246cc204cc7 to staging
:checkmark:
1



bastien
  9:46 AM
Hi team - SP+ Accounting team is doing reconciliation and is trying to track down a few deposits. Are we able to provide any details for them to better trace these with their bank?
3ZFNNR85VFKG8YVAFHBY12E701TS
3ZHGVPTP2ZWM8YVAFHBY12E701TS
3ZM5HS2VBESM8YVAFHBY12E701TS
3ZM5HS8BBESM8YVAFHBY12E701TS
3ZMS2V3MK5CM8YVAFHBY12E701TS
Is the Trace Number show in regulator helpful for them? Do we have ARNs (I think that's what they're called) we can provide? (edited) 
:checkmark:
1



7 replies
Last reply 5 months agoView thread


andreyg
  12:11 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-106420
(ledger @ 246cc204cc7 to production)
:+1:
4



8 replies
Last reply 5 months agoView thread


andreyg
  12:41 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


andreyg
  1:35 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


andreyg
  2:42 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass


acastberg
  3:28 PM
@andreyg
 could I deploy a canary to staging?


andreyg
  3:28 PM
are you going to do some testing?


acastberg
  3:29 PM
yep


andreyg
  3:30 PM
okay, go ahead
:thankyoublob:
1



andreyg
  4:02 PM
@acastberg
 are you still testing?


5 replies
Last reply 5 months agoView thread


zandt
:spiral_calendar_pad:  4:18 PM
Hi all. I have a PR to correct an issue I discovered with a change I made a couple of weeks ago to the Esperanto payment record feed listener. Could I get some eyes on it?
Some additional context here...


ahdoot
So I think we’re fine from the UR perspective because:
URs are not force-refundable via Regulator
The only unlinked refund specific checks that exist in the sync review library are rejection checks
So that combined with Zandt’s query returning nothing makes me think we’re okay. (edited) 
From a thread in refunds-api-help | Jan 30th | View reply
:eyes:
1
:stamp3:
1


2 replies
Last reply 5 months agoView thread


andreyg
  4:47 PM
deploying db7e8796442 to staging


fishes
:spiral_calendar_pad:  9:19 AM
Hello! Could I please can an approval on this renewal request? https://registry.sqprod.co/app_dependency_requests/30515 It allows BadActors to call ledger to freeze accounts flagged on MasterCard MATCH lists, which keeps us in contractual compliance with Mastercard.
:stamp3:
1



zandt
:spiral_calendar_pad:  9:22 AM
replied to a thread:
Hi all. I have a PR to correct an issue I discovered with a change I made a couple of weeks ago to the Esperanto payment record feed listener. Could I get some eyes on it?…
Possible I could get a stamp :prayforstamp: today ? I'd like to get it fixed before it potentially becomes an issue.
:stamp3:
1

View newer replies


kendralarue
:bulb:  10:24 AM
Hello Team! I have an expected behavior question for you. If this is not the right space, please feel free to let me know. We are looking to track down expected behavior/logic for Reg. For context, this account was debited from their bank account rather than their Square Balance as I would expect. We approved a Debit Request expecting the funds to pull from the stored Square balance, but that didn't happen. Can I get an explanation as to why? There are also other account that this happened to here, here, and here.
:eyes:
1



9 replies
Last reply 5 months agoView thread


acastberg
  12:55 PM
:wave: from transfers, we would like to deploy a consumer of the BankSettlementEntryFeed to prod in deposits but are wary that it would consume the history of the feed until it is up to date.
Our listener is configured to take no action on the events it processes right now.
Would it be preferential to pause the consumer and manually update the cursors to consume from the current feed_sync_ids or can we let the consumer catch up by processing all events?
cc 
@oncall




12 replies
Last reply 5 months agoView thread


kcrane
:coolfingergun:  1:08 PM
no code changes in Ledger in the past day, skipping deploy today


zandt
:spiral_calendar_pad:  1:46 PM
cc 
@dskarbek


zandt
My change to Ledger to make use of the RefundAdapter (Standard Payment Record) is now ready for review.
https://github.com/squareup/java/pull/271798
Posted in method-platform-team | Jan 31st | View message
:eyes:
1





34 replies
Last reply 5 months agoView thread


ahwang
  2:43 PM
Hi! Would someone be able to provide read-only access to Ledger snowflake data for my team? https://registry.sqprod.co/access_requests/293621 We are investigating how to make free processing applicable to cost+ transactions and are trying to understand the behavior of cost plus (particularly what data is available in the fee entry that is published for a refund reversal, if any.) Let me know if you need more context. Thank you!


kcrane
:coolfingergun:  4:04 PM
deploying 14bcb778f5d (latest) to staging


tal
:no_entry:  9:40 AM
hello :ablobwave: we're seeing some failures in staging when trying to pull funds from Ledger for an instant transfer, can i get some :eyes: to help investigate? example trace and error in thread:
:checkmark:
1




23 replies
Last reply 5 months agoView thread


andreyg
  10:04 AM
replied to a thread:
Hey team! We’re hoping to finish rolling out RPC enforcement in Envoy SAFE. For ledger, we see that there are a couple RPC routes that are not yet defined in Envoy SAFE: https://presidio-ui.sqprod.co/search?search=application:ledger%20%22Envoy%20SAFE%20Diff%22&instance=staging&window=3d…
done, generated routes on staging
:checkmark:
1

View newer replies


pgombert
  10:56 AM
Hi all, we’ve been hitting some rate limits when calling ledger’s tender service from omnibus. It seems to happen when invocies has bursty traffic around the end of the month, although we do tend to see them pop up over time. It looks like omnibus is allotted 30QPS and I’m wondering 1. if this is new and 2. how did we arrive at this number? We’re trying to determine if we should ask for a bump in QPS, try to smooth out invocies traffic, or both. Thanks!





+2
35 replies
Last reply 4 months agoView thread


andreyg
  12:01 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-106540
(ledger @ 14bcb778f5d to production)

5 replies
Last reply 5 months agoView thread


andreyg
  12:30 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


skaltenbach
  1:21 PM
:wave: Hi team - we are moving into Stage 2 for AU and CA SPooL migration today. I’ll be migrating the following 10 merchants over to SPooL for each market
CA:
L4QR89MMWZRXF
DG09TK4BXCFXC
L4N0CA1H1X1D1
LKJPJZJHHQ08T
3C7GEN30T75MR
L5R1H00YMYTA2
LZZ7S5202WMDK
L6WP6QXTM3MYA
LQSCYDJJM15D9
LWQZJXKAFSCRG
AU:
LZ1J99R73VFVH
LMB6ZRY6HP57P
LV2Q4FMZJRC8B
LBYGNBKXRZ70N
L9VM5KDJADSNQ
LZNHDWDXNABKH
LB75H70VPFC8C
LAMSE7Z1625MK
LKYS8V00MAHCY
L7ZVZ0XRE6QJJ
cc: 
@oncall
 for viz
:ack-red:
1



4 replies
Last reply 5 months agoView thread


andreyg
  1:23 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


cberda
:spiral_calendar_pad:  2:33 PM
hello :meow-wave:, I'm working on a doc to close a risk gap for SEPA linked bank accounts. I wanted to understand what happens when the seller has some money in their SQ balance but not enough to cover the entire refund.
For example, the seller has 1000€ in their SQ balance but the refund is for 2000€.
Do we take the 1000€ from the SQ balance and attempt to debit 1000€ for their linked bank account?
or do we just attempt to debit 2000€ from their linked bank account?
cc 
@lizstark
 
@dcollins
G Suite Document
 

Close EU SEPA Gap - PRD
Google Doc


andreyg
  2:52 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass


andreyg
  4:04 PM
deploying ad24a9229f6 (latest) to staging
:checkmark:
1



zandt
:spiral_calendar_pad:  8:13 AM
Is there any reason why unlinked refunds are disabled in Ledger sandbox?
:checkmark:
1



3 replies
Last reply 5 months agoView thread


andreyg
  4:09 PM
deploying ce1e3b5759a (latest) to staging
:checkmark:
1



skaltenbach
  1:10 PM
:wave: PR here to move the ledger AU pipeline from 11:35 AET -> 12:00 AET. This this thread has all of the context


bjoseph
  4:00 PM
deploying 14af54236a6 (latest) to staging


mengen
  12:26 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-106704
(ledger @ 14af54236a64a9e83f536206beacdc8a026996d9 to production)
:+1::+1::skin-tone-2:
7





13 replies
Last reply 5 months agoView thread


irisd
:spiral_calendar_pad:  12:27 PM
was added to #ledger by mengen
. Also, brentw
 joined.


mengen
  1:31 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


mengen
  2:04 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


irisd
:spiral_calendar_pad:  2:21 PM
Hi, I'm asking for some clarification on cutoff times for SMBC, details in the thread.




8 replies
Last reply 5 months agoView thread


mengen
  3:20 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass
We have one system check status alert on AU ledger pipeline due to the change of pipeline run time. Hopefully it will auto resolve after the GFF_AUD_WEEKDAY runs today after 2 hours at new run time.


emilyl
  4:22 PM
deploying 8d12a81898d (latest) to staging


dskarbek
  4:25 PM
actually, stoping that deploy to staging and going to restart with a slightly newer one.


dskarbek
  4:33 PM
deploying 520e0281de6b741bbf60daa590a106e1101a4550 (latest) to staging


wouter
:palm_tree:  2:51 AM
hey, question: we are consuming the ledger pending-balance feed, and I was assuming that calculated_at would be an indication of when an entry on the feed was published. but that doesn’t seem to be the case, and that caused some issues in how we processed that data. looking at PendingBalanceFeedImpl, the lag is calculated based on updated_at, so I suppose that’s a better indication; but that field is not exposed in the feed. could you perhaps add that field into the PendingBalance proto so that we can use that?


5 replies
Last reply 5 months agoView thread


escates
  6:00 AM
Hey Team, this strategic seller is reporting trouble issuing refunds. For example, this transaction has a pending status in Regulator but on the Seller's dashboard it shows  6 different records of the refund being cancelled. Seller reported that when they clicked to issue the refund that they receive the "oops something went wrong" error message. Can someone take a look to 1) confirm whether the refund is pending or truly cancelled and 2) if cancelled, confirm how/why it was cancelled?
Thanks!



7 replies
Last reply 5 months agoView thread


skaltenbach
  4:12 PM
:wave: I’d like to move the Sunday run time for the CA Ledger Pipeline (it runs earlier than the Mon-Fri runs) to allow for a rollback in the case of a Payouts issue during migration. Based on a comment in Ledger, the US pipeline needs to run after the CA pipeline completes, so it needs to be moved 15 minutes later as well. The SleepUntilTransmitTransmission stage for the Sunday US run runs for ~55 minutes as transmit time is set at 20:35 - so this shouldn’t delay sending the file to the bank. PTAL when you have a moment: https://github.com/squareup/java/pull/273294
:merged-icon:
1



7 replies
Last reply 5 months agoView thread


mengen
  4:30 PM
deploying 693f065a468 (latest) to staging


sumitg
:spiral_calendar_pad:  9:07 AM
Can i get read only permissions to go/ledgeradmin  I am debugging why certain transfers do not show up in seller's bank account




27 replies
Last reply 5 months agoView thread


acastberg
  10:34 AM
:wave: looking to deploy a canary on staging today




7 replies
Last reply 5 months agoView thread


manij
  10:42 AM
hi there, is there a way to check if the update made to ledger balance(while holding/releasing reserves) is reflected in ledger balance? we(credit risk eng) team are trying to figure out a way to know if the ledger balance is up to date or not and accordingly take actions like alerting in case of any discrepancies? for more context, we use connectV2's GetBalanceSummaryInternalAuthWorkaround API for fetching the balance and ledger RiskReserveService's CreateRiskReserveHold/RiskReserveRelease APIs for holding/releasing. thanks!
cc: 
@yskhoo
:eyes:
1




6 replies
Last reply 5 months agoView thread


tal
:no_entry:  4:25 PM
hello 
@oncall
 :ablobwave: hoping you can help run this ROLL sometime tomorrow to refund IT fees for AU sellers impacted by ALERT-11469 :pray:



15 replies
Last reply 5 months agoView thread


emilyl
  4:28 PM
deploying ae585a40bb1f9789347ce76a9c96cad07b4d34d6 (latest) to staging


dkong
:lacroix:  9:01 AM
hey team, which bank account holds physical funds from UK payments processing (basically the UK version of US WELLS_PLATFORM )? is this more of a baapi question?




16 replies
Last reply 5 months agoView thread


acastberg
  2:16 PM
replied to a thread:
:wave: looking to deploy a canary on staging today
deploy canary to staging :canary-bird:
:done:
1

View newer replies


zandt
:spiral_calendar_pad:  2:34 PM
I've been looking into this for much of the day. Hopefully I might be missing something, but does anyone know where I can find this metric in datadog? I know it should be recorded since I see the corresponding log entry in presidio.
https://github.com/squareup/java/blob/c11d15e9e59a68f0076aa6759212023c4829d21b/set[…]areup/ledger/feeds/consumers/payments/PaymentRecordSkipper.java
PaymentRecordSkipper.java
    if (hasFeesWithNoRefunds(record)) {
      metrics.newCounter(FILTERED_PAYMENTS_WITH_FEES_METRIC_NAME).inc(1);
      errors.add(Errors.error("Ignoring payment with fees from the Esperanto Feed: %s",
          record.getPaymentId()));
    }
Show more
<https://github.com/squareup/java|squareup/java>squareup/java | Added by GitHub



15 replies
Last reply 5 months agoView thread


shawnsaylor
  3:17 PM
Hey team, I am looking for some assistance in understanding what happened with this account. The seller had attempted to change their linked bank account multiple times but they appeared to fail. A freeze was lifted and a debit went to the bank account ending in 330 on 2/5/23. However, the next day on 2/6/23, a deposit went to a different accounting ending in 544. Can someone explain why this had occurred?
:eyes:
1





13 replies
Last reply 5 months agoView thread


ahwang
  3:26 PM
Hi y'all, my team is working on making free processing usable for cost+ merchants later this quarter (around 3/27) and was wondering if your team could take a look at a section of our eng design Add related_entry_type to Free Processing Adjustment ledger entry. We're adding a new field to rewards' FreeProcessingAdjustment (more context in the eng design) and so would like to update the FreeProcessingAdjustment ledger entry to include the same field as well. This new field will ensure that free processing numbers in our Transactions reports don't break once we launch this project. 
@dskarbek
 I believe you worked on a very similar request from us to add a new field for Free Processing Reporting project, and that it was a pretty straightforward change :slightly_smiling_face:  Thank you!
https://docs.google.com/document/d/1g2KYac_OM-Semz3AQBXLXfwo2KGQ-hE_-YMa3HjG4rY/edit#bookmark=id.1m9jn6nqij2k



26 replies
Last reply 4 days agoView thread


tianyu
  4:39 PM
Hi, I have a question regarding Ledger’s use of Kafka Feeds.
I noticed Ledger has a super high producer connection count at fixed times of the day. The publish request rate is also pretty high and the record size is on the low end compared to other services.
The large number of connection count sometimes causes the cluster load to be in the 80%-90%. I have the following questions:
What’s Ledger’s traffic pattern like? It looks like a pretty bursty pattern. Is Ledger using some kind of cron job to publish during certain times of the day?
Is it possible to make it less bursty?
Is Ledger doing anything special with the Kafka publisher? The number of connections is really high compared to other services.
Thank you
2 files
 
Screenshot 2023-02-09 at 4.34.11 PM.png
Screenshot 2023-02-09 at 4.35.34 PM.png


2 replies
Last reply 5 months agoView thread


emilyl
  6:39 PM
deploying 03272c2d0a0 (latest) to staging


zandt
:spiral_calendar_pad:  7:01 AM
Could I get a review of this PR (using standard payment record on unlinked refund processing) ?
#273252 [ledger] Use the refund adapter in the unlinked record processor
The goal of this change is to make use of the Standard Payment Record  
(specifically the Refund Adapter) to remove payment method specific  
logic from Ledger's unlinked refund payment record processor. This should ensure  
no changes to Ledger's unlinked refund payment record processing are needed in  
order to support new payment methods.
This change is a similar effort to (4c22c04) pr #269638 and (1b4ec08) pr #271798
Labels
accounting-engineering
Comments
2
<https://github.com/squareup/java|squareup/java>squareup/java | Feb 7th | Added by GitHub



6 replies
Last reply 5 months agoView thread


tianyu
  9:56 AM
Friendly ping on this https://square.slack.com/archives/CAMN0UWMS/p1675989583282439


tianyu
Hi, I have a question regarding Ledger’s use of Kafka Feeds.
I noticed Ledger has a super high producer connection count at fixed times of the day. The publish request rate is also pretty high and the record size is on the low end compared to other services.
The large number of connection count sometimes causes the cluster load to be in the 80%-90%. I have the following questions:
What’s Ledger’s traffic pattern like? It looks like a pretty bursty pattern. Is Ledger using some kind of cron job to publish during certain times of the day?
Is it possible to make it less bursty?
Show more
2 files
 
Screenshot 2023-02-09 at 4.34.11 PM.png
Screenshot 2023-02-09 at 4.35.34 PM.png
Posted in ledger | Feb 9th | View message





+1
29 replies
Last reply 21 days agoView thread


hoyi
  11:18 AM
Taking over ledger-staging


rho
  1:13 PM
@oncall
 hi, risk infra here. We’ve had a couple instances where we’ve gotten paged for a single payment not being cleared from ledger. We usually refeed or clear it via admin console but I wanted to bring it up since it’s happened intermittently. There’s one such stale payment right now if you wanted to take a look.




39 replies
Last reply 4 months agoView thread


zandt
:spiral_calendar_pad:  10:23 AM
replied to a thread:
Could I get a review of this PR (using standard payment record on unlinked refund processing) ?
Friendly bump :smiley:
:eyes:
1

View newer replies


skaltenbach
  10:39 AM
replied to a thread:
:wave: Hi team - we are moving into Stage 2 for AU and CA SPooL migration today. I’ll be migrating the following 10 merchants over to SPooL for each market…
Everything looks good for the AU/CA migration - so I will be turning Stage 2 on again today for the same merchants above. I will update the merchant migration flags with this request
{
  "merchant_token": [
    "L4QR89MMWZRXF",
    "DG09TK4BXCFXC",
    "L4N0CA1H1X1D1",
    "LKJPJZJHHQ08T",
    "3C7GEN30T75MR",
    "L5R1H00YMYTA2",
    "LZZ7S5202WMDK",
    "L6WP6QXTM3MYA",
    "LQSCYDJJM15D9",
    "LWQZJXKAFSCRG",
    "LZ1J99R73VFVH",
    "LMB6ZRY6HP57P",
    "LV2Q4FMZJRC8B",
    "LBYGNBKXRZ70N",
    "L9VM5KDJADSNQ",
    "LZNHDWDXNABKH",
    "LB75H70VPFC8C",
    "LAMSE7Z1625MK",
    "LKYS8V00MAHCY",
    "L7ZVZ0XRE6QJJ"
  ],
  "settle_using_payouts": true
}
I have also updated the SPOOL expected daily amounts spreadsheet to have the transfer data for these merchants. cc 
@oncall
 for viz (edited) 
G Suite Spreadsheet
 

SPOOL Migration Daily Expectations
Google Sheet
View newer replies


jsilva
  12:38 PM
hey team - can we get someone assigned to this ticket: https://jira.sqprod.co/browse/ONCALL-145203
@lugo
:resolved-redirect:
1




6 replies
Last reply 5 months agoView thread


mitchkamman
  1:57 PM
Hey :wave:, from Justice Eng, CivilProcessor is already using GetBalanceTokenForUnitToken to get a balance token and then SetCivilProcessFreeze to freeze funds. I understand that this RPC results in an update being published to the FreezeFeed /1/freeze , the SFS team told me they subscribe to this FreezeFeed to do freezing/unfreezing of savings accounts. The problem is we should not be freezing savings balances, but in the future, we will. I would like to be able to control whether SFS is freezing the savings balances via this RPC.
I am wondering if we want to not publish to the freeze feed in this case, or if we will just want to add in additional data that can be used to determine behavior.
Thank you in advance!
:resolved-redirect:
1



10 replies
Last reply 5 months agoView thread


rohitdinakar
:spiral_calendar_pad:  3:31 PM
Hi from Risk Infra :wave: . We are trying to understand how ledger determines the risk evaluation staleness for a payment type BANK_TRANSACTION (ach payments). Per my understanding, bank transfer payments when initiated from esperanto have a status of ‘pending’ (Example) and once the bank clears the payment in about 3 business days, the status of that payment changes to completed. Does ledger only consume the bank transaction payments from esperanto that have a status of ‘completed’ and then start a countdown of 15 minute staleness or does it consume the payment way earlier when it is initiated and triggers the staleness check only after the state change? cc 
@zeke
:thank:
1
:checkmark:
1



4 replies
Last reply 5 months agoView thread


hoyi
  4:07 PM
Deploying latest (acdc5bbe8f2) to staging


dskarbek
  4:19 PM
@oncall
 list


9 replies
Last reply 5 months agoView thread


minghua
:bulb:  1:12 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-107035
(ledger @ acdc5bbe8f2e55e29b97266f9218d8e1ab067fcd to production)
:+1::+1::skin-tone-2:
9






+5
101 replies
Last reply 5 months agoView thread


minghua
:bulb:  1:37 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


minghua
:bulb:  2:15 PM
replied to a thread:
Ledger ROLL:…
production deploy checks fail (canary failed)
:atlassian_error: rolling back
View newer replies


minghua
:bulb:  2:30 PM
replied to a thread:
Ledger ROLL:…
:green: we’re *rolled-back* on prod
deploy checks pass
View newer replies


dskarbek
  7:48 PM
deploying latest 8d8a011115ae58be1c9157f9ebdff7fdb99d635e to staging


asilverman
  10:46 AM
was added to #ledger by lishahe
. Also, mgreenberg
 joined.


awernick
:spiral_calendar_pad:  10:55 AM
:wave: Hey team, do we have the ability to emit a test ChangeRequest in Ledger staging?
For context, we recently finished moving things around in BAAPI’s systems so that Gringotts processes Ledger NOCs  (instead of SqWeb). The new flow is currently behind a feature flag, but we’d like to do an end-to-end test in staging before we fully rollout in production.





23 replies
Last reply 5 months agoView thread


zandt
:spiral_calendar_pad:  10:56 AM
Last of the largish PR's to Ledger for removing direct dependencies to the PaymentRecord (most of the changes involve deleting code). Could I get a review? (cc 
@dskarbek
)
https://github.com/squareup/java/pull/274336
After this change, I will have much smaller and more targeted changes to cleanup the remaining PaymentRecord references.
#274336 [ledger] Use standard payment and refund adapters in PaymentRecordSkipper
On the surface, there are a lot of changes. However, most of the changes  
involve deleting code. Most of the substantial changes are in the  
PaymentRecordSkipper class.
Summary of changes:
• Deleted all of the CountryEntryMethod config classes.
   • The only usage of it was related to skipping US SaaS Card Payments, which I ported the logic to the standard payment/refund isSquareLiability field.
• Deleted the PaymentStates class
Show more
Labels
accounting-engineering
Comments
3
<https://github.com/squareup/java|squareup/java>squareup/java | Feb 14th | Added by GitHub





+3
60 replies
Last reply 5 months agoView thread


minghua
:bulb:  12:46 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-107118
(ledger @ 8d8a011115ae58be1c9157f9ebdff7fdb99d635e to production)
:+1::+1::skin-tone-2:
11






20 replies
Last reply 5 months agoView thread


minghua
:bulb:  1:16 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


zehra
:speech_balloon:  1:35 PM
Hi team! https://regulator.sqprod.co/n/users/BGW1453NRETAM?section=transfers trying to figure this out: enrolled in PP 1/19. Seller processed a payment yesterday for $180.00. $174.48 (after Square fees) showing in available balance. When looking at PP, i see that $36 has been captured. Why  did the percentage processing Adjustment result in a Transfer instead of just reducing the available balance.


minghua
:bulb:  1:50 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
:tada:
4

View newer replies


minghua
:bulb:  2:41 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass
:dance_and_wear_sunnies:
6



rose
  3:23 PM
Are there currently any controls in place to prevent freezes from being applied to a specific merchant? Use case being one of the "magic merchants" used at Square that is tied to a product (Bill Pay in this case)
:checkmark:
1



4 replies
Last reply 5 months agoView thread


hoyi
  4:04 PM
Deploying latest (1e81a6c31aa) to staging


ena
:spiral_calendar_pad:  9:27 AM
heya team! :helloblob: would I be able to test a canary on staging around 12:40pm PST? :canary-bird:
We’ll need it for an hour and a half, as we’re doing some testing on dashboard & our mobile clients (should only affect the US IT fee for onboarding sellers) :blobheart:



15 replies
Last reply 5 months agoView thread


awernick
:spiral_calendar_pad:  11:22 AM
Bump on this! I’d really like to test this out before EOW so we can start rollout early next week.


awernick
:wave: Hey team, do we have the ability to emit a test ChangeRequest in Ledger staging?
For context, we recently finished moving things around in BAAPI’s systems so that Gringotts processes Ledger NOCs  (instead of SqWeb). The new flow is currently behind a feature flag, but we’d like to do an end-to-end test in staging before we fully rollout in production.
Posted in ledger | Feb 15th | View message
:eyes:
1



hoyi
  4:01 PM
Deploying latest (48e92ed7f8c) to staging


bta
  4:20 PM
Deploying latest 213fdc338ad30dc615d738d2886545a7aaa28d3c to staging
:bless:
1



dskarbek
  6:18 PM
Deploying latest 291fc924eef409dc189dce2b60a2b99cc0342fb9 to staging  (wanted to get my latest PR on there)


zandt
:spiral_calendar_pad:  9:06 AM
replied to a thread:
Last of the largish PR's to Ledger for removing direct dependencies to the PaymentRecord (most of the changes involve deleting code). Could I get a review? (cc @dskarbek)…
I found a couple of bugs after running the change on staging over the weekend. I've addressed them along with some additional unit tests to ensure these scenarios are covered. Anyone able to take a look ? I want to make sure they are fixed before the next ledger deploy since it would cause problems with not being able to process refunds correctly.
https://github.com/squareup/java/pull/275014
#275014 [ledger] Correct bugs found while testing changes to payment record skipper PAYMP-12
There are two bugs that I found while testing changes from pr #274336.
1. The logic to skip payment records with fees containing no refunds was  
   missing a check to allow fees with refunds.
2. The new method for returning errors related to unlinked refunds was  
   always returning an empty collection, instead of the intended set of  
   errors.
Additional unit tests have been added to cover these scenarios.
Labels
accounting-engineering
Comments
1
<https://github.com/squareup/java|squareup/java>squareup/java | Feb 21st | Added by GitHub
:eyes:
1
:stamp3:
1

View newer replies


bjoseph
  12:31 PM
replied to a thread:
Last of the largish PR's to Ledger for removing direct dependencies to the PaymentRecord (most of the changes involve deleting code). Could I get a review? (cc @dskarbek)…
skipping the ledger deploy today due to a bug in refunds that should be fixed for tomorrow's deploy
View newer replies


bjoseph
  4:01 PM
deploying latest e2ff47561ec67740cbb4823c3f14c8b9a4d9079e  to staging

PayswingBot
APP  6:01 AM
Evacuating payments traffic from WEST datacenters (swinging EAST) in production has been initiated by davidsmith with message: Network maintenance -- https://jira.sqprod.co/browse/ROLL-107249


dskarbek
  9:51 AM
@oncall
 did we not deploy ledger yesterday?




5 replies
Last reply 5 months agoView thread


skaltenbach
  10:19 AM
:annouce: We will be kicking off Stage 3 of AU/CA SPooL migrations today :annouce:
The UpdateMerchantMigrationFlagRequests will include the first 1000 merchants (rows 5-1005) in stage 3 for the markets in this spreadsheet  (edited) 

4 replies
Last reply 4 months agoView thread

PayswingBot
APP  12:05 PM
Restoring normal payments traffic (unswinging) in production has been initiated by albertdam with message: Network maintenance completed (rolled back) -- https://jira.sqprod.co/browse/ROLL-107249


skaltenbach
  1:13 PM
Hey 
@oncall
 - I’m trying to use the GenerateReturnFile RPC in ledger and it wants a bank_settlement_entry_tokens_to_change …what is this?




16 replies
Last reply 3 months agoView thread


songlin
  4:01 PM
deploying 5bc99e91180d44cf9fd1f42c660db141061f8f53 to staging
:bless:
1


PayswingBot
APP  8:09 AM
Evacuating payments traffic from WEST datacenters (swinging EAST) in production has been initiated by albertdam with message: Network maintenance -- https://jira.sqprod.co/browse/ROLL-107249


ena
:spiral_calendar_pad:  9:46 AM
hey team! can we borrow staging for a canary test at 12:40pm PST today? :pray::skin-tone-2: we should only need it for about an hour! :tybig:




17 replies
Last reply 5 months agoView thread


skaltenbach
  10:11 AM
replied to a thread:
:annouce: We will be kicking off Stage 3 of AU/CA SPooL migrations today :annouce:…
Both CA and AU runs were successful without issue yesterday, so we will be migrating the next 1000 merchants per market for today’s runs (rows 1006-2005 in the spreadsheet above)
:clap-clap:
3

View newer replies

PayswingBot
APP  12:10 PM
Restoring normal payments traffic (unswinging) in production has been initiated by davidsmith with message: General stability concerns in IAD


songlin
  12:20 PM
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-107418
(ledger @ 5bc99e91180d44cf9fd1f42c660db141061f8f53 to production)
:+1::+1::skin-tone-2:
9
:stamp3:
1






12 replies
Last reply 5 months agoView thread


songlin
  12:35 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-107418…
staging checks pass
:canary: canary start
View newer replies

PayswingBot
APP  12:42 PM
Evacuating payments traffic from EAST datacenters (swinging WEST) in production has been initiated by davidsmith with message: Stability concerns in IAD
:ack:
1



brentw
:spiral_calendar_pad:  1:16 PM
@oncall
 Can you take a look at a PR that affects settlements when you get the chance?
:done:
1





5 replies
Last reply 5 months agoView thread


songlin
  1:21 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-107418…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


songlin
  2:37 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-107418…
:shipitparrot: we're out on prod
deploy checks pass

PayswingBot
APP  2:56 PM
Restoring normal payments traffic (unswinging) in production has been initiated by davidsmith with message: #pay-incident-265 resolved

PayswingBot
APP  3:01 PM
Evacuating payments traffic from WEST datacenters (swinging EAST) in production has been initiated by davidsmith with message: Complete interrupted network maintenance -- https://jira.sqprod.co/browse/ROLL-107249
:ack:
1


PayswingBot
APP  3:39 PM
Restoring normal payments traffic (unswinging) in production has been initiated by aedwards with message: trying to fix SEV

1 reply
5 months agoView thread


songlin
  3:58 PM
deploying 16d9a2e28343e5db4c477f23d93c3bf4850c4b33 to staging
:bless:
1



fasih
  4:30 PM
@oncall
 :wave: was there a deploy today that changed the refund_policy  enum proto? We, PDA, got another ledger entry where one file had
{
   "type":"enum",
   "name":"RefundPolicy",
   "symbols":[
      "DEFAULT_REFUND_POLICY_DO_NOT_USE",
      "FEES_REFUNDABLE",
      "FEES_NON_REFUNDABLE"
   ]
}
and others that had
{
   "type":"enum",
   "name":"RefundPolicy",
   "symbols":[
      "DEFAULT_REFUND_POLICY_DO_NOT_USE",
      "PROPORTIONAL_REFUND",
      "NO_FEES_REFUND"
   ]
}



16 replies
Last reply 5 months agoView thread


mgp
:baby:  3:22 PM
@oncall
 deploying a canary to Ledger staging

1 reply
5 months agoView thread


bjoseph
  4:04 PM
deploying latest f021ad53eb800af0c45cc579e78ff21d480a464f to staging


zandt
:spiral_calendar_pad:  4:47 PM
replied to a thread:
Last of the largish PR's to Ledger for removing direct dependencies to the PaymentRecord (most of the changes involve deleting code). Could I get a review? (cc @dskarbek)…
An update to this. I have a change (pr) to Ledger that should resolve this issue by ignoring payments that are not a Square liability during risk state evaluation processing. Originally, I was thinking these SaaS payments should be skipped entirely by Risk. They kind of are, but processed with an 'all clear' risk assessment. This is different than ignoring the payments completely as is the case of payments that do not move money (some discussion here).
I plan to do some testing of my change Monday with a Staging canary.


zandt
Hi all. Question about risk checks for internal Square merchants (specifically SaaS US). I see that riskarbiter has 7TV3AV0NCZ16X (Square Paid Svcs) listed under square_unit_tokens.
From the logic in PaymentRecordRiskFilter, I can see it is checked in the shouldPublishDummyScoredPayments method, but not in the shouldEvaluateRisk method.
What would be the reason why this internal merchant is not excluded from all risk checks?
Show more
Thread in risk-infrastructure | Feb 23rd | View message
#275716 [ledger] Ensure risk evaluations are ignored for payments that do not impact the seller balance PAYMP-14 PAYMP-12
There are payments that are intentionally skipped by Ledger since  
they are not a Square liability. However, risk may still evaluate them  
with an 'all clear' risk assessment. During processing of the risk  
evaluation feed, payments that are not a liability should be ignored  
so they do not fall into the holding area.
There are two main changes with this PR:
• Direct dependencies to the Esperanto Payment Record for checking old  
Show more
Labels
accounting-engineering
Comments
1
<https://github.com/squareup/java|squareup/java>squareup/java | Feb 24th | Added by GitHub
View newer replies


zandt
:spiral_calendar_pad:  8:30 AM
replied to a thread:
Last of the largish PR's to Ledger for removing direct dependencies to the PaymentRecord (most of the changes involve deleting code). Could I get a review? (cc @dskarbek)…
Could I get this canary build deployed to staging?
https://kochiku.sqprod.co/squareup/java/builds/6670992
View newer replies


andreyg
  9:26 AM
taking over staging for ~1hr for testing

1 reply
5 months agoView thread


skaltenbach
  9:44 AM
replied to a thread:
:annouce: We will be kicking off Stage 3 of AU/CA SPooL migrations today :annouce:…
Everything looks good - we will migrate another 2000 merchants per market today. (rows 2006 - 4005 in the spreadsheet).
:done:
1

View newer replies


andreyg
  10:07 AM
replied to a thread:
taking over staging for ~1hr for testing
done, rolling back to f021ad53eb8


alafranchise
  11:18 AM
@oncall
 I'm going to start a backfill for bank account state (part of our BAOS migration) at 1PM PST. You may see elevated numbers of link/unlink events. We are going to start slowly and dial up the backfill batch size as we go. See ROLL for details:
https://jira.sqprod.co/browse/ROLL-107371
:ack-red:
1


1 reply
5 months agoView thread


hoyi
  12:54 PM
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-107571
(ledger @ f021ad53eb8 to production)
:+1::+1::skin-tone-2:
5




6 replies
Last reply 4 months agoView thread


hoyi
  1:18 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-107571…
staging checks pass
:canary: canary start
View newer replies


hoyi
  1:57 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-107571…
canary deploy checks pass
:rolling_kirby: rolling forward


mengen
  2:28 PM
Deploying latest 4e08568ecd25577b8dc73c59c56a85193e7e6742 to Ledger staging


hoyi
  4:04 PM
Deploying latest (d3dcc0a4d79) to staging


zandt
:spiral_calendar_pad:  11:20 AM
https://github.com/squareup/java/pull/276008
#276008 [ledger] Refactor RefundPaymentRecordProcessor to use the feeRefundPolicy field on the refund adapter PAYMP-14
This change simplifies the lookup of the new fee refund policy field to  
pull it from the refund adapter instead of the raw Esperanto payment  
record.
Labels
accounting-engineering
Comments
3
<https://github.com/squareup/java|squareup/java>squareup/java | Feb 28th | Added by GitHub


zandt
:spiral_calendar_pad:  11:36 AM
Does anyone know what's going on with this test? it seems flaky today and it just failed on the master build.
AccountingQueueSqsIntegrationTest.testStopProcessingWithFeatureFlag


dskarbek
  11:41 AM
Yeah, it is flaky
:ack:
1



5 replies
Last reply 4 months agoView thread


kyeboah
  12:35 PM
Hi team :wave:, I have a question regarding the bai_transaction_detail feed data that the ledger app consumes from labrador.
The feed contains data that could be considered sensitive (customer_reference_number and bank_reference_number). Is the data that ledger app consumes considered sensitive (PII) and is it needed in the un-redacted form?
PS: If this is not the right channel, please let me know :thankyoublob: (edited) 
:eyes:
1



13 replies
Last reply 4 months agoView thread


jarlan
  12:54 PM
Hello, wondering if someone can help explain the different balances Ledger might look at to move money around. Really if there’s a doc that you could point me to, that would be best. An example for context is here, but basically it seems like sometimes a money movement occurs (overwhelmingly an Adjustment for my use case) but then operates in a way that we aren’t expecting.
ex: a Debit Adjustment results in an outbound debit, even though the adjustment amount was for less than the unit’s current processing balance. So far I’ve ruled out custom transfer schedules being in play, but not even sure what else I should be looking out for.
:checkmark:
1



5 replies
Last reply 4 months agoView thread


hoyi
  1:13 PM
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-107643
(ledger @ d3dcc0a4d79 to production)
:+1:
3



4 replies
Last reply 4 months agoView thread


hoyi
  1:20 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-107643…
staging checks pass
:canary: canary start
View newer replies


hoyi
  1:42 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-107643…
canary deploy checks pass
:rolling_kirby: rolling forward


jthomas
  2:42 PM
Hi! Related to http://go/settlementschedule where are POS cutoff times defined? Is there a yaml file that defines those?


2 replies
Last reply 4 months agoView thread


hoyi
  4:04 PM
Deploying latest (e27d9a65688) to staging


skaltenbach
  10:03 AM
replied to a thread:
:annouce: We will be kicking off Stage 3 of AU/CA SPooL migrations today :annouce:…
Today we will be migrating all remaining stage 3 AU merchants (~900 merhants rows 4006 to the end) and 4000 more CA merchants (rows 4006 to 8005). This will complete stage 3 migrations for AU,  CA will be completed on Thursday.
:yay:
1
:celeryman3:
1

View newer replies


kataria
  12:06 PM
Hi team, we are investigating an ONCALL ticket, the ledger balance was 0 and hence no sweep was made to SFS by moneysweeper (log trace).
We found 13 payments out of 31 which seller made that day which had this issue, but we did not find any refunds on that day (from Regulator). Can you please help tell why the ledger  balance was 0 for this unit for these 13 payments on 02/22?
Note: We have logs for few more days before we loose logs to investigate. CC: 
@abhishekg
  
@muftiat





7 replies
Last reply 4 months agoView thread


muftiat
  12:12 PM
was added to #ledger by kataria
.


palak
  12:24 PM
hello! what time does ledger.raw_feeds.freeze update everyday? i am looking for a data source in snowflake which has accounts marked as frozen or deactivated. eg:
select * from ledger.raw_feeds.freeze 
where merchanttoken='MLB8P9R2SQAN2'
this merchant is marked frozen and deactivated around yesterday evening but not showing up in the table. is there any other data source that would have this info? i'm trying to find a source that does not have a latency issue and has data in (1) real time or (2) has atleast all the frozen/deactivated info from the day before available early in the morning.  cc: 
@jackscoglio
 
@shasta
 (edited) 
:eyes:
1



32 replies
Last reply 4 months agoView thread


hoyi
  12:49 PM
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-107720
(ledger @ e27d9a65688 to production)



5 replies
Last reply 4 months agoView thread


hoyi
  1:09 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-107720…
staging checks pass
:canary: canary start
View newer replies


hoyi
  2:02 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-107720…
canary deploy checks pass
:rolling_kirby: rolling forward


zandt
:spiral_calendar_pad:  3:44 PM
Could I get a review :prayforstamp: of https://github.com/squareup/java/pull/276008 ? Pretty small change to get the fee refund policy from the standard payment record.
#276008 [ledger] Refactor RefundPaymentRecordProcessor to use the feeRefundPolicy field on the refund adapter PAYMP-14
This change simplifies the lookup of the new fee refund policy field to  
pull it from the refund adapter instead of the raw Esperanto payment  
record.
Labels
accounting-engineering
Comments
3
<https://github.com/squareup/java|squareup/java>squareup/java | Feb 28th | Added by GitHub


bta
  4:27 PM
deploying latest 43c36d682e3289755d9448050e6534fdd8fcbf43 to staging


briannab
  8:21 AM
Hello! I was wondering if we may be able to see what team is debiting the merchant ? I am trying to figure it out so I can escalate to the right team to followup with the seller! Thank you for your help!



12 replies
Last reply 4 months agoView thread


zandt
:spiral_calendar_pad:  8:51 AM
Question. Why does Ledger consider a payment "old" up to 3 years and not 1 year? Just wondering if there are known scenarios where Ledger needs to be able to handle a payment older than 1 year.
OldPaymentChecker.java
  // The threshold for an old payment is any payment older than 3 years old from the current date.
  // This should be sufficient for the purposes of feed consumption where our feed consumers
  // should not expect to consume data from more than 3 years ago.
  @VisibleForTesting static final Duration OLD_PAYMENT_THRESHOLD = Duration.standardDays(365L * 3L);
<https://github.com/squareup/java|squareup/java>squareup/java | Added by GitHub



17 replies
Last reply 4 months agoView thread


skaltenbach
  11:56 AM
replied to a thread:
:annouce: We will be kicking off Stage 3 of AU/CA SPooL migrations today :annouce:…
Migrating the remaining ~2500 merchants for CA to complete Stage 3 migrations (rows 8006 to the end in the spreadsheet)


hoyi
  12:04 PM
Deploying 27d00e95ccd to staging


bta
  12:50 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-107783
(ledger @ 27d00e95ccd10d0cfb96448d8933dba0b71d9907 to production)
:+1:
6






+1
16 replies
Last reply 4 months agoView thread


zandt
:spiral_calendar_pad:  1:07 PM
Could I get a review of https://github.com/squareup/java/pull/276455 ? (fairly small... drops some unused direct payment record references from the refund payment record processor)
#276455 [ledger] Remove remaining direct payment record references from the RefundPaymentRecordProcessor PAYMP-14
I've removed the remaining direct payment record references from the  
RefundPaymentRecordProcessor, along with marking the  
target_platform_account_token field as deprecated on the RefundEvent  
proto. This is a field associated with the market places  
project that never got off the ground.
Related to pr #271798.
Labels
accounting-engineering
Comments
3
<https://github.com/squareup/java|squareup/java>squareup/java | Mar 2nd | Added by GitHub


bta
  1:24 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


bta
  1:52 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


kataria
  1:55 PM
Hi team, 
@oncall
 - can you help look in to this oncall issue? It has been escalated by our compliance due to a BBR complaint. Notes doc
CC: 
@haoyang
 
@abhishekg
 
@tugce
:eyes:
1






29 replies
Last reply 4 months agoView thread


andreyg
  4:09 PM
deploying latest 8a12bf09de532d97e87a72b6b6895d9eb2444d98 to staging


emilyl
  5:55 PM
:alert-fyi: Ledger’s risk feed has been paused in production (edited) 


5 replies
Last reply 4 months agoView thread


emilyl
  9:17 PM
replied to a thread:
:alert-fyi: Ledger’s risk feed has been paused in production
Risk feed has been resumed. There are still some entries waiting to be retried in the holding area but are catching up


jengel
:spiral_calendar_pad:  8:40 AM
Hey Team, How does the SUSPECTED reason in the MerchantSettlementState get set?

1 reply
4 months agoView thread


bta
  4:10 PM
deploying latest 7fd286d3da1d947d2e2c673714ca9a86fe6bb5ce to staging


skaltenbach
  9:29 AM
:annouce: Today we will be starting Stage 4 of the AU/CA SPooL Migration Plan :annouce:
For part 1 of Stage 4 we will migrate 4 high volume sellers in each market. We’ll keep just these 8 stage 4 merchants migrated for at least 3 nights of settlement before migrating the rest of the stage 4 merchants in the spreadsheet
For CA:
1F6SWMJRCNCPW
8EKD18AJYSZ5E
BTANESZMYCDK5
8KW4ZVTHHTBGN
For AU:
81FDXHVKQPYW6
L4AGM3JHA1QGD
LYY5EYTV01WTW
5FDBME2ATZWHR
(edited)
:+1:
1
:tada:
1


3 replies
Last reply 4 months agoView thread


bta
  12:31 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-107913
(ledger @ 7fd286d3da1d947d2e2c673714ca9a86fe6bb5ce to production)
:+1:
3



5 replies
Last reply 4 months agoView thread


jpulgarin
  12:32 PM
was added to #ledger by bta
.


bta
  1:03 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


bta
  1:32 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


bta
  2:30 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we're out on prod
deploy checks pass


bta
  6:49 PM
deploying latest 5c5ca7e3c8ed33e5360df239b5527bf8b687b994 to staging


pfinnegan
:palm_tree:  7:01 PM
The Merchant has reported that every month we are debiting from their account £10.89 and then we refund it. She has provided bank statements in the case showing this. I filed a JIRA and they advised the following "The sale bill and the return bill look uncomplicated. The refund succeeded on the first attempt. Any error that is occurring is occurring within the payments stack. Please reassign to the settlements team."

2 replies
Last reply 4 months agoView thread


skaltenbach
  12:14 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-107984
(ledger @ 5c5ca7e3c8ed33e5360df239b5527bf8b687b994 to production)
:+1:
1



8 replies
Last reply 4 months agoView thread


skaltenbach
  12:38 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


mgreenberg
  1:05 PM
replied to a thread:
Hi all, we’ve been hitting some rate limits when calling ledger’s tender service from omnibus. It seems to happen when invocies has bursty traffic around the end of the month, although we do tend to see them pop up over time. It looks like omnibus is allotted 30QPS and I’m wondering 1. if this is new and 2. how did we arrive at this number? We’re trying to determine if we should ask for a bump in QPS, try to smooth out invocies traffic, or both. Thanks!
@oncall
 — can we get engagement on this thread. it’s been a week without a response despite multiple pings. thanks
:eyes:
1

View newer replies


skaltenbach
  1:21 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


skaltenbach
  2:48 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass


skaltenbach
  4:08 PM
deploying e32532ea9ca9158a1fc2af084cc9bf3fd673f528 to staging


cschram
  2:10 PM
Hi team, I am hoping to find out more information about an interac debit :canada: refund and where the balance is drawn from for returns. Basically seller had a refund on interac debit and wasn't able to process it. As per JIRA, they didn't have enough of a balance to process the refund. But based on my rough calculations (looking at transaction reporting), they should have had more than enough to cover the $330 refund. Refund attempted at these unit tokens: LSCAPRX7PFJDB and LZTK732W4289S. Any insights would be appreciated :pray-all:


9 replies
Last reply 4 months agoView thread


jschaeffer
:ooo_1:  3:29 PM
Hi team, working with an enterprise seller who is trying to locate which account the below deposits came from. Not sure this is the correct channel but hoping someone might be able to point me in the right direction. The bank account they were deposited to ends in *468
$973.80 	3ZFZ42CRWBWM8YV4Q2BY12E701TD
$1,124.95 	3ZFZ42CRWBWM8YV4Q2BY12E701TD
$1,507.35 	3ZFZ42CRWBWM8YV4Q2BY12E701TD
$607.40 	3ZFZ42CRWBWM8YV4Q2BY12E701TD
$1,296.25 	3ZFZ42CRWBWM8YV4Q2BY12E701TD
$176.90 	3ZFZ42CRWBWM8YV4Q2BY12E701TD




13 replies
Last reply 4 months agoView thread


aackerman
  7:15 AM
Hi Ledger team, I wanted to ask a question about the stale risk payment metrics emitted by ledger in :thread:



6 replies
Last reply 4 months agoView thread


skaltenbach
  11:03 AM
replied to a thread:
:annouce: Today we will be starting Stage 4 of the AU/CA SPooL Migration Plan :annouce:…
:annouce:  I am migrating the rest of the stage 4 merchants in the spreadsheet above for AU and CA to SPooL (~2000 merchants per market) :annouce:
:done:
1

View newer replies


bjoseph
  12:23 PM
deploying 7d619a79e70a5bbe628e06dc5f6df376eb1de627  (latest) to staging


skaltenbach
  4:10 PM
deploying 595aa28ceb181197dba81fdad961d507ecd69acf(latest) to staging


tmahoney
  6:30 PM
:wave: just curious, what’s up with this staging payment? the refund got wedged in refundsarbiter — RA’s first processing step (creating a refund ledger entry) succeeded, but then when RA tries to look up that same ledger token again later, we can’t find it.
it looks like Ledger’s MessageQueueAccountingQueueProcessor gets java.lang.IllegalStateException: No book entries with positive amounts are set in GrossFeeRefundJournalEntryTemplate$Builder.build: link
it’s not a huge deal that a refund got stuck in staging, and clearly there was some experimenting going on with this staging refund (all good, that’s what staging is for…), but I wonder if the failure mode here in ledger could be improved? from our POV, it’s weird that CreateRefundLedgerEntry returned a success response + ledger entry token, but then we couldn’t look up that same token later.



9 replies
Last reply 4 months agoView thread


bwester
:officepig:  12:50 PM
hi team, random question: I noticed that all of the FreezeService methods are listed in ledger's route permissions except for SetActivationFreeze. could I request that the route to that RPC method be added too?  thanks!
:eyes:
1





9 replies
Last reply 4 months agoView thread


fpereira
  2:14 PM
Hi all, not sure this is the right channel, but is there a way to query in Snowflake, for a group of user tokens, who they are sending their balances to?
For instance, trying to identify whether funds are being sent to a another seller/company or a specific bank. (edited) 

PayswingBot
APP  2:24 PM
Evacuating payments traffic from WEST datacenters (swinging EAST) in production has been initiated by bmazanec with message: Swinging East for #pay-incident-272

PayswingBot
APP  3:48 PM
Restoring normal payments traffic (unswinging) in production has been initiated by bmazanec with message: Returning to normal as pay-incident-272 stabilizes


mchiesa
  7:46 AM
Hello :wave:  I'm reaching out about the ledger service(s) which use(s) API Velocity and Envoy Logging.  As a follow-up for a recent SEV (see ALERT-11256) we created additional monitors to help detect dropped logs for your app.  Fortunately we’ve done all of the heavy lifting for you, and all your team has to do is add the monitors to your app.  We strongly recommend that you add these monitors to detect and prevent any data loss to ES2, Datadog, and CDP (powers the API Log Inspector).
Additionally we would like API owners to set up monitors tracking their Envoy Sidecar CPU usage.  This will further improve the stability of Envoy Logging
Action Items
Open this Jira epic, find the ticket with your app's name, assign it to a point of contact from your team, and follow the instructions in the ticket.  If you choose to create a separate ticket to track this work in your own Jira project/board please link it to the ticket we created.  Please mark the ticket IN PROGRESS when you start working on it and RESOLVED when you finish.  We strongly recommend completing this task within the next 4 weeks to protect us from potential data loss.  See more details in this setup guide
If you have any questions or concerns, please reach out to us on #api-frameworks


skaltenbach
  9:58 AM
replied to a thread:
:annouce: Today we will be starting Stage 4 of the AU/CA SPooL Migration Plan :annouce:…
Stage 4 is complete for both AU and CA. We will begin stage 5 for AU today by flipping the market migration state to MIGRATED. Per BCONs request, we will wait until tomorrow to set CA to MIGRATED to make sure the teller pipeline handles the 100% AU traffic fine first.
View newer replies


jquindica
  10:27 AM
Not sure if this is the right channel for this, but we're trying to understand why a seller's bank account was unlinked. This seller is a Term Loans borrower, and they have 3 non-consecutive failed payments towards their loan. Assuming this is the right channel, could one of y'all please take a look at this seller?
:checkmark:
1





13 replies
Last reply 4 months agoView thread


aackerman
  12:02 PM
Hi team, in staging we've had about 6k stale risk payments for the last 2 months or so, I spot checked and see most of these are actually from 2022 :sweat_smile: I am going to try clearing them out by turning on the clear_existing_unscored_payments flag in staging and wanted to give a heads up here
:ack:
1



kcrane
:coolfingergun:  1:19 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-108296
(ledger @ dcfb698df4 to production)
:+1::+1::skin-tone-2:
6



5 replies
Last reply 4 months agoView thread


kcrane
:coolfingergun:  1:26 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:chocobo-face: canary start
View newer replies


kcrane
:coolfingergun:  1:55 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


minghua
:bulb:  2:48 PM
Looking into removing webBankAccountsFeed configs <- PR
Cross-posted this in BAAPI channel too. I think we’re ok removing this, but could use a sanity check (edited) 
:merge:
1



kcrane
:coolfingergun:  3:17 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we're out on prod
deploy checks pass
:thank:
1



emilyl
  4:08 PM
deploying 140b96e2372 (latest) to staging


rishika
:goldengate:  4:59 PM
Hey :wave:, I am testing a new rpc in staging which adds (SEPA) payment record. It has triggered an alert and could potentially block ledger esperanto payment feed. Please let me know if there are process on my end to make sure existing pipelines stay functional.
https://square.slack.com/archives/C025LAF94DB/p1678751335592839 (edited) 


zandt
I think these are related to the async payments (SEPA) ?
rbp1Pp6Gzp8j9Z4B2dWPbgU5vaB
    "payment_type": "ASYNC_TRANSACTION",
Thread in alt-payment-methods-help | Mar 13th | View message



30 replies
Last reply 4 months agoView thread


emilyl
  6:59 PM
replied to a thread:
Hey :wave:, I am testing a new rpc in staging which adds (SEPA) payment record. It has triggered an alert and could potentially block ledger esperanto payment feed. Please let me know if there are process on my end to make sure existing pipelines stay functional.…
:fyii: ledger staging is not consuming esperanto so we will be behind in staging until we merge a fix tomorrow
View newer replies


skaltenbach
  9:34 AM
replied to a thread:
:annouce: Today we will be starting Stage 4 of the AU/CA SPooL Migration Plan :annouce:…
Everything went well yesterday for AU :+1: Today we will set CA to MIGRATED to move 100% of CA merchants to the Payouts workflow.
:do_it:
1
:fingers_crossed:
1



emilyl
  9:55 AM
deploying f374ab52873 (latest) to staging

1 reply
4 months agoView thread


cuong
:spiral_calendar_pad:  10:08 AM
Hi team, let me know if I post this in a wrong channel. I have a user that is unable to deactivate Square account. I am from seller profile team and by looking at our code I am guessing that this is happening because there is still pending balance. How can I confirm if that is the cause? Is there a way to tell the pending balance of user?


19 replies
Last reply 3 months agoView thread


bforehand
  10:15 AM
Hello Ledger friends, I noticed in teller that we had a secret called teller-database.yaml which appears to have contained a randomly generated password for accessing the database; however, I talked with #ods and they confirmed that they do not use any such mechanism for accessing the database. The secret in question for Teller was from 2014. I can see that ledger has a similar ledger-database.yaml secret from the Square Console. Today, I have removed the teller-database.yaml secret in staging with no impact. Tomorrow, I will be removing this secret from production as well. I suspect this secret is not useful to Ledger either, and you may also want to clean it up cc: 
@oncall
:niceee:
1




4 replies
Last reply 4 months agoView thread


emilyl
  10:43 AM
replied to a thread:
deploying f374ab52873 (latest) to staging
:fyii: ledger staging has resumed processing the esperanto feed
:blob-tada-gif:
3



bhargava
  12:27 PM
tiny PR to remove outdated config in Ledger: https://github.com/squareup/java/pull/278145 (edited) 
:stamp:
1


PayswingBot
APP  3:13 PM
Evacuating payments traffic from WEST datacenters (swinging EAST) in production has been initiated by ejamison with message: esperanto sjc2b appears to be down


kcrane
:coolfingergun:  3:17 PM
@dskarbek
 probably no action required but heads up ^

PayswingBot
APP  3:21 PM
Restoring normal payments traffic (unswinging) in production has been initiated by ejamison with message: esperanto db has recovered


emilyl
  4:21 PM
deploying e41aba436fd (latest) to staging


bright
:spiral_calendar_pad:  4:36 PM
Hi team, we’ve received a complaint from a merchant mentioning a payment hold that was attempted to be released several times not getting released. Can I get some help investigating into this issue?
More details - JRIA ticket
unit token: 8NHNJS70M9HRC
payment token: xmdFFgkox93uIGppTTrb6q1unGWZY
hold token: i3hAmxJNQQ6_R54pob2eYg
Presidio query: diagnostic_context.com.squareup.logging.SpeleoTraceId:BGGBFJQPBWGbj application:ledger
https://rqm.iad1.sqprod.co/index/payment#/query/payment/xmdFFgkox93uIGppTTrb6q1unGWZY
I manually tried to release the hold via Regulator, but that did not work. From the RQM page, I do see there are attempted ledger entries. (edited) 



9 replies
Last reply 4 months agoView thread


cjustice
:ooo_1:  11:30 AM
Hey folks - I'm looking at our dashboards for rolodexdiscovery and noticed ledger deploys are now showing up as events on our charts. Did your events get added to everyone's consumed feeds dashboards? Or did we setup our saved charts incorrectly?


4 replies
Last reply 4 months agoView thread


lishahe
:spiral_calendar_pad:  2:23 PM
@oncall
 we got paged on a refund request for this payment. The feeplan rate id passed from this request is invalid. The following id is on refund policy, not on feeplan rate. Wonder how this refund is created with corrupt data?
feeplanId=Optional[DEFAULT_ZERO_FEE_OVERRIDE]}
:eyes:
1





13 replies
Last reply 4 months agoView thread


zandt
:spiral_calendar_pad:  3:14 PM
Hey all. I have a few pr's that I could use a review on related to payment record cleanup:
https://github.com/squareup/java/pull/278448
https://github.com/squareup/java/pull/278315
https://github.com/squareup/java/pull/278304
https://github.com/squareup/java/pull/276209



24 replies
Last reply 4 months agoView thread


njain
  3:40 PM
Hey 
@oncall
, we are receiving a bunch of 503s from production.ledger.gns.square in Capital. Is the something going on with the service?



11 replies
Last reply 4 months agoView thread


emilyl
  4:14 PM
deploying 8daa52ac2cb (latest) to staging


cpopescu
:spiral_calendar_pad:  11:08 AM
If a Cost+ seller terminates their contract with Square mid-month, and they have some Cost+ fee adjustments that have not posted yet, but will post on the 10th of the next month, what is the current process? Will the seller still pay the cost plus fee adjustments when they post via a settlement debit on the 10th? Or is their bank account unlinked when they terminate their contract with Square? cc 
@mgp
 (edited) 





8 replies
Last reply 4 months agoView thread


mmargenot
:no_entry:  11:26 AM
hi folks, seems like the watermark for ledger.LEDGER__LEDGER_PRODUCTION.pending_balance_snapshots didn't update, delaying app_risk.app_risk.chargebacks by way of a DWSSensor. are there any known issues? sounds like there might be something up with Shinkansen per discussion in sqwave here
cc: 
@klachance


3 replies
Last reply 4 months agoView thread


raul
:spiral_calendar_pad:  12:54 PM
Hey all! Looking to add an additional field to the FreezeFeedEntry for ledger. Currently, corporate card is introducing merchant level signals (MASTER_MERCHANT) in risk arbiter. We are aware that the merchant_token field for this input refers to the unit token and we would want to add the actual merchant token to this entry so that we can group certain signals. Is this something we could self-serve? Thank you in advance! :frogparty: (edited) 


6 replies
Last reply 4 months agoView thread


wstewart
  1:07 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-108504
(ledger @ 8daa52ac2cb6b6ad5d6349cdf4a206c8541a1f9b to production)
:+1::+1::skin-tone-2::+1::skin-tone-4:
5


3 replies
Last reply 4 months agoView thread


wstewart
  1:35 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
:chocobo-face:
2

View newer replies


wstewart
  2:42 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we're out on prod
deploy checks pass
:shipitparrot:
3



kcrane
:coolfingergun:  4:14 PM
deploying 0a2e60540ab (latest) to staging


njain
  6:30 PM
Hey ledger team, 
@cmendenhall
’s team runs a daily report that reads SettledLedgerEntry table up until 22:00GMT and sends a payment report to the sellers. As per this settlement chart UK has a 4 PM GMT cutoff for ledger settlement.  So does this mean that for UK sellers any payment after 4pm GMT won't be settled until the next day, and not be included in this report? cc: 
@kyoung




6 replies
Last reply 2 months agoView thread


kyoung
  6:30 PM
was added to #ledger by njain
.


njain
  2:33 PM
Hey 
@oncall
, Ops team had posted a loan repayment of $510.99 for this customer. The account was frozen and a debit lock was in place when this repayment was posted and I see that the ledger entry for this repayment has not been settled. What would happen when the freeze and debit lock are lifted? Would ledger debit this amount from the customer's bank account? cc: 
@quon
 
@npadilla





+1
25 replies
Last reply 4 months agoView thread


awernick
:spiral_calendar_pad:  9:59 AM
Flipping baos/ledger_use_bank_account_version_in_bank_account_feed_listenerto true in staging
cc 
@jtan
:ack:
1



mnovich
  12:59 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-108619
(ledger @ 8bf3b27f1318d09f0c08e13df043a969d7023d01 to production) (edited) 
:+1::+1::skin-tone-2:
8



7 replies
Last reply 4 months agoView thread


mnovich
  1:19 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


mnovich
  1:53 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


mnovich
  2:50 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass


mnovich
  4:00 PM
deploying d0b90e7cf420671dffe5c46b6d6c8afeda2fa4ac (latest) to staging
:bless:
2



awernick
:spiral_calendar_pad:  8:01 AM
@oncall
 list



12 replies
Last reply 4 months agoView thread


mnovich
  9:31 AM
So we just had an interesting blip in ledger. The transfers api was timing out and I looked at the ledger dash. It looks scary
https://square.datadoghq.com/dashboard/s6t-r83-8wz?from_ts=1679414424232&to_ts=1679416224232&live=true





6 replies
Last reply 4 months agoView thread


mnovich
  9:45 AM
@mengen
 there’s a stuck entry in holding area
https://apa1194--ledger.sqprod.co/_admin#tab:holdingarea
I couldn’t find any runbook entry for it, so not sure which team should handle this
image.png
 
image.png
:eyes:
1




11 replies
Last reply 3 months agoView thread


awernick
:spiral_calendar_pad:  9:48 AM
Flipping baos/ledger_use_bank_account_version_in_bank_account_feed_listenerto true in production
cc 
@jtan

1 reply
4 months agoView thread


mnovich
  12:03 PM
So there is one host dead in ledger staging and I am running the pre prod health checks
https://square-console.sqprod.co/app/ledger/deploy/p2
I need help understanding the reason. 
@mengen




14 replies
Last reply 4 months agoView thread


mnovich
  1:16 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-108706
(ledger @ d0b90e7cf420671dffe5c46b6d6c8afeda2fa4ac to production)
:+1:
2
:stamp3:
1



7 replies
Last reply 4 months agoView thread


alexanderl
  1:19 PM
was added to #ledger by mnovich
.


mnovich
  1:20 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


mnovich
  2:03 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


zandt
:spiral_calendar_pad:  2:42 PM
Is there any reason for this class to be named CardPayment instead of something generic such as just Payment ? I don't see anything card specific about it.
CardPayment.java
public abstract class CardPayment {
<https://github.com/squareup/java|squareup/java>squareup/java | Added by GitHub




8 replies
Last reply 4 months agoView thread


mnovich
  3:01 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass


yongqing
  3:56 PM
:hi-all: , Cash Crypto plans to support USDC stablecoin in cash app. 
@aliceyuzhang
 and I wrote this eng proposal to add a new currency code for USDC in the CurrencyCode proto for ledgering (similar to BTC in the proto ). Because the proto is widely used in Block, we would like to see if there are any concerns on your side. Happy to provide additional context if needed. Thank you :thank: :thank: :thank:
aliceyuzhang
 | G Suite Document
 

USDC Ledgering Proposal
Google Doc
:checkmark:
1



2 replies
Last reply 4 months agoView thread


mengen
  4:56 PM
Deploying 445b74cd2a73fb4fa80b0008d31a0c71dbe6a64c(latest) to staging


zifan
:spiral_calendar_pad:  7:05 PM
:wave: Hi team! FYI - Ledger tomorrow’s JP SMBC pipeline will be over Connecure (new networking, replacing ISDN). Teller test was successful so I don’t expect any failure. However, if it somehow fails, please set JBA’s client_ip_with_overrides feature flag to false and rerun the pipeline. :messenger-thanks:
:celeryman3:
2
:hellmo:
2
:its-happening:
2



2 replies
Last reply 4 months agoView thread


mnovich
  9:30 AM
@oncall
 ledger is unhealthy. Checking the reasons



7 replies
Last reply 4 months agoView thread


mnovich
  12:49 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-108771
(ledger @ 445b74cd2a73fb4fa80b0008d31a0c71dbe6a64c to production)

4 replies
Last reply 4 months agoView thread


mnovich
  1:17 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


mnovich
  2:04 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


mnovich
  2:54 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass
:kirbyparty:
4



mengen
  4:25 PM
Deploying 34aff1dac04b91aec33b8461a306410e1d47fbc8  (latest) to staging

root
APP  1:15 AM
ODS host fpd1543.iad3b.square (pd-odsgroup377) is down
No action is needed from you. ODS oncall will try to successover metaclusters if they are active on this host.
Please see the #situation channel for more information.
apps affected: ledger
metaclusters affected for these apps:
- pd-mysql-ledger-004
Cc: 
@oncall

1 reply
4 months agoView thread


obaltay
  8:27 AM
Hi Ledger Team - regarding the ledger entries in BQ (payments-raw-production.feeds.ledger_entries_raw_records), the PayPCP team currently manages our transaction cost data in BQ, and we would like to join the ledger and cost data for an upcoming project on InterchangePlus pricing. How often is this BQ view updated compared to the ledger entry feed, and is consuming the data in BQ instead of listening to the feed a recommended option? Our cost data is calculated in a batch context once a day, so I think using the BQ option would make more sense as opposed to the realtime consumption of the feed.
G Suite Document
 

PRD: Interchange Plus (IC+) Pricing EU - Payment Platform Support
Google Doc


cynthiali
:bulb:  10:22 AM
Hello, is anyone able to tell me about Good Merchant Gone Bad (gmgb) tags? I’m investigating a plan with a lot of unsettled entries, and all of the unsettled entries seem to have this tag. Thanks! Here’s a link to one of the unsettled entries with said tag


mnovich
  11:31 AM
Starting https://jira.sqprod.co/browse/ROLL-108822 to clean up ledger DB 
@oncall


2 replies
Last reply 4 months agoView thread


mnovich
  11:37 AM
replied to a thread:
Starting https://jira.sqprod.co/browse/ROLL-108822 to clean up ledger DB @oncall
Roll complete


bmickel
  1:20 PM
(#orders-reporting-team) We maintain prismo which consumes the ledgerEntriesFeed at 1:37pm CT we saw a spike in consumption lag from a ~2seconds to 1day 2h on consume shard 5 of 16. Is this expected from the ROLL-108822: Ledger DB cleanup above?
datadog dashboard




25 replies
Last reply 4 months agoView thread


zandt
:spiral_calendar_pad:  4:16 PM
Hi team. Here are the last two pr's for method platform work in ledger for this quarter:
https://github.com/squareup/java/pull/279850
https://github.com/squareup/java/pull/279762
#279850 [ledger] Remove setting of `reader_type` on the ledger entry payment detail PAYMP-15
<https://github.com/squareup/java|squareup/java>squareup/java | Mar 23rd | Added by GitHub
#279762 [ledger] factor out instrument_type field for capture paymentrecord processing PAYMP-14
<https://github.com/squareup/java|squareup/java>squareup/java | Mar 23rd | Added by GitHub


10 replies
Last reply 4 months agoView thread


mengen
  9:58 PM
Deploying 56515af2c529744206798d8c933cb1c8398a65e1  (latest) to staging


ssopp
  11:59 AM
Hey Ledger team, we're designing a new service that will be emitting feed events that represent balance changes, I was looking at LedgerEntry to see how other teams are modeling their messages. I noticed there are multiple UNDO type entries, for example UNDO_HOLD and UNDO_RELEASE. I vaguely remember hearing (but could be misremembering) that Ledger ended up preferring the 1:1 relationship with undo events vs. a generic event (like UNDO). If true, what led to that preference? Trying to gather information to inform the choice we make



6 replies
Last reply 4 months agoView thread


brianr
  3:56 AM
hi team, ops are having issues with clearing this merchant (L12DBQZP745HF). As you can see it has the 'flagged for review banner' and its transfer status is in a 'suspected' state. The suspected status comes from the ListMerchantSettlementState endpoint having a REASON=SUSPECTED on the last settlement state.
def is_suspected?
  merchant_settlement_states.first&.reason&.include?(MerchantSettlementStateProto::Reason::SUSPECTED)
end
however I checked in skeptic, and there are no internal suspicions for this unit token. would you be able to provide any additional details as to what is causing the suspicious settlement state for this merchant? Thanks!




6 replies
Last reply 4 months agoView thread


minghua
:bulb:  1:01 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-108986
(ledger @ 56515af2c529744206798d8c933cb1c8398a65e1 to *production*)
@zandt
 
@bjoseph
 
@prabhjot
 
@kcrane
 
@mengen
 
@dskarbek
 
@bta
 
@mgp
 (edited) 
:+1::skin-tone-3::+1:
8




7 replies
Last reply 4 months agoView thread


minghua
:bulb:  1:20 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


minghua
:bulb:  2:18 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


jcook
:spiral_calendar_pad:  2:50 PM
replied to a thread:
hi team, ops are having issues with clearing this merchant (L12DBQZP745HF). As you can see it has the 'flagged for review banner' and its transfer status is in a 'suspected' state. The suspected status comes from the ListMerchantSettlementState endpoint having a REASON=SUSPECTED on the last settlement state.…
Bump on this ^ could someone help point us to the payment causing the SUSPECTED settlement state reason?
View newer replies


minghua
:bulb:  3:17 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass
View newer replies


minghua
:bulb:  4:25 PM
deploying 1a6aca67620426a7bfe886c856a046b4470f31d5 to staging



15 replies
Last reply 4 months agoView thread

root
APP  1:35 AM
ODS host fpd1478.sjc2b.square (pd-odsgroup373) is down
No action is needed from you. ODS oncall will try to successover metaclusters if they are active on this host.
Please see the #situation channel for more information.
apps affected: ledger
metaclusters affected for these apps:
- pd-mysql-ledger-028
- pd-mysql-ledger-029
Cc: 
@oncall

1 reply
4 months agoView thread


zandt
:spiral_calendar_pad:  10:53 AM


awhitney
:wave: I've got a big PR that moves the payment-adapter and refund-adapter into /kiwi. There are a lot of touched files as a result, but no other changes. Would someone mind taking a quick look?
Posted in accounting-eng | Mar 28th | View message


minghua
:bulb:  12:23 PM
:skip: Ledger ROLL: Skipping for today due to pending fixes needed


larryl
:palm_tree:  12:24 PM
:wave:  hi 
@oncall
 we have an urgent request to send an IT for this seller to get their funds ASAP. Their balance is around $45k but only $6,541.73 is available for instant transfer. Is there a reason why we can't access the full balance/can we make the full balance available for IT right now? cc: 
@ena
 
@aiqi



25 replies
Last reply 4 months agoView thread


mgp
:baby:  5:38 PM
Deploying b395d032ccaac23887f3fb8b4065e9d22b0fcdcd to staging
:bless:
3



bwester
:officepig:  12:29 PM
hey Ledger folks! I wanted to confirm something with you:
Ledger's FreezeService has many distinct types of freezes, and each type appears to be enabled and disabled independently.  I just want to check: if any of these freeze types are enabled, that is supposed to block transfers, right?
Ledger offers a feed /1/freezes that appears to publish updates. just to confirm: is a new feed entry published for each freeze type, independently of whether transfers are enabled overall for the unit?  more to the point, if that feed publishes a message that a freeze type is not "active", that does NOT say anything about whether the unit as a whole is able to transfer, right?
the block_bank_settlement_per_onboard permission is used to disable a unit's ability to transfer.  this is not considered a "freeze" though, right?
do you happen to know what mechanism is used to prevent transfers if this doesn't count as a freeze?  or if this even affects Ledger state?  at the moment, production unit L7GQP2Y49V4RF has this permission set, and transfers are blocked, but I see that LedgerService.GetFreezes returns no data, even with include_all_settlement_blocking_freezes: true in the request.
:eyes:
1





6 replies
Last reply 4 months agoView thread


minghua
:bulb:  1:11 PM
Ledger ROLL:
ROLL-109129
(ledger @ b395d032ccaac23887f3fb8b4065e9d22b0fcdcd to production)



10 replies
Last reply 4 months agoView thread


minghua
:bulb:  1:20 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


afranks
:spiral_calendar_pad:  1:24 PM
hey folks! question on getting the value for can_debit (on settlementstate) for a bunch of merchants. I see there’s a list_merchant_settlement_states bulk API that supports a list of tokens, so we may just be able to use that. Is that the easiest/best way to get the this value?
Context: we trying to see how many merchants in a list is debitable as a one off exercise to inform an upcoming project (~9k merchants in the list)


13 replies
Last reply 3 months agoView thread


minghua
:bulb:  1:56 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


jonchu
  2:12 PM
Hello ledger team :ablobwave:! Engineer from the transfers team here:
We're looking to update the feature flag logic for evaluating whether to disable instant transfer fees in ledger. For context, this feature flag is going to be used for a 0% Instant Transfer fee experiment. I have a PR up that changes the logic to check the feature flag using the merchant token instead of the unit token, as we want to standardize on a single token type.
We own this part of the code, but I wanted to reach out to as an FYI as y'all would be the ones doing the deploy. Please let me know if you have any questions or concerns! :thx-blob:
cc: 
@eyung

1 reply
4 months agoView thread


minghua
:bulb:  2:51 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass
:italian-nice:
1



zandt
:spiral_calendar_pad:  3:54 PM
Last pr from the method platform team to cleanup a few residual things for the Q1 standard payment record effort.
https://github.com/squareup/java/pull/280280
#280280 [ledger] Remove obsolete `instrument_type` fallback logic from capture event processors
The fallback logic was temporary until all older CaptureEvents have  
been processed.
This is a followup to #279762.
Labels
accounting-engineering
Comments
2
<https://github.com/squareup/java|squareup/java>squareup/java | Mar 28th | Added by GitHub
:stamp3:
1
:th:
1



3 replies
Last reply 4 months agoView thread


mgp
:baby:  4:26 PM
Deploying 8bedc8df6f0 to Ledger staging


afranks
:spiral_calendar_pad:  9:04 AM
replied to a thread:
hey folks! question on getting the value for can_debit (on settlementstate) for a bunch of merchants. I see there’s a list_merchant_settlement_states bulk API that supports a list of tokens, so we may just be able to use that. Is that the easiest/best way to get the this value?…
quick ping on this question ^ (edited) 
View newer replies


tugce
  10:14 AM
Hi team :wave:  What is the recommended timeout to set for Ledger requests? I was thinking of increasing it to 5 seconds, in order to decrease the error rate in our service when Ledger experiences latency issues. (for example)


2 replies
Last reply 3 months agoView thread


jonchu
  11:42 AM
Hi ledger team - I wanted to bump this question from a while back that I posted in accounting-eng. Could someone provide some guidance if this is expected behavior? Thanks!


jonchu
Hi team :ablobwave:! I'm working on this ticket, and it looks like there's a transfer that has an UNSETTLEABLE blocker, which I believe comes from Ledger. Here is the transfer, with client idempotence key of 2202e4f5-8f08-4989-b56d-9904bb8139ab .
I think the issue comes from the fact that a transfer with a blocker for a stored balance gets moved to a pending balance, resulting in the dashboard showing $0. From what I can tell, this is populated by deposits (us) hitting bankc, who then calls GetClearedBalanceV2 . Is this expected behavior, or have I misunderstood something? Thanks so much for the help! :thankyoublob:
Thread in accounting-eng | Feb 28th | View message



5 replies
Last reply 3 months agoView thread


alafranchise
  2:20 PM
:ablobwave: 
@oncall
 BAAPI is going to start a backfill to update SqWeb scope data in Instruments and Gringotts (part of our BAOS migration). You may see elevated numbers of settlement view feed messages. We are going to start slowly and dial up the backfill concurrency as we go. See ROLL for details:
https://jira.sqprod.co/browse/ROLL-109147

1 reply
3 months agoView thread


andreyg
  2:24 PM
@oncall
 can I take over ledger on staging for some testing?




7 replies
Last reply 3 months agoView thread


andreyg
  2:27 PM
replied to a thread:
@oncall can I take over ledger on staging for some testing?
taking over ledger on staging for testing
View newer replies


andreyg
  3:37 PM
replied to a thread:
@oncall can I take over ledger on staging for some testing?
done with testing. I will wait until ~4pm and trigger latest master deploy to staging
View newer replies


mgp
:baby:  4:02 PM
Deploying feb727b0a4c to Ledger staging


anand
  2:00 PM
Hello, is there any endpoint via connect or internal to know if a merchant account has been frozen ? Got directed to this channel by #seller-profile.

1 reply
3 months agoView thread


kcrane
:coolfingergun:  4:06 PM
hey 
@zandt
 sorry for the late tag (and feel free to ignore this until Monday if you're off for the day already), but I had a question about commit 16b085a12d2dfbf57f4e9a8f2eed5e6e2174d658 ("[ledger] Remove unused references to payment token and refund uuid PAYMP-14").
In it, you made mtTenderServerToken/PaymentToken optional in Refund Ledger events. Is this correct & expected? I thought it was mandatory in general for payment events like Refund.
If that's expected and everyone agreed it's fine, I'll make a change in books-ddl.yaml; (one of the Refund files you changed is auto-generated from that YAML file, so I was confused when I auto-generated them again and all of a sudden some other tests I didn't change started failing lolol)



60 replies
Last reply 3 months agoView thread


smartin
  10:17 AM
Deploying 1533170b3a1 to Ledger staging


sumitg
:spiral_calendar_pad:  6:45 PM
We have a scheduled Barclays  outage from 9:45 Eastern on April 1 to 10:00 AM Eastern on April 2nd. This will impact, GBP transfers in UK. I will post any updates as we receive them. :blob-thanks:


3 replies
Last reply 3 months agoView thread

PayswingBot
APP  3:00 AM
Evacuating payments traffic from EAST datacenters (swinging WEST) in production has been initiated by mparmet with message: https://jira.sqprod.co/browse/ROLL-108623

PayswingBot
APP  3:15 AM
Restoring normal payments traffic (unswinging) in production has been initiated by mparmet with message: https://jira.sqprod.co/browse/ROLL-108623


chenj
  9:07 AM
Hi 
@oncall
, wondering if you help me identify if there is anything special regarding this payment token HbyFjvOUozgJz3KB1UdA7febJoYZY.
It’s an old payment from 3/30 but was disputed and refunded today. It landed in Statham’s DLQ due to trying to reprocess the payment and not being able to get signals back from RiskArbiter (wont be able to get it since beacon doesn’t support evaluating payments after 48 hours and its been 5 days) but we probably should’t have tried to reprocess payments as auth/capture again for a refund.
Quick glance at other refund events in presidio, seems like its not common for payment to get re-queued for processing during a refund.
So was wondering if you would be able to see if there was something different about this particular refund that might have it landed back to get processed again?
:eyes:
1
:checkmark:
1




7 replies
Last reply 3 months agoView thread


smartin
  2:30 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-109326
(ledger @ 1533170b3a17028b665d77f1e772e5c64f079e10 to production)
cc: 
@bhargava
 
@mgp
 
@andreyg
 
@mengen
 
@zifan
 
@zandt
 
@dskarbek
:+1::+1::skin-tone-4:
5
:stamp3:
1


1 reply
3 months agoView thread


bhargava
  2:30 PM
was added to #ledger by smartin
.


smartin
  3:20 PM
Deploying c56e45ba604 to Ledger staging


kcrane
:coolfingergun:  5:37 PM
deploying 035b18388b7 (latest) to staging


parkjane
  8:38 AM
:wave: Hi Team! To support Project Sequoia and Regulator Modernization, Ledger data will need to be served as a GraphQL subgraph. The Regulator team is ready to help facilitate this process, in which the details can be found here. I will be the Regulator dev working closely with this effort. Who would be the DRI for Ledger that I can coordinate with? (edited) 
:eyes:
1






+2
19 replies
Last reply 3 months agoView thread


smartin
  10:50 AM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-109354
(ledger @ 035b18388b7eebb321938dd666ebc520da04b80b) to production)
:+1::+1::skin-tone-4::+1::skin-tone-3::+1::skin-tone-2:
10
:stamp3:
1






+1
22 replies
Last reply 3 months agoView thread


smartin
  12:49 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


smartin
  1:41 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby:  rolling forward
View newer replies


smartin
  2:47 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot:  we’re out on prod
deploy checks pass
:woo-hoo:
3



smartin
  3:51 PM
deploying dd57eac8284 (latest) to staging


lagarwal
  3:15 AM
Team: we have the MySQL8 upgrade PR merged for 'ledger app https://github.com/squareup/java/pull/278329 for sometime. Can you please look and get it to merge soon? Thanks
:checkmark:
1


1 reply
3 months agoView thread


eseguy
:spiral_calendar_pad:  7:28 AM
was added to #ledger by parkjane
. Also, hulett
 joined.


smartin
  10:09 AM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-109443
(ledger @ dd57eac828424b97ac9aa361897b57dc3dfcdfae to production)
:+1::+1::skin-tone-2:
4
:stamp3:
3



14 replies
Last reply 3 months agoView thread


chenj
  11:18 AM
Hi Team, I’m clearing out some of our old pager for Staging, one of them being At least 1 payment is risk stale for at least 60 minutes
was wondering if we could purge all the risk stale payments in Staging?
:eyes:
1
:checkmark:
1



33 replies
Last reply 3 months agoView thread


smartin
  12:47 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary:  canary start
View newer replies


smartin
  1:33 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby:  rolling forward
View newer replies


smartin
  2:24 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot:  we’re out on prod
deploy checks pass
:party-parrot:
1



tmahoney
  2:58 PM
:wave: hey, is anyone able to help me understand which merchant(s), if any, use the canAutomaticallyApproveRefunds property of MerchantSettlementState?
a brief look at Ledger code makes me think that it’s an obsolete Marketplaces concept, and if so, I’d love if we could retire it (would help simplify things a bit in refundsarbiter). FWIW, my team already has controls on our end for always allow refunds for merchant/unit X (we do this for e.g. Square Hardware today), so retiring this would not be an overall reduction in functionality.




43 replies
Last reply 3 months agoView thread


smartin
  3:58 PM
deploying 69021e1b4af (latest) to staging


acastberg
  4:08 PM
:wave: 
@oncall
 when does the staging pipeline run happen? :thankyoublob:




11 replies
Last reply 3 months agoView thread


tmahoney
  4:25 PM
replied to a thread:
:wave: hey, is anyone able to help me understand which merchant(s), if any, use the canAutomaticallyApproveRefunds property of MerchantSettlementState?…
cleanup PR is up now: https://github.com/squareup/java/pull/281707
View newer replies


acastberg
  2:59 PM
:wave: 
@oncall
 I would like to flip this feature flag to disable sending of pending credit emails (edited) 
:checkmark:
1





6 replies
Last reply 3 months agoView thread


smartin
  4:06 PM
deploying cf9e5762d3c (latest) to staging


jazmineg
  10:54 AM
Hi Team! It looks like there is a $158,500.75 held on Equilibria. But not seeing any freeze on transfers or anything. Could anyone provide additional details on what this hold is? Thanks!
:eyes:
1
:checkmark:
1




4 replies
Last reply 3 months agoView thread


ashliek
  11:51 AM
was added to #ledger by jazmineg
.


sarve
  4:07 PM
Deploying 30e5b417f05 to Ledger staging

1 reply
3 months agoView thread


ena
:spiral_calendar_pad:  9:00 AM
[scheduled message] hey team!! #transfers is planning on increasing the US IT fee from 1.5% to 1.75% in production on Tuesday 11th April, at 9AM PST (this change was already done in staging a couple of months ago)
This will involve us updating the fee basis points in ledger’s production DB. Please take a look at  ROLL-109666 and :stamp3: if it looks good :blobheart: thank you!!





21 replies
Last reply 3 months agoView thread


jkesting
  9:45 AM
@oncall
 I am seeing some feed lag in Cloud Persister for the ledger-settled-ledger-entries_2 feed starting at around 830 PM PST last night. Is everything alright with this feed on your end? Not seeing any errors in Cloud Persister but seeing a decreased rate of consumption since that time (edited) 



4 replies
Last reply 3 months agoView thread


eengart
:spiral_calendar_pad:  9:51 AM
Hi Team! Random question about this account: CC3TNDW4QEPG5. I am in credit risk and working on this account and the account has queued up 3 times in the past month due to the failed debits. Since the M is actively processing with us, why are those transactions not being put toward the negative balance on the account?



11 replies
Last reply 3 months agoView thread


nirali
  11:11 AM
hello! Not sure if this is the best place to ask, but we're trying to get a list of all frozen sellers with an open IRF case that have a balance or not (meaning they have money in their account that they are unable to move to their bank account because they are frozen). The query we're using is below but it times out when we try to run it. Is there a more efficient way or summary ledger table that we can use to get balance information? cc 
@sarahsultan
SELECT 
    fpt.unit_token
  , fpt.payment_token
  , fpt.auth_intent_created_at AS payment_created_date
  , fpt.currency_code
  , fpt.amount_base_unit/100 AS amount_base_unit
  , fpt.card_brand
  , fpt.payment_type
FROM payments_dw.public.payment_transactions fpt
LEFT JOIN ledger.raw_feeds.ledger_entry le ON le.payment_token = fpt.payment_token
LEFT JOIN ledger.raw_feeds.settled_ledger_entry sle ON le.external_source_id = sle.externalsource_id
WHERE fpt.auth_success = 'TRUE'
AND sle.banksettlemententrytoken IS NULL
AND FPT.PAYMENT_TRX_RECOGNIZED_AT >= '2021-01-01';
(edited)

1 reply
3 months agoView thread


mchiesa
  11:32 AM
Hello :wave:  just a friendly reminder about version validation migration for the APIs in ledger.
Action Items
Please make sure the migration status for any listed API your team owns is up to date in our tracking spreadsheet. If your team has already completed the migration process, thank you! Otherwise, we kindly ask that you provide any notes or links to tickets related to completing this process in the last column (this may even include a simple indication that migration is not necessary for the listed API).
If you have any questions or concerns, please reach out to us on #api-frameworks


hoyi
  12:46 PM
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-109704
(ledger @ 30e5b417f05 to production)
:stamp:
1



4 replies
Last reply 3 months agoView thread


hoyi
  1:26 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-109704…
staging checks pass
:canary: canary start


hoyi
  4:02 PM
Deploying latest (7235f071e7f) to staging


acastberg
  8:58 AM
replied to a thread:
[scheduled message] hey team!! #transfers is planning on increasing the US IT fee from 1.5% to 1.75% in production on Tuesday 11th April, at 9AM PST (this change was already done in staging a couple of months ago)…
starting ROLL :rolling_kirby:
:yay-frog:
1

View newer replies


acastberg
  9:33 AM
replied to a thread:
[scheduled message] hey team!! #transfers is planning on increasing the US IT fee from 1.5% to 1.75% in production on Tuesday 11th April, at 9AM PST (this change was already done in staging a couple of months ago)…
ROLL complete :check-mark:
:hands-up:
1



markl
:spiral_calendar_pad:  12:35 PM
@oncall
 I merged a fix (https://github.com/squareup/java/pull/282327) to a regression I introduced with a previous change. Any chance we could get it deployed on staging?




13 replies
Last reply 3 months agoView thread


hoyi
  12:47 PM
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-109781
(ledger @ 7235f071e7f to production)
:+1:
1



9 replies
Last reply 3 months agoView thread


conner
  12:52 PM
hi 
@oncall
! the SaaS team is working on remediation for a SEV, and there's a chance we'll need to credit merchants money if their original payment method isn't viable for a refund.
the marketing team pointed us to this doc, outlining a potential credit process.
we have some questions related to this -- could you or someone on your team please join #alert-11904_bills_are_generated_for_canceled_free-trial_postpay_saas?
:eyes:
1


1 reply
3 months agoView thread


hoyi
  12:56 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-109781…
Cancelling deploy to due known bug
:sorry:
1
:ack:
1

View newer replies
12:59
Deploying 0d5b726a85a (latest) to staging


jyenbamroong
:ms-teams-jeans:  1:16 PM
hi! could i get a review on this PR to add paymentactivator to the ListMerchantSettlementStates acl whenever someone has a moment? thank you! https://github.com/squareup/java/pull/282252
:stamp:
1



hoyi
  4:04 PM
Deploying latest (f8966e21b54) to staging


ayana
:no_entry:  8:26 AM
Hi there! Can I get some assistance with these accounts?
4RYX96DBFTS6N
L427GG563DEAB
We had approved adjustments for refunds on these accounts but they were unable to credit the merchant due to the accounts being deactivated and both sellers have Sq Cards in which those processes have blocked external transfers. (Refer to slack thread if needed in regards to this issue).
We would like to see if there is any guidance on stopping the payments that is sitting in the ledgers or if there are any other alternative methods to help credit these funds to the sellers? Please and thank you!


bryanneva
Hi, I have a merchant with a Square Card with a positive adjustment. However, the ledger entry isn’t settling. I learned that these entries don’t settle until Square Card sweeps the balance to card.
Could someone help me understand why Card hasn’t swept them?
https://regulator.sqprod.co/n/users/4RYX96DBFTS6N?section=ledger-entries
Show more
Thread in square-debit-card | Apr 7th | View message
:eyes:
1






+2
21 replies
Last reply 3 months agoView thread


jzerilli
:spiral_calendar_pad:  10:58 AM
@oncall
 recoverytron is seeing rate limiting issues when trying to release reserves through ledger. A high qps merchant recently had a lot of transactions to release through ledger so traffic is higher than normal. would it be possible to raise the limit for a bit? We have ~1000 payments that need to be released




28 replies
Last reply 3 months agoView thread


cpopescu
:spiral_calendar_pad:  12:02 PM
Hi team, I just had a conversation with 
@ankit
 from the BI team on how his team can get offline access to the merchant_features table in Ledger. The preferred way would be Snowflake but Big Query would work too. What is the typical process to expose a table in Snowflake? cc 
@mgp
 
@snigdhak
 
@kcrane
 (edited) 





25 replies
Last reply 3 months agoView thread


hoyi
  1:08 PM
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-109849
(ledger @ f8966e21b54 to *production)


4 replies
Last reply 3 months agoView thread


hoyi
  1:28 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-109849…
staging checks pass
:canary: canary start
View newer replies


hoyi
  2:18 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-109849…
Consumer lag is increasing on a feed, but it’s an issue with a known, unrelated cause.
:rolling_kirby: rolling forward


brentw
:spiral_calendar_pad:  10:11 AM
Hey Ledger team, I ran into a column length limit when adding a new square bank account this morning. Created a PR for teller to increase the column length, but wanted to double check if there was anything that needed to be done on your end as well


3 replies
Last reply 3 months agoView thread


lagarwal
  11:02 AM
MySQL8 upgrade - Just writting to check that can we move 'ledger' staging on 4/17? Thanks





+1
12 replies
Last reply 2 months agoView thread


dhowe
:no_entry:  12:52 PM
registry access request for access to ledger snowflake (readonly) for square compliance engineering :pray:
https://registry.sqprod.co/access_requests/324906



4 replies
Last reply 3 months agoView thread


hoyi
  2:49 PM
set the channel topic: ALERT-11964 Balances delayed | Discussion for https://registry.sso.global.square/apps/ledger | Contact @oncall for questions | Emergency page the entire team: https://go/ledger911


hoyi
  4:14 PM
Deploying latest (93c40659d2c) to staging


hoyi
  4:24 PM
set the channel topic: Stable | Discussion for https://registry.sso.global.square/apps/ledger | Contact @oncall for questions | Emergency page the entire team: https://go/ledger911


jengel
:spiral_calendar_pad:  12:33 PM
Hey Team, is there away to determine if a seller has ever been frozen by ledger?
:checkmark:
1



4 replies
Last reply 3 months agoView thread


emilyl
  4:10 PM
deploying ccceb83d53e (latest) to staging


ishvydchenko
  4:17 PM
Hey team! Does anyone know which team owns creating the DISPUTE_ADJUSTMENT and RESOLVED_DISPUTE ledger entries?
They are both created at the exact same time so it is causing some complications in capitals migration to MoneySweeper, so we were wondering if its at all possible to offset their creation by a little?
:checkmark:
1




13 replies
Last reply 3 months agoView thread

PayswingBot
APP  3:03 AM
Evacuating payments traffic from WEST datacenters (swinging EAST) in production has been initiated by mparmet with message: https://jira.sqprod.co/browse/ROLL-109664

PayswingBot
APP  3:12 AM
Restoring normal payments traffic (unswinging) in production has been initiated by mparmet with message: https://jira.sqprod.co/browse/ROLL-109664


leah
  7:48 AM
Hi, I'm wondering if someone can take a look at BCON-10277. I understood that logic had been changed back in 2021 to stop unlinking UK bank accounts after 3 failed debits (since this is ACH logic not applicable to the UK-- and to ensure that sellers weren't DAed as a result due to the UK FCA requirement). We are still seeing accounts that have 3 failed debits, the bank unlinks, and the account becomes DAed after the grace period-- and this is leading to seller escalations and FCA complaints. (If this is not your team's responsibility I'd appreciate if you can point me in the right direction- I've been sent here from #bank-accounts-api after being redirected there from #transfers :pray:)





+1
16 replies
Last reply 3 months agoView thread


acastberg
  9:18 AM
:helloblob: hello! l would like to turn this feature flag for endpoint rule notifyInstantDepositApproval to 1% in prod today
this is where it is used in ledger
cc 
@oncall
:ack:
1



6 replies
Last reply 3 months agoView thread


eliobis
  12:21 PM
was added to #ledger by hsilverio
.


mhagy
  1:19 PM
I’m going to swing payments at 10 AM ET tomorrow, https://jira.sqprod.co/browse/ROLL-110066
I’ll announce this again tomorrow when starting in the relevant channels, including #ledger

1 reply
3 months agoView thread


emilyl
  1:24 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-110084
(ledger @ ccceb83d53e to production)

4 replies
Last reply 3 months agoView thread


emilyl
  2:02 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


emilyl
  2:30 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


emilyl
  3:35 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass


emilyl
  4:06 PM
deploying 3e51c256b17 (latest) to staging


kateo
  6:36 AM
was added to #ledger by leah
.


mhagy
  7:01 AM
replied to a thread:
I’m going to swing payments at 10 AM ET tomorrow, https://jira.sqprod.co/browse/ROLL-110066…
Starting this payswing from east/IAD to west/SJC

PayswingBot
APP  7:03 AM
Evacuating payments traffic from EAST datacenters (swinging WEST) in production has been initiated by mhagy with message: https://jira.sqprod.co/browse/ROLL-110066 for network maintenance

PayswingBot
APP  8:39 AM
Restoring normal payments traffic (unswinging) in production has been initiated by mhagy with message:  https://jira.sqprod.co/browse/ROLL-110066 normalizing now that network maintenance is complete


acastberg
  8:56 AM
replied to a thread:
:helloblob: hello! l would like to turn this feature flag for endpoint rule notifyInstantDepositApproval to 1% in prod today…
bumping this to 10% :rolling_kirby:
cc 
@oncall
View newer replies


ahdoot
:spiral_calendar_pad:  9:03 AM
:wave:, we have an interesting case:
merchant is disabled
has refunds that were processed over a year ago, but there is strong belief that merchant never got their money, and the money is being held by Square
~10 payments totaling ~$50k
timing lines up with the Russia sanctions
In situations like these in the past we’ve just had RefundsArbiter call Ledger’s CancelRefundLedgerEntry endpoint, but given how old these refunds are and how much money it is, I wanted to run this by y’all first. (edited) 


davidsmith
Another real weird question. Not related to my previous real weird question. If we want to retroactively pretend the refund for Djt8td4ziW5UaUqkcaeoPtA7taB failed and release the funds back to the seller, is there a process for that? (#recon-help has verified that the refund actually did fail, and Square has the money, and compliance people in Australia are :eyeshake:)
Thread in refunds-api-help | Apr 17th | View message
:eyes:
1



6 replies
Last reply 3 months agoView thread


tisaacs
:face_with_thermometer:  9:04 AM
was added to #ledger by ahdoot
.


emilyl
  12:48 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-110146
(ledger @ 3e51c256b17 to production)


4 replies
Last reply 3 months agoView thread


emilyl
  1:33 PM
replied to a thread:
Ledger ROLL:…
canceled today


emilyl
  4:14 PM
deploying 7460f26b815 (latest) to staging


ayana
:no_entry:  8:41 AM
Hi there -- escalating this issue from a previous thread and hoping we can get assistance for these accounts:
L11FY2H6KW7H2
4RYX96DBFTS6N
Both accounts are included on  ONCALL-147680. Still trying to figure how to refund the sellers ASAP with the funds sitting in each of their ledgers.
I was advised to reach out to #square-debit-card and they referred back to this channel for additional guidance. Can someone please assist? Please note this is time sensitive


dkong
are the adjustments stuck only for those 2 units? if it's time sensitive, we should ask the #ledger team to manually remove those settlement blockers off those units, so we can process them quickly
From a thread in square-debit-card | Apr 19th | View reply





+1
11 replies
Last reply 3 months agoView thread


jthomas
  9:34 AM
Hi! Looking at http://go/settlementschedule I’m trying to get a better understanding of the relationship between POS cutoff and Ledger settlement time. Can someone help with explaining? I’ll put specifics in the thread
:checkmark:
1



12 replies
Last reply 3 months agoView thread


boz
  10:25 AM
Hi there, our app(cloud-persister) keep getting noisy alert about spikes of feed lag from ledger-settled-ledger-entries_2, like INCIDENT #2598224
Would like to know if you could adjust the feed consumption rate or set a higher threshold for triggering the alert?
Thanks! cc 
@carolina




18 replies
Last reply 3 months agoView thread


tal
:no_entry:  10:47 AM
hey team! hopefully quick question -- can a seller only have 1 active merchant settlement state at a time?


5 replies
Last reply 3 months agoView thread


jcook
:spiral_calendar_pad:  11:28 AM
Hey all, is there a good way to freeze all units under a given merchant without individually freezing all units for a given merchant?
:checkmark:
1


1 reply
3 months agoView thread


acastberg
  11:42 AM
replied to a thread:
:helloblob: hello! l would like to turn this feature flag for endpoint rule notifyInstantDepositApproval to 1% in prod today…
bumping to 20% :rolling_kirby:
View newer replies


emilyl
  12:15 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-110207
(ledger @ 7460f26b815 to production)
:+1:
4



5 replies
Last reply 3 months agoView thread


emilyl
  12:56 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


wstewart
  1:07 PM
I'm going to take over staging for a bit


emilyl
  1:19 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


emilyl
  2:24 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass


emilyl
  4:21 PM
deploying 714a5d6e07d (latest) to staging


rachit
  5:20 PM
Hey Team,
For our new service Interchange Plus (IC+) , we will be querying  payments-raw-production.feeds.ledger_entries_raw_records in BQ.
We will be creating a service account for our production environment. Would It be possible to give our service account read access to the above table?
cc: 
@obaltay
:checkmark:
1



4 replies
Last reply 3 months agoView thread


acastberg
  9:14 AM
replied to a thread:
:helloblob: hello! l would like to turn this feature flag for endpoint rule notifyInstantDepositApproval to 1% in prod today…
bumping to 50% :rolling_kirby:
View newer replies

PayswingBot
APP  10:04 AM
Evacuating payments traffic from WEST datacenters (swinging EAST) in production has been initiated by vballari with message: as per https://jira.sqprod.co/browse/ROLL-110255


joannexu
:bulb:  12:23 PM
hi, billpay started getting timeouts in staging calling get_freezes, is there an issue with ledger in staging?
example call: https://square-inc.sentry.io/issues/3609972442/?project=5959763&referrer=slack
started a couple hours ago: https://square.datadoghq.com/s/3b6b4a9c0/q9r-mah-f4a
Errors on service billpay-ledger in env staging
Added by Datadog (34 kB)
https://square.datadoghq.com/s/3b6b4a9c0/q9r-mah-f4a


1 reply
3 months agoView thread

PayswingBot
APP  12:58 PM
Restoring normal payments traffic (unswinging) in production has been initiated by vballari with message: as per https://jira.sqprod.co/browse/ROLL-110255


emilyl
  4:06 PM
deploying 3d1fa5abbd4 (latest) to staging


acastberg
  9:03 AM
replied to a thread:
:helloblob: hello! l would like to turn this feature flag for endpoint rule notifyInstantDepositApproval to 1% in prod today…
rolled out to 100% :check-mark:


sschloss
:spiral_calendar_pad:  9:32 AM
Hi team. Question about the payment_token included in Ledger cleared transaction events. Is this the same as the payment_id included in the public V2 Payments API? Or is this an internal-only token?
:checkmark:
1


1 reply
3 months agoView thread


andreyg
  4:12 PM
deploying d82f4379796 (latest) to staging (edited) 
:checkmark:
1


PayswingBot
APP  3:05 AM
Evacuating payments traffic from EAST datacenters (swinging WEST) in production has been initiated by mparmet with message: https://jira.sqprod.co/browse/ROLL-110070

PayswingBot
APP  3:13 AM
Restoring normal payments traffic (unswinging) in production has been initiated by mparmet with message: https://jira.sqprod.co/browse/ROLL-110070


stefan
:bulb:  12:07 PM
Hi team! Following up on this thread I started with #orders-reporting-team: https://square.slack.com/archives/C026QC9U2TW/p1682113539569839 to learn more about the ledger feed and particularly entries with the type CAPTURE. It looks like CAPTURE is what's used by the beemo stack to store the fees associated with a Bill for reporting (and the FEE type event, if Cost+ based on the comments in go/proto). For RST, we have a report called "Close of Day" run by the manager and the flow for running it essentially (with a lot of non-payment related stuff ommited) looks like:
Adjust all tips (if they were not already set by the employee earlier)
Capture all payments
Show a big report based on a set of calls to beemoreporter's CustomReport API
Since step 3 and 4 happens back to back here, we often don't have the right fee numbers, since it seems like it can take seconds for the capture event to be fired from ledger after step 3, and then prismo has to process it which can also be seconds behind (sometimes even hours).
So I think the first question we have is whether it's possible to calculate the fees (even if they're not final) earlier, like say when the tip is added to the tender, since it is possible for the tips to be adjusted throughout the flow of service, rather than only at close of day? That would probably help significantly with accuracy (at least, outside of times that prismo is 4h behind ledger). Follow-up question would be if it's technically possible to calculate, would it break anything else downstream (e.g., if it being calculated before capture would break the seller's balance or something by deducting fees before crediting payments)?
Totally understand if it isn't feasible, but wanted to explore what our options were since we hear complaints about the fees shown in the report being inaccurate. Thanks!


stefan
Not sure if this is the right place, so please redirect me as appropriate.
On RST, we've noticed that the fees in beemo reports are not accurate if there are bills that are pending. For our close of day feature, we capture all uncaptured bills right before showing the report, but it can take significant time (60s+ sometimes) for bills to go from starting capture to the fee event and having the fees reported correctly in the report so we've had sellers notice their fees change if they look at reports later in the night. I think this also applies to them looking at reports in dashboard too.
Is the fee calculation dependent on capture, or is that something that could potentially happen earlie… Show more
Thread in orders-reporting-team | Apr 21st | View message



7 replies
Last reply 3 months agoView thread


kcrane
:coolfingergun:  12:50 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-110423
(ledger @ d82f4379796 to production)
:+1::+1::skin-tone-2:
7




7 replies
Last reply 3 months agoView thread


kcrane
:coolfingergun:  1:12 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


kcrane
:coolfingergun:  1:48 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


kcrane
:coolfingergun:  3:02 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we're out on prod
deploy checks pass


kcrane
:coolfingergun:  5:31 PM
deploying 1da1c129744 (latest) to staging

PayswingBot
APP  7:14 AM
Evacuating payments traffic from EAST datacenters (swinging WEST) in production has been initiated by malbert with message: neteng needs to update the IAD transaction firewall for pci compliance


kdalvi
:baby-baby:  8:48 AM
Hi team, a merchant is not able to deactivate their square account because it appears they have a pending balance. However, they don't see any balance and regulator also shows the balance to be $0. Could you please help to check if there is any pending balance on this merchant 8AZDEP1RMJ69K or any of its units?
Oncall Ticket: https://jira.sqprod.co/browse/ONCALL-146623





+1
30 replies
Last reply 3 months agoView thread

PayswingBot
APP  10:37 AM
Restoring normal payments traffic (unswinging) in production has been initiated by malbert with message: network maintenance complete


kcrane
:coolfingergun:  12:35 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-110501
(ledger @ 1da1c129744 to production)
:+1::+1::skin-tone-2:
2
:stamp3:
1



12 replies
Last reply 3 months agoView thread


kcrane
:coolfingergun:  12:52 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


kcrane
:coolfingergun:  1:25 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


mgp
:baby:  2:29 PM
replied to a thread:
Ledger ROLL:…
Rolling back Ledger to d82f4379796
View newer replies


acastberg
  2:32 PM
:ablobwave: hello, transfers team is planning to start percentage rollout in prod of transactional emails tomorrow at 9am PDT (ROLL)
this will mainly affect the linkCardV2 and resendVerificationEmail endpoints
cc 
@oncall
 (edited) 
:ack-red:
1


1 reply
3 months agoView thread


kcrane
:coolfingergun:  4:27 PM
deploying 339915591eb to staging (latest)


kenji
  7:59 PM
Hi 
@mgp
, team,
SMBC is asking the below, do you happen to what this is about?
Regarding remittances using the JAPAN LINK Service as of today
One error has occurred.
We apologize for the inconvenience, but please check the following information.
Transmission information
Payer Code: 8430782 *Code discrepancy
Payee Code: CHASUS33 *Code discrepancy
Amount of remittance: 10,122,271 yen
There is no information on the payee name or receiving bank, and the only information we have received is the above.
We assume that the money was transferred to your company’s account at JP Morgan.
Can you please confirm the following information about this money transfer?
We will send the money as soon as we confirm the correct information.
Client Code (Payer Code)
Payee Code
Payee Name
Payee Address
Payee Bank/Payee Branch
(
@shigeki
@ryosuke
)


3 replies
Last reply 3 months agoView thread


kdalvi
:baby-baby:  7:49 AM
Hi team, could I pls get an approval on this app dependency request? TIA!
:checkmark:
1



kcrane
:coolfingergun:  12:52 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-110576
(ledger @ 3399155 to production)
:+1::+1::skin-tone-2:
3



11 replies
Last reply 3 months agoView thread


kcrane
:coolfingergun:  1:40 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
:bless:
1

View newer replies


kcrane
:coolfingergun:  2:36 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


vlong
  2:48 PM
replied to a thread:
:wave: Hello, we’re reaching out because your service ledger uses Envoy Logging (go/envoylogging) to log information about API Velocity endpoints. Envoy Logging is supported by our service api-observe, which your service’s Envoy sidecar asynchronously sends information to. Historically, api-observe has used endpoints_set.go to know which endpoints need to be logged and obtain information about those endpoints.…
We’ve had diffs enabled in staging/prod for some time now, and we haven’t seen any concerning diffs or issues for ledger in both prod and staging. We are going to be flipping the flag now in staging to fully switch over to the schema implementation.
View newer replies


weisong
  3:03 PM
Hi team,  we got
Protobuf::GeneratedProtos::squareup::ledger::service::FreezeService#delete_freeze received status 500 with error
https://regulator.sqprod.co/admin/sidekiq/morgue/1682546251.7204242-dce4b84e7f25d57b42bfeec9.  Can someone help to investigate that?




46 replies
Last reply 3 months agoView thread


kcrane
:coolfingergun:  3:36 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we're out on prod
deploy checks pass


eliobis
  4:28 PM
:helloblob: Hello from BAAPI! Trying to better understand how/where Ledger uses uk direct debit mandates. We're moving them to the auth service over the new few quarters and trying to map out the current use cases. Been looking through the code by I'm not too familiar with Ledger so any help is appreciated. Happy to jump in a meeting if that's easier for someone! Thanks! :slightly_smiling_face:

1 reply
3 months agoView thread


kcrane
:coolfingergun:  4:30 PM
deploying 49e0bbfa485 to staging (latest)


kenji
  6:39 PM
Hi 
@mgp

qq, no rush though, [production] JPY H2H settlement 2023-4-27 No.2240 with Mizuho Bank, Ltd. completed was sent nearly 50 minutes late than usual, and Mizuho is asking me why.
Have we changed the schedule in any way? or is this due to DST?
(
@ryosuke
@shigeki
)


5 replies
Last reply 3 months agoView thread


kcrane
:coolfingergun:  4:18 PM
deploying 80352c14b4a to staging (latest)


eslocombe
:spiral_calendar_pad:  7:51 AM
hi ledger engineers! we are trying to diagnose some performance issues the ledger database shards in staging - but have not uncovered anything in particular. The next thing I would like is for someone to (a) restart the staging app nodes to have a fresh start and then (b) to investigate if there are any issues on the app connection side. I am specifically wondering if there is something in the db connection itself making queries return slowly. I discussed it a bit in here https://square.slack.com/archives/C02FFJXER/p1682622616439449 and https://square.slack.com/archives/C03Q4J2CJ58/p1682624899777009 but the slack threads are so long that I think we might be getting into dedicated slack channel territory.


minghua
Hey folks :corgi-wave:
I have a migration stuck in FAILED_RETRYABLE for a few metaclusters (migration here)
I followed some of the previous threads that encountered the same error, and essentially created that migration to retry only the failed metaclusters, but they are still failing.
Show more
Thread in ods | Apr 27th | View message


eslocombe
did anyone here notice that ledger was performing horribly on mysql8? IMO - this needs immediate triage 
@ioberst
Thread in mysql-8-upgrades | Apr 27th | View message


3 replies
Last reply 2 months agoView thread


mgp
:baby:  5:51 PM
Deploying 8d433bdc365 to Ledger staging (latest)

PayswingBot
APP  3:03 AM
Pay swing has been initiated by mparmet with message: https://jira.sqprod.co/browse/ROLL-110444.
Evacuating payments traffic from WEST datacenters (swinging EAST) in production
**EAST** :large_green_circle: (Available): Serving new payments
**WEST** :large_orange_circle: (Degraded): NOT serving new payments

PayswingBot
APP  3:12 AM
Pay swing has been initiated by mparmet with message: https://jira.sqprod.co/browse/ROLL-110444.
Restoring normal payments traffic (unswinging) in production
**EAST** :large_green_circle: (Available): Serving new payments
**WEST** :large_green_circle: (Available): Serving new payments


brentw
:spiral_calendar_pad:  10:04 AM
Q: Does Ledger have any active Chase pipelines anymore?

1 reply
2 months agoView thread


skaltenbach
  11:38 AM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-110773
(ledger @ 8d433bdc365fa93669c54c11abae11f326ea4d60 to production)
:+1::+1::skin-tone-2:
3





10 replies
Last reply 2 months agoView thread


skaltenbach
  12:37 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


skaltenbach
  1:10 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


ishvydchenko
  2:01 PM
Hey team!
We've been testing some refund flows on staging for the capital migration to MoneySweeper and we had a case on staging where we took 3 partial refunds and it looks like only 1 of them showed up as a Ledger Entry? This seems like a potential issue since the seller sees them as refunded but we don't see it on our end?
Payment Token: https://regulator.stage.sqprod.co/n/payments/lYv8Rn6tWAWltCrGRxD3ECZHKaGZY
:eyes:
1



5 replies
Last reply 2 months agoView thread


skaltenbach
  2:54 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass


tal
:no_entry:  4:20 PM
hey team! just curious if anything changed with this script, we use it on Transfers team to be able to easily get into the right ledger DB shard in prod or staging for a given unit token. these are the aliases we use:
# This command, followed by a unit token automatically connects you the Ledger shard that the unit is stored in.
alias lpd='~/Development/java/settlements/ledger/script/calculate-shard'
alias lsd='~/Development/java/settlements/ledger/script/calculate-shard --staging'
but it seems like it's not working anymore, we're getting this error:
env: python: No such file or directory
appreciate any help :pray: !



8 replies
Last reply 2 months agoView thread


skaltenbach
  4:47 PM
deploying ba60af2f4faa2b1f16db25864d128edca35868f7 to staging (latest)


hpham
  5:34 PM
Hey 
@oncall
 I was wondering if we could halt all ledger debits on this Seller here as the Seller has made an external complaint. The system looks like it keeps debiting $9591.64 from their bank account after marking one of their debits as “failed” manually on our side. cc: 
@njain
 (edited) 





49 replies
Last reply 2 months agoView thread


songlinliu
:spiral_calendar_pad:  9:34 AM
Can I get an approval to extend regulator ’s access to ledger? https://registry.sqprod.co/app_dependency_requests/33016 Thanks
:stamp3:
1



manij
  10:16 AM
hello there, is there a way to extend a hold on a user applied via regulator "create user hold" ? for more context, credit risk ops team applied a hold on a seller(convene) but the duration is defaulted to 90 days which is not sufficient for this use case. without an option to extend to a custom time, ops team is waiting for the existing hold to expire and then apply a new hold for the next 90 days using reminders which is tedious and error prone. just wanted to check if there is any override that can be done in the backend to extend the hold. thanks  :pray:


3 replies
Last reply 2 months agoView thread


skaltenbach
  12:11 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-110861
(ledger @ ba60af2f4faa2b1f16db25864d128edca35868f7 to production)
:+1:
2




8 replies
Last reply 2 months agoView thread


nbl
  12:31 PM
Hey 
@oncall
could help explain what’s happening to a confused loans customer who called into ops? We created a ledger entry for this customer, and it seems to have taken all of their balance and debited their bank account the full amount (instead of just the amount remaining after balance). I’m not sure if this is just because it’s still in the Pending state but do you mind taking a look?
report from ops


jjuarez
@nbl
 The amount seems wrong though. We sent a debit to the linked BA for $2689. And we took their processing for $2309. All to pay for the $2689 term loan payment, that doesn’t make sense to us
From a thread in ops-term-loan | May 2nd | View reply



13 replies
Last reply 2 months agoView thread


skaltenbach
  1:04 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


lise
:no_entry:  1:23 PM
Hey team! I've noticed no new data in ledger.raw_feeds.settled_ledger_entry since 4/25. Would someone here be able to help out? Please feel free to redirect me if not the correct spot to ask. thanks!


3 replies
Last reply 2 months agoView thread


skaltenbach
  1:40 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


skaltenbach
  2:27 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass


acastberg
  2:28 PM
:wave: we have a seller (LHENBTMSDZJHA) with 2 settlements that were sent to a bank account on 4/30 that failed verification. Is there any way to know whether these funds are still in flight? If so is it possible to claw these back?
@oncall



6 replies
Last reply 2 months agoView thread


skaltenbach
  4:20 PM
deploying 53b9d0c5ab3f352557c1f6cc37f3a2cde7ba0ce3 to staging (latest)


kcrane
:coolfingergun:  6:14 PM
@tmahoney
 sorry for the slightly after-hours tag, but we're seeing some IllegalCashflowExceptions from a merchant trying to refund a lot more than they have available. is there anything we should do about this?
https://square-inc.sentry.io/issues/4149551522/?referrer=slack
IllegalCashflowException
bad cashflow: Attempt to refund more than available. Tried to refund USD 50000.00 on payment ZkSdPfHQgOPacY0E4gmOCUtFFdfZY, but only USD 0.00 remains
LEDGER-PRODUCTION-15KSLEDGER-PRODUCTION-15KS | May 2nd | Added by Sentry
Select Assignee...




41 replies
Last reply 2 months agoView thread


tmahoney
  6:48 AM
:bufo-wave: hey folks! is Ledger having trouble in staging? namely, heavily backed up on processing captures?
we’ve been getting refundsarbiter staging alerts since yesterday evening (“PAYMENT_NOT_FOUND” errors from Ledger) that suggest this is happening.



24 replies
Last reply 2 months agoView thread


skaltenbach
  11:54 AM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-110941
(ledger @ 53b9d0c5ab3f352557c1f6cc37f3a2cde7ba0ce3 to production)



18 replies
Last reply 2 months agoView thread


skaltenbach
  1:01 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


skaltenbach
  1:33 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


skaltenbach
  2:22 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass
:yey:
1



skaltenbach
  4:08 PM
deploying 3ba24f24f4cfb3608b1489448d340f14cb84377f to staging (latest)


sfitzgerald
:palm_tree:  6:00 AM
Hi team! Any chance someone can take a look at this? Missing transfers for an ES merchant but it hasn't been assigned to anyone yet! Thank you!!
:eyes:
1



3 replies
Last reply 2 months agoView thread


zellyn
  12:32 PM
Hey 
@oncall
… have y’all had trouble migrating Ledger to gRPC/envoy in the past?





+1
83 replies
Last reply 1 month agoView thread


alexandrawilliams
  1:47 PM
Hi team, MYSQL8 update:
On Monday 5/8, we will successover ledger to the B side, and monitor
Then on Monday 5/15: we will upgrade A side (assuming previous week with B side went smoothly)
Does this work for you? Please follow along in #mysql-8-upgrades and ping us with any questions. cc 
@lagarwal
 
@jzammito


2 replies
Last reply 2 months agoView thread


ioberst
:palm_tree:  2:09 PM
was added to #ledger by alexandrawilliams
.


lagarwal
  2:21 PM
replied to a thread:
MySQL8 upgrade - Just writting to check that can we move 'ledger' staging on 4/17? Thanks
Just a gentle reminder: we have the MySQL8 upgrade PR merged for 'ledger' app. We have put in week of 5/8. We will upgrade side B first then side A following week. You can follow #mysql-8-upgrades for more progress/updates. Thanks
:ok_hand::skin-tone-2:
1

View newer replies


acastberg
  2:44 PM
hello from transfers:wave: I was wondering if there's a good place to find metrics on the # of payouts being sent out during each type of pipeline run in ledger
for context: we want to know what the peak volume will be for sending transfer notifications during pipeline runs :blob-thanks:


7 replies
Last reply 2 months agoView thread


ena
:spiral_calendar_pad:  3:12 PM
heya team! seeing some timeouts on staging for ListMerchantSettlementStates , GetInstantDepositAccount , GetClearedBalanceV2 which we think might be causing some of the transfers pages to intermittently fail to load :thinkeyes: do y’all know what might be happening? :pray::skin-tone-2:
:eyes:
1




7 replies
Last reply 2 months agoView thread


kcrane
:coolfingergun:  4:13 PM
Rolling Ledger back to 53b9d0c5ab3 in staging (stable on 5/2/23); latencies are sharply elevated since the deploy last night
:+1:
1
:tybig:
1



2 replies
Last reply 2 months agoView thread


sherrywan
:bulb:  8:15 AM
Good morning Ledger team! I’m an engineer from reconciliation team, and I have a bit urgent ask around CAPITAL_CREDIT_CARD_TRANSFER event type, more specifically, the external_source_id field for them. (please see screenshot)
I realized the first row on the external_source_id is merchant_token, and the second row is a concatenation of 3 different fields: I noticed the first part is the sweep token, and can I get someone’s help on the remaining parts? what are those?
appreciate your help as we’re working on reconcile these ledger entries on our side. :thankyou-2852:
Screenshot 2023-05-05 at 7.00.56 AM.png
 
Screenshot 2023-05-05 at 7.00.56 AM.png



5 replies
Last reply 2 months agoView thread


eallar
:ooo_1:  3:43 PM
:wave: Hi all, could someone help us understand why the seller LR5MJDTNM15AK is suspected?
{
  "settlement_state": [
    {
      "merchant_token": "LR5MJDTNM15AK",
      "can_settle": false,
      "reason": [
        "SUSPECTED"
      ],
      "start_at": {
        "instant_usec": 1683324094000000,
        "timezone_offset_min": 0,
        "tz_name": [
          "UTC"
        ]
      },
      "can_debit": true,
      "linked_bank_account": true,
      "transaction_fund_id": 10
    }
  ]
}




7 replies
Last reply 2 months agoView thread


smartin
  4:14 PM
deploying be424713807 (latest) to Ledger staging


sumitg
:spiral_calendar_pad:  7:37 PM
Hi team, we are having planned outage with Barclays from 10:00 PM Eastern today to 5:00 PM Eastern May 7, this will impact GBP transfers in UK. I will post updates here if outage is extended


5 replies
Last reply 2 months agoView thread


lauraknight
:bufo-mask:  10:55 AM
:wave: i’m getting failures in dashboard staging, looks like ListPendingBalances is timing out (speleo)


ioberst
:palm_tree:  12:21 PM
ODS here. To prep for the MySQL 8.0 upgrade I will need to run a Shift request on ledger_entries to rebuild the table. We generally to these for teams but for a table of this size I wanted to double check with you guys before kicking this off.





21 replies
Last reply 2 months agoView thread


wstewart
  12:43 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-111157
(ledger @ be4247138072a7821692b9b58762d4769e130217 to production)
:approve:
1




11 replies
Last reply 2 months agoView thread


egraham
:spiral_calendar_pad:  1:15 PM
hey! Can someone help me understand why the Payments Schedule II role is included in the ledger owners group?
https://registry.sqprod.co/groups/ledger--owners
it feels like maybe it was done out of convenience at some point, but I'm not sure it makes sense today. (edited) 




8 replies
Last reply 22 days agoView thread


wstewart
  2:45 PM
deploying 1dfc31cfdeab3934a58b4a09d7d38be9808011c3 to staging


wstewart
  1:03 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-111227
(ledger @ 1dfc31cfdeab3934a58b4a09d7d38be9808011c3 to production)





18 replies
Last reply 2 months agoView thread


wstewart
  1:52 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


wstewart
  2:18 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


wstewart
  2:41 PM
Deploying 7c2dfbfbabad3d0e3ffb35d575d05efbdbfe3d1d to staging


shawnee
:dancing_pigeon:  2:49 PM
Hi team :pig-wave: Looking to get ledger over the finish line for Envoy SAFE gRPC enforcement (ROLL). It's currently in logging mode only in prod for gRPC enforcement and I'd like to enable it to 25%. Can someone confirm it's good to go for that? Best way to tell is to check for any irregularities/conflicts in these kinds of logs (1 & 2 in staging and 3 in prod) for your service.




25 replies
Last reply 2 months agoView thread


wstewart
  3:34 PM
replied to a thread:
Ledger ROLL:…
:atlassian_error: rolling back
View newer replies


olena
:ooo_1:  11:40 AM
https://jira.sqprod.co/browse/ROLL-111299
Swing payments out of US-WEST (SJC) to US-EAST (IAD) for maintenance
swing execution: May 10, 2023 at 12:00PM PT
slack thread
cc 
@oncall


olena
:thread:for swing SJC -> IAD
Thread in methods-regional-help | May 10th | View message


3 replies
Last reply 2 months agoView thread

PayswingBot
APP  12:20 PM
Pay swing has been initiated by olena with message: https://jira.sqprod.co/browse/ROLL-111299.
Evacuating payments traffic from WEST datacenters (swinging EAST) in production
**EAST** :large_green_circle: (Available): Serving new payments
**WEST** :large_orange_circle: (Degraded): NOT serving new payments


olena
:ooo_1:  1:00 PM
replied to a thread:
https://jira.sqprod.co/browse/ROLL-111299…
swing to IAD is done
:ack:
1

View newer replies


wstewart
  1:17 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-111314
(ledger @ 7c2dfbfbabad3d0e3ffb35d575d05efbdbfe3d1d to production)
:+1::+1::skin-tone-2:
5




8 replies
Last reply 2 months agoView thread


wstewart
  1:37 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


kcrane
:coolfingergun:  1:41 PM
There's an issue in Ledger (by way of Books) with an index in Spanner being re-built; this is causing a small subset of Ledger entries and their respective balances to be delayed. Once the index in spanner is rebuilt, the issue will resolve itself. Sorry about this! We're keeping an eye on it and will update here once the index is back and running. (edited) 

1 reply
2 months agoView thread

PayswingBot
APP  1:53 PM
Pay swing has been initiated by olena with message: https://jira.sqprod.co/browse/ROLL-111299.
Restoring normal payments traffic (unswinging) in production
**EAST** :large_green_circle: (Available): Serving new payments
**WEST** :large_green_circle: (Available): Serving new payments


olena
:ooo_1:  2:06 PM
replied to a thread:
https://jira.sqprod.co/browse/ROLL-111299…
unswing is done (back to normal)


wstewart
  2:18 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


egraham
:spiral_calendar_pad:  2:22 PM
replied to a thread:
hey! Can someone help me understand why the Payments Schedule II role is included in the ledger owners group?…
:bump:  bump on this -- would y'all be comfortable w/ removing the Schedule II role from the owner group? Asking as a schedule II w/ an irrational passion for registry cleanup and a low tolerance for inbox noise.
View newer replies


wstewart
  3:40 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we're out on prod
deploy checks pass


bbradley
  11:03 AM
Hi Team! Could I get a review for this Registry request and PR to grant Risk-Self-Serve access to Ledger?
We'll be using the GetPendingBalance and DeleteFreeze endpoints to help us automatically respond to Fake Account DocIDV sessions. Thanks!
:approve:
1
:thank-you1:
1




10 replies
Last reply 2 months agoView thread


olena
:ooo_1:  7:17 AM
https://jira.sqprod.co/browse/ROLL-111401
Swing payments out of US-EAST (IAD) to US-WEST (SJC) for maintenance
swing execution: May 12, 2023 at 9:30AM PT
slack thread
cc 
@oncall


olena
:thread:for swing IAD -> SJC 9:30am PT
https://jira.sqprod.co/browse/ROLL-111401 (edited) 
Thread in methods-regional-help | May 12th | View message
:doneee:
1


1 reply
2 months agoView thread


smartin
  11:16 AM
@oncall
 Looking to take over staging to test the move from sake -> gRPC, would like to leave it for a couple hours if that works


2 replies
Last reply 2 months agoView thread


smartin
  11:23 AM
Deploying 2166970e73b8 (canary) to staging


2 replies
Last reply 2 months agoView thread


wstewart
  2:41 PM
deploying 138c95ad25acbf691b51de7cfd803a5b25b211ae to staging


dberner
:spiral_calendar_pad:  10:42 PM
@oncall
 We've noticed two nights in a row ledger has stopped or slowed down polling of the /1/risk-evaluation-changes feed on magistrate for over an hour, resulting in stale risk states that take hours to recover. Are you aware of any issue?




20 replies
Last reply 2 months agoView thread


oelgabry
  7:41 AM
hi team! :wave:  I work on the Square Local Offers team (aka Cashback). It's a program where merchants offer buyers cashback earnings on their purchases. We'll be integrating with Moneysweeper to collect the cashback earnings plus a commission fee for cashback-eligible transactions.
We need to add a new LE type and Allocation type and I was wondering if there is any guide to follow. I am happy to provide more context. Here is the eng design doc. thank you so much!
G Suite Document
 

Seller Billing Eng Design - MoneySweeper
Google Doc
:checkmark:
1






39 replies
Last reply 1 month agoView thread


jzerilli
:spiral_calendar_pad:  1:24 PM
Hey team, Is it ever possible for a ledger balance to change without creating a ledger entry? I am currently looking into a reserve balance discrepancy between our service recoverytron and ledger. There is a non-zero reserve balance in our service but the ledger balance is zero. I am unable to find a ledger entry that would have set the ledger balance to zero
For more info I am looking into reserves for unit 8X25SQYWH6V6W. This unit took only 3 payments with reserves. I see 3 corresponding Risk Reserve Hold's in the ledger entries for these payments, but only 2 Risk Reserve Releases. The most recent ledger entry is from 2/15 when the risk reserve release happened for payment 2. There is nothing more recent in the ledger entry table despite something else causing the remaining $4,385 balance from payment 3 to be released.





25 replies
Last reply 2 months agoView thread


mengen
  1:35 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-111589
(ledger @ 138c95ad25acbf691b51de7cfd803a5b25b211ae to production)
:+1::+1::skin-tone-4:
7
:stamp:
1



11 replies
Last reply 2 months agoView thread


kramanathan
:spiral_calendar_pad:  1:36 PM
was added to #ledger by mengen
.


mengen
  2:01 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


mengen
  2:46 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


mengen
  4:03 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass

PayswingBot
APP  6:54 AM
Pay swing has been initiated by colten with message: Neteng maintenance https://jira.sqprod.co/browse/ROLL-111541.
Evacuating payments traffic from WEST datacenters (swinging EAST) in production
**EAST** :large_green_circle: (Available): Serving new payments
**WEST** :large_orange_circle: (Degraded): NOT serving new payments

PayswingBot
APP  7:43 AM
Pay swing has been initiated by colten with message: Neteng maintenance complete..
Restoring normal payments traffic (unswinging) in production
**EAST** :large_green_circle: (Available): Serving new payments
**WEST** :large_green_circle: (Available): Serving new payments


wstewart
  10:03 AM
@oncall
 can I take over staging for a bit?



11 replies
Last reply 2 months agoView thread


mgp
:baby:  12:37 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-111637
(ledger @ 3f1ac03225321f163ceb61ec66e7ddbc250561e7 to production)
:+1:
1


3 replies
Last reply 2 months agoView thread


mgp
:baby:  12:47 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


ena
:spiral_calendar_pad:  1:25 PM
hey team! wondering if we can get a bit more context on JP weekly settlement pipelines and when the cutoff time is - from go/settlementsschedule and from what we could see in the code, we generally have a cutoff time of 3PM for weekly settlements.
In this ONCALL ticket, we mentioned to the agent that the cutoff time was 9:20am - wondering where this timeframe came from? light tagging 
@mgp
 (but no rush) since you’ve looked at this ticket previously :blobheart:


mgp
:baby:  1:30 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


mgp
:baby:  2:33 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass
2:35
Deploying 91d2678b9cf73d23929d7548232dc2893f6b0b0f to Ledger staging


ssopp
  7:24 AM
Hey team, sorry if you get this question often but I see from the Merchant Settlement Overview that a frozen merchant should be debitable still. I have a frozen merchant I made a debit against today, but it hasn't settled yet. Do I just need to wait for the nightly settlement pipeline to run? They have Square Card, so I wasn't sure if that would complicate things.


2 replies
Last reply 2 months agoView thread


mengen
  4:44 PM
Deploying 51fcba2e1b0ca0820c4cf75c1f8c7cbbafae2b20 to Ledger staging

PayswingBot
APP  5:23 PM
Pay swing has been initiated by rafe with message: pago is struggling in iad.
Evacuating payments traffic from EAST datacenters (swinging WEST) in production
**EAST** :large_orange_circle: (Degraded): NOT serving new payments
**WEST** :large_green_circle: (Available): Serving new payments

PayswingBot
APP  8:13 PM
Pay swing has been initiated by rafe with message: Pago is no longer having issues (ALERT-12188 stable).
Restoring normal payments traffic (unswinging) in production
**EAST** :large_green_circle: (Available): Serving new payments
**WEST** :large_green_circle: (Available): Serving new payments


ishvydchenko
  10:09 AM
Hey team! Any chance we can get a ledger deploy out today (since I think it was missed yesterday)?
Context: We've started the migration for Capital to use MoneySweeper and have launched with 3 sellers this week! However, we found a settling issue and 
@mgp
 helped put out a fix for it. We would love to get this deployed today so we don't need to pause the migration



8 replies
Last reply 2 months agoView thread


mgp
:baby:  11:47 AM
Per above we’d like to deploy Ledger today since we did not deploy yesterday.
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-111783
(ledger @ 51fcba2e1b0ca0820c4cf75c1f8c7cbbafae2b20 to production) (edited) 
:+1::+1::skin-tone-2:
5





16 replies
Last reply 2 months agoView thread


mgp
:baby:  12:32 PM
replied to a thread:
Per above we’d like to deploy Ledger today since we did not deploy yesterday.…
staging checks pass
:canary: canary start
:crossed_fingers:
1

View newer replies


alim
:no_entry:  12:42 PM
hi team! i'm not sure if im in the right channel (apologies in advance if not.) i have a seller who has multiple square accounts with us and is having trouble identifying which square account/location we are trying to debit for SaaS costs. Is there anyway to look up a "TXXXXXX ID" if i provide those #'s?


2 replies
Last reply 2 months agoView thread


vlong
  1:09 PM
replied to a thread:
:wave: Hello, we’re reaching out because your service ledger uses Envoy Logging (go/envoylogging) to log information about API Velocity endpoints. Envoy Logging is supported by our service api-observe, which your service’s Envoy sidecar asynchronously sends information to. Historically, api-observe has used endpoints_set.go to know which endpoints need to be logged and obtain information about those endpoints.…
Things have looked good so far in staging, and we haven’t seen any diffs in production for ledger. We’re going to go ahead and flip the flag in production/sandbox to switch over to the schema implementation.
View newer replies


mgp
:baby:  1:14 PM
replied to a thread:
Per above we’d like to deploy Ledger today since we did not deploy yesterday.…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


mgp
:baby:  2:34 PM
replied to a thread:
Per above we’d like to deploy Ledger today since we did not deploy yesterday.…
:shipitparrot: we’re out on prod
deploy checks pass


carol
:spiral_calendar_pad:  10:53 AM
Hi Ledger friends, requesting snowflake access :thank: https://registry.sqprod.co/access_requests/341196
:stamp:
1
:thanku:
1



ssopp
  11:40 AM
@oncall
 Hey team, Capital is experiencing high delay for assessments and I'm less familiar with Ledger's dashboards after the migration to Datadog. Can you confirm if Ledger's consumption of CapitalEventFeedEntries is stable/normal?
(our dashboards show lag rising steadily starting at noon)
:following:
1
:eyes:
1





7 replies
Last reply 2 months agoView thread


sbrown
:spiral_calendar_pad:  12:03 PM
:ablobwave: Hello! Not sure if this is the right place to ask, but is there any documentation on ledger.raw_feeds.merchant_settlement_state?
Looking for some information on the difference between cansettle,  candebit, and reason


2 replies
Last reply 2 months agoView thread


tochi
  12:42 PM
Hey 
@oncall
, quick question, is there any way we can see the rate of Ledger entry creation? We're wondering if there was a spike in the number entries created some time within the past 3 - 4 hours.
:checkmark:
1



2 replies
Last reply 2 months agoView thread


sarve
  4:02 PM
Deploying a7dcff89-b852-4868-9a1c-0e2683dd355b to Ledger staging
:celeryman3:
1



mgp
:baby:  5:20 PM
Deploying a9afd265748e0d81c73b6c06dabdb3b1e1e4a195 to Ledger staging


minghua
:bulb:  12:43 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-112010
(`ledger` @ a9afd265748e0d81c73b6c06dabdb3b1e1e4a195 to production)
:stamp3:
1
:+1:
3


6 replies
Last reply 2 months agoView thread


minghua
:bulb:  1:18 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


songye
:fine:  1:39 PM
:wave:  I am from #cards-api and trying to understand a ledger ConfirmInstrument call. In this trace there is a lot of requests from ledge to instrument.ConfirmInstrument. Wondering are they synchronous sequential calls based on a batch, or just happened to be grouped under same trace id?
:thanks:
1
:checkmark:
1



14 replies
Last reply 2 months agoView thread


minghua
:bulb:  1:53 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


minghua
:bulb:  3:05 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass
:bless-frog:
1



conner
  11:25 AM
Hi! Would ledger oncall be able to help us run the script related to this  (ALERT-11904) tomorrow? We'll have a google sheet with a merchant token and amount to credit.  cc 
@hoyi
 who already has context


conner
hi 
@oncall
! the SaaS team is working on remediation for a SEV, and there's a chance we'll need to credit merchants money if their original payment method isn't viable for a refund.
the marketing team pointed us to this doc, outlining a potential credit process.
we have some questions related to this -- could you or someone on your team please join #alert-11904_bills_are_generated_for_canceled_free-trial_postpay_saas?
Thread in ledger | Apr 11th | View message
:checkmark:
1



2 replies
Last reply 2 months agoView thread


minghua
:bulb:  3:02 PM
Deploying ledger staging on a0979afc3c07daebda9e7036fab5e21a04d8de79


minghua
:bulb:  1:09 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-112113
(`ledger` @ `a0979afc3c07daebda9e7036fab5e21a04d8de79` to *production*)


6 replies
Last reply 2 months agoView thread


minghua
:bulb:  1:54 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


seung
:california:  3:02 PM
hi, for ListMerchantSettlementStatesResponse, if the can_debit field is true will linked_bank_account always be true too?
:checkmark:
1



2 replies
Last reply 2 months agoView thread


minghua
:bulb:  3:26 PM
Deploying ledger staging on 8bbce9b24a5cd916f4997a9cce279012f7467348


minghua
:bulb:  4:14 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass


jengel
:spiral_calendar_pad:  7:06 AM
Hey Team, my team consumes from the MerchantSettlementState feed and then stores a local replica of the data. It then queries the local replica to get a list of reasons for a unitToken. Would calling ledger listMerchantSettlementStates rpc yield the same result?
:eyes:
1



2 replies
Last reply 2 months agoView thread


agajardo
:spiral_calendar_pad:  7:37 AM
Question about freezes: What happens if freeze is called on a unit that is already frozen? Does the call return an error or does it just succeed?
:checkmark:
1




10 replies
Last reply 1 month agoView thread


harryw
:speech_balloon:  11:58 AM
was added to #ledger by cpopescu
.


emilyl
  12:19 PM
deploying 71123d41780 to staging


ashleychen
  2:53 PM
@oncall
 list

1 reply
2 months agoView thread


mgp
:baby:  2:57 PM
Deploying a7d5e649263f3a4464418b6cc9bcf6f156c659c7 to Ledger staging


minghua
:bulb:  8:11 AM
:info: No deployments today


oliviazhang
:spiral_calendar_pad:  1:57 PM
Hi all, the $45k loss still shows on ACH for this seller regardless this money has been refunded, do you know when ledger balance will update so this loss will be removed?
Thank you!




18 replies
Last reply 1 month agoView thread


minghua
:bulb:  2:33 PM
deploying 22b2b9799248a6435af13c502ae04528c5efe901 to staging


songlin
  1:37 PM
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-112286
(ledger @ c496f073728d682e662296f344c9151f4a5523f9 to production)
:+1:
4




7 replies
Last reply 1 month agoView thread


songlin
  1:47 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-112286…
staging checks pass
:canary: canary start
View newer replies


songlin
  2:27 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-112286…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


songlin
  2:46 PM
deploying 25965c7e81dd097ce2ba0bddc8b942c35f03f2df to staging (edited) 


songlin
  3:28 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-112286…
:shipitparrot: we're out on prod
deploy checks pass
:celeryman3:
1



ryohei
  12:24 AM
Hello team sorry if this is wrong channel but hope it is correct!
When payments are captured, is captured_at field that Square checks to determine to make a deposit in the next business day or the day after the next day?
The JP doc says a payment is sent to bank accounts the next business day if customers use Mitsui Sumitomo Bank and Mizuho Bank accounts. For the other types of accounts, it is the day after the next day. A JP partner wants to make sure that Square checks captured_at to determine the timing.
For Mitsui Sumitomo Bank and Mizuho Bank accounts, if captured_at is between 00:00 and 23:59 , it will be the next day. There will never be the day after the next day
For other bank accounts, if captured_at is between 00:00 and 23:59 , it will be the day after the next day
Thank you in advance!
:eyes:
1



13 replies
Last reply 5 days agoView thread


klachance
:no_entry:  6:51 AM
Hey team, we're getting a question from audit for a completeness check with ledger data. Would it be appropriate to directly query the ledger production database and compare it with snowflake data?
cc: 
@mmargenot
:eyes:
1



4 replies
Last reply 1 month agoView thread


mmargenot
:no_entry:  6:51 AM
was added to #ledger by klachance
.


brentw
:spiral_calendar_pad:  8:54 AM
Hey Ledger team, please hold off on merging changes to ledger today until we can verify that no emergency changes need to be made to mitigate the JPMC issues from last night. Thanks! cc: 
@oncall



4 replies
Last reply 1 month agoView thread


mgp
:baby:  11:02 AM
@oncall
 can I deploy a canary build to Ledger staging? I just need to test something for 5 minutes and then I can put it back



5 replies
Last reply 1 month agoView thread


songlin
  12:56 PM
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-112347
(ledger @ 25965c7e81dd097ce2ba0bddc8b942c35f03f2df to production)

5 replies
Last reply 1 month agoView thread


songlin
  1:08 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-112347…
staging checks pass
:canary: canary start
View newer replies


songlin
  2:19 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-112347…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


songlin
  2:25 PM
deploying 8628d131ccec33fae9ce0e0c05bef37afaa45c1e to staging


songlin
  3:26 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-112347…
:shipitparrot: we're out on prod
deploy checks pass


mgp
:baby:  3:52 PM
@oncall
 can I deploy another canary build to staging?



4 replies
Last reply 1 month agoView thread

ODS Insights
APP  5:15 PM
This is a monthly reminder from ODS. Databases for one or more apps associated with this Slack channel (#ledger) have Best Practices issues. Review the issues in the databases/best-practices screen in Square Console.
https://square-console.sqprod.co/app/ledger/databases/best-practices (1361 cases)
See https://wiki.sqprod.co/display/ProdEng/ODS+Insights+MySQL+Best+Practices for explanations of issue types.

1 reply
1 month agoView thread


songlin
  3:05 PM
deploying c2f643f4be3df3e31439568cbf94f587b4dd4031 to staging

PayswingBot
APP  10:20 AM
Pay swing has been initiated by kumar with message: East is down for v2/payments.
Evacuating payments traffic from EAST datacenters (swinging WEST) in production
:large_orange_circle: (Degraded) EAST: NOT serving new payments
:large_green_circle: (Available) WEST: Serving new payments


cqin
:spiral_calendar_pad:  11:02 AM
Hi team, repost an oncall question here. Could someone help me to understand this please? Thank you:blobheart:


cqin
Hi team, could someone look at this oncall ticket please? The seller has a refund on 5/10, however, Ledger did not debit seller’s checking balance. Does anyone have ideas on why not debit? Thank you :blobheart:
Thread in banking-services | Jun 2nd | View message
:eyes:
1






5 replies
Last reply 1 month agoView thread

PayswingBot
APP  11:06 AM
Pay swing has been initiated by kumar with message: Preceding SEV is stable. Normalizing traffic..
Restoring normal payments traffic (unswinging) in production
:large_green_circle: (Available) EAST: Serving new payments
:large_green_circle: (Available) WEST: Serving new payments


zifan
:spiral_calendar_pad:  1:03 PM
:bufo-wave: Hi team, heads up - there will be a planned outage from Barclays FileGateway between 02:45 and 15:30 BST on June 11th (Jun 10 6:45 PM - Jun 11 3:00 AM PST). cc 
@oncall

1 reply
1 month agoView thread


bjoseph
  2:49 PM
deploying latest 0b708b52701cbcee7d6a3a6a47b05b431cd99254 to staging


sherrywan
:bulb:  11:11 AM
:high-five-front: Heyo ledger team! May I ask some details around the external_source_id field for the moneysweeper transferred ledger entries - what are each sub-part of the entire id (since it is an array of strings? please see screenshot).
I assume the first part is merchant_token, what about the second part?
This is pretty important & urgent for us (reconciliation team) since we need this information to compare / join with bankc tables. Thanks!!!
Screenshot 2023-06-04 at 11.06.08 PM.png
 
Screenshot 2023-06-04 at 11.06.08 PM.png


6 replies
Last reply 1 month agoView thread

PayswingBot
APP  11:54 AM
Pay swing has been initiated by lieberman with message: ZK instability.
Evacuating payments traffic from EAST datacenters (swinging WEST) in production
:large_orange_circle: (Degraded) EAST: NOT serving new payments
:large_green_circle: (Available) WEST: Serving new payments


hoyi
  12:53 PM
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-112580
(ledger @ 0b708b52701 to production)
:+1::+1::skin-tone-2:
4



4 replies
Last reply 1 month agoView thread


hoyi
  1:13 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-112580…
staging checks pass
:chocobo-face: canary start
View newer replies


hoyi
  1:42 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-112580…
canary deploy checks pass
:rolling_kirby: rolling forward

PayswingBot
APP  1:51 PM
Pay swing has been initiated by lieberman with message: ZK issues are resolved.
Restoring normal payments traffic (unswinging) in production
:large_green_circle: (Available) EAST: Serving new payments
:large_green_circle: (Available) WEST: Serving new payments


tmahoney
  3:18 PM
:wave:
hey folks, last week I noticed that refundsarbiter-staging has been getting pretty badly clogged with refunds that never approve until they eventually expire. the acceptance tests themselves don’t “care” (they’re Pago-oriented so they’re just exercising, like, “can I create this refund?), but it does create some concern that our async refund approval paths aren’t getting sufficiently exercised in staging. so I’ve been digging into why our staging refunds so rarely get approved.
what I’m seeing is that RefundsArbiter never sees a settled Ledger entry. I think this is one of those places where Ledger actually owns some Risk-oriented logic around settlement state, maybe? my conjecture here might not be particularly helpful, but basically I see:
1) this yellow banner in Regulator for our primary staging unit: https://regulator.stage.sqprod.co/n/users/P3CCK6HSNDAS7
2) that RefundsArbiter is never seeing a settled Ledger entry
and I suspect the two are related. would just like to better understand what happens here, and how we can avoid it (and/or self-serve fixing it in the future so that acceptance-test staging data doesn’t get clogged up like this). appreciate any advice y’all can give :bless:



23 replies
Last reply 1 month agoView thread


minghua
:bulb:  7:15 AM
forgot to mention, but staging at d1217aba440b0ac65641a0ca74f4d6a608bc86f8 deployed yesterday evening

2 replies
Last reply 1 month agoView thread


mnovich
  11:09 AM
@oncall
 did we deploy anything to staging?
Triggered: [SQUARE][payouts-engineering][ledger]: System Status Checks Errors on check:pipeline-complete-fr_barclays_dry_run,env:staging,region:iad3a
System check metric pipeline-complete-fr_barclays_dry_run has high errors in staging
 @slack-payouts-alerts-dd-nonprod
min(last_5m): max:server.system_status.errors{service:ledger AND (env:production OR env:staging) AND region IN (*) AND check IN (*) AND check NOT IN (all) AND check:pipeline-* AND NOT check:*usd_return_chase AND NOT check:*cad_return_chase AND NOT check:*aud_return_chase AND NOT check:*jpy_return_smbc AND NOT check:*usd_return_wells_platform AND NOT check:*usd_return_celtic AND NOT check:*gbp_barclays_psr AND NOT check:*sepa_barclays_psr AND NOT check:*deprecated_fr_barclays AND NOT check:*zengin_settlement_dry_run_weekday AND NOT check:*zengin_settlement_weekday AND NOT check… Show more (10 kB)
Tags
check:pipeline-complete-fr_barclays_dry_run, env:staging, region:iad3a
Notified
@slack-payouts-alerts-dd-nonprod
https://square.datadoghq.com/monitors/105316571?group=check%3Apipeline-complete-fr_barclays_dry_run%2Cenv%3Astaging%2Cregion%3Aiad3a&from_ts=1686073031000&to_ts=1686074231000

:eyes:
1





15 replies
Last reply 1 month agoView thread


acastberg
  11:49 AM
:helloblob: hello from transfers, we see a few Canadian sellers (ex: LHP1ZZDGEZBXF) that are publishing AutoInstantTransferEvents that are consumed by deposits and failing to send since this path is only supported for US and AU.
We do also see that the sellers has the same day transfer setting enabled in dashboard but we aren't sure how they got to this state as we can't replicate this with other accounts so we think this is back-end driven.
Would anyone here be able to help figure out why this is happening? :pray: (edited) 



17 replies
Last reply 1 month agoView thread


lmancini
:blue_car:  1:56 PM
it looks like my production account LA6K6BJCJMEZH
has some ledger entries that are not settling? what are the recommended next steps for something like this? happy to provide more info if necessary
https://square.slack.com/archives/C0320QG19R9/p1686078515164759


lmancini
I just signed up for a Square Checking account in prod and then my balance was immediately reduced? I’ve never transferred any money out of this Square account so pretty confused as to what is happening with the balance? is it related to the review that looks like is indicated on the Balance page?
2 files
 
image.png
image.png
Thread in checking | Jun 6th | View message



7 replies
Last reply 1 month agoView thread


hoyi
  4:23 PM
Deploying latest (af2d6a78e71) to staging


tornubari
  5:17 PM
Hi Ledger,
I'm not certain if this is the appropriate channel for escalating this matter, but I have a merchant who experienced 27 dispute reversals from the same buyer that are two months old now. However, the funds have not appeared in the merchant's ledger. I'm wondering if there is a way for us to confirm whether these funds have been returned to Square from the buyer's bank?


3 replies
Last reply 1 month agoView thread


hoyi
  12:46 PM
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-112729
(ledger @ af2d6a78e71 to production)



6 replies
Last reply 1 month agoView thread


hoyi
  1:18 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-112729…
staging checks pass
:chocobo-face: canary start
View newer replies


irisd
:spiral_calendar_pad:  1:46 PM
Hi team :wave: I'm wondering if I can get a stamp from someone on this team to transfer the owner of the Wells GPG keys from ledger to teller?


cfu
:wave:  Hi 
@irisd
 I see that you are on the team that owns teller. Before we execute this request can we also get someone from the ledger team to comment here as a :stamp: for this request. Thank you!
From a thread in data-security-eng | Jun 7th | View reply
:stamp:
1



hoyi
  1:56 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-112729…
canary deploy checks pass
:rolling_kirby: rolling forward


robing
  5:09 PM
Hi everyone, I am interested on learning more about the Ledger feeds for freezes and payment holds. I am planning to consume them and would like to know some details about them, could you point me to the right point of contact for asking questions? Thank you!



36 replies
Last reply 4 days agoView thread


jcook
:spiral_calendar_pad:  5:48 PM
replied to a thread:
Hey Ledger team :wave: What are the merchant settlement states for L8X76D50F0AVT in staging? @justinroberts are puzzled as to why we are receiving NO_VERIFIED_BANK_ACCOUNT despite the seller having a linked bank account as per the linked bank accounts in regulator.…
Hey, seeing the same issue today with units L5M5SS89AR9XA and LFWDDW942MHNT.
View newer replies


janis
  4:06 AM
hello! i see a few UK sellers with a positive ledger balance and open chargebacks but the pending_balance_snapshots table is not updated with dispute cents. could you have a look why?  https://regulator.sqprod.co/n/users/LWJF3E8Z11Q14?section=ledger-entries thank you
select *
from ledger.ledger__ledger_production.pending_balance_snapshots
where merchant_token = 'LWJF3E8Z11Q14';

1 reply
1 month agoView thread


chrischiu
:spiral_calendar_pad:  8:20 AM
Hi 
@oncall
 I have a canary that I wanted to deploy to staging to test the feedetail that is being passed from feeplans to ledger. Could you help me deploy this sha 1466771 from this PR ? cc: 
@bjoseph
 (edited) 





+1
19 replies
Last reply 1 month agoView thread


bjoseph
  9:02 AM
replied to a thread:
Hi @oncall I have a canary that I wanted to deploy to staging to test the feedetail that is being passed from feeplans to ledger. Could you help me deploy this sha 1466771 from this PR ? cc: @bjoseph
deploying canary 1466771e4609ad52a313c3304288703415f128d5  to staging
View newer replies


bjoseph
  9:40 AM
replied to a thread:
Hi @oncall I have a canary that I wanted to deploy to staging to test the feedetail that is being passed from feeplans to ledger. Could you help me deploy this sha 1466771 from this PR ? cc: @bjoseph
deploying latest 78a86316b280a7397961420d92f8659676056df5  to staging
View newer replies


bji
  10:41 AM
How does ledger handle storing Japanese yen values? Is there any type of conversion to a concept of cents?


3 replies
Last reply 1 month agoView thread


robing
  10:45 AM
replied to a thread:
Hi everyone, I am interested on learning more about the Ledger feeds for freezes and payment holds. I am planning to consume them and would like to know some details about them, could you point me to the right point of contact for asking questions? Thank you!
Hi Daniel, I am working on a service that aggregates multiple feeds to understand why certain events happened based on context. I am interested on consuming the LedgerFreezes and LedgerHolds feeds to see their events and relate them to SSP actions on Risk. I'm wondering, how immediately do events get produced in those feeds? e.g. how fast would a freeze appear on the feed after it was applied by an operator?
View newer replies


jmao
  6:35 PM
Hi :wave:, Recon is currently seeing the following error when loading Ledger bank settlement entries from gs://sq-ledger-prod-bank-settlement-entries/feeds/1/bank-settlement-entries/4/proto-converted/YYYY-MM-DD/*.avro :
Error while reading data, error message: The Apache Avro library failed to read data with the following error: Cannot resolve: { "type": "enum", "namespace": "com.squareup.protos.paymentbalances.Model_PaymentBalanceAccount_", "name": "AccountType", "symbols": [ "ACCOUNT_TYPE_UNKNOWN_DO_NOT_USE", "FEE", "RISK_RESERVE", "PAYABLE" ] } with [ "null", { "type": "enum", "namespace": "com.squareup.protos.paymentbalances.ModelProtos_PaymentBalanceAccount_", "name": "AccountType", "symbols": [ "ACCOUNT_TYPE_UNKNOWN_DO_NOT_USE", "FEE", "RISK_RESERVE", "PAYABLE" ] } ] File: bigstore/sq-ledger-prod-bank-settlement-entries/feeds/1/bank-settlement-entries/4/proto-converted/2023-06-06/01/bGVkZ2VyLWFjaDoyMTk1NjExNzEx_2.avro
Was there a schema change recently? 
@mgp
 maybe related to https://github.com/squareup/java/pull/284422 ?




6 replies
Last reply 1 month agoView thread


emilyl
  2:39 PM
deploying b30e0d6c908 to staging


emilyl
  1:10 PM
:info: ledger staging will see interruptions to connections for awhile while a shift is running
:done:
1



emilyl
  1:49 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-112927
(ledger @ b30e0d6c9080f53bacafed8cf45bfa6216ee81cd to production)
:+1:
5




7 replies
Last reply 1 month agoView thread


emilyl
  1:59 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


emilyl
  2:34 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


emilyl
  3:11 PM
deploying f575557f460 (latest) to staging


emilyl
  3:43 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass


nirmit
:spiral_calendar_pad:  10:50 AM
Hey team :wave:  - looking at https://jira.sqprod.co/browse/ONCALL-150878. We (
@ahdoot
 and myself) have tried to understand what's going on and we reasoned it down to this:
Ledger balance: +216
2. Square Card: 216, Ledger balance: 0
3. Ledger balance: -225, Square Card: 216
4. Ledger Balance: -9, Square Card: 0
5. Ledger Balance: 216, Square Card: 0 refund canceled
6. Ledger balance: -9, Square Card: 225
if that looks right, can yall confirm if the debits for the merchant's accounts are in the right state and/or there werent extra debits? (edited) 
:checkmark:
1



3 replies
Last reply 1 month agoView thread


reilly
:headphones:  12:39 PM
Hi team :wave:, I'm seeing some unexpected results from the Ledger list_ledger_entries RPC. I am querying this endpoint for the production unit G9W0KNK240V6F  with a lookup created_at_interval of the last week, but I don't see any results even though the merchant has ledger entries that have been created in the last month. I would expect these to be returned by the query https://regulator.sqprod.co/n/users/G9W0KNK240V6F?section=ledger-entries
:eyes:
1
:checkmark:
1



5 replies
Last reply 1 month agoView thread


emilyl
  1:07 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-113007
(ledger @ f575557f4606dd05e5978bea1bf31a4927ec0606 to production)
:+1:
2




9 replies
Last reply 1 month agoView thread


emilyl
  1:12 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


emilyl
  1:51 PM
replied to a thread:
Ledger ROLL:…
a node in sjc2b is unknown, which will block the roll forward. Going to roll back canary, rotate the unknown node out, and attempt canary again
View newer replies


emilyl
  2:19 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


emilyl
  2:35 PM
deploying eff0f6b5412 (latest) to staging
:squirtle-happy-tears:
1


1 reply
1 month agoView thread


emilyl
  3:38 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass


skhan
  8:51 AM
Hey :wave: from the #seller-branding-team! We are building a new Seller Brand API (design doc) that will be responsible for storing brand-related information. As part of this effort, brand-related data and client calls will be migrated from Roster to Seller Brand API.
Your team is responsible for one or more services (ledger) that are dependent on Roster and may be impacted by this migration. We want to make this migration as straightforward as possible and to provide clear guidance for our upcoming AP asks. Please take a few minutes to update the highlighted columns in our tracking spreadsheet for each of these services: go/seller-brand-migration-audit
:thankyou:
mwatts
 | G Suite Spreadsheet
 

Brand Dependency Audit (go/seller-brand-migration-audit)
Google Sheet
:eyes:
1
:checkmark:
1



venkata
  11:12 AM
Hi team :wave:, we have a merchant (unit) with a square card and this refund is unsettled, which is causing some downstream issues for capital. Is there a reason why the refund is unsettled and possible to settle it?
:checkmark:
1


1 reply
1 month agoView thread


emilyl
  12:42 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-113069
(ledger @ eff0f6b54122160b0dd464e7fee8f9460b817920 to production)
:+1::+1::skin-tone-3:
5
:pleasecat:
1






+3
15 replies
Last reply 30 days agoView thread


moshe
  12:45 PM
was added to #ledger by emilyl
.


bta
  12:51 PM
Taking over staging for a bit with 09aec56540eca1659b78930ffdeb954f5a80ca78





13 replies
Last reply 29 days agoView thread


emilyl
  1:16 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


emilyl
  1:39 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


bta
  2:13 PM
replied to a thread:
Taking over staging for a bit with 09aec56540eca1659b78930ffdeb954f5a80ca78
Deploying canary ae197088d720cdc4f4ba0041ef7afaf3276fae70 to ledger staging
View newer replies


emilyl
  2:39 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass


emilyl
  3:16 PM
deploying 0f690a984f3 (latest) to staging


mgp
:baby:  4:07 PM
@oncall
 running PopulatePartyAtFaultBackfila on ledger staging in dry run mode
:ack:
1



4 replies
Last reply 30 days agoView thread


nickbui
:ooo_1:  8:36 AM
@oncall
 Could I get this sha ae197088d720cdc4f4ba0041ef7afaf3276fae70 as a canary again? :ty2:



11 replies
Last reply 29 days agoView thread


ahdoot
:spiral_calendar_pad:  8:58 AM
hey 
@oncall
, not urgent b/c it’s in staging, but we’ve been noticing a lot of callouts from RefundsArbiter to Ledger’s LedgerService timing out recently in staging. Is something going on?
I’m noticing what looks like a big increase in Missed Deadlines to the LedgerService starting about a month 2 weeks ago (graph). (edited) 





10 replies
Last reply 29 days agoView thread


nickbui
:ooo_1:  9:21 AM
replied to a thread:
@oncall Could I get this sha ae197088d720cdc4f4ba0041ef7afaf3276fae70 as a canary again? :ty2:
@oncall
 my new sha to canary is: 0ae94adda94c249822769748525d1806a6b5abe5
:ack:
1
:ty2:
1

View newer replies


bta
  9:23 AM
replied to a thread:
@oncall Could I get this sha ae197088d720cdc4f4ba0041ef7afaf3276fae70 as a canary again? :ty2:
Taking over ledger staging with 0ae94adda94c249822769748525d1806a6b5abe5
View newer replies


estanfill
:spiral_calendar_pad:  9:33 AM
Hi! I’m the EM for Refunds API and we have been asked a question about transfers and refunds that I would appreciate your take on: https://square.slack.com/archives/C020XT0B9A9/p1686846690699649


estanfill
Our current CS guidance for refund cancellations has advocates do the followiing:
 locate the refund
 If the refund is “completed”, we cannot reject the refund.
 If the refund is still in “Pending” status, go to the Inbound Transfers section of Regulator.
 If there is an Inbound Transfer already initiated that contains the refund, the guidance says we cannot reject it.
Show more
Posted in refunds-api-help | Jun 15th | View message


kacie
:kermit-typing-working-like-crazy:  10:04 AM
Hi folks! I have a Strat Seller who is having issues with their bank account coming unlinked. I see several successful and several failed deposits to their bank account ending in 708 (most recent deposits have been successful) and see the reason for the fail on the failed deposits being "Credit Entry Refused by Receiver"
The seller has provided Square's ACH number or Origin IDs and spoke to Chase. Chase is saying the issue "is not on their side" and I'm really not sure where to go form here - any idea why this is happening or how we can ensure the bank account successfully stays linked?
This seller has 3 locations using the same bank account at which all the bank account has now become unlinked.
TAJR0D364WAB6
FZ7TM7Q08N4M3
LXBBZJ9FF1MEW


2 replies
Last reply 29 days agoView thread


gianni
  1:53 PM
was added to #ledger by kacie
.


emilyl
  3:26 PM
deploying 20f86a489475e4578433f2d46ca8aa45ab29a68d to staging


tal
:no_entry:  3:35 PM
hey team :ablobwave: we're seeing some timeout issues in deposits staging when calling Ledger endpoints (eg: GetDepositSchedule, GetInstantDepositAccount) that started around 12:30pm PT on June 12th. we aren't seeing anything in deposits that lines up with this timeline and saw some changes in #payment-balances-robots around that time. can you think of anything that happened that could cause these errors? cc 
@oncall





+2
27 replies
Last reply 22 days agoView thread


ahdoot
:spiral_calendar_pad:  7:41 AM
:wave: , can I get a review on this PR to add a metric to Ledger when y’all get the chance? I’ve provided context in the description, but happy to answer other questions. cc: 
@dskarbek
 (edited) 


2 replies
Last reply 24 days agoView thread


emilyl
  3:14 PM
deploying 08bff3483ec (latest) to staging


rohitdinakar
:spiral_calendar_pad:  12:58 PM
@oncall
 FYI, payment capture risk evaluations are happening via backstop since 11:57 AM PST due to a beacon redis lag issue. Fix is being deployed on the beacon side. spot checking the 15 min stale payments,  they seem to be >$1000 and backstop is keeping up with the evaluation volume for now for the sub-$1000 payments. cc 
@aackerman


chansen
Hey 
@zhonglin
 - anything I can do to help out? (I'm on fraud risk, we rely on beacon/RA for a bunch of event evals and are seeing a bunch of errors/issues on our side as well -> #fraud-eng-oncall)
Thread in beacon-dumbo-oncall | Jun 17th | View message


2 replies
Last reply 27 days agoView thread


klachance
:no_entry:  10:11 AM
Hey Team, I'm looking at a seller that has 11 chargebacks but not every chargeback has an open_dispute ledger entry so the disputed_amount_cents from the pending balance table doesn't line up with the total disputed amount. I would expect we would create a ledger entry for each new dispute to hold the funds which is typically what I see. Why is there no ledge entries for some but there is for others? Is there specific ledger entry logic that affects whether a open_dispute entry is created or not? I would expect the disputed_amount_cents to equal the total chargeback amount. We use the disputed_amount_cents as part of our recoveries calculation that we use to determine loss so this affects our overall loss amounts. Thanks cc: 
@mmargenot
https://regulator.sqprod.co/n/users/02EPE74JT17SH?section=transfers
select pbs.merchant_token
    ,pbs.currency_code
    ,pbs.next_deposit_amount_cents
    ,pbs.outstanding_amount_cents
    ,pbs.disputed_amount_cents
    ,pbs.non_expiring_hold_amount_cents
from ledger.ledger__ledger_production.pending_balance_snapshots pbs
where merchant_token = '02EPE74JT17SH'

SELECT merchant_token
    ,dense_rank() over(partition by merchant_token order by payment_token) num
    ,payment_token
    ,external_source_name
    ,entry_type
    ,to_user_amount_base
    ,to_user_amount_currency_code
FROM ledger.raw_feeds.ledger_entry le
WHERE merchant_token = '02EPE74JT17SH'
AND entry_type in ('OPEN_DISPUTE', 'RESOLVED_DISPUTE', 'DISPUTE_ADJUSTMENT')
ORDER BY 3,5
(edited)





+2
18 replies
Last reply 7 days agoView thread


hoyi
  4:25 PM
Deploying latest (03c0bffca96) to staging


ewalls
  7:50 AM
Hi Ledger team, I have a couple of questions about some LedgerEntries I'm seeing in Regulator. We were paged a couple of times for Issue encountered processing Ledger failure but I'm confused because it looks like they settled. However, I don't see a linked payment token for either.
For this unit, the LE created on 6/13/23 at 1:59pm EDT corresponds to a pending payment txn which is still pending. Why is it showing up as settled in Regulator, and why is there no linked payment token?
For this unit, the LE created on 5/25/23 at 2:08pm EDT corresponds to a pending payment txn which has been marked as succeeded. Why does it not have a linked payment token?


3 replies
Last reply 24 days agoView thread


ahdoot
:spiral_calendar_pad:  9:08 AM
replied to a thread:
:wave: , can I get a review on this PR to add a metric to Ledger when y’all get the chance? I’ve provided context in the description, but happy to answer other questions. cc: @dskarbek
Friendly :bump-thread:  on this when y’all get the chance
View newer replies


montemisa
  10:54 AM
Hello friends! I am with the reconciliation team and we consume the BankSettlementReturns feed through cloud persister. There has not been any data since 6/12. Is that expected?
accounts.google.comaccounts.google.com
Google Cloud Platform
Google Cloud Platform lets you build, deploy, and scale applications, websites, and services on the same infrastructure as Google.



5 replies
Last reply 24 days agoView thread


nickbui
:ooo_1:  12:38 PM
Could I have 
@oncall
 canary d0484a4a613504becf45b9c278d712c2000a7c08 to ledger in staging?
:ack:
1
:ty2:
1




3 replies
Last reply 24 days agoView thread


kcrane
:coolfingergun:  12:45 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-113292
(ledger @ 03c0bffca96 to production)
:+1::+1::skin-tone-2:
5


4 replies
Last reply 24 days agoView thread


kcrane
:coolfingergun:  1:03 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


kcrane
:coolfingergun:  1:31 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


skaltenbach
  2:45 PM
replied to a thread:
Hello friends! I am with the reconciliation team and we consume the BankSettlementReturns feed through cloud persister. There has not been any data since 6/12. Is that expected?
I am seeing an error in presidio for cloud-persister :
BankSettlementReturn has unknown fields [10]
when consuming this feed.
a new field was recently added to the BankSettlementReturn proto here with the number value 10, so I think cloud-persister may need to be restarted to pick up the change? cc 
@oncall
:this3:
1

View newer replies

PayswingBot
APP  3:00 PM
Pay swing has been initiated by markb with message: ROLL-113099 - neteng JPMC VPN work.
Evacuating payments traffic from EAST datacenters (swinging WEST) in production
:large_orange_circle: (Degraded) EAST: NOT serving new payments
:large_green_circle: (Available) WEST: Serving new payments


kcrane
:coolfingergun:  3:12 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we're out on prod
deploy checks pass


nickbui
:ooo_1:  3:15 PM
Could I get a review here? https://github.com/squareup/java/pull/286002 The current approval is from the #transfers side and is effectively sign off from them agreeing that the changes/intent looks good.
#286002 [ACCOUNTS-3659] Add new condition that can result in skipping email verification
This work supports the Step Up Authentication Pilot (https://docs.google.com/document/d/1oaebZSZd8aTYASGktxuC4jB3H_bHxrhj7tK2SV-aaZE/edit?pli=1#heading=h.ixzozqqgkxlh).
If you aren't familiar with the pilot, feel free to connect with me via Slack / Meets to get some context.
This PR follows this PR. It reads the new field of stepUpAuthenticationSatisfied and includes it in the criteria for skipping email verification.
Labels
accounting-engineering
Comments
5
<https://github.com/squareup/java|squareup/java>squareup/java | May 4th | Added by GitHub

2 replies
Last reply 23 days agoView thread


kcrane
:coolfingergun:  3:22 PM
Deploying latest (0ee165a6c0f) to staging

PayswingBot
APP  4:02 PM
Pay swing has been initiated by markb with message: ROLL-113099 restoring normal traffic.
Restoring normal payments traffic (unswinging) in production
:large_green_circle: (Available) EAST: Serving new payments
:large_green_circle: (Available) WEST: Serving new payments


aackerman
  5:27 PM
Hi 
@oncall
, have a non urgent issue that I wanted to drop a note in here




8 replies
Last reply 23 days agoView thread


nickbui
:ooo_1:  6:52 AM
replied to a thread:
Could I get a review here? https://github.com/squareup/java/pull/286002 The current approval is from the #transfers side and is effectively sign off from them agreeing that the changes/intent looks good.
Bump. Looking for a review from paybal
View newer replies


egraham
:spiral_calendar_pad:  7:11 AM
replied to a thread:
hey! Can someone help me understand why the Payments Schedule II role is included in the ledger owners group?…
:bump:  seems like folks are in agreement. any true Ledger owners comfortable making the actual change? (Doesn't feel quite right for me to modify permissions as a faux owner).
View newer replies


ewalls
  12:04 PM
ServRec has been seeing 500s from Squareup::Ledger::Service::LedgerService#list_ledger_entries over the past hour. Is there something happening with Ledger right now?
Sq::Protos::RpcClient::SakeError
Squareup::Ledger::Service::LedgerService#list_ledger_entries received status 500 with error
CAPITAL-1A5CCAPITAL-1A5C | Jun 21st | Added by Sentry
Select Assignee...


11 replies
Last reply 23 days agoView thread


kcrane
:coolfingergun:  12:32 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-113350
(ledger @ 0ee165a6 to production)
:+1:
2
:stamp3:
1


4 replies
Last reply 23 days agoView thread


kcrane
:coolfingergun:  12:33 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


kcrane
:coolfingergun:  1:20 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


kcrane
:coolfingergun:  2:25 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we're out on prod
deploy checks pass


kcrane
:coolfingergun:  2:33 PM
Deploying latest (599390ad871) to staging


rpeterson
  10:12 AM
was added to #ledger by klachance
.


nickbui
:ooo_1:  10:26 AM
When would the next ledger deploy be?

1 reply
22 days agoView thread


egraham
:spiral_calendar_pad:  11:10 AM
replied to a thread:
hey! Can someone help me understand why the Payments Schedule II role is included in the ledger owners group?…
fyi, I've removed the Payments Schedule II role from the ledger owners group!
:bless:
1
:tombstone:
1

View newer replies


ewalls
  12:52 PM
Hey Ledger team! Will a ReturnedLedgerEntry always have the same effective time as the original? I'm asking because it looks like we're seeing a case where that isn't true.
https://square.slack.com/archives/C02P16P09TR/p1687461632917699?thread_ts=1687404438.438389&cid=C02P16P09TR


ewalls
Based on how we handled this scenario from earlier this week, I was looking into this new case but I'm a bit confused about this payment.
Error: No unsettled entry found
Txn ID: 2455278270
Plan ID: 2193873
CEFE ID: 2002725206
Show more (edited) 
2 files
 
Mca repayment.png
Returned Ledger entry.png
From a thread in credit-servicing-record-alerts | Jun 22nd | View reply

1 reply
22 days agoView thread


johno
:spiral_calendar_pad:  1:26 PM
replied to a thread:
Friendly ping on this https://square.slack.com/archives/CAMN0UWMS/p1675989583282439
resurfacing this. it ended up paging us last night due to a larger than usual spike from ledger slowing down our kafka producer in esperanto. is there any way to put a cap on how heavy these bursts hit when they do happen?
View newer replies


jzerilli
:spiral_calendar_pad:  2:12 PM
Hey team, I am currently trying to trigger a bank settlement return in regulator staging for unit L33R41VJRBSB8 for testing purposes and appear to be running into an error that is coming from ledger. I will include the full stack track in this thread but seeing LedgerService#return_bank_settlement_entry received status 400 with error Invalid bank settlement entry token specified:. For reference I am using the return action shown on the transfers table and not specifying any token so im not sure why its happening. (edited) 
:checkmark:
1



9 replies
Last reply 22 days agoView thread


jessicadai
:spiral_calendar_pad:  2:13 PM
was added to #ledger by jzerilli
.


aackerman
  10:56 AM
Hi team, I have a small PR that adds a few merchants to the blacklisted-staging-merchants.yaml in ledger to address an issue with payment risk evaluations in staging, wondering if I might be able to get a look :slightly_smiling_face: https://github.com/squareup/java/pull/292797
#292797 [risk-common] dont send excluded entity for eval
After turning on the ExcludedEntities filter for statham payment evaluations in staging canary, I saw stale payments come through and eventually get evaluated by backstop. I noticed they were all from a few merchants, but not all of the merchants on the ExcludedEntities list. I think we need to align the ledger blacklisted merchant staging list with these staging merchants so that those payments don't alert for being stale, since we cannot get a beacon/RA evaluation for any payments from these units. I noticed most of the lists overlapped, with just these 3 for staging that were not in the ledger list.
Labels
accounting-engineering
Comments
3
<https://github.com/squareup/java|squareup/java>squareup/java | Jun 21st | Added by GitHub


8 replies
Last reply 18 days agoView thread


prabhjot
:no_entry:  12:17 PM
Hi Team :wave:, There is a planned Barclays FileGateway outage tonight between 06:45 PM (PDT) and tomorrow 07:30 AM (PDT), this will impact UK transfers. I’ll provide update here if the outage is extended, please let me know if I can provide more details.



3 replies
Last reply 21 days agoView thread


minghua
:bulb:  2:48 PM
deploying staging on 5eafc6674adf1d9956905fc84572f9d13ff85b44


mnovich
  11:05 AM
Are items in staging holidng are for esperantoPayments feed a risk for todays ledger prod deploy?
https://apa1280--ledger.stage.sqprod.co/_admin#tab:holdingarea

1 reply
18 days agoView thread


dskarbek
  11:09 AM
BTW, since I'm about to be traveling and it's almost ledger deploy time, I approve my changes going live with the deploy.
:ty-bouncy-green:
1



mnovich
  11:37 AM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-113533
(ledger @ 5eafc6674adf1d9956905fc84572f9d13ff85b44 to production)
:+1:
1




9 replies
Last reply 18 days agoView thread


mnovich
  12:29 PM
replied to a thread:
Ledger ROLL:…
Can someone stamp this?
:stamp:
1

View newer replies


mnovich
  12:30 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


njain
  12:42 PM
Hey 
@oncall
, Capital seems to be experiencing high latency from ledger which is causing high delay in assessment creation.
(This is the dashboard I am looking at )
Could you please check to see if there are issues on the ledger side?





29 replies
Last reply 18 days agoView thread


mnovich
  12:56 PM
replied to a thread:
Ledger ROLL:…
cancelling deploy due to ongoing issue ( unrelated)


reilly
:headphones:  3:25 PM
Hi team, I had some questions about this returned ledger entry (token wXu0PTLr4RsS4vT53__tGjrVG_0 ). The created at time is 6/21/23 at 8:00pm PDT , and I noticed the time it was settled or sent is exactly the same time (transfer link). This seems different from what we usually see, is there a reason this happened in this case? Asking because my team's service (Capital) depends on being able to catch RLEs being created before a settlement is sent but in this case we would not be able to do so. Thanks!
:checkmark:
1



2 replies
Last reply 17 days agoView thread


mnovich
  3:55 PM
deploying staging on 8b87ace1d860ecc9617e5d58c052371752c5d65e (edited) 


mnovich
  11:40 AM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-113627
(ledger @ 8b87ace1d860ecc9617e5d58c052371752c5d65e to production)
cc: 
@bjoseph
 
@emilyl
 
@brentw
 
@minghua
 
@dskarbek
 
@wstewart
 
@bhargava
:+1::skin-tone-2::+1::+1::skin-tone-4:
7



6 replies
Last reply 17 days agoView thread


mnovich
  12:12 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


mnovich
  12:46 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


mnovich
  1:53 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we're out on prod
deploy checks pass


mnovich
  3:15 PM
deploying staging on 27f292dba9d1e9e8f25a750f38e7e37a7a724784


sunny
  4:52 PM
https://square.slack.com/archives/C022YKL0EUE/p1687908753378109


sunny
hi! has anybody noticed issues related to recent payments loading in regulator for the Payments Table? we are investigating an oncall ticket where we see Automated Savings transfers (which are linked to payments) but we do not see the corresponding payments in the Payments table (payments no longer show after June 16th)
Merchant: MLXPD2DKQSGXZ Unit: L5KN8A2JBZW8S (this is also the only unit)
https://regulator.sqprod.co/n/users/L5KN8A2JBZW8S?section=admin-actions
Show more
Posted in regulator-help | Jun 27th | View message
:checkmark:
1




12 replies
Last reply 16 days agoView thread


sunny
  4:53 PM
replied to a thread:
hi! has anybody noticed issues related to recent payments loading in regulator for the Payments Table? we are investigating an oncall ticket where we see Automated Savings transfers (which are linked to payments) but we do not see the corresponding payments in the Payments table (payments no longer show after June 16th)…
as a follow-up, I was also impersonating the merchant and I did not see any payments (in Square Dashboard) from them after June 16th (although automated savings reflects that there were payments taken on June 17th and June 18th) - where’d the payments go? :eyes: :ghost: (edited) 
View newer replies

root
APP  10:22 AM
ODS host fpd1527.sjc3b.square (pd-odsgroup380) is down
No action is needed from you. ODS oncall will try to successover metaclusters if they are active on this host.
Please see the #situation channel for more information.
apps affected: ledger
metaclusters affected for these apps:
- pd-mysql-ledger-007
Cc: 
@oncall

1 reply
16 days agoView thread

root
APP  11:25 AM
ODS host fpd1296.iad3b.square (pd-odsgroup315) is down
No action is needed from you. ODS oncall will try to successover metaclusters if they are active on this host.
Please see the #situation channel for more information.
apps affected: ledger
metaclusters affected for these apps:
- pd-mysql-ledger-035
Cc: 
@oncall

1 reply
16 days agoView thread


mnovich
  11:27 AM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-113694
(ledger @ 27f292dba9d1e9e8f25a750f38e7e37a7a724784 to production)


6 replies
Last reply 16 days agoView thread


mnovich
  11:33 AM
replied to a thread:
Ledger ROLL:…
can I get a :stamp:  from anyone?
View newer replies


mnovich
  12:21 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


mnovich
  12:52 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


mnovich
  1:54 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we're out on prod
deploy checks pass


mnovich
  2:43 PM
deploying 2bf2986e1ad39d0638692b1eb0496b5fb963ca43 to staging


suril
  7:24 AM
Hello Team, I need help with one question. When seller’s ledger balance goes to negative, ledger recovers it via debiting seller’s external bank account. Does ledger create ledger entry for the ACH debit? (I did not see it in the Regulator Ledger Entries tab). What is the the best way to see this ACH on any of the available UI?



3 replies
Last reply 15 days agoView thread


alexluk
:spiral_calendar_pad:  2:36 PM
:wave: Hello owners of ledger,
The 3P Enablement Team, previously API Frameworks, is in the process of gathering information around rate limiting usage and requirements from owners of public APIs. We're hoping to make improvements to rate limiting in our platform and potentially monetize from top callers of our APIs.
We would greatly appreciate if you could fill out this google form to help inform our product decisions: https://forms.gle/iUE9w5b4tpAhMqJu8
Thank you and we'll keep you updated!


faisal
  3:34 PM
Hello, Ledger maintainers –
Block is migrating our Linux hosts to Oracle Linux 8, and the newer GPG software version in OL8 introduces a breaking change in the gpg command line tool Ledger uses for encryption. We need you to make a change in your project to keep it running on OL8.
To ease the transition to the new OS, Data Security Engineering has tested packaging changes that allow most software to continue working with minimal code changes. To prepare your app for the transition, we ask that you review OL8 Migration and GPG - Instructions for Service Owners, identify a team-member to coordinate this change, and provide us with a ticket we can watch to see your progress (if possible).
If you have any questions about this GPG upgrade path, please reach out to #data-security-eng. For general information about the OL8 upgrade, please see #oracle8-migration.
2 files
 

Next OS Project Overview
Google Doc

OL8 Migration and GPG - Instructions for Service Owners
Google Doc

1 reply
14 days agoView thread


mnovich
  3:54 PM
deploying a69baaed49036008b9be195556bad7d946086907 to staging


jsandifer
  1:28 PM
hi team. risk is seeing some instances in which fraudsters are able to exit funds before risk systems can flag the activity, largely it seems because Ledger is reflecting a  0 balance. the full thread is below, but does anyone have any ideas on why this might be happening?
https://square.slack.com/archives/CSS9G0N77/p1688058355042289
:speech_balloon:
1




12 replies
Last reply 10 days agoView thread


smartin
  3:24 PM
deploying f7c9d337d713bd42ddc585c31307273807d62654 to staging


prabhjot
:no_entry:  5:36 PM
Hi Team :wave:, There is a planned Barclays FileGateway starting now until 05:30 AM (PDT) tomorrow, this will impact UK transfers. I’ll provide update here if the outage is extended, please let me know if I can provide more details.
:ack:
1



parkjane
  12:25 PM
Hi Team! Would creator_token  from GetFreezesResponse always return a unit/merchant token? If so, which one is prioritized in returning (i.e. freeze creator has both unit/merchant token)?


tal
:no_entry:  2:19 PM
hey! not sure if this is the right place but i'm taking payments via Virtual Terminal in staging and it's been over an hour and i'm not seeing the funds in my balance :thinkeyes: any idea what could be causing the delay :bufo-pray: ?


6 replies
Last reply 9 days agoView thread


mengen
  2:50 PM
deploying 8ed4a3da3a83226643d132ff51f36446a91ee1e7  to staging


mengen
  5:37 PM
deploy c2e9781149ffedab055a5a41018aba4d63909fc3  to staging


joshuaw
  6:52 AM
I'm curious if there's a recommended way to configure settledLedgerEntry feed consumption. Every Saturday when free processing entries come in we see a massive spike in our feed lag. I'm wondering if you all are aware of any clients who can successfully handle the spike in traffic without much feed lag or if there's any other recommended approach or future plan to mitigate this lag?


ena
:spiral_calendar_pad:  8:37 AM
heya team! :ablobwave: from the Transfers team here! we're getting some inquiries (thread, thread) about sellers not receiving their nightly settlement sent last night (5th july). Regulator is showing these transfers as successful but sellers are saying the funds haven't hit their bank account yet (e.g. this transfer). They've called up their bank with the trace id and the routing number, but the banks say they didn't receive anything from Square. Would someone be able to help us take a look? :tybig: cc 
@ecoleman


cdannenberg
Hey Team - similar to the above, have another Strategic Seller, Fortuna Bakery, reporting they have not received transfers today for either of the two below accounts for any locations: 
@oncall
1.) ML6YQD88QSK9Q
2.)MLA78B4WQ5S9S
Thread in transfers | Jul 6th | View message


coglander
Hi team, I am covering for jean while he is ooo. Juice Press (Strategic Account) did not receive their transfers today. It is crucial as they need to pay out their payroll. ZH2JE5C3T7ZVS Can anyone take a look for me
Thread in transfers | Jul 6th | View message





+4
29 replies
Last reply 8 days agoView thread


jchi
  9:58 AM
was added to #ledger by bforehand
. Also, joycec
 joined.


joshuaw
  10:08 AM
I'm planning on increasing the max items for beemos consumption of ledgerEntries for 25 to 100. Please let me know if there are any concerns. We currently consume using 16 shards.  https://github.com/squareup/java/pull/294511

1 reply
8 days agoView thread

root
APP  11:38 AM
ODS host fpd1519.sjc3b.square (pd-odsgroup376) is down
No action is needed from you. ODS oncall will try to successover metaclusters if they are active on this host.
Please see the #situation channel for more information.
apps affected: ledger
metaclusters affected for these apps:
- pd-mysql-ledger-003
Cc: 
@oncall

1 reply
8 days agoView thread


zifan
:spiral_calendar_pad:  12:14 PM
Hi team! I have a question on ledger's logic on handling JP transfers. Does SMBC_daily pipeline only process transfers from SMBC to SMBC? And weekly pipeline handles transfers from SMBC to non-SMBC banks? Is that also true for Mizuho_daily and Mizuho_weekly pipelines? Or, according to this logic, does all transfers to non-SMBC && non-Mizuho goes to SMBC_weekly pipeline? Please help me to understand the difference between transfers processed by JP daily and weekly pipelines. :messenger-thanks:
:eyes:
1



10 replies
Last reply 8 days agoView thread


mengen
  12:33 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-113961
(ledger @ c2e9781149ffedab055a5a41018aba4d63909fc3 to production)
:+1:
2






12 replies
Last reply 8 days agoView thread


cadams
:red_circle:  12:35 PM
was added to #ledger by mengen
. Also, cgarnier
 joined.


mengen
  12:59 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


mengen
  1:21 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


brentw
:spiral_calendar_pad:  1:58 PM
Hey Ledger team, I’m working on changes to process Chase ACK files in Teller for US, CA, and AU. I’m curious what you think the level of difficulty would be to perform similar changes in ledger, or if you think it’s worth it considering the latter two marketplaces have been migrated fully to teller.


mengen
  2:45 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass
:tada:
1



tmahoney
  3:05 PM
is CreateRefundLedgerEntry eligible to be marked idempotent?



48 replies
Last reply 23 hours agoView thread


tmahoney
  3:25 PM
replied to a thread:
is CreateRefundLedgerEntry eligible to be marked idempotent?
PR here: https://github.com/squareup/java/pull/294586
#294586 [ledger] make CreateRefundLedgerEntry idempotent with 1000ms retry ti…
…meout
Doing this to mitigate some transient failures in staging (and, less often, prod) from RefundsArbiter calling this RPC.
Used https://wiki.sqprod.co/display/DPS/Consuming+and+Exposing+RPC+Services as a reference.
Corresponding Slack discussion: https://square.slack.com/archives/CAMN0UWMS/p1688681104137169
Labels
accounting-engineering
Comments
1
<https://github.com/squareup/java|squareup/java>squareup/java | Jul 6th | Added by GitHub
:stamp3:
1
:thankyoublob:
1

View newer replies


tal
:no_entry:  3:31 PM
hey team! just wanted to surface this thread again, we've been getting a lot of timeouts in staging to downstream Ledger endpoints that Deposits calls, sometimes preventing us from being able to test properly. it seems to largely be units on ledger shard 10 -- is there anything still going on with that shard?


tal
hey team :ablobwave: we're seeing some timeout issues in deposits staging when calling Ledger endpoints (eg: GetDepositSchedule, GetInstantDepositAccount) that started around 12:30pm PT on June 12th. we aren't seeing anything in deposits that lines up with this timeline and saw some changes in #payment-balances-robots around that time. can you think of anything that happened that could cause these errors? cc 
@oncall
Thread in ledger | Jun 15th | View message


4 replies
Last reply 4 days agoView thread


zeke
  4:19 PM
Hi team, a follow up to this thread, I’ve got another single payment that’s stale for risk: zNm0prUfv5rEWs7ltb8fxMj3uaB. I checked in Magistrate and we cleared it. I can republish it but this happens every so often. 
@oncall
 can you take a look?


rho
@oncall
 hi, risk infra here. We’ve had a couple instances where we’ve gotten paged for a single payment not being cleared from ledger. We usually refeed or clear it via admin console but I wanted to bring it up since it’s happened intermittently. There’s one such stale payment right now if you wanted to take a look.
Thread in ledger | Feb 10th | View message
:eyes:
1




5 replies
Last reply 8 days agoView thread


mengen
  4:36 PM
deploying 7c77617ab1acff7bc00c6d90699bdcae1d933755 to staging


trandall
  3:00 PM
Hey I was hoping to get confirmation on why an MCA Repayment Refund ledger entry hasn’t been able to be processed yet? (continuation from this thread)
The $34.67 refund ledger entry part of this payment is the entry that hasn’t settled. Is this solely because the current primary payer on the plan doesn’t have a linked bank account, even though the secondary payer does have a linked bank account? And all that needs to happen to get this refund to settle is have Ops deactivate the current primary payer and make the secondary payer the primary payer? (ops mentioned that the current primary payer unit got hacked so I’m assuming that the unit hasn’t been updated on the Capital side to reflect this)




9 replies
Last reply 1 day agoView thread


dberner
:spiral_calendar_pad:  9:02 AM
Hi team - just an FYI, we have an issue in IAD magistrate that prevents us from processing risk events in that dc. To mitigate, we moved all event processing over to SJC. Unfortunately, the exception was not being logged so we are unable to identify a root cause. As such, we have fixed the exception swallowing and deployed it, and are now going to turn on IAD processing in production to replicate the errors deliberately. We will not leave it on longer than a minute before turning it off again. SJC will pick the failed messages back up and process them normally, and we should not see any stale payments as a result of this, but we're letting you know just in case there is an issue. cc @risk-infra-eng

2 replies
Last reply 4 days agoView thread


kingraham
:spiral_calendar_pad:  10:49 AM
hello, Invoices received an ONCALL issue related to a 'Bookkeeper adjustment' that with the MCA Repayment is consuming the invoice payment (regulator link for transfer from JIRA). Can someone assist?


2 replies
Last reply 4 days agoView thread


jsookikian
  11:40 AM
Hey team, I'm looking into a request from an EU seller who is trying to link their bank account again. Upon inspection, it looks like the had 2 failed bank transfers that are showing R10 return codes, which seems odd considering both transfers were credit. Can someone help provide some more information? cc: 
@ssusanto


lcarrie
Hey team - I have a seller (ML14871F99WES) who recently changed back account and is waiting for this bank account to be verified. They've asked if there's any way for this process to be expedited or anything we can do on our end to speed up the process? Thanks!
Thread in bank-accounts-api | Jul 10th | View message
:eyes:
1



4 replies
Last reply 4 days agoView thread


heggert
:speech_balloon:  11:47 AM
Hey team , Seller asking why her account is negative, i found that back in 3/7  -3 payments were flagged as possible buyer fraud and ssp sent. Seller already transferred the funds out, so we tried to pull funds from BA, but failed 3 times and unlinked, looks like those payments cleared from hold on 3/11 , she re linked a BA on 7/5 and now a return ledger entry tried to pull the funds again and caused the account to go negative. These ledger entries shoudl not be there as the paymenst were cleared. can you look into this, i think we need to reverse all the ledger entries on last failed attempt to debit her account as they are no longer needed since the hold was released. please lmk so i can update the seller. Risk ops said they removed the hold on their end, but we still ended up charging her again on 7/9 with a bank withdrawl, this should not have happened. This should be reversed as we took her initial balance as well. I was told to escalate here by tier 2 risk. ANy assistance would be appreciated.
LK7VB1N3C9RV4





+6
48 replies
Last reply 1 day agoView thread


lucasc
  11:52 AM
Hi team! I have a quick question for you. What triggers settlement for a payment on a bill/order? I noticed on this payment from this bill that the payment was authed/captured in January but the payment is settled in June. I know this is test data but curious what the workflow is here and if this is likely to happen in prod


2 replies
Last reply 4 days agoView thread


skaltenbach
  1:32 PM
Ledger ROLL:
https://block.atlassian.net/browse/ROLL-114059
(ledger @ 5a428a79c00c12e8b7da2d69adc37da5807de724 to production)
:+1::+1::skin-tone-2:
8






+1
64 replies
Last reply 1 day agoView thread


skaltenbach
  3:49 PM
deploying ef7a95891eb47b9fdfc44ac933c321d6b33fefdb (latest) to staging


hagit
:palm_tree:  4:58 PM
replied to a thread:
Hey team , Seller asking why her account is negative, i found that back in 3/7 -3 payments were flagged as possible buyer fraud and ssp sent. Seller already transferred the funds out, so we tried to pull funds from BA, but failed 3 times and unlinked, looks like those payments cleared from hold on 3/11 , she re linked a BA on 7/5 and now a return ledger entry tried to pull the funds again and caused the account to go negative. These ledger entries shoudl not be there as the paymenst were cleared. can you look into this, i think we need to reverse all the ledger entries on last failed attempt to debit her account as they are no longer needed since the hold was released. please lmk so i can update the seller. Risk ops said they removed the hold on their end, but we still ended up charging her again on 7/9 with a bank withdrawl, this should not have happened. This should be reversed as we took her initial balance as well. I was told to escalate here by tier 2 risk. ANy assistance would be appreciated.…
@oncall
, can you please help look at the payments in this thread? It seems to be a ledger issue with holds :pray:
View newer replies


suril
  4:49 AM
Hi Team, In the current state, Capital is creating Ledger entries to process payments to payoff loan. We are trying to learn which ledger entries ends up making ledger balance negative which results in Ledger creating ACH debit (ex: if Ledger debits $40 from external bank account, which Ledger entries are aggregating to $40). We are hoping to create metrics in looker at the product level, so looking for some help to understand data model in snowflake. Thanks!


14 replies
Last reply 1 day agoView thread


dpotvin
:spiral_calendar_pad:  8:41 AM


dpotvin
Hi all, we are rotating the Barclays UK key right now
Posted in banking-connections | Jul 11th | View message


nirmit
:spiral_calendar_pad:  9:30 AM
hey team 
@oncall
 - Looking at the RQM page for this payment, a refund ledger entry is created even though the refund reservation failed. Any idea what's going on here? Here’s an example with the same error type but correctly not making a refund ledger entry
:eyes:
1


1 reply
3 days agoView thread


alisonc
:spiral_calendar_pad:  12:31 PM
Hi team, in Datadog, I see that deposits sends about 4k QPS to ledger but only around 2k QPS are 200s. Is this due to rate limiting, and if so, where does this configuration exist? The rate limiting config in console for ledger appears to be unrelated.


2 replies
Last reply 3 days agoView thread


skaltenbach
  12:36 PM
replied to a thread:
Ledger ROLL:…
updated Ledger ROLL: https://block.atlassian.net/browse/ROLL-114119
cc: 
@brentw
 - this one includes some changes from you as well
:+1::+1::skin-tone-2:
6

View newer replies


skaltenbach
  1:06 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


skaltenbach
  1:52 PM
replied to a thread:
Ledger ROLL:…
rolling back!
:cry:
1

View newer replies


skaltenbach
  2:42 PM
deploying a7c94c99006c8952577b0b07acda49fde9b14b9a (latest) to staging


manij
  4:30 PM
hello there, is there a way to extend a hold on a user applied via regulator "create user hold" ? for more context, credit risk ops team applied a hold on a seller(convene) but the duration is defaulted to 90 days which is not sufficient for this use case. without an option to extend to a custom time, ops team is waiting for the existing hold to expire and then apply a new hold for the next 90 days using reminders which is tedious and error prone. just wanted to check if there is any override that can be done in the backend to extend the hold. thanks  :pray:



5 replies
Last reply 2 days agoView thread


skaltenbach
  5:40 PM
deploying e680bce3d481691a66c372a6428882467f5d971f to staging

1 reply
3 days agoView thread

root
APP  8:17 PM
ODS host fpd1517.sjc3b.square (pd-odsgroup375) is down
No action is needed from you. ODS oncall will try to successover metaclusters if they are active on this host.
Please see the #situation channel for more information.
apps affected: ledger
metaclusters affected for these apps:
- pd-mysql-ledger-002
Cc: 
@oncall
:ack-red:
1




4 replies
Last reply 3 days agoView thread

root
APP  9:02 PM
ODS host fpd1517.sjc3b.square (pd-odsgroup375) is down
No action is needed from you. ODS oncall will try to successover metaclusters if they are active on this host.
Please see the #situation channel for more information.
apps affected: ledger
metaclusters affected for these apps:
- pd-mysql-ledger-002
Cc: 
@oncall

1 reply
3 days agoView thread

root
APP  6:43 AM
ODS host fpd1553.iad3b.square (pd-odsgroup382) is down
No action is needed from you. ODS oncall will try to successover metaclusters if they are active on this host.
Please see the #situation channel for more information.
apps affected: ledger
metaclusters affected for these apps:
- pd-mysql-ledger-009
Cc: 
@oncall

1 reply
2 days agoView thread


dpotvin
:spiral_calendar_pad:  7:46 AM


dpotvin
We are rotating the Barclays SEPA key now
Posted in banking-connections | Jul 12th | View message


skaltenbach
  12:21 PM
replied to a thread:
Ledger ROLL:…
Ledger ROLL with the BankSettlementEntryTransformer fix:
https://block.atlassian.net/browse/ROLL-114171
(ledger @ e680bce3d481691a66c372a6428882467f5d971f) to production)
:+1:
3

View newer replies


skaltenbach
  12:56 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
:llama-eagerly-awaiting-death:
2

View newer replies


skaltenbach
  1:34 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
:yay-cat:
1

View newer replies


skaltenbach
  2:33 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass
:tada:
1



skaltenbach
  2:41 PM
deploying fc56d58a64c27423572d568c3dd2a82fa0eaaca6 (latest) to staging


heggert
:speech_balloon:  4:16 PM
Hey team, i have another one for you : 4QKYN46JG4V4G , seller has multiple adjustments with no explanations , looks like he had 2 disputes on 6/15 (271.88 and 200.00), we took 116.96 on 6/20 for an adjustment when seller took a payment , then a transfer of 271.88 which im guessing is for the dipsute ,  on 6/22 seller transfers 60.00 bucks into this account, we then have adjuments for giving back the 116.96 then removing 176.96, taking the 60.00 , on 6/26 we have back the 176.96 then the seller transfer the funds out, on 7/3 we gave 400.00 , took 200.00 , then took 197.30 , on 7/10 we give back the 197.30 , take 400.00 leaving the account negative 202.70 , seller then takes 2 payments 193.90 and 237.29 with 146.80 going to savings, i ask for your help cause im trying to understand where the seller stands, he started out owing 471.88 , but looks like we were trying to take more funds and he took the funds out  , an extra  176.96 leaving him owing a total of 648.84 due to dipsutes and us paying him to much, so far iu calculate that we got 271.88 and 202.70 from him already leaving 174.26 im guessing will be an adjustmnet later down the road once it gets caught, my question is , do we know why we kept putting funds in and taking funds out, and why we dont just leave the account negative whats owed. DIdnt know if you could help me here with this, ty.
:eyes:
1



14 replies
Last reply 19 hours agoView thread

PayswingBot
APP  7:06 AM
Pay swing has been initiated by malbert with message: neteng request https://square.slack.com/archives/CV3T92JV6/p1689003092063559.
Evacuating payments traffic from EAST datacenters (swinging WEST) in production
:large_orange_circle: (Degraded) EAST: NOT serving new payments
:large_green_circle: (Available) WEST: Serving new payments


meganz
  10:25 AM
Hi team, can someone point me to the Snowflake table that contains the Transfers balance that shows up in the Regulator for Square Account? The #regulator-help channel point me to here, as they mentioned the information appears to be coming from a request that is ultimately routed to the Ledger service. Thank you! :pray:
Binary
 

Screenshot 2023-07-12 at 2.50.39 PM.png
Binary

PayswingBot
APP  10:42 AM
Pay swing has been initiated by malbert with message: unswinging payments per https://square.slack.com/archives/CV3T92JV6/p1689003092063559.
Restoring normal payments traffic (unswinging) in production
:large_green_circle: (Available) EAST: Serving new payments
:large_green_circle: (Available) WEST: Serving new payments


ssuppal
  1:47 PM
Hello :wave:, owners of: ledger
We’re reaching out to you because one or more of your APIs uses version validation via Envoy or API Velocity. Due to a reorg shifting priorities on the team, the Envoy Version Validation filter has been defunded.
If you have already migrated your app to the Envoy Version Validation filter then we will rollback your API to use the version validation code in API Velocity and resolve any diffs in the version data. There will be no impact to your customers. We will post updates to this channel.
If you are currently using version validation in API Velocity then please do not migrate to the Envoy Version Validation filter! Do nothing.
Apologies for any inconvenience this has caused your team. We hope to make this a seamless and pain-free rollback. Please respond to this thread with any questions.
Thanks,
3P Enablement (formerly API Frameworks)


rohitdinakar
:spiral_calendar_pad:  2:40 PM
@oncall
 Hi from Risk Infra, due to a downstream beacon redis issue, you might see an increase in stale risk payments (currently, about 500 payments are 15 minute stale). our backstop framework is kicking in (for the past 30 minutes or so) and keeping the staleness down within SLA as much as possible


zhonglin
Hi 
@oncall
, can I get some help checking the redis cluster of beacon? Our updateRedis consumption is stopping again: https://square.datadoghq.com/dashboard/jrv-kzw-zsy/squaremlfsveneur---beacon-update-red[…]-green&from_ts=1689278189101&to_ts=1689281789101&live=true
Thread in ods | Yesterday at 2:00 PM | View message
:eyes:
1
:thank:
1






+1
14 replies
Last reply 19 hours agoView thread


skaltenbach
  2:43 PM
deploying dce24d8bd1f2f647c3c60d7c7a1b510268628e9f (latest) to staging


emilee
  3:14 PM
Hi, I’m working on reporting taxes for Australian Square sellers and have a question on this payment. Will put details in a thread (cc: 
@kbrunnerdunn
)


2 replies
Last reply 20 hours agoView thread





Only visible to you

Slackbot
  10:20 AM
:wave: Welcome to #ledger! People in this ch