carolina
:knife_fork_plate:  1:57 PM
@oncall
 Recently we added ACLs to settlements/ledger to have duplograph be able to hit the ledgerFreezes and ledgerPendingBalances feed endpoints: https://github.com/squareup/java/pull/265882/files#diff-6294b3846404f4a0bccaf2a84bc0cb809e47a18f8689b795753ae61989248bf6
But when we try to fetch feeds we get this message, which indicates some envoy misconfig on ledger side I think.
 "RpcException (SERVICE_UNAVAILABLE): gRPC call to squareup.feedsync.service.FeedSourceService/Fetch failed: UNAVAILABLE: envoy has no route for the specified Host header.
duplograph is currently able to access other feed publishers, and our container sq-cloud-envoy returns 200 when pinging the ledger GNS:
[2022-12-14T21:34:33.611Z] "POST /squareup.feedsync.service.FeedSourceService/Fetch HTTP/2" 200 14/- - "direct_response" 0 0 0 - - - - "grpc-java-netty/1.48.0" "0bc43aaa-9aab-4f5d-bd4d-9c5552f4216a" "staging-writer.ledger.gns.square" "zKeYJCcfPcWDA""-" "-"
Could you help us figure out what’s wrong?
:eyes:
1
:checkmark:
1




3 replies
Last reply 7 months agoView thread


songlin
:spiral_calendar_pad:  2:05 PM
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-104873
(ledger @ ca40f3cb5ebac03a1e77d46b5cdcdf07c1412126 to production)
:+1:
2



13 replies
Last reply 7 months agoView thread


songlin
:spiral_calendar_pad:  2:23 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-104873…
rotated out those two nodes
:bless:
1

View newer replies


songlin
:spiral_calendar_pad:  2:24 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-104873…
staging checks pass
:chocobo-face: canary start
View newer replies


songlin
:spiral_calendar_pad:  2:56 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-104873…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


songlin
:spiral_calendar_pad:  4:08 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-104873…
:shipitparrot: we're out on prod
deploy checks pass


songlin
:spiral_calendar_pad:  4:38 PM
deploying fc8e3bb30d0ad0b215bde17747002d2ca549e8cd to staging

root
APP  11:24 PM
ODS host fpd1482.iad3b.square (pd-odsgroup373) is down
No action is needed from you. ODS oncall will try to successover metaclusters if they are active on this host.
Please see the #situation channel for more information.
apps affected: ledger
metaclusters affected for these apps:
- pd-mysql-ledger-028
- pd-mysql-ledger-029
Cc: 
@oncall

1 reply
7 months agoView thread


ericz
:spiral_calendar_pad:  10:42 AM
@oncall
 I'm planning on shutting off the web consumer of the ledger-entry-feed and that might cause the feed lag to increase which might trigger this alarm and page. I wanted to let you know so that we can work together to make sure you don't get paged for this and are aware of what's going on. I'll probably shut it off in about an hour, will keep you posted!
:ack:
1




8 replies
Last reply 7 months agoView thread


markl
:spiral_calendar_pad:  2:57 PM
I have a chart that tracks deleted sweeps from moneysweeper. The largest subset comes from frozen or deactivated units that seems to happen daily around 8pm PST and is oddly roughly the same volume every day. Is there a job that clears transactions for these unit types daily around this time?
Graph showing the daily 8pm spike: https://square.signalfx.com/#/temp/chart/FkDaUPqAcAA (edited) 
moneysweeper.deleted-sweep
Added by SignalFx (11 kB)
https://square.signalfx.com/#/temp/chart/FkDaUPqAcAA



6 replies
Last reply 7 months agoView thread


songlin
:spiral_calendar_pad:  4:46 PM
deploying 8e78dc06f2af1f2b22f56011e254c38900c2647a to staging


ericz
:spiral_calendar_pad:  1:00 PM
Is any chance we could get https://jira.sqprod.co/browse/ACTENG-5169 prioritized? This leads to significant feed lag every Saturday and it makes it very hard for us to monitor for actual issues while this is ongoing



46 replies
Last reply 7 months agoView thread


andreyg
:spiral_calendar_pad:  4:21 PM
deploying e872073f1cd to staging
:checkmark:
1



zzhang
:spiral_calendar_pad:  8:36 PM
Hi team, we got paged for 6 Returned Ledger Entries were created 2 years after a plan was closed, could you advise why this could happen, and what should we do about them? https://regulator.sqprod.co/n/users/0ZA97V39A87EC?section=ledger-entries
:eyes:
1


2 replies
Last reply 7 months agoView thread


andreyg
:spiral_calendar_pad:  11:56 AM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-105006
(ledger @ e872073f1cd to production)
:+1:
2






10 replies
Last reply 7 months agoView thread


andreyg
:spiral_calendar_pad:  1:00 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:chocobo-face: canary start
View newer replies


andreyg
:spiral_calendar_pad:  1:59 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


andreyg
:spiral_calendar_pad:  2:59 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass
View newer replies


andreyg
:spiral_calendar_pad:  4:04 PM
deploying 38c09b099d4 to staging
:checkmark:
1



bjoseph
:spiral_calendar_pad:  11:22 AM
No ledger production deploy today since there's no changes in the staging SHA


tcespedes
  1:04 PM
Hey team, just finished the migrating the requested custom ledger dashboards from SFX. Feel free to take a look in the list below. A couple callouts that I should mention:
Was asked for MySQL Usage & Capacity Monitoring but those all use the nodes.percona metrics which don't appear to be in use in DD, I'd recommend using the MySQL standard dash for this
This also affects the Ledger Overview mysql section
Settlement Jobs Latency —> last 2 widgets don’t support rate in DD due to the metric type
Stale Risk --> Missing "Risk-skipped payments..." widget
Event Latency :
Missing balance_changing_events.latency_enqueue.* metrics
graphite() queries aren't supported in DD
Feeds Consumed went with the OOTB one on this one, it covers entire use case and more
Please don't hesitate to let me know if there are any questions whatsoever! Thanks.
https://square.datadoghq.com/dashboard/lists/manual/350884
:bless:
2



bjoseph
:spiral_calendar_pad:  4:08 PM
deploying 4360ad93b1adef4f24b11d9f61fefa7bd31ce73a  to staging
:checkmark:
1



kcrane
:coolfingergun:  1:35 PM
Skipping deploy today since the deploy freeze starts in like 12 hours and settlements can be risky.

root
APP  6:49 AM
ODS host fpd1482.iad3b.square (pd-odsgroup373) is down
No action is needed from you. ODS oncall will try to successover metaclusters if they are active on this host.
Please see the #situation channel for more information.
apps affected: ledger
metaclusters affected for these apps:
- pd-mysql-ledger-028
- pd-mysql-ledger-029
Cc: 
@oncall
:ack-red:
1


1 reply
7 months agoView thread


nbl
  9:03 AM
@oncall
 hopefully a simple question :crossed_fingers:
For legder payments, first we draw from square balance and then we draw the rest from linked bank account? That is my understanding but a capital loan seller called in wondering why we pulled everything from their bank account when they have a balance.
:eyes:
1





24 replies
Last reply 4 months agoView thread


zandt
:spiral_calendar_pad:  11:03 AM
Hey all. I'm trying to understand, between two sample payments that involved a Square Gift Card on SOS why only one of the payments has a THIRD_PARTY_FEE ledger entry. The only difference that I can see is the latter payment has an app fee for the refund and the other one does not. As long as there is an app fee on the original payment, shouldn't there be a THIRD_PARTY_FEE ledger entry?
Sample payments:
f7Q100xgXWmEW5d4iotf9kSiYLeZY
FCQ0Mpzr4LX3MCpeQlMSTRsTbxFZY
On a slightly related note, could I get access to Ledger's snowflake database to run some queries to verify some assumptions that I have about how payments are processed?
:eyes:
1






66 replies
Last reply 7 months agoView thread


andreyg
:spiral_calendar_pad:  4:15 PM
deploying 9e6182e42ca to staging

root
APP  12:33 AM
ODS host fpd1515.sjc3b.square (pd-odsgroup374) is down
No action is needed from you. ODS oncall will try to successover metaclusters if they are active on this host.
Please see the #situation channel for more information.
apps affected: ledger
metaclusters affected for these apps:
- pd-mysql-ledger-001
- pd-mysql-ledger-012
Cc: 
@oncall

1 reply
7 months agoView thread


ashtyn
  11:53 AM
Hello! I’m trying to troubleshoot ONCALL-143217 - basically, a settlement report is failing for unit F1M1HX9VTKHKA because they have some ledger entry that is of entry_type THIRD_PARTY_FEE or THIRD_PARTY_FEE_REFUND but is missing the entry.detail.third_party_fee.third_party_fee_amount_detail field.  I looked at the ledger entries for the payments included in this settlement report, and they all look as they should, so I’m guessing the issue is in one of the refunds - but I’m not sure how to look those up by refund token. Can someone please check these refunds and let me know if any have an entry type of THIRD_PARTY_FEE_REFUND and are missing that field?
p8recRb4Unyh8KoYNNwO1KWFpm6fTYphXkY6WNUDxeL
l8ykJ3Z11yHcakOk38TMbxHJycsDg1gOoLM0V6r0hkH
MqJjzVgd7BkkzgC3VW5P1KtkQZ8GbZUs3gkaJjQu3sd
2S3ln020QMFVbWRGtq6tv5ijed27VaD4naX9XSIXV4Y
VSkbUPalFjriXn8Zhs9JkjfbTcxhqLGfexNkK6T1uaD



9 replies
Last reply 6 months agoView thread


jcurry
  12:27 PM
Hey team,
I received this message from my customer who recently onboarded with our Staylist integration. I was informed by a member of our accounting eng team to reach out to this channel to flag this issue for potential remediation. We think this may have to do with the timing as to when they are pulling reports / pulling back of refunds, but can anyone on this channel clarify if thats the case and if there is any forward guidance here? TY in advance!
"Hello,
There is a discrepancy between what supposed to be deposited and what was actually deposited for 12-1-22.
Square reports a net total of $26,192.23, same as Staylist (our booking software) for transactions on 12-1-22. On 12-2-22 there was a direct deposit of $25,965.93 for a short of $226.30. Why ? Where is it?
If i add all the deposits into my account (from square) from 12-1-22 to 12-9-22, the sum never equals the sum of the sales of the transactions for the same time span.
Regard,
Michael Ho-Lung
Manager
Nova Family Campground"


3 replies
Last reply 6 months agoView thread


gkeyes
:spiral_calendar_pad:  11:00 AM
Hey yall, I was hoping you could help me understand why the refund ledger entry from "12/20/22 at 12:43pm EST" for https://regulator.sqprod.co/n/users/J7T62C0V6QR3F?section=ledger-entries hasn't been settled yet
:eyes:
1



5 replies
Last reply 6 months agoView thread


andreyg
:spiral_calendar_pad:  11:51 AM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-105277
(ledger @ 9e6182e42ca to production)


5 replies
Last reply 6 months agoView thread


andreyg
:spiral_calendar_pad:  12:23 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:chocobo-face: canary start
View newer replies


andreyg
:spiral_calendar_pad:  1:20 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


andreyg
:spiral_calendar_pad:  2:21 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass


ena
  2:50 PM
heya team! :helloblob: from transfers here!
[ONCALL-143239] we have a seller (LKYTRB7CBB8FQ) who is blocked from transferring due to UNSETTLEABLE blocker coming back from ledger’s merchant settlement state (BLOCKED_BY_ONBOARDING)
from the merchant + unit permissions standpoint, it look like they don’t have any onboarding permission blockers :thinkeyes: does anyone know how we can get this unit unblocked? :thanks_so_much::skin-tone-2:
:eyes:
1



8 replies
Last reply 6 months agoView thread


mnovich
:spiral_calendar_pad:  3:08 PM
can someone tell me what is ledgers datadog migration status?

1 reply
6 months agoView thread


andreyg
:spiral_calendar_pad:  4:03 PM
deploying 551065363cc to staging
:checkmark:
1



bastien
  5:41 PM
Hi team - are we able to tell what account this is related to?
I usually look for an L or T in the ID number but I dont see one here - I’m not 100% sure this is even related to Square
image.png
 
image.png
:checkmark:
1



3 replies
Last reply 6 months agoView thread


louisa
:spiral_calendar_pad:  10:22 AM
hi there, recon got a question from accounting about tracing some outbound transfers to cash, but we don’t currently have this data in our tables (i believe due to the migration of some settlements from ledger to payouts, and we don’t have a feed from payouts yet). can you help point us in the right direction on how to trace these transfers / who might be able to help? cc 
@huanl
 
@angelia


angelia
Happy New Year recon team, I am looking at regulator and saw two same set amounts showing in outbound transfers, however, our bank only shows we receiving one. (see highlight in the below screenshot), can you advise these are duplicate or we should receive all, if there are duplicate, is it due to the migration project? Please direct me to the right team if you are not. Thx (edited) 
2 files
 
image.png
image.png
Thread in recon-operations | Jan 4th | View message
:checkmark:
1




13 replies
Last reply 6 months agoView thread


mengen
:spiral_calendar_pad:  12:27 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-105365
(ledger @ 551065363cc781131237f777d5ee3d713a5619a1 to production)



7 replies
Last reply 6 months agoView thread


mengen
:spiral_calendar_pad:  12:48 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:chocobo-face: canary start
View newer replies


mengen
:spiral_calendar_pad:  1:38 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


mengen
:spiral_calendar_pad:  3:25 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass


mengen
:spiral_calendar_pad:  4:28 PM
deploying 3751414c74d0a280596e39a6d10fabb066ddcc73  to staging


mnovich
:spiral_calendar_pad:  1:51 PM
@oncall
 I may cause a stuck-payouts alarm in staging within next 30 minutes. Please ignore.

1 reply
6 months agoView thread


jcui
:spiral_calendar_pad:  2:05 PM
hi, i am investigating an issue where a seller's monthly payment to their term loan failed due to insufficient funds. the seller had enough funds in their ledger balance but we attempted to debit their bank account instead. is there a reason why the funds were not pulled from their ledger balance?
:eyes:
1




8 replies
Last reply 6 months agoView thread


tmahoney
  3:05 PM
would Ledger throw a CASHFLOW_VIOLATION if we attempted to refund (to the original payment card) a payment that had already been refunded to gift card?



27 replies
Last reply 6 months agoView thread


andreyg
:spiral_calendar_pad:  4:02 PM
deploying a85484b3068 to staging


emilyl
  11:53 AM
:information_source:  We will be conducting a Ledger DR exercise on Tuesday, January 10th as part of the wider Payments DR exercise. Updates will be posted here


zandt
:spiral_calendar_pad:  12:59 PM
:wave: Small pr to adjust how the payment feed listener checks for app fees. This was a followup from a previous pr. https://github.com/squareup/java/pull/269714
#269714 [ledger] Update Esperanto Feed Listener to use payment adapter for app fee check
Labels
accounting-engineering
Comments
2
<https://github.com/squareup/java|squareup/java>squareup/java | Jan 6th | Added by GitHub


26 replies
Last reply 6 months agoView thread


emilyl
  4:03 PM
deploying 6e7b3284320 (latest) to staging


kcrane
:coolfingergun:  4:51 PM
deploying 49f3fba3a89 (latest) to staging


chansen
  8:24 AM
Hey Ledger team :wave:   What are the merchant settlement states for L8X76D50F0AVT  in staging? 
@justinroberts
 are puzzled as to why we are receiving NO_VERIFIED_BANK_ACCOUNT  despite the seller having a linked bank account as per the linked bank accounts in regulator.
Note: this has was tested a few months ago, and everything worked as expected - no code changes since then
:eyes:
1
:checkmark:
1




7 replies
Last reply 1 month agoView thread


kcrane
:coolfingergun:  1:06 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-105521
(ledger @ 49f3fba3a89 to production)
:bless:
1





16 replies
Last reply 6 months agoView thread


kcrane
:coolfingergun:  1:22 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:chocobo-face: canary start
View newer replies


kcrane
:coolfingergun:  2:17 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


emilyl
  4:03 PM
deploying 71ee9e7ac48 (latest) to staging


kcrane
:coolfingergun:  4:39 PM
replied to a thread:
Ledger ROLL:…
(forgot to post this earlier)
:shipitparrot: we're out on prod
deploy checks pass


bforehand
  5:08 PM
FYI, we're unable to currently connect to the Barclays SFTP File Gateway. This is causing our UK pipeline to stall. I'm not sure if/when Ledger will see similar impact, but the issue appears to be ongoing.
:ok_hand::skin-tone-3:
1




6 replies
Last reply 6 months agoView thread

root
APP  8:47 AM
ODS host fpd1555.iad3b.square (pd-odsgroup383) is down
No action is needed from you. ODS oncall will try to successover metaclusters if they are active on this host.
Please see the #situation channel for more information.
apps affected: ledger
metaclusters affected for these apps:
- pd-mysql-ledger-010
Cc: 
@oncall


emilyl
  9:29 AM
Payments DR preemptive sev for ledger: https://jira.sqprod.co/browse/ALERT-11296 (edited) 

9 replies
Last reply 6 months agoView thread

PayswingBot
APP  10:22 AM
Evacuating payments traffic from WEST datacenters (swinging EAST) in production has been initiated by zandt with message: Payment DR 2023 Q1 Exercise

root
APP  11:02 AM
ODS host fpd1551.iad3b.square (pd-odsgroup381) is down
No action is needed from you. ODS oncall will try to successover metaclusters if they are active on this host.
Please see the #situation channel for more information.
apps affected: ledger
metaclusters affected for these apps:
- pd-mysql-ledger-008
Cc: 
@oncall

1 reply
6 months agoView thread


emilyl
  12:04 PM
replied to a thread:
Payments DR preemptive sev for ledger: https://jira.sqprod.co/browse/ALERT-11296
starting to swing ledger
View newer replies


emilyl
  12:16 PM
replied to a thread:
Payments DR preemptive sev for ledger: https://jira.sqprod.co/browse/ALERT-11296
pausing risk feeds
View newer replies


emilyl
  12:18 PM
replied to a thread:
Payments DR preemptive sev for ledger: https://jira.sqprod.co/browse/ALERT-11296
updating dns to iad
View newer replies


zellyn
:spiral_calendar_pad:  12:40 PM
Gentle ping… (edited) 


zellyn
Hey folks, just checking in on Java PRs #258234 and #258235, to migrate ledger-acceptance and ledger from using Sake to using gRPC/Envoy as a client. Could y’all take a look, and let us know in #frameworks if you have any questions?
Posted in ledger | Dec 8th, 2022 | View message


2 replies
Last reply 6 months agoView thread


emilyl
  12:48 PM
replied to a thread:
Payments DR preemptive sev for ledger: https://jira.sqprod.co/browse/ALERT-11296
ledger has swung to iad


grassadonia
:ooo_1:  2:52 PM
Hi team - does anyone know what "Square Sync Production Fee" is referring to in Ledger? One of our Enterprise sellers is asking about this $13.29 ACH debit from their bank account. See screenshot below and regulator link
Screenshot 2023-01-10 at 2.48.52 PM.png
 
Screenshot 2023-01-10 at 2.48.52 PM.png
:checkmark:
1



2 replies
Last reply 6 months agoView thread


emilyl
  4:13 PM
deploying e5a53b5157c (latest) to staging

PayswingBot
APP  11:21 AM
Restoring normal payments traffic (unswinging) in production has been initiated by zandt with message: Payments DR unswing


emilyl
  12:03 PM
:information_source:  starting to unswing ledger

11 replies
Last reply 6 months agoView thread


bforehand
  12:24 PM
I'm seeing some timeouts for InternalListsDeposits which calls Ledger for ListBankSettlementEntries.


3 replies
Last reply 6 months agoView thread


jonchu
:spiral_calendar_pad:  12:26 PM
Hey team! I had a quick question about the LedgerService.GetMerchantDepositTags endpoint call. We have a merchant who's tags used to include the date and looked like 1207 CCHE . However, as of ~Dec 8th, it looks like the tags have dropped the date to instead just be CCHE , for example. Testing using ledger admin's RPC with the unit token shows that the tag returned now is just CCHE :
{
      "merchant_token": "LXVDG48HTH62B",
      "deposit_tag": "CCHE"
    }
Were there any changes made around that time that might have caused the date to have been dropped? Thanks! :thx-blob:

2 replies
Last reply 6 months agoView thread


emilyl
  1:05 PM
replied to a thread:
:information_source: starting to unswing ledger
ledger is back to normal
:clap-clap:
2



lishahe
:spiral_calendar_pad:  3:45 PM
Hi, I have a small PR that add unit token to assess refund request, can I get a :stamp:? cc 
@mengen
#270295 Pass unit token for AssessRefundRequest - needed by the new refund po…
…licy feature
Labels
accounting-engineering
Comments
1
<https://github.com/squareup/java|squareup/java>squareup/java | Jan 11th | Added by GitHub
:stamp:
2
:pray:
1



emilyl
  4:07 PM
deploying f39a434498f (latest) to staging


stilden
:spiral_calendar_pad:  4:22 PM
Hey team! We’re hoping to finish rolling out RPC enforcement in Envoy SAFE. For ledger, we see that there are a couple RPC routes that are not yet defined in Envoy SAFE: https://presidio-ui.sqprod.co/search?search=application:ledger%20%22Envoy%20SAFE%20Diff%22&instance=staging&window=3d
Any chance someone on your team could define the following routes at go/routes/ledger ? We should then be able to roll out RPC enforcement for Envoy SAFE without breaking you!
/squareup.ledger.service.InstantDepositService/ReserveFundsForDeposit
/squareup.ledger.service.InstantDepositService/SettleFundsForDeposit
/squareup.ledger.service.BalanceService/FoldBalance
:checkmark:
1



2 replies
Last reply 4 months agoView thread


emilyl
  4:16 PM
deploying a50cda51d5a (latest) to staging


acastberg
  11:22 AM
:helloblob: Hello! I have a Initial Balance Change ledger entry in regulator where I'm not sure what the origin is. Does anyone know what might have caused the $164.31 adjustment here? :blob-thanks:
:eyes:
1
:checkmark:
1



3 replies
Last reply 6 months agoView thread


dchen
  12:43 PM
hi team, Ledger.ledger__ledger_production.pending_balance_snapshots . i am looking for a historical version (daily snapshot) of this one, since this table only stores the most recent snapshot. could someone help? :thankyou-rainbow:





7 replies
Last reply 4 months agoView thread


grassadonia
:ooo_1:  2:18 PM
Hi team - One of our enterprise sellers (Thrive) reached out about an unknown debit of ($1,562.12) on one of their 11/30/22 balance transfers. The debit is listed under "other" in the transfer report on dashboard and I took a look in regulator and the debit is listed as an "adjustment" but no further details are provided. Would anyone be able to help me identify what this debit is for? (edited) 
2 files
 
Screenshot 2023-01-13 at 2.06.03 PM.png
image002 (1).png
:checkmark:
1



2 replies
Last reply 6 months agoView thread


dfelixkim
  2:52 PM
Hi, I’m looking at a seller who has had 2 failed payments on a Term loan due to insufficient funds. They currently have a pending 3rd payment here. I’m newer to the servicing side, but I remember hearing about seller bank accounts getting unlinked after 3 failed payments. Will that happen to this seller if this pending payment fails as well?
:eyes:
1
:checkmark:
1



3 replies
Last reply 6 months agoView thread


bjoseph
:spiral_calendar_pad:  4:04 PM
deploying fd3110e77ae11b5fde6eb30ce7511f4d0d133349 (latest) to staging


christiew
  9:59 PM
Hi Team, There looks to be a bug or error in Balance reporting for some merchants in AU. Chargebacks with a lost resolution are being included in the Sellers outstanding balance. Can someone please assist in fixing this? We have seen this with a number of sellers. I am not sure what the total population is or what is causing it but here are some easy to see examples as almost all payments processed are lost chargebacks for these sellers however the transfers balance is still showing the lost payments as payable. LC4WG7MFB8F10, L9XC6Z90PVM77 and LWX3YXWXJSJM0


5 replies
Last reply 6 months agoView thread


obaltay
  10:27 AM
Hi Ledger Team! Just wanted to provide notice that the PayPCP team has updated our PagerDuty monitoring for the missing feeplan alert in staging only to notify with low urgency (page daytime only). This alert has caused strain for our oncall engineers in the past, and we hope to reduce this by lowering the urgency of this alert. The urgency will be unchanged in sandbox and prod. Thanks! cc: 
@plee
 
@zachs
yash
 | G Suite Document
 

FeePlans Runbook (go/feeplansrunbook)
Google Doc



5 replies
Last reply 6 months agoView thread


bjoseph
:spiral_calendar_pad:  12:06 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-105830
(ledger @ Sfd3110e77ae11b5fde6eb30ce7511f4d0d133349 to production)
:+1::+1::skin-tone-2::+1::skin-tone-3:
4






10 replies
Last reply 6 months agoView thread


bjoseph
:spiral_calendar_pad:  12:31 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


bjoseph
:spiral_calendar_pad:  1:05 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


bjoseph
:spiral_calendar_pad:  2:09 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we're out on prod
deploy checks pass


sokolik
:palm_tree:  4:03 PM
:wave:  is this the right channel to ask about the definition of "frozen" as it relates to a unit? My team (Customer Foundations) owns digital receipts and we're trying to prevent a bombardment of scams that have popped up recently. One lever we want to pull is to fail early on "frozen" accounts (we freeze accounts once we detect fraud/scams), but it appears that some sellers can be in frozen states while (1) still accepting payments and (2) having a frozen state for other reasons for which we might still want to send receipts.
:checkmark:
1



19 replies
Last reply 6 months agoView thread


bjoseph
:spiral_calendar_pad:  4:03 PM
deploying 6810d069238e2a39c728f4e6215dab460b6f2b1e (latest) to staging


bji
  9:08 AM
not sure if this is the correct channel but I'm trying payments for a new capital product on staging but the settlement has been stuck in pending status and im not sure why.
:eyes:
1
:checkmark:
1




10 replies
Last reply 6 months agoView thread


bjoseph
:spiral_calendar_pad:  12:07 PM
there's no ledger changes from yesterday's staging sha so no production deploy today


bjoseph
:spiral_calendar_pad:  4:03 PM
deploying 4e5b6b1f65b22c32e5264be739d3a23b6c167d9b (latest) to staging


skaltenbach
:spiral_calendar_pad:  4:32 PM
Hi team - for CA pipeline there is a cutoff of 19:00 PST and the ledger CA pipeline runs at 19:30 PST M-F, but on Sunday it runs at 19:05. And for AU, there is a cut-off time of 11:30 AET and the AU ledger pipeline runs at 11:05 AET. For payouts AU / CA step function runs, we cannot run the live run until the cut off time. However, having these ledger pipelines run just 5 minutes after the cutoff times means that there is no time to rollback to ledger during migration if needed. For example, with GB, payouts runs at 15:30 PST and ledger GB pipeline runs at 16:00 PST, which gave us 30 minutes to flip to 100% ledger if needed.
Would it be possible to push back the Sunday CA ledger pipeline run-time as well as the AU ledger pipeline run-times by ~ 30 minutes?


hikaru
  10:52 PM
Hi team! This chargeback was imported 5 hours ago but it is still not reflected in the balance. (The balance  of this seller is showing 3,080 JPY) Does anyone know why it is taking so long for the balance to reflect the chargeback?


2 replies
Last reply 6 months agoView thread


justinroberts
:funkyfish:  10:05 AM
Hi there! We’ve got an unlinked refund that got rejected at the gateway (so it failed, but after the payment record was marked completed, and there’s not a way for it to go back and update that PR state because of design decisions made long ago) with a ledger entry token of X6JRO8-0u17xBrfQXb27eGCh7xQ and we were hoping y’all could see what the state of that ledger entry is. We want it to be undone if it’s not already (and I think we might be able to do that with a call from refundsarbiter). Thread for more context.


bastien
@cberda
 - in the above thread with 
@cakinrinade
 he investigated this unlinked refund https://regulator.sqprod.co/n/payments/Lx0rmSCywq1WaVdDMQs3UAniA9BZY which was to an AMEX card. Shouldn’t this have been stopped since it’s AMEX?
I reached out to Rodrigo in #payment-partner-ops and he then reached out to AMEX who is now asking questions about the unlinked nature of the refund and the original transaction but then I remembered that AMEX should have not worked in the first place
Thread in unlinked-refunds-canada-powdr | Jan 13th | View message
:eyes:
1
:checkmark:
1



4 replies
Last reply 6 months agoView thread


brenton
:spiral_calendar_pad:  2:28 PM
is there a way to check if a merchant was frozen during a specific period of time? I have an oncall ticket for a merchant where repayments didn't go through from october through january, then showed up combined all at once in january
:checkmark:
1



28 replies
Last reply 6 months agoView thread


bjoseph
:spiral_calendar_pad:  4:07 PM
deploying b80550cbeb644d71202702c30d3e22b3b047a916 (latest) to staging


zandt
:spiral_calendar_pad:  8:18 AM
Hi all. I have a PR open to consolidate the capture payment record processors that are used during processing of the Esperanto Payment Feed. There should not be any behavior changes and I have left some comments for follow-ups once we can be confident that some remaining method specific details can be removed. I would appreciate some feedback :prayforstamp: .
#269638 [ledger] Merge the card and bank capture payment record processors by using the payment adapter
The intent of this change is to pave the way forward to remove payment  
method specific checks from the capture payment record processor. As a  
first step, the card and bank capture payment record processors have  
been merged. There are still some method specific checks, but only  
because there are dependencies to downstream apps or method specific  
Show more
Labels
accounting-engineering
Comments
4
<https://github.com/squareup/java|squareup/java>squareup/java | Jan 5th | Added by GitHub
:eyes:
1






14 replies
Last reply 6 months agoView thread


nan
  9:29 AM
Hi Team, have a question about this SEV (L0NR598Z0FFW5), from Regulator or CBMS (chargeback tables), we saw $649K chargeback. While we only see $319K disputed amount in ledger table. Can the team help to understand the discrepancy here? cc: 
@rpeterson
 
@klachance
 
@andreal

SELECT * FROM ledger.LEDGER__LEDGER_PRODUCTION.pending_balance_snapshots WHERE merchant_token = 'L0NR598Z0FFW5';
:eyes:
1





22 replies
Last reply 6 months agoView thread


klachance
:no_entry:  9:29 AM
was added to #ledger by nan
.


agu
  12:29 PM
Hi Team! I have a question about a Square Balance funded payroll run that failed with a 400 status, i see in presidio that we got
Found backwards incompatibility in calculation for merchant LKJWXP2KG2N2W: 1) outstanding deposit amounts disagree

2) outstanding deposit debit amounts disagree
here's the speleo trace id: CDN-6b356a06-4816-470a-a835-519900e2d41c
can anyone explain what this means? and if it would have bubbled up an error?
:eyes:
1




7 replies
Last reply 6 months agoView thread


songlin
:spiral_calendar_pad:  3:55 PM
deploying 194cd16d9ca707d52e26b6e18b13e1950e108889 to staging


hoyi
  5:16 PM
Deploying latest (11dedf5d998) to staging


ewalls
  7:37 AM
Hi Ledger team, I have a question about settlements: are they idempotent by external_source_id?


klachance
:no_entry:  9:25 AM
Hi team, Im trying to understand why the disputed_amount_cents doesn't line up with the total chargebacks for this user: L8FTYPA2ETYAV
In ledger the disputed_amount_cents is 2000 which represents this payment_token VWQLVL7klMJOMQe6odEnFGW1vaB but this payment_token appears to be missing in ledger J8aFXsTvddYiYUql53iXgJxtuaB but shows up in our chargeback table. Why doesn't this show up in the ledger table? Thanks for your help
cc: 
@evelynlee
 
@merrilyn
 
@mmargenot

SELECT user_token
    ,payment_token
    ,amount_cents
FROM cbms.raw_oltp.disputed_payments
WHERE user_token = 'L8FTYPA2ETYAV'
SELECT * FROM ledger.LEDGER__LEDGER_PRODUCTION.pending_balance_snapshots WHERE merchant_token = 'L8FTYPA2ETYAV';
(edited)
:eyes:
1


2 replies
Last reply 6 months agoView thread


songlin
:spiral_calendar_pad:  12:36 PM
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-106068
(ledger @ 11dedf5d99896ab10fa9941604b509f7c586da5c to production)
:+1:
4



6 replies
Last reply 6 months agoView thread


songlin
:spiral_calendar_pad:  12:55 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-106068…
staging checks pass
:canary: canary start
View newer replies


songlin
:spiral_calendar_pad:  1:36 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-106068…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


songlin
:spiral_calendar_pad:  2:42 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-106068…
:shipitparrot: we're out on prod
deploy checks pass


songlin
:spiral_calendar_pad:  4:05 PM
deploying ee7e2d0ab2e1d6404cefa5a8ddfe8d4e79082a2d to staging


acastberg
  9:29 AM
:wave: hello from transfers, could I deploy a canary on staging for this build today?


16 replies
Last reply 6 months agoView thread


acastberg
  12:14 PM
replied to a thread:
:wave: hello from transfers, could I deploy a canary on staging for this build today?
@bta
 starting deploy
:ack:
1

View newer replies


bta
  12:28 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-106147
(ledger @ ee7e2d0ab2e1d6404cefa5a8ddfe8d4e79082a2d to production)

5 replies
Last reply 6 months agoView thread


bta
  12:45 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


bta
  1:14 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
:+1:
1

View newer replies


bta
  2:12 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we're out on prod
deploy checks pass


bta
  4:06 PM
deploying 9ff3251730e0e9a5eab87a4dd77e65669f742d76 (latest) to staging


chansen
  11:55 AM
Hey :wave: What payment id is associated with ledger entry ftlyx67RTYi8quizwsp3xMF  in staging?
:eyes:
1



4 replies
Last reply 6 months agoView thread


songlin
:spiral_calendar_pad:  12:15 PM
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-106241
(ledger @ 9ff3251730e0e9a5eab87a4dd77e65669f742d76 to production)
:+1:
1



5 replies
Last reply 6 months agoView thread


songlin
:spiral_calendar_pad:  12:17 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-106241…
staging checks pass
:canary: canary start
View newer replies


bjoseph
:spiral_calendar_pad:  12:23 PM
taking over ledger staging with a canary for ~30 mins

2 replies
Last reply 6 months agoView thread


mitchkamman
:hamburger:  12:28 PM
Hey :wave:, from Justice Eng, CivilProcessor is already using SetCivilProcessFreeze to freeze funds. I'm looking to also freeze SFS savings funds, the SFS team told me they subscribe to Ledger's FreezeFeed to do the freezing/unfreezing.
I'm wondering if SetCivilProcessFreeze results in the merchant making it onto the FreezeFeed?
:eyes:
1


1 reply
6 months agoView thread


songlin
:spiral_calendar_pad:  1:05 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-106241…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


cqin
:spiral_calendar_pad:  1:19 PM
Hi team, can I have some help on this ticket please? The money is stuck in ledger, could anyone advise me what I should do to solve this? Thank you:thank:
:eyes:
1



4 replies
Last reply 6 months agoView thread


bjoseph
:spiral_calendar_pad:  2:07 PM
replied to a thread:
taking over ledger staging with a canary for ~30 mins
taking over ledger staging with a canary again for ~30 min


songlin
:spiral_calendar_pad:  2:13 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-106241…
:shipitparrot: we're out on prod
deploy checks pass
:+1:
1



mchiesa
:spiral_calendar_pad:  4:16 PM
:waves: Hi all, to address an alert for a longstanding discrepancy between the response codes returned to clients and the values we record to service container metrics, we have recently merged a PR in the Java monorepo that affects the framework.actions.service_api.response_codes metrics of all Java services that use API Velocity (APIV). Previously, APIV endpoints that returned responses containing V2 errors to clients could record a 200 code to these metrics while the client would receive an error status (4xx or 5xx depending on the V2 code). We have modified APIV to ensure that the recorded metric value reflects the status that is returned to the client. Please note that if you have any detectors on this metric, you may need to adjust their sensitivity to account for this change. Please reach out to #api-frameworks if you have any questions or concerns about this update.


bta
  4:27 PM
deploying d734784974c5b21ae73637d69d027c3030167504 (latest) to staging


bjoseph
:spiral_calendar_pad:  10:37 AM
deploying efb5ed561c6be32e2738f40bd9b247ffc80648b1  (latest) to staging


yelson
:spiral_calendar_pad:  11:24 AM
Hi team, we noticed UK ACH bank settlement for BACS and FASTER_PAYMENTS no longer has new records in the LEDGER.RAW_FEEDS.BANK_SETTLEMENT_ENTRY table after 12/08/2022. Is this the expected behavior? PayPCP team leverage this table to assess UK settlement fee, should we use other source instead? Please redirect me if I’m in heading to the wrong direction. Thank you!
Query attached in thread.



13 replies
Last reply 6 months agoView thread


acastberg
  12:10 PM
replied to a thread:
:wave: hello from transfers, could I deploy a canary on staging for this build today?
starting canary deploy (edited) 
:ack:
1

View newer replies


acastberg
  2:43 PM
:wave: hello, I was wondering if I could get some help in understanding why this settlement containing payments from 1/6 was sent on 1/8 for this seller?
I see a much larger AU weekend transfer(A$123k) went out on 1/6 and the seller is wondering why the other batch of payments for 1/6 wasn't included in this.
:eyes:
1





36 replies
Last reply 5 months agoView thread


bta
  4:09 PM
deploying 24ed4a29720dc27604aafa156ef45c0e67c90158 (latest) to stagin
:bless:
1



bji
  9:26 AM
Not sure if this is the correct channel but I'm doing some payment testing on staging and the ledger entry here shows a type of "mca repayment" but I'm testing with a flex loan. Should the type to be mca regardless of the product?

1 reply
6 months agoView thread


andreyg
:spiral_calendar_pad:  4:02 PM
deploying 246cc204cc7 to staging
:checkmark:
1



bastien
  9:46 AM
Hi team - SP+ Accounting team is doing reconciliation and is trying to track down a few deposits. Are we able to provide any details for them to better trace these with their bank?
3ZFNNR85VFKG8YVAFHBY12E701TS
3ZHGVPTP2ZWM8YVAFHBY12E701TS
3ZM5HS2VBESM8YVAFHBY12E701TS
3ZM5HS8BBESM8YVAFHBY12E701TS
3ZMS2V3MK5CM8YVAFHBY12E701TS
Is the Trace Number show in regulator helpful for them? Do we have ARNs (I think that's what they're called) we can provide? (edited) 
:checkmark:
1



7 replies
Last reply 5 months agoView thread


andreyg
:spiral_calendar_pad:  12:11 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-106420
(ledger @ 246cc204cc7 to production)
:+1:
4



8 replies
Last reply 5 months agoView thread


andreyg
:spiral_calendar_pad:  12:41 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


andreyg
:spiral_calendar_pad:  1:35 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


andreyg
:spiral_calendar_pad:  2:42 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass


acastberg
  3:28 PM
@andreyg
 could I deploy a canary to staging?


andreyg
:spiral_calendar_pad:  3:28 PM
are you going to do some testing?


acastberg
  3:29 PM
yep


andreyg
:spiral_calendar_pad:  3:30 PM
okay, go ahead
:thankyoublob:
1



andreyg
:spiral_calendar_pad:  4:02 PM
@acastberg
 are you still testing?


5 replies
Last reply 5 months agoView thread


zandt
:spiral_calendar_pad:  4:18 PM
Hi all. I have a PR to correct an issue I discovered with a change I made a couple of weeks ago to the Esperanto payment record feed listener. Could I get some eyes on it?
Some additional context here...


ahdoot
So I think we’re fine from the UR perspective because:
URs are not force-refundable via Regulator
The only unlinked refund specific checks that exist in the sync review library are rejection checks
So that combined with Zandt’s query returning nothing makes me think we’re okay. (edited) 
From a thread in refunds-api-help | Jan 30th | View reply
:eyes:
1
:stamp3:
1


2 replies
Last reply 5 months agoView thread


andreyg
:spiral_calendar_pad:  4:47 PM
deploying db7e8796442 to staging


fishes
:spiral_calendar_pad:  9:19 AM
Hello! Could I please can an approval on this renewal request? https://registry.sqprod.co/app_dependency_requests/30515 It allows BadActors to call ledger to freeze accounts flagged on MasterCard MATCH lists, which keeps us in contractual compliance with Mastercard.
:stamp3:
1



zandt
:spiral_calendar_pad:  9:22 AM
replied to a thread:
Hi all. I have a PR to correct an issue I discovered with a change I made a couple of weeks ago to the Esperanto payment record feed listener. Could I get some eyes on it?…
Possible I could get a stamp :prayforstamp: today ? I'd like to get it fixed before it potentially becomes an issue.
:stamp3:
1

View newer replies


kendralarue
:bulb:  10:24 AM
Hello Team! I have an expected behavior question for you. If this is not the right space, please feel free to let me know. We are looking to track down expected behavior/logic for Reg. For context, this account was debited from their bank account rather than their Square Balance as I would expect. We approved a Debit Request expecting the funds to pull from the stored Square balance, but that didn't happen. Can I get an explanation as to why? There are also other account that this happened to here, here, and here.
:eyes:
1



9 replies
Last reply 5 months agoView thread


acastberg
  12:55 PM
:wave: from transfers, we would like to deploy a consumer of the BankSettlementEntryFeed to prod in deposits but are wary that it would consume the history of the feed until it is up to date.
Our listener is configured to take no action on the events it processes right now.
Would it be preferential to pause the consumer and manually update the cursors to consume from the current feed_sync_ids or can we let the consumer catch up by processing all events?
cc 
@oncall




12 replies
Last reply 5 months agoView thread


kcrane
:coolfingergun:  1:08 PM
no code changes in Ledger in the past day, skipping deploy today


zandt
:spiral_calendar_pad:  1:46 PM
cc 
@dskarbek


zandt
My change to Ledger to make use of the RefundAdapter (Standard Payment Record) is now ready for review.
https://github.com/squareup/java/pull/271798
Posted in method-platform-team | Jan 31st | View message
:eyes:
1





34 replies
Last reply 5 months agoView thread


ahwang
  2:43 PM
Hi! Would someone be able to provide read-only access to Ledger snowflake data for my team? https://registry.sqprod.co/access_requests/293621 We are investigating how to make free processing applicable to cost+ transactions and are trying to understand the behavior of cost plus (particularly what data is available in the fee entry that is published for a refund reversal, if any.) Let me know if you need more context. Thank you!


kcrane
:coolfingergun:  4:04 PM
deploying 14bcb778f5d (latest) to staging


tal
:no_entry:  9:40 AM
hello :ablobwave: we're seeing some failures in staging when trying to pull funds from Ledger for an instant transfer, can i get some :eyes: to help investigate? example trace and error in thread:
:checkmark:
1




23 replies
Last reply 5 months agoView thread


andreyg
:spiral_calendar_pad:  10:04 AM
replied to a thread:
Hey team! We’re hoping to finish rolling out RPC enforcement in Envoy SAFE. For ledger, we see that there are a couple RPC routes that are not yet defined in Envoy SAFE: https://presidio-ui.sqprod.co/search?search=application:ledger%20%22Envoy%20SAFE%20Diff%22&instance=staging&window=3d…
done, generated routes on staging
:checkmark:
1

View newer replies


pgombert
  10:56 AM
Hi all, we’ve been hitting some rate limits when calling ledger’s tender service from omnibus. It seems to happen when invocies has bursty traffic around the end of the month, although we do tend to see them pop up over time. It looks like omnibus is allotted 30QPS and I’m wondering 1. if this is new and 2. how did we arrive at this number? We’re trying to determine if we should ask for a bump in QPS, try to smooth out invocies traffic, or both. Thanks!





+2
35 replies
Last reply 4 months agoView thread


andreyg
:spiral_calendar_pad:  12:01 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-106540
(ledger @ 14bcb778f5d to production)

5 replies
Last reply 5 months agoView thread


andreyg
:spiral_calendar_pad:  12:30 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


skaltenbach
:spiral_calendar_pad:  1:21 PM
:wave: Hi team - we are moving into Stage 2 for AU and CA SPooL migration today. I’ll be migrating the following 10 merchants over to SPooL for each market
CA:
L4QR89MMWZRXF
DG09TK4BXCFXC
L4N0CA1H1X1D1
LKJPJZJHHQ08T
3C7GEN30T75MR
L5R1H00YMYTA2
LZZ7S5202WMDK
L6WP6QXTM3MYA
LQSCYDJJM15D9
LWQZJXKAFSCRG
AU:
LZ1J99R73VFVH
LMB6ZRY6HP57P
LV2Q4FMZJRC8B
LBYGNBKXRZ70N
L9VM5KDJADSNQ
LZNHDWDXNABKH
LB75H70VPFC8C
LAMSE7Z1625MK
LKYS8V00MAHCY
L7ZVZ0XRE6QJJ
cc: 
@oncall
 for viz
:ack-red:
1



4 replies
Last reply 5 months agoView thread


andreyg
:spiral_calendar_pad:  1:23 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


cberda
:knife_fork_plate:  2:33 PM
hello :meow-wave:, I'm working on a doc to close a risk gap for SEPA linked bank accounts. I wanted to understand what happens when the seller has some money in their SQ balance but not enough to cover the entire refund.
For example, the seller has 1000€ in their SQ balance but the refund is for 2000€.
Do we take the 1000€ from the SQ balance and attempt to debit 1000€ for their linked bank account?
or do we just attempt to debit 2000€ from their linked bank account?
cc 
@lizstark
 
@dcollins
G Suite Document
 

Close EU SEPA Gap - PRD
Google Doc


andreyg
:spiral_calendar_pad:  2:52 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass


andreyg
:spiral_calendar_pad:  4:04 PM
deploying ad24a9229f6 (latest) to staging
:checkmark:
1



zandt
:spiral_calendar_pad:  8:13 AM
Is there any reason why unlinked refunds are disabled in Ledger sandbox?
:checkmark:
1



3 replies
Last reply 5 months agoView thread


andreyg
:spiral_calendar_pad:  4:09 PM
deploying ce1e3b5759a (latest) to staging
:checkmark:
1



skaltenbach
:spiral_calendar_pad:  1:10 PM
:wave: PR here to move the ledger AU pipeline from 11:35 AET -> 12:00 AET. This this thread has all of the context


bjoseph
:spiral_calendar_pad:  4:00 PM
deploying 14af54236a6 (latest) to staging


mengen
:spiral_calendar_pad:  12:26 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-106704
(ledger @ 14af54236a64a9e83f536206beacdc8a026996d9 to production)
:+1::+1::skin-tone-2:
7





13 replies
Last reply 5 months agoView thread


irisd
:spiral_calendar_pad:  12:27 PM
was added to #ledger by mengen
. Also, brentw
 joined.


mengen
:spiral_calendar_pad:  1:31 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


mengen
:spiral_calendar_pad:  2:04 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


irisd
:spiral_calendar_pad:  2:21 PM
Hi, I'm asking for some clarification on cutoff times for SMBC, details in the thread.




8 replies
Last reply 5 months agoView thread


mengen
:spiral_calendar_pad:  3:20 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass
We have one system check status alert on AU ledger pipeline due to the change of pipeline run time. Hopefully it will auto resolve after the GFF_AUD_WEEKDAY runs today after 2 hours at new run time.


emilyl
  4:22 PM
deploying 8d12a81898d (latest) to staging


dskarbek
:spiral_calendar_pad:  4:25 PM
actually, stoping that deploy to staging and going to restart with a slightly newer one.


dskarbek
:spiral_calendar_pad:  4:33 PM
deploying 520e0281de6b741bbf60daa590a106e1101a4550 (latest) to staging


wouter
:palm_tree:  2:51 AM
hey, question: we are consuming the ledger pending-balance feed, and I was assuming that calculated_at would be an indication of when an entry on the feed was published. but that doesn’t seem to be the case, and that caused some issues in how we processed that data. looking at PendingBalanceFeedImpl, the lag is calculated based on updated_at, so I suppose that’s a better indication; but that field is not exposed in the feed. could you perhaps add that field into the PendingBalance proto so that we can use that?


5 replies
Last reply 5 months agoView thread


escates
  6:00 AM
Hey Team, this strategic seller is reporting trouble issuing refunds. For example, this transaction has a pending status in Regulator but on the Seller's dashboard it shows  6 different records of the refund being cancelled. Seller reported that when they clicked to issue the refund that they receive the "oops something went wrong" error message. Can someone take a look to 1) confirm whether the refund is pending or truly cancelled and 2) if cancelled, confirm how/why it was cancelled?
Thanks!



7 replies
Last reply 5 months agoView thread


skaltenbach
:spiral_calendar_pad:  4:12 PM
:wave: I’d like to move the Sunday run time for the CA Ledger Pipeline (it runs earlier than the Mon-Fri runs) to allow for a rollback in the case of a Payouts issue during migration. Based on a comment in Ledger, the US pipeline needs to run after the CA pipeline completes, so it needs to be moved 15 minutes later as well. The SleepUntilTransmitTransmission stage for the Sunday US run runs for ~55 minutes as transmit time is set at 20:35 - so this shouldn’t delay sending the file to the bank. PTAL when you have a moment: https://github.com/squareup/java/pull/273294
:merged-icon:
1



7 replies
Last reply 5 months agoView thread


mengen
:spiral_calendar_pad:  4:30 PM
deploying 693f065a468 (latest) to staging


sumitg
  9:07 AM
Can i get read only permissions to go/ledgeradmin  I am debugging why certain transfers do not show up in seller's bank account




27 replies
Last reply 5 months agoView thread


acastberg
  10:34 AM
:wave: looking to deploy a canary on staging today




7 replies
Last reply 5 months agoView thread


manij
:spiral_calendar_pad:  10:42 AM
hi there, is there a way to check if the update made to ledger balance(while holding/releasing reserves) is reflected in ledger balance? we(credit risk eng) team are trying to figure out a way to know if the ledger balance is up to date or not and accordingly take actions like alerting in case of any discrepancies? for more context, we use connectV2's GetBalanceSummaryInternalAuthWorkaround API for fetching the balance and ledger RiskReserveService's CreateRiskReserveHold/RiskReserveRelease APIs for holding/releasing. thanks!
cc: 
@yskhoo
:eyes:
1




6 replies
Last reply 5 months agoView thread


tal
:no_entry:  4:25 PM
hello 
@oncall
 :ablobwave: hoping you can help run this ROLL sometime tomorrow to refund IT fees for AU sellers impacted by ALERT-11469 :pray:



15 replies
Last reply 5 months agoView thread


emilyl
  4:28 PM
deploying ae585a40bb1f9789347ce76a9c96cad07b4d34d6 (latest) to staging


dkong
:lacroix:  9:01 AM
hey team, which bank account holds physical funds from UK payments processing (basically the UK version of US WELLS_PLATFORM )? is this more of a baapi question?




16 replies
Last reply 5 months agoView thread


acastberg
  2:16 PM
replied to a thread:
:wave: looking to deploy a canary on staging today
deploy canary to staging :canary-bird:
:done:
1

View newer replies


zandt
:spiral_calendar_pad:  2:34 PM
I've been looking into this for much of the day. Hopefully I might be missing something, but does anyone know where I can find this metric in datadog? I know it should be recorded since I see the corresponding log entry in presidio.
https://github.com/squareup/java/blob/c11d15e9e59a68f0076aa6759212023c4829d21b/set[…]areup/ledger/feeds/consumers/payments/PaymentRecordSkipper.java
PaymentRecordSkipper.java
    if (hasFeesWithNoRefunds(record)) {
      metrics.newCounter(FILTERED_PAYMENTS_WITH_FEES_METRIC_NAME).inc(1);
      errors.add(Errors.error("Ignoring payment with fees from the Esperanto Feed: %s",
          record.getPaymentId()));
    }
Show more
<https://github.com/squareup/java|squareup/java>squareup/java | Added by GitHub



15 replies
Last reply 5 months agoView thread


shawnsaylor
  3:17 PM
Hey team, I am looking for some assistance in understanding what happened with this account. The seller had attempted to change their linked bank account multiple times but they appeared to fail. A freeze was lifted and a debit went to the bank account ending in 330 on 2/5/23. However, the next day on 2/6/23, a deposit went to a different accounting ending in 544. Can someone explain why this had occurred?
:eyes:
1





13 replies
Last reply 5 months agoView thread


ahwang
  3:26 PM
Hi y'all, my team is working on making free processing usable for cost+ merchants later this quarter (around 3/27) and was wondering if your team could take a look at a section of our eng design Add related_entry_type to Free Processing Adjustment ledger entry. We're adding a new field to rewards' FreeProcessingAdjustment (more context in the eng design) and so would like to update the FreeProcessingAdjustment ledger entry to include the same field as well. This new field will ensure that free processing numbers in our Transactions reports don't break once we launch this project. 
@dskarbek
 I believe you worked on a very similar request from us to add a new field for Free Processing Reporting project, and that it was a pretty straightforward change :slightly_smiling_face:  Thank you!
https://docs.google.com/document/d/1g2KYac_OM-Semz3AQBXLXfwo2KGQ-hE_-YMa3HjG4rY/edit#bookmark=id.1m9jn6nqij2k



26 replies
Last reply 4 days agoView thread


tianyu
  4:39 PM
Hi, I have a question regarding Ledger’s use of Kafka Feeds.
I noticed Ledger has a super high producer connection count at fixed times of the day. The publish request rate is also pretty high and the record size is on the low end compared to other services.
The large number of connection count sometimes causes the cluster load to be in the 80%-90%. I have the following questions:
What’s Ledger’s traffic pattern like? It looks like a pretty bursty pattern. Is Ledger using some kind of cron job to publish during certain times of the day?
Is it possible to make it less bursty?
Is Ledger doing anything special with the Kafka publisher? The number of connections is really high compared to other services.
Thank you
2 files
 
Screenshot 2023-02-09 at 4.34.11 PM.png
Screenshot 2023-02-09 at 4.35.34 PM.png


2 replies
Last reply 5 months agoView thread


emilyl
  6:39 PM
deploying 03272c2d0a0 (latest) to staging


zandt
:spiral_calendar_pad:  7:01 AM
Could I get a review of this PR (using standard payment record on unlinked refund processing) ?
#273252 [ledger] Use the refund adapter in the unlinked record processor
The goal of this change is to make use of the Standard Payment Record  
(specifically the Refund Adapter) to remove payment method specific  
logic from Ledger's unlinked refund payment record processor. This should ensure  
no changes to Ledger's unlinked refund payment record processing are needed in  
order to support new payment methods.
This change is a similar effort to (4c22c04) pr #269638 and (1b4ec08) pr #271798
Labels
accounting-engineering
Comments
2
<https://github.com/squareup/java|squareup/java>squareup/java | Feb 7th | Added by GitHub



6 replies
Last reply 5 months agoView thread


tianyu
  9:56 AM
Friendly ping on this https://square.slack.com/archives/CAMN0UWMS/p1675989583282439


tianyu
Hi, I have a question regarding Ledger’s use of Kafka Feeds.
I noticed Ledger has a super high producer connection count at fixed times of the day. The publish request rate is also pretty high and the record size is on the low end compared to other services.
The large number of connection count sometimes causes the cluster load to be in the 80%-90%. I have the following questions:
What’s Ledger’s traffic pattern like? It looks like a pretty bursty pattern. Is Ledger using some kind of cron job to publish during certain times of the day?
Is it possible to make it less bursty?
Show more
2 files
 
Screenshot 2023-02-09 at 4.34.11 PM.png
Screenshot 2023-02-09 at 4.35.34 PM.png
Posted in ledger | Feb 9th | View message





+1
29 replies
Last reply 21 days agoView thread


hoyi
  11:18 AM
Taking over ledger-staging


rho
  1:13 PM
@oncall
 hi, risk infra here. We’ve had a couple instances where we’ve gotten paged for a single payment not being cleared from ledger. We usually refeed or clear it via admin console but I wanted to bring it up since it’s happened intermittently. There’s one such stale payment right now if you wanted to take a look.




39 replies
Last reply 4 months agoView thread


zandt
:spiral_calendar_pad:  10:23 AM
replied to a thread:
Could I get a review of this PR (using standard payment record on unlinked refund processing) ?
Friendly bump :smiley:
:eyes:
1

View newer replies


skaltenbach
:spiral_calendar_pad:  10:39 AM
replied to a thread:
:wave: Hi team - we are moving into Stage 2 for AU and CA SPooL migration today. I’ll be migrating the following 10 merchants over to SPooL for each market…
Everything looks good for the AU/CA migration - so I will be turning Stage 2 on again today for the same merchants above. I will update the merchant migration flags with this request
{
  "merchant_token": [
    "L4QR89MMWZRXF",
    "DG09TK4BXCFXC",
    "L4N0CA1H1X1D1",
    "LKJPJZJHHQ08T",
    "3C7GEN30T75MR",
    "L5R1H00YMYTA2",
    "LZZ7S5202WMDK",
    "L6WP6QXTM3MYA",
    "LQSCYDJJM15D9",
    "LWQZJXKAFSCRG",
    "LZ1J99R73VFVH",
    "LMB6ZRY6HP57P",
    "LV2Q4FMZJRC8B",
    "LBYGNBKXRZ70N",
    "L9VM5KDJADSNQ",
    "LZNHDWDXNABKH",
    "LB75H70VPFC8C",
    "LAMSE7Z1625MK",
    "LKYS8V00MAHCY",
    "L7ZVZ0XRE6QJJ"
  ],
  "settle_using_payouts": true
}
I have also updated the SPOOL expected daily amounts spreadsheet to have the transfer data for these merchants. cc 
@oncall
 for viz (edited) 
G Suite Spreadsheet
 

SPOOL Migration Daily Expectations
Google Sheet
View newer replies


jsilva
  12:38 PM
hey team - can we get someone assigned to this ticket: https://jira.sqprod.co/browse/ONCALL-145203
@lugo
:resolved-redirect:
1




6 replies
Last reply 5 months agoView thread


mitchkamman
:hamburger:  1:57 PM
Hey :wave:, from Justice Eng, CivilProcessor is already using GetBalanceTokenForUnitToken to get a balance token and then SetCivilProcessFreeze to freeze funds. I understand that this RPC results in an update being published to the FreezeFeed /1/freeze , the SFS team told me they subscribe to this FreezeFeed to do freezing/unfreezing of savings accounts. The problem is we should not be freezing savings balances, but in the future, we will. I would like to be able to control whether SFS is freezing the savings balances via this RPC.
I am wondering if we want to not publish to the freeze feed in this case, or if we will just want to add in additional data that can be used to determine behavior.
Thank you in advance!
:resolved-redirect:
1



10 replies
Last reply 5 months agoView thread


rohitdinakar
:spiral_calendar_pad:  3:31 PM
Hi from Risk Infra :wave: . We are trying to understand how ledger determines the risk evaluation staleness for a payment type BANK_TRANSACTION (ach payments). Per my understanding, bank transfer payments when initiated from esperanto have a status of ‘pending’ (Example) and once the bank clears the payment in about 3 business days, the status of that payment changes to completed. Does ledger only consume the bank transaction payments from esperanto that have a status of ‘completed’ and then start a countdown of 15 minute staleness or does it consume the payment way earlier when it is initiated and triggers the staleness check only after the state change? cc 
@zeke
:thank:
1
:checkmark:
1



4 replies
Last reply 5 months agoView thread


hoyi
  4:07 PM
Deploying latest (acdc5bbe8f2) to staging


dskarbek
:spiral_calendar_pad:  4:19 PM
@oncall
 list


9 replies
Last reply 5 months agoView thread


minghua
:spiral_calendar_pad:  1:12 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-107035
(ledger @ acdc5bbe8f2e55e29b97266f9218d8e1ab067fcd to production)
:+1::+1::skin-tone-2:
9






+5
101 replies
Last reply 5 months agoView thread


minghua
:spiral_calendar_pad:  1:37 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


minghua
:spiral_calendar_pad:  2:15 PM
replied to a thread:
Ledger ROLL:…
production deploy checks fail (canary failed)
:atlassian_error: rolling back
View newer replies


minghua
:spiral_calendar_pad:  2:30 PM
replied to a thread:
Ledger ROLL:…
:green: we’re *rolled-back* on prod
deploy checks pass
View newer replies


dskarbek
:spiral_calendar_pad:  7:48 PM
deploying latest 8d8a011115ae58be1c9157f9ebdff7fdb99d635e to staging


asilverman
  10:46 AM
was added to #ledger by lishahe
. Also, mgreenberg
 joined.


awernick
:spiral_calendar_pad:  10:55 AM
:wave: Hey team, do we have the ability to emit a test ChangeRequest in Ledger staging?
For context, we recently finished moving things around in BAAPI’s systems so that Gringotts processes Ledger NOCs  (instead of SqWeb). The new flow is currently behind a feature flag, but we’d like to do an end-to-end test in staging before we fully rollout in production.





23 replies
Last reply 5 months agoView thread


zandt
:spiral_calendar_pad:  10:56 AM
Last of the largish PR's to Ledger for removing direct dependencies to the PaymentRecord (most of the changes involve deleting code). Could I get a review? (cc 
@dskarbek
)
https://github.com/squareup/java/pull/274336
After this change, I will have much smaller and more targeted changes to cleanup the remaining PaymentRecord references.
#274336 [ledger] Use standard payment and refund adapters in PaymentRecordSkipper
On the surface, there are a lot of changes. However, most of the changes  
involve deleting code. Most of the substantial changes are in the  
PaymentRecordSkipper class.
Summary of changes:
• Deleted all of the CountryEntryMethod config classes.
   • The only usage of it was related to skipping US SaaS Card Payments, which I ported the logic to the standard payment/refund isSquareLiability field.
• Deleted the PaymentStates class
Show more
Labels
accounting-engineering
Comments
3
<https://github.com/squareup/java|squareup/java>squareup/java | Feb 14th | Added by GitHub





+3
60 replies
Last reply 5 months agoView thread


minghua
:spiral_calendar_pad:  12:46 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-107118
(ledger @ 8d8a011115ae58be1c9157f9ebdff7fdb99d635e to production)
:+1::+1::skin-tone-2:
11






20 replies
Last reply 5 months agoView thread


minghua
:spiral_calendar_pad:  1:16 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


zehra
:speech_balloon:  1:35 PM
Hi team! https://regulator.sqprod.co/n/users/BGW1453NRETAM?section=transfers trying to figure this out: enrolled in PP 1/19. Seller processed a payment yesterday for $180.00. $174.48 (after Square fees) showing in available balance. When looking at PP, i see that $36 has been captured. Why  did the percentage processing Adjustment result in a Transfer instead of just reducing the available balance.


minghua
:spiral_calendar_pad:  1:50 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
:tada:
4

View newer replies


minghua
:spiral_calendar_pad:  2:41 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass
:dance_and_wear_sunnies:
6



rose
:spiral_calendar_pad:  3:23 PM
Are there currently any controls in place to prevent freezes from being applied to a specific merchant? Use case being one of the "magic merchants" used at Square that is tied to a product (Bill Pay in this case)
:checkmark:
1



4 replies
Last reply 5 months agoView thread


hoyi
  4:04 PM
Deploying latest (1e81a6c31aa) to staging


ena
  9:27 AM
heya team! :helloblob: would I be able to test a canary on staging around 12:40pm PST? :canary-bird:
We’ll need it for an hour and a half, as we’re doing some testing on dashboard & our mobile clients (should only affect the US IT fee for onboarding sellers) :blobheart:



15 replies
Last reply 5 months agoView thread


awernick
:spiral_calendar_pad:  11:22 AM
Bump on this! I’d really like to test this out before EOW so we can start rollout early next week.


awernick
:wave: Hey team, do we have the ability to emit a test ChangeRequest in Ledger staging?
For context, we recently finished moving things around in BAAPI’s systems so that Gringotts processes Ledger NOCs  (instead of SqWeb). The new flow is currently behind a feature flag, but we’d like to do an end-to-end test in staging before we fully rollout in production.
Posted in ledger | Feb 15th | View message
:eyes:
1



hoyi
  4:01 PM
Deploying latest (48e92ed7f8c) to staging


bta
  4:20 PM
Deploying latest 213fdc338ad30dc615d738d2886545a7aaa28d3c to staging
:bless:
1



dskarbek
:spiral_calendar_pad:  6:18 PM
Deploying latest 291fc924eef409dc189dce2b60a2b99cc0342fb9 to staging  (wanted to get my latest PR on there)


zandt
:spiral_calendar_pad:  9:06 AM
replied to a thread:
Last of the largish PR's to Ledger for removing direct dependencies to the PaymentRecord (most of the changes involve deleting code). Could I get a review? (cc @dskarbek)…
I found a couple of bugs after running the change on staging over the weekend. I've addressed them along with some additional unit tests to ensure these scenarios are covered. Anyone able to take a look ? I want to make sure they are fixed before the next ledger deploy since it would cause problems with not being able to process refunds correctly.
https://github.com/squareup/java/pull/275014
#275014 [ledger] Correct bugs found while testing changes to payment record skipper PAYMP-12
There are two bugs that I found while testing changes from pr #274336.
1. The logic to skip payment records with fees containing no refunds was  
   missing a check to allow fees with refunds.
2. The new method for returning errors related to unlinked refunds was  
   always returning an empty collection, instead of the intended set of  
   errors.
Additional unit tests have been added to cover these scenarios.
Labels
accounting-engineering
Comments
1
<https://github.com/squareup/java|squareup/java>squareup/java | Feb 21st | Added by GitHub
:eyes:
1
:stamp3:
1

View newer replies


bjoseph
:spiral_calendar_pad:  12:31 PM
replied to a thread:
Last of the largish PR's to Ledger for removing direct dependencies to the PaymentRecord (most of the changes involve deleting code). Could I get a review? (cc @dskarbek)…
skipping the ledger deploy today due to a bug in refunds that should be fixed for tomorrow's deploy
View newer replies


bjoseph
:spiral_calendar_pad:  4:01 PM
deploying latest e2ff47561ec67740cbb4823c3f14c8b9a4d9079e  to staging

PayswingBot
APP  6:01 AM
Evacuating payments traffic from WEST datacenters (swinging EAST) in production has been initiated by davidsmith with message: Network maintenance -- https://jira.sqprod.co/browse/ROLL-107249


dskarbek
:spiral_calendar_pad:  9:51 AM
@oncall
 did we not deploy ledger yesterday?




5 replies
Last reply 5 months agoView thread


skaltenbach
:spiral_calendar_pad:  10:19 AM
:annouce: We will be kicking off Stage 3 of AU/CA SPooL migrations today :annouce:
The UpdateMerchantMigrationFlagRequests will include the first 1000 merchants (rows 5-1005) in stage 3 for the markets in this spreadsheet  (edited) 

4 replies
Last reply 4 months agoView thread

PayswingBot
APP  12:05 PM
Restoring normal payments traffic (unswinging) in production has been initiated by albertdam with message: Network maintenance completed (rolled back) -- https://jira.sqprod.co/browse/ROLL-107249


skaltenbach
:spiral_calendar_pad:  1:13 PM
Hey 
@oncall
 - I’m trying to use the GenerateReturnFile RPC in ledger and it wants a bank_settlement_entry_tokens_to_change …what is this?




16 replies
Last reply 3 months agoView thread


songlin
:spiral_calendar_pad:  4:01 PM
deploying 5bc99e91180d44cf9fd1f42c660db141061f8f53 to staging
:bless:
1


PayswingBot
APP  8:09 AM
Evacuating payments traffic from WEST datacenters (swinging EAST) in production has been initiated by albertdam with message: Network maintenance -- https://jira.sqprod.co/browse/ROLL-107249


ena
  9:46 AM
hey team! can we borrow staging for a canary test at 12:40pm PST today? :pray::skin-tone-2: we should only need it for about an hour! :tybig:




17 replies
Last reply 5 months agoView thread


skaltenbach
:spiral_calendar_pad:  10:11 AM
replied to a thread:
:annouce: We will be kicking off Stage 3 of AU/CA SPooL migrations today :annouce:…
Both CA and AU runs were successful without issue yesterday, so we will be migrating the next 1000 merchants per market for today’s runs (rows 1006-2005 in the spreadsheet above)
:clap-clap:
3

View newer replies

PayswingBot
APP  12:10 PM
Restoring normal payments traffic (unswinging) in production has been initiated by davidsmith with message: General stability concerns in IAD


songlin
:spiral_calendar_pad:  12:20 PM
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-107418
(ledger @ 5bc99e91180d44cf9fd1f42c660db141061f8f53 to production)
:+1::+1::skin-tone-2:
9
:stamp3:
1






12 replies
Last reply 5 months agoView thread


songlin
:spiral_calendar_pad:  12:35 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-107418…
staging checks pass
:canary: canary start
View newer replies

PayswingBot
APP  12:42 PM
Evacuating payments traffic from EAST datacenters (swinging WEST) in production has been initiated by davidsmith with message: Stability concerns in IAD
:ack:
1



brentw
:spiral_calendar_pad:  1:16 PM
@oncall
 Can you take a look at a PR that affects settlements when you get the chance?
:done:
1





5 replies
Last reply 5 months agoView thread


songlin
:spiral_calendar_pad:  1:21 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-107418…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


songlin
:spiral_calendar_pad:  2:37 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-107418…
:shipitparrot: we're out on prod
deploy checks pass

PayswingBot
APP  2:56 PM
Restoring normal payments traffic (unswinging) in production has been initiated by davidsmith with message: #pay-incident-265 resolved

PayswingBot
APP  3:01 PM
Evacuating payments traffic from WEST datacenters (swinging EAST) in production has been initiated by davidsmith with message: Complete interrupted network maintenance -- https://jira.sqprod.co/browse/ROLL-107249
:ack:
1


PayswingBot
APP  3:39 PM
Restoring normal payments traffic (unswinging) in production has been initiated by aedwards with message: trying to fix SEV

1 reply
5 months agoView thread


songlin
:spiral_calendar_pad:  3:58 PM
deploying 16d9a2e28343e5db4c477f23d93c3bf4850c4b33 to staging
:bless:
1



fasih
  4:30 PM
@oncall
 :wave: was there a deploy today that changed the refund_policy  enum proto? We, PDA, got another ledger entry where one file had
{
   "type":"enum",
   "name":"RefundPolicy",
   "symbols":[
      "DEFAULT_REFUND_POLICY_DO_NOT_USE",
      "FEES_REFUNDABLE",
      "FEES_NON_REFUNDABLE"
   ]
}
and others that had
{
   "type":"enum",
   "name":"RefundPolicy",
   "symbols":[
      "DEFAULT_REFUND_POLICY_DO_NOT_USE",
      "PROPORTIONAL_REFUND",
      "NO_FEES_REFUND"
   ]
}



16 replies
Last reply 5 months agoView thread


mgp
:baby:  3:22 PM
@oncall
 deploying a canary to Ledger staging

1 reply
5 months agoView thread


bjoseph
:spiral_calendar_pad:  4:04 PM
deploying latest f021ad53eb800af0c45cc579e78ff21d480a464f to staging


zandt
:spiral_calendar_pad:  4:47 PM
replied to a thread:
Last of the largish PR's to Ledger for removing direct dependencies to the PaymentRecord (most of the changes involve deleting code). Could I get a review? (cc @dskarbek)…
An update to this. I have a change (pr) to Ledger that should resolve this issue by ignoring payments that are not a Square liability during risk state evaluation processing. Originally, I was thinking these SaaS payments should be skipped entirely by Risk. They kind of are, but processed with an 'all clear' risk assessment. This is different than ignoring the payments completely as is the case of payments that do not move money (some discussion here).
I plan to do some testing of my change Monday with a Staging canary.


zandt
Hi all. Question about risk checks for internal Square merchants (specifically SaaS US). I see that riskarbiter has 7TV3AV0NCZ16X (Square Paid Svcs) listed under square_unit_tokens.
From the logic in PaymentRecordRiskFilter, I can see it is checked in the shouldPublishDummyScoredPayments method, but not in the shouldEvaluateRisk method.
What would be the reason why this internal merchant is not excluded from all risk checks?
Show more
Thread in risk-infrastructure | Feb 23rd | View message
#275716 [ledger] Ensure risk evaluations are ignored for payments that do not impact the seller balance PAYMP-14 PAYMP-12
There are payments that are intentionally skipped by Ledger since  
they are not a Square liability. However, risk may still evaluate them  
with an 'all clear' risk assessment. During processing of the risk  
evaluation feed, payments that are not a liability should be ignored  
so they do not fall into the holding area.
There are two main changes with this PR:
• Direct dependencies to the Esperanto Payment Record for checking old  
Show more
Labels
accounting-engineering
Comments
1
<https://github.com/squareup/java|squareup/java>squareup/java | Feb 24th | Added by GitHub
View newer replies


zandt
:spiral_calendar_pad:  8:30 AM
replied to a thread:
Last of the largish PR's to Ledger for removing direct dependencies to the PaymentRecord (most of the changes involve deleting code). Could I get a review? (cc @dskarbek)…
Could I get this canary build deployed to staging?
https://kochiku.sqprod.co/squareup/java/builds/6670992
View newer replies


andreyg
:spiral_calendar_pad:  9:26 AM
taking over staging for ~1hr for testing

1 reply
5 months agoView thread


skaltenbach
:spiral_calendar_pad:  9:44 AM
replied to a thread:
:annouce: We will be kicking off Stage 3 of AU/CA SPooL migrations today :annouce:…
Everything looks good - we will migrate another 2000 merchants per market today. (rows 2006 - 4005 in the spreadsheet).
:done:
1

View newer replies


andreyg
:spiral_calendar_pad:  10:07 AM
replied to a thread:
taking over staging for ~1hr for testing
done, rolling back to f021ad53eb8


alafranchise
:spiral_calendar_pad:  11:18 AM
@oncall
 I'm going to start a backfill for bank account state (part of our BAOS migration) at 1PM PST. You may see elevated numbers of link/unlink events. We are going to start slowly and dial up the backfill batch size as we go. See ROLL for details:
https://jira.sqprod.co/browse/ROLL-107371
:ack-red:
1


1 reply
5 months agoView thread


hoyi
  12:54 PM
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-107571
(ledger @ f021ad53eb8 to production)
:+1::+1::skin-tone-2:
5




6 replies
Last reply 4 months agoView thread


hoyi
  1:18 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-107571…
staging checks pass
:canary: canary start
View newer replies


hoyi
  1:57 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-107571…
canary deploy checks pass
:rolling_kirby: rolling forward


mengen
:spiral_calendar_pad:  2:28 PM
Deploying latest 4e08568ecd25577b8dc73c59c56a85193e7e6742 to Ledger staging


hoyi
  4:04 PM
Deploying latest (d3dcc0a4d79) to staging


zandt
:spiral_calendar_pad:  11:20 AM
https://github.com/squareup/java/pull/276008
#276008 [ledger] Refactor RefundPaymentRecordProcessor to use the feeRefundPolicy field on the refund adapter PAYMP-14
This change simplifies the lookup of the new fee refund policy field to  
pull it from the refund adapter instead of the raw Esperanto payment  
record.
Labels
accounting-engineering
Comments
3
<https://github.com/squareup/java|squareup/java>squareup/java | Feb 28th | Added by GitHub


zandt
:spiral_calendar_pad:  11:36 AM
Does anyone know what's going on with this test? it seems flaky today and it just failed on the master build.
AccountingQueueSqsIntegrationTest.testStopProcessingWithFeatureFlag


dskarbek
:spiral_calendar_pad:  11:41 AM
Yeah, it is flaky
:ack:
1



5 replies
Last reply 4 months agoView thread


kyeboah
:spiral_calendar_pad:  12:35 PM
Hi team :wave:, I have a question regarding the bai_transaction_detail feed data that the ledger app consumes from labrador.
The feed contains data that could be considered sensitive (customer_reference_number and bank_reference_number). Is the data that ledger app consumes considered sensitive (PII) and is it needed in the un-redacted form?
PS: If this is not the right channel, please let me know :thankyoublob: (edited) 
:eyes:
1



13 replies
Last reply 4 months agoView thread


jarlan
  12:54 PM
Hello, wondering if someone can help explain the different balances Ledger might look at to move money around. Really if there’s a doc that you could point me to, that would be best. An example for context is here, but basically it seems like sometimes a money movement occurs (overwhelmingly an Adjustment for my use case) but then operates in a way that we aren’t expecting.
ex: a Debit Adjustment results in an outbound debit, even though the adjustment amount was for less than the unit’s current processing balance. So far I’ve ruled out custom transfer schedules being in play, but not even sure what else I should be looking out for.
:checkmark:
1



5 replies
Last reply 4 months agoView thread


hoyi
  1:13 PM
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-107643
(ledger @ d3dcc0a4d79 to production)
:+1:
3



4 replies
Last reply 4 months agoView thread


hoyi
  1:20 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-107643…
staging checks pass
:canary: canary start
View newer replies


hoyi
  1:42 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-107643…
canary deploy checks pass
:rolling_kirby: rolling forward


jthomas
  2:42 PM
Hi! Related to http://go/settlementschedule where are POS cutoff times defined? Is there a yaml file that defines those?


2 replies
Last reply 4 months agoView thread


hoyi
  4:04 PM
Deploying latest (e27d9a65688) to staging


skaltenbach
:spiral_calendar_pad:  10:03 AM
replied to a thread:
:annouce: We will be kicking off Stage 3 of AU/CA SPooL migrations today :annouce:…
Today we will be migrating all remaining stage 3 AU merchants (~900 merhants rows 4006 to the end) and 4000 more CA merchants (rows 4006 to 8005). This will complete stage 3 migrations for AU,  CA will be completed on Thursday.
:yay:
1
:celeryman3:
1

View newer replies


kataria
:spiral_calendar_pad:  12:06 PM
Hi team, we are investigating an ONCALL ticket, the ledger balance was 0 and hence no sweep was made to SFS by moneysweeper (log trace).
We found 13 payments out of 31 which seller made that day which had this issue, but we did not find any refunds on that day (from Regulator). Can you please help tell why the ledger  balance was 0 for this unit for these 13 payments on 02/22?
Note: We have logs for few more days before we loose logs to investigate. CC: 
@abhishekg
  
@muftiat





7 replies
Last reply 4 months agoView thread


muftiat
  12:12 PM
was added to #ledger by kataria
.


palak
:spiral_calendar_pad:  12:24 PM
hello! what time does ledger.raw_feeds.freeze update everyday? i am looking for a data source in snowflake which has accounts marked as frozen or deactivated. eg:
select * from ledger.raw_feeds.freeze 
where merchanttoken='MLB8P9R2SQAN2'
this merchant is marked frozen and deactivated around yesterday evening but not showing up in the table. is there any other data source that would have this info? i'm trying to find a source that does not have a latency issue and has data in (1) real time or (2) has atleast all the frozen/deactivated info from the day before available early in the morning.  cc: 
@jackscoglio
 
@shasta
 (edited) 
:eyes:
1



32 replies
Last reply 4 months agoView thread


hoyi
  12:49 PM
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-107720
(ledger @ e27d9a65688 to production)



5 replies
Last reply 4 months agoView thread


hoyi
  1:09 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-107720…
staging checks pass
:canary: canary start
View newer replies


hoyi
  2:02 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-107720…
canary deploy checks pass
:rolling_kirby: rolling forward


zandt
:spiral_calendar_pad:  3:44 PM
Could I get a review :prayforstamp: of https://github.com/squareup/java/pull/276008 ? Pretty small change to get the fee refund policy from the standard payment record.
#276008 [ledger] Refactor RefundPaymentRecordProcessor to use the feeRefundPolicy field on the refund adapter PAYMP-14
This change simplifies the lookup of the new fee refund policy field to  
pull it from the refund adapter instead of the raw Esperanto payment  
record.
Labels
accounting-engineering
Comments
3
<https://github.com/squareup/java|squareup/java>squareup/java | Feb 28th | Added by GitHub


bta
  4:27 PM
deploying latest 43c36d682e3289755d9448050e6534fdd8fcbf43 to staging


briannab
  8:21 AM
Hello! I was wondering if we may be able to see what team is debiting the merchant ? I am trying to figure it out so I can escalate to the right team to followup with the seller! Thank you for your help!



12 replies
Last reply 4 months agoView thread


zandt
:spiral_calendar_pad:  8:51 AM
Question. Why does Ledger consider a payment "old" up to 3 years and not 1 year? Just wondering if there are known scenarios where Ledger needs to be able to handle a payment older than 1 year.
OldPaymentChecker.java
  // The threshold for an old payment is any payment older than 3 years old from the current date.
  // This should be sufficient for the purposes of feed consumption where our feed consumers
  // should not expect to consume data from more than 3 years ago.
  @VisibleForTesting static final Duration OLD_PAYMENT_THRESHOLD = Duration.standardDays(365L * 3L);
<https://github.com/squareup/java|squareup/java>squareup/java | Added by GitHub



17 replies
Last reply 4 months agoView thread


skaltenbach
:spiral_calendar_pad:  11:56 AM
replied to a thread:
:annouce: We will be kicking off Stage 3 of AU/CA SPooL migrations today :annouce:…
Migrating the remaining ~2500 merchants for CA to complete Stage 3 migrations (rows 8006 to the end in the spreadsheet)


hoyi
  12:04 PM
Deploying 27d00e95ccd to staging


bta
  12:50 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-107783
(ledger @ 27d00e95ccd10d0cfb96448d8933dba0b71d9907 to production)
:+1:
6






+1
16 replies
Last reply 4 months agoView thread


zandt
:spiral_calendar_pad:  1:07 PM
Could I get a review of https://github.com/squareup/java/pull/276455 ? (fairly small... drops some unused direct payment record references from the refund payment record processor)
#276455 [ledger] Remove remaining direct payment record references from the RefundPaymentRecordProcessor PAYMP-14
I've removed the remaining direct payment record references from the  
RefundPaymentRecordProcessor, along with marking the  
target_platform_account_token field as deprecated on the RefundEvent  
proto. This is a field associated with the market places  
project that never got off the ground.
Related to pr #271798.
Labels
accounting-engineering
Comments
3
<https://github.com/squareup/java|squareup/java>squareup/java | Mar 2nd | Added by GitHub


bta
  1:24 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


bta
  1:52 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


kataria
:spiral_calendar_pad:  1:55 PM
Hi team, 
@oncall
 - can you help look in to this oncall issue? It has been escalated by our compliance due to a BBR complaint. Notes doc
CC: 
@haoyang
 
@abhishekg
 
@tugce
:eyes:
1






29 replies
Last reply 4 months agoView thread


andreyg
:spiral_calendar_pad:  4:09 PM
deploying latest 8a12bf09de532d97e87a72b6b6895d9eb2444d98 to staging


emilyl
  5:55 PM
:alert-fyi: Ledger’s risk feed has been paused in production (edited) 


5 replies
Last reply 4 months agoView thread


emilyl
  9:17 PM
replied to a thread:
:alert-fyi: Ledger’s risk feed has been paused in production
Risk feed has been resumed. There are still some entries waiting to be retried in the holding area but are catching up


jengel
:spiral_calendar_pad:  8:40 AM
Hey Team, How does the SUSPECTED reason in the MerchantSettlementState get set?

1 reply
4 months agoView thread


bta
  4:10 PM
deploying latest 7fd286d3da1d947d2e2c673714ca9a86fe6bb5ce to staging


skaltenbach
:spiral_calendar_pad:  9:29 AM
:annouce: Today we will be starting Stage 4 of the AU/CA SPooL Migration Plan :annouce:
For part 1 of Stage 4 we will migrate 4 high volume sellers in each market. We’ll keep just these 8 stage 4 merchants migrated for at least 3 nights of settlement before migrating the rest of the stage 4 merchants in the spreadsheet
For CA:
1F6SWMJRCNCPW
8EKD18AJYSZ5E
BTANESZMYCDK5
8KW4ZVTHHTBGN
For AU:
81FDXHVKQPYW6
L4AGM3JHA1QGD
LYY5EYTV01WTW
5FDBME2ATZWHR
(edited)
:+1:
1
:tada:
1


3 replies
Last reply 4 months agoView thread


bta
  12:31 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-107913
(ledger @ 7fd286d3da1d947d2e2c673714ca9a86fe6bb5ce to production)
:+1:
3



5 replies
Last reply 4 months agoView thread


jpulgarin
  12:32 PM
was added to #ledger by bta
.


bta
  1:03 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


bta
  1:32 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


bta
  2:30 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we're out on prod
deploy checks pass


bta
  6:49 PM
deploying latest 5c5ca7e3c8ed33e5360df239b5527bf8b687b994 to staging


pfinnegan
:palm_tree:  7:01 PM
The Merchant has reported that every month we are debiting from their account £10.89 and then we refund it. She has provided bank statements in the case showing this. I filed a JIRA and they advised the following "The sale bill and the return bill look uncomplicated. The refund succeeded on the first attempt. Any error that is occurring is occurring within the payments stack. Please reassign to the settlements team."

2 replies
Last reply 4 months agoView thread


skaltenbach
:spiral_calendar_pad:  12:14 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-107984
(ledger @ 5c5ca7e3c8ed33e5360df239b5527bf8b687b994 to production)
:+1:
1



8 replies
Last reply 4 months agoView thread


skaltenbach
:spiral_calendar_pad:  12:38 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


mgreenberg
  1:05 PM
replied to a thread:
Hi all, we’ve been hitting some rate limits when calling ledger’s tender service from omnibus. It seems to happen when invocies has bursty traffic around the end of the month, although we do tend to see them pop up over time. It looks like omnibus is allotted 30QPS and I’m wondering 1. if this is new and 2. how did we arrive at this number? We’re trying to determine if we should ask for a bump in QPS, try to smooth out invocies traffic, or both. Thanks!
@oncall
 — can we get engagement on this thread. it’s been a week without a response despite multiple pings. thanks
:eyes:
1

View newer replies


skaltenbach
:spiral_calendar_pad:  1:21 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


skaltenbach
:spiral_calendar_pad:  2:48 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass


skaltenbach
:spiral_calendar_pad:  4:08 PM
deploying e32532ea9ca9158a1fc2af084cc9bf3fd673f528 to staging


cschram
  2:10 PM
Hi team, I am hoping to find out more information about an interac debit :canada: refund and where the balance is drawn from for returns. Basically seller had a refund on interac debit and wasn't able to process it. As per JIRA, they didn't have enough of a balance to process the refund. But based on my rough calculations (looking at transaction reporting), they should have had more than enough to cover the $330 refund. Refund attempted at these unit tokens: LSCAPRX7PFJDB and LZTK732W4289S. Any insights would be appreciated :pray-all:


9 replies
Last reply 4 months agoView thread


jschaeffer
:ooo_1:  3:29 PM
Hi team, working with an enterprise seller who is trying to locate which account the below deposits came from. Not sure this is the correct channel but hoping someone might be able to point me in the right direction. The bank account they were deposited to ends in *468
$973.80 	3ZFZ42CRWBWM8YV4Q2BY12E701TD
$1,124.95 	3ZFZ42CRWBWM8YV4Q2BY12E701TD
$1,507.35 	3ZFZ42CRWBWM8YV4Q2BY12E701TD
$607.40 	3ZFZ42CRWBWM8YV4Q2BY12E701TD
$1,296.25 	3ZFZ42CRWBWM8YV4Q2BY12E701TD
$176.90 	3ZFZ42CRWBWM8YV4Q2BY12E701TD




13 replies
Last reply 4 months agoView thread


aackerman
  7:15 AM
Hi Ledger team, I wanted to ask a question about the stale risk payment metrics emitted by ledger in :thread:



6 replies
Last reply 4 months agoView thread


skaltenbach
:spiral_calendar_pad:  11:03 AM
replied to a thread:
:annouce: Today we will be starting Stage 4 of the AU/CA SPooL Migration Plan :annouce:…
:annouce:  I am migrating the rest of the stage 4 merchants in the spreadsheet above for AU and CA to SPooL (~2000 merchants per market) :annouce:
:done:
1

View newer replies


bjoseph
:spiral_calendar_pad:  12:23 PM
deploying 7d619a79e70a5bbe628e06dc5f6df376eb1de627  (latest) to staging


skaltenbach
:spiral_calendar_pad:  4:10 PM
deploying 595aa28ceb181197dba81fdad961d507ecd69acf(latest) to staging


tmahoney
  6:30 PM
:wave: just curious, what’s up with this staging payment? the refund got wedged in refundsarbiter — RA’s first processing step (creating a refund ledger entry) succeeded, but then when RA tries to look up that same ledger token again later, we can’t find it.
it looks like Ledger’s MessageQueueAccountingQueueProcessor gets java.lang.IllegalStateException: No book entries with positive amounts are set in GrossFeeRefundJournalEntryTemplate$Builder.build: link
it’s not a huge deal that a refund got stuck in staging, and clearly there was some experimenting going on with this staging refund (all good, that’s what staging is for…), but I wonder if the failure mode here in ledger could be improved? from our POV, it’s weird that CreateRefundLedgerEntry returned a success response + ledger entry token, but then we couldn’t look up that same token later.



9 replies
Last reply 4 months agoView thread


bwester
:officepig:  12:50 PM
hi team, random question: I noticed that all of the FreezeService methods are listed in ledger's route permissions except for SetActivationFreeze. could I request that the route to that RPC method be added too?  thanks!
:eyes:
1





9 replies
Last reply 4 months agoView thread


fpereira
  2:14 PM
Hi all, not sure this is the right channel, but is there a way to query in Snowflake, for a group of user tokens, who they are sending their balances to?
For instance, trying to identify whether funds are being sent to a another seller/company or a specific bank. (edited) 

PayswingBot
APP  2:24 PM
Evacuating payments traffic from WEST datacenters (swinging EAST) in production has been initiated by bmazanec with message: Swinging East for #pay-incident-272

PayswingBot
APP  3:48 PM
Restoring normal payments traffic (unswinging) in production has been initiated by bmazanec with message: Returning to normal as pay-incident-272 stabilizes


mchiesa
:spiral_calendar_pad:  7:46 AM
Hello :wave:  I'm reaching out about the ledger service(s) which use(s) API Velocity and Envoy Logging.  As a follow-up for a recent SEV (see ALERT-11256) we created additional monitors to help detect dropped logs for your app.  Fortunately we’ve done all of the heavy lifting for you, and all your team has to do is add the monitors to your app.  We strongly recommend that you add these monitors to detect and prevent any data loss to ES2, Datadog, and CDP (powers the API Log Inspector).
Additionally we would like API owners to set up monitors tracking their Envoy Sidecar CPU usage.  This will further improve the stability of Envoy Logging
Action Items
Open this Jira epic, find the ticket with your app's name, assign it to a point of contact from your team, and follow the instructions in the ticket.  If you choose to create a separate ticket to track this work in your own Jira project/board please link it to the ticket we created.  Please mark the ticket IN PROGRESS when you start working on it and RESOLVED when you finish.  We strongly recommend completing this task within the next 4 weeks to protect us from potential data loss.  See more details in this setup guide
If you have any questions or concerns, please reach out to us on #api-frameworks


skaltenbach
:spiral_calendar_pad:  9:58 AM
replied to a thread:
:annouce: Today we will be starting Stage 4 of the AU/CA SPooL Migration Plan :annouce:…
Stage 4 is complete for both AU and CA. We will begin stage 5 for AU today by flipping the market migration state to MIGRATED. Per BCONs request, we will wait until tomorrow to set CA to MIGRATED to make sure the teller pipeline handles the 100% AU traffic fine first.
View newer replies


jquindica
  10:27 AM
Not sure if this is the right channel for this, but we're trying to understand why a seller's bank account was unlinked. This seller is a Term Loans borrower, and they have 3 non-consecutive failed payments towards their loan. Assuming this is the right channel, could one of y'all please take a look at this seller?
:checkmark:
1





13 replies
Last reply 4 months agoView thread


aackerman
  12:02 PM
Hi team, in staging we've had about 6k stale risk payments for the last 2 months or so, I spot checked and see most of these are actually from 2022 :sweat_smile: I am going to try clearing them out by turning on the clear_existing_unscored_payments flag in staging and wanted to give a heads up here
:ack:
1



kcrane
:coolfingergun:  1:19 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-108296
(ledger @ dcfb698df4 to production)
:+1::+1::skin-tone-2:
6



5 replies
Last reply 4 months agoView thread


kcrane
:coolfingergun:  1:26 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:chocobo-face: canary start
View newer replies


kcrane
:coolfingergun:  1:55 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


minghua
:spiral_calendar_pad:  2:48 PM
Looking into removing webBankAccountsFeed configs <- PR
Cross-posted this in BAAPI channel too. I think we’re ok removing this, but could use a sanity check (edited) 
:merge:
1



kcrane
:coolfingergun:  3:17 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we're out on prod
deploy checks pass
:thank:
1



emilyl
  4:08 PM
deploying 140b96e2372 (latest) to staging


rishika
:goldengate:  4:59 PM
Hey :wave:, I am testing a new rpc in staging which adds (SEPA) payment record. It has triggered an alert and could potentially block ledger esperanto payment feed. Please let me know if there are process on my end to make sure existing pipelines stay functional.
https://square.slack.com/archives/C025LAF94DB/p1678751335592839 (edited) 


zandt
I think these are related to the async payments (SEPA) ?
rbp1Pp6Gzp8j9Z4B2dWPbgU5vaB
    "payment_type": "ASYNC_TRANSACTION",
Thread in alt-payment-methods-help | Mar 13th | View message



30 replies
Last reply 4 months agoView thread


emilyl
  6:59 PM
replied to a thread:
Hey :wave:, I am testing a new rpc in staging which adds (SEPA) payment record. It has triggered an alert and could potentially block ledger esperanto payment feed. Please let me know if there are process on my end to make sure existing pipelines stay functional.…
:fyii: ledger staging is not consuming esperanto so we will be behind in staging until we merge a fix tomorrow
View newer replies


skaltenbach
:spiral_calendar_pad:  9:34 AM
replied to a thread:
:annouce: Today we will be starting Stage 4 of the AU/CA SPooL Migration Plan :annouce:…
Everything went well yesterday for AU :+1: Today we will set CA to MIGRATED to move 100% of CA merchants to the Payouts workflow.
:do_it:
1
:fingers_crossed:
1



emilyl
  9:55 AM
deploying f374ab52873 (latest) to staging

1 reply
4 months agoView thread


cuong
:spiral_calendar_pad:  10:08 AM
Hi team, let me know if I post this in a wrong channel. I have a user that is unable to deactivate Square account. I am from seller profile team and by looking at our code I am guessing that this is happening because there is still pending balance. How can I confirm if that is the cause? Is there a way to tell the pending balance of user?


19 replies
Last reply 3 months agoView thread


bforehand
  10:15 AM
Hello Ledger friends, I noticed in teller that we had a secret called teller-database.yaml which appears to have contained a randomly generated password for accessing the database; however, I talked with #ods and they confirmed that they do not use any such mechanism for accessing the database. The secret in question for Teller was from 2014. I can see that ledger has a similar ledger-database.yaml secret from the Square Console. Today, I have removed the teller-database.yaml secret in staging with no impact. Tomorrow, I will be removing this secret from production as well. I suspect this secret is not useful to Ledger either, and you may also want to clean it up cc: 
@oncall
:niceee:
1




4 replies
Last reply 4 months agoView thread


emilyl
  10:43 AM
replied to a thread:
deploying f374ab52873 (latest) to staging
:fyii: ledger staging has resumed processing the esperanto feed
:blob-tada-gif:
3



bhargava
  12:27 PM
tiny PR to remove outdated config in Ledger: https://github.com/squareup/java/pull/278145 (edited) 
:stamp:
1


PayswingBot
APP  3:13 PM
Evacuating payments traffic from WEST datacenters (swinging EAST) in production has been initiated by ejamison with message: esperanto sjc2b appears to be down


kcrane
:coolfingergun:  3:17 PM
@dskarbek
 probably no action required but heads up ^

PayswingBot
APP  3:21 PM
Restoring normal payments traffic (unswinging) in production has been initiated by ejamison with message: esperanto db has recovered


emilyl
  4:21 PM
deploying e41aba436fd (latest) to staging


bright
:spiral_calendar_pad:  4:36 PM
Hi team, we’ve received a complaint from a merchant mentioning a payment hold that was attempted to be released several times not getting released. Can I get some help investigating into this issue?
More details - JRIA ticket
unit token: 8NHNJS70M9HRC
payment token: xmdFFgkox93uIGppTTrb6q1unGWZY
hold token: i3hAmxJNQQ6_R54pob2eYg
Presidio query: diagnostic_context.com.squareup.logging.SpeleoTraceId:BGGBFJQPBWGbj application:ledger
https://rqm.iad1.sqprod.co/index/payment#/query/payment/xmdFFgkox93uIGppTTrb6q1unGWZY
I manually tried to release the hold via Regulator, but that did not work. From the RQM page, I do see there are attempted ledger entries. (edited) 



9 replies
Last reply 4 months agoView thread


cjustice
:ooo_1:  11:30 AM
Hey folks - I'm looking at our dashboards for rolodexdiscovery and noticed ledger deploys are now showing up as events on our charts. Did your events get added to everyone's consumed feeds dashboards? Or did we setup our saved charts incorrectly?


4 replies
Last reply 4 months agoView thread


lishahe
:spiral_calendar_pad:  2:23 PM
@oncall
 we got paged on a refund request for this payment. The feeplan rate id passed from this request is invalid. The following id is on refund policy, not on feeplan rate. Wonder how this refund is created with corrupt data?
feeplanId=Optional[DEFAULT_ZERO_FEE_OVERRIDE]}
:eyes:
1





13 replies
Last reply 4 months agoView thread


zandt
:spiral_calendar_pad:  3:14 PM
Hey all. I have a few pr's that I could use a review on related to payment record cleanup:
https://github.com/squareup/java/pull/278448
https://github.com/squareup/java/pull/278315
https://github.com/squareup/java/pull/278304
https://github.com/squareup/java/pull/276209



24 replies
Last reply 4 months agoView thread


njain
:spiral_calendar_pad:  3:40 PM
Hey 
@oncall
, we are receiving a bunch of 503s from production.ledger.gns.square in Capital. Is the something going on with the service?



11 replies
Last reply 4 months agoView thread


emilyl
  4:14 PM
deploying 8daa52ac2cb (latest) to staging


cpopescu
:spiral_calendar_pad:  11:08 AM
If a Cost+ seller terminates their contract with Square mid-month, and they have some Cost+ fee adjustments that have not posted yet, but will post on the 10th of the next month, what is the current process? Will the seller still pay the cost plus fee adjustments when they post via a settlement debit on the 10th? Or is their bank account unlinked when they terminate their contract with Square? cc 
@mgp
 (edited) 





8 replies
Last reply 4 months agoView thread


mmargenot
:no_entry:  11:26 AM
hi folks, seems like the watermark for ledger.LEDGER__LEDGER_PRODUCTION.pending_balance_snapshots didn't update, delaying app_risk.app_risk.chargebacks by way of a DWSSensor. are there any known issues? sounds like there might be something up with Shinkansen per discussion in sqwave here
cc: 
@klachance


3 replies
Last reply 4 months agoView thread


raul
  12:54 PM
Hey all! Looking to add an additional field to the FreezeFeedEntry for ledger. Currently, corporate card is introducing merchant level signals (MASTER_MERCHANT) in risk arbiter. We are aware that the merchant_token field for this input refers to the unit token and we would want to add the actual merchant token to this entry so that we can group certain signals. Is this something we could self-serve? Thank you in advance! :frogparty: (edited) 


6 replies
Last reply 4 months agoView thread


wstewart
  1:07 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-108504
(ledger @ 8daa52ac2cb6b6ad5d6349cdf4a206c8541a1f9b to production)
:+1::+1::skin-tone-2::+1::skin-tone-4:
5


3 replies
Last reply 4 months agoView thread


wstewart
  1:35 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
:chocobo-face:
2

View newer replies


wstewart
  2:42 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we're out on prod
deploy checks pass
:shipitparrot:
3



kcrane
:coolfingergun:  4:14 PM
deploying 0a2e60540ab (latest) to staging


njain
:spiral_calendar_pad:  6:30 PM
Hey ledger team, 
@cmendenhall
’s team runs a daily report that reads SettledLedgerEntry table up until 22:00GMT and sends a payment report to the sellers. As per this settlement chart UK has a 4 PM GMT cutoff for ledger settlement.  So does this mean that for UK sellers any payment after 4pm GMT won't be settled until the next day, and not be included in this report? cc: 
@kyoung




6 replies
Last reply 2 months agoView thread


kyoung
  6:30 PM
was added to #ledger by njain
.


njain
:spiral_calendar_pad:  2:33 PM
Hey 
@oncall
, Ops team had posted a loan repayment of $510.99 for this customer. The account was frozen and a debit lock was in place when this repayment was posted and I see that the ledger entry for this repayment has not been settled. What would happen when the freeze and debit lock are lifted? Would ledger debit this amount from the customer's bank account? cc: 
@quon
 
@npadilla





+1
25 replies
Last reply 4 months agoView thread


awernick
:spiral_calendar_pad:  9:59 AM
Flipping baos/ledger_use_bank_account_version_in_bank_account_feed_listenerto true in staging
cc 
@jtan
:ack:
1



mnovich
:spiral_calendar_pad:  12:59 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-108619
(ledger @ 8bf3b27f1318d09f0c08e13df043a969d7023d01 to production) (edited) 
:+1::+1::skin-tone-2:
8



7 replies
Last reply 4 months agoView thread


mnovich
:spiral_calendar_pad:  1:19 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


mnovich
:spiral_calendar_pad:  1:53 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


mnovich
:spiral_calendar_pad:  2:50 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass


mnovich
:spiral_calendar_pad:  4:00 PM
deploying d0b90e7cf420671dffe5c46b6d6c8afeda2fa4ac (latest) to staging
:bless:
2



awernick
:spiral_calendar_pad:  8:01 AM
@oncall
 list



12 replies
Last reply 4 months agoView thread


mnovich
:spiral_calendar_pad:  9:31 AM
So we just had an interesting blip in ledger. The transfers api was timing out and I looked at the ledger dash. It looks scary
https://square.datadoghq.com/dashboard/s6t-r83-8wz?from_ts=1679414424232&to_ts=1679416224232&live=true





6 replies
Last reply 4 months agoView thread


mnovich
:spiral_calendar_pad:  9:45 AM
@mengen
 there’s a stuck entry in holding area
https://apa1194--ledger.sqprod.co/_admin#tab:holdingarea
I couldn’t find any runbook entry for it, so not sure which team should handle this
image.png
 
image.png
:eyes:
1




11 replies
Last reply 3 months agoView thread


awernick
:spiral_calendar_pad:  9:48 AM
Flipping baos/ledger_use_bank_account_version_in_bank_account_feed_listenerto true in production
cc 
@jtan

1 reply
4 months agoView thread


mnovich
:spiral_calendar_pad:  12:03 PM
So there is one host dead in ledger staging and I am running the pre prod health checks
https://square-console.sqprod.co/app/ledger/deploy/p2
I need help understanding the reason. 
@mengen




14 replies
Last reply 4 months agoView thread


mnovich
:spiral_calendar_pad:  1:16 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-108706
(ledger @ d0b90e7cf420671dffe5c46b6d6c8afeda2fa4ac to production)
:+1:
2
:stamp3:
1



7 replies
Last reply 4 months agoView thread


alexanderl
:spiral_calendar_pad:  1:19 PM
was added to #ledger by mnovich
.


mnovich
:spiral_calendar_pad:  1:20 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


mnovich
:spiral_calendar_pad:  2:03 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


zandt
:spiral_calendar_pad:  2:42 PM
Is there any reason for this class to be named CardPayment instead of something generic such as just Payment ? I don't see anything card specific about it.
CardPayment.java
public abstract class CardPayment {
<https://github.com/squareup/java|squareup/java>squareup/java | Added by GitHub




8 replies
Last reply 4 months agoView thread


mnovich
:spiral_calendar_pad:  3:01 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass


yongqing
  3:56 PM
:hi-all: , Cash Crypto plans to support USDC stablecoin in cash app. 
@aliceyuzhang
 and I wrote this eng proposal to add a new currency code for USDC in the CurrencyCode proto for ledgering (similar to BTC in the proto ). Because the proto is widely used in Block, we would like to see if there are any concerns on your side. Happy to provide additional context if needed. Thank you :thank: :thank: :thank:
aliceyuzhang
 | G Suite Document
 

USDC Ledgering Proposal
Google Doc
:checkmark:
1



2 replies
Last reply 4 months agoView thread


mengen
:spiral_calendar_pad:  4:56 PM
Deploying 445b74cd2a73fb4fa80b0008d31a0c71dbe6a64c(latest) to staging


zifan
:spiral_calendar_pad:  7:05 PM
:wave: Hi team! FYI - Ledger tomorrow’s JP SMBC pipeline will be over Connecure (new networking, replacing ISDN). Teller test was successful so I don’t expect any failure. However, if it somehow fails, please set JBA’s client_ip_with_overrides feature flag to false and rerun the pipeline. :messenger-thanks:
:celeryman3:
2
:hellmo:
2
:its-happening:
2



2 replies
Last reply 4 months agoView thread


mnovich
:spiral_calendar_pad:  9:30 AM
@oncall
 ledger is unhealthy. Checking the reasons



7 replies
Last reply 4 months agoView thread


mnovich
:spiral_calendar_pad:  12:49 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-108771
(ledger @ 445b74cd2a73fb4fa80b0008d31a0c71dbe6a64c to production)

4 replies
Last reply 4 months agoView thread


mnovich
:spiral_calendar_pad:  1:17 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


mnovich
:spiral_calendar_pad:  2:04 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


mnovich
:spiral_calendar_pad:  2:54 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass
:kirbyparty:
4



mengen
:spiral_calendar_pad:  4:25 PM
Deploying 34aff1dac04b91aec33b8461a306410e1d47fbc8  (latest) to staging

root
APP  1:15 AM
ODS host fpd1543.iad3b.square (pd-odsgroup377) is down
No action is needed from you. ODS oncall will try to successover metaclusters if they are active on this host.
Please see the #situation channel for more information.
apps affected: ledger
metaclusters affected for these apps:
- pd-mysql-ledger-004
Cc: 
@oncall

1 reply
4 months agoView thread


obaltay
  8:27 AM
Hi Ledger Team - regarding the ledger entries in BQ (payments-raw-production.feeds.ledger_entries_raw_records), the PayPCP team currently manages our transaction cost data in BQ, and we would like to join the ledger and cost data for an upcoming project on InterchangePlus pricing. How often is this BQ view updated compared to the ledger entry feed, and is consuming the data in BQ instead of listening to the feed a recommended option? Our cost data is calculated in a batch context once a day, so I think using the BQ option would make more sense as opposed to the realtime consumption of the feed.
G Suite Document
 

PRD: Interchange Plus (IC+) Pricing EU - Payment Platform Support
Google Doc


cynthiali
:bulb:  10:22 AM
Hello, is anyone able to tell me about Good Merchant Gone Bad (gmgb) tags? I’m investigating a plan with a lot of unsettled entries, and all of the unsettled entries seem to have this tag. Thanks! Here’s a link to one of the unsettled entries with said tag


mnovich
:spiral_calendar_pad:  11:31 AM
Starting https://jira.sqprod.co/browse/ROLL-108822 to clean up ledger DB 
@oncall


2 replies
Last reply 4 months agoView thread


mnovich
:spiral_calendar_pad:  11:37 AM
replied to a thread:
Starting https://jira.sqprod.co/browse/ROLL-108822 to clean up ledger DB @oncall
Roll complete


bmickel
  1:20 PM
(#orders-reporting-team) We maintain prismo which consumes the ledgerEntriesFeed at 1:37pm CT we saw a spike in consumption lag from a ~2seconds to 1day 2h on consume shard 5 of 16. Is this expected from the ROLL-108822: Ledger DB cleanup above?
datadog dashboard




25 replies
Last reply 4 months agoView thread


zandt
:spiral_calendar_pad:  4:16 PM
Hi team. Here are the last two pr's for method platform work in ledger for this quarter:
https://github.com/squareup/java/pull/279850
https://github.com/squareup/java/pull/279762
#279850 [ledger] Remove setting of `reader_type` on the ledger entry payment detail PAYMP-15
<https://github.com/squareup/java|squareup/java>squareup/java | Mar 23rd | Added by GitHub
#279762 [ledger] factor out instrument_type field for capture paymentrecord processing PAYMP-14
<https://github.com/squareup/java|squareup/java>squareup/java | Mar 23rd | Added by GitHub


10 replies
Last reply 4 months agoView thread


mengen
:spiral_calendar_pad:  9:58 PM
Deploying 56515af2c529744206798d8c933cb1c8398a65e1  (latest) to staging


ssopp
:spiral_calendar_pad:  11:59 AM
Hey Ledger team, we're designing a new service that will be emitting feed events that represent balance changes, I was looking at LedgerEntry to see how other teams are modeling their messages. I noticed there are multiple UNDO type entries, for example UNDO_HOLD and UNDO_RELEASE. I vaguely remember hearing (but could be misremembering) that Ledger ended up preferring the 1:1 relationship with undo events vs. a generic event (like UNDO). If true, what led to that preference? Trying to gather information to inform the choice we make



6 replies
Last reply 4 months agoView thread


brianr
  3:56 AM
hi team, ops are having issues with clearing this merchant (L12DBQZP745HF). As you can see it has the 'flagged for review banner' and its transfer status is in a 'suspected' state. The suspected status comes from the ListMerchantSettlementState endpoint having a REASON=SUSPECTED on the last settlement state.
def is_suspected?
  merchant_settlement_states.first&.reason&.include?(MerchantSettlementStateProto::Reason::SUSPECTED)
end
however I checked in skeptic, and there are no internal suspicions for this unit token. would you be able to provide any additional details as to what is causing the suspicious settlement state for this merchant? Thanks!




6 replies
Last reply 4 months agoView thread


minghua
:spiral_calendar_pad:  1:01 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-108986
(ledger @ 56515af2c529744206798d8c933cb1c8398a65e1 to *production*)
@zandt
 
@bjoseph
 
@prabhjot
 
@kcrane
 
@mengen
 
@dskarbek
 
@bta
 
@mgp
 (edited) 
:+1::skin-tone-3::+1:
8




7 replies
Last reply 4 months agoView thread


minghua
:spiral_calendar_pad:  1:20 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


minghua
:spiral_calendar_pad:  2:18 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


jcook
  2:50 PM
replied to a thread:
hi team, ops are having issues with clearing this merchant (L12DBQZP745HF). As you can see it has the 'flagged for review banner' and its transfer status is in a 'suspected' state. The suspected status comes from the ListMerchantSettlementState endpoint having a REASON=SUSPECTED on the last settlement state.…
Bump on this ^ could someone help point us to the payment causing the SUSPECTED settlement state reason?
View newer replies


minghua
:spiral_calendar_pad:  3:17 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass
View newer replies


minghua
:spiral_calendar_pad:  4:25 PM
deploying 1a6aca67620426a7bfe886c856a046b4470f31d5 to staging



15 replies
Last reply 4 months agoView thread

root
APP  1:35 AM
ODS host fpd1478.sjc2b.square (pd-odsgroup373) is down
No action is needed from you. ODS oncall will try to successover metaclusters if they are active on this host.
Please see the #situation channel for more information.
apps affected: ledger
metaclusters affected for these apps:
- pd-mysql-ledger-028
- pd-mysql-ledger-029
Cc: 
@oncall

1 reply
4 months agoView thread


zandt
:spiral_calendar_pad:  10:53 AM


awhitney
:wave: I've got a big PR that moves the payment-adapter and refund-adapter into /kiwi. There are a lot of touched files as a result, but no other changes. Would someone mind taking a quick look?
Posted in accounting-eng | Mar 28th | View message


minghua
:spiral_calendar_pad:  12:23 PM
:skip: Ledger ROLL: Skipping for today due to pending fixes needed


larryl
:palm_tree:  12:24 PM
:wave:  hi 
@oncall
 we have an urgent request to send an IT for this seller to get their funds ASAP. Their balance is around $45k but only $6,541.73 is available for instant transfer. Is there a reason why we can't access the full balance/can we make the full balance available for IT right now? cc: 
@ena
 
@aiqi



25 replies
Last reply 4 months agoView thread


mgp
:baby:  5:38 PM
Deploying b395d032ccaac23887f3fb8b4065e9d22b0fcdcd to staging
:bless:
3



bwester
:officepig:  12:29 PM
hey Ledger folks! I wanted to confirm something with you:
Ledger's FreezeService has many distinct types of freezes, and each type appears to be enabled and disabled independently.  I just want to check: if any of these freeze types are enabled, that is supposed to block transfers, right?
Ledger offers a feed /1/freezes that appears to publish updates. just to confirm: is a new feed entry published for each freeze type, independently of whether transfers are enabled overall for the unit?  more to the point, if that feed publishes a message that a freeze type is not "active", that does NOT say anything about whether the unit as a whole is able to transfer, right?
the block_bank_settlement_per_onboard permission is used to disable a unit's ability to transfer.  this is not considered a "freeze" though, right?
do you happen to know what mechanism is used to prevent transfers if this doesn't count as a freeze?  or if this even affects Ledger state?  at the moment, production unit L7GQP2Y49V4RF has this permission set, and transfers are blocked, but I see that LedgerService.GetFreezes returns no data, even with include_all_settlement_blocking_freezes: true in the request.
:eyes:
1





6 replies
Last reply 4 months agoView thread


minghua
:spiral_calendar_pad:  1:11 PM
Ledger ROLL:
ROLL-109129
(ledger @ b395d032ccaac23887f3fb8b4065e9d22b0fcdcd to production)



10 replies
Last reply 4 months agoView thread


minghua
:spiral_calendar_pad:  1:20 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


afranks
  1:24 PM
hey folks! question on getting the value for can_debit (on settlementstate) for a bunch of merchants. I see there’s a list_merchant_settlement_states bulk API that supports a list of tokens, so we may just be able to use that. Is that the easiest/best way to get the this value?
Context: we trying to see how many merchants in a list is debitable as a one off exercise to inform an upcoming project (~9k merchants in the list)


13 replies
Last reply 3 months agoView thread


minghua
:spiral_calendar_pad:  1:56 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


jonchu
:spiral_calendar_pad:  2:12 PM
Hello ledger team :ablobwave:! Engineer from the transfers team here:
We're looking to update the feature flag logic for evaluating whether to disable instant transfer fees in ledger. For context, this feature flag is going to be used for a 0% Instant Transfer fee experiment. I have a PR up that changes the logic to check the feature flag using the merchant token instead of the unit token, as we want to standardize on a single token type.
We own this part of the code, but I wanted to reach out to as an FYI as y'all would be the ones doing the deploy. Please let me know if you have any questions or concerns! :thx-blob:
cc: 
@eyung

1 reply
4 months agoView thread


minghua
:spiral_calendar_pad:  2:51 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass
:italian-nice:
1



zandt
:spiral_calendar_pad:  3:54 PM
Last pr from the method platform team to cleanup a few residual things for the Q1 standard payment record effort.
https://github.com/squareup/java/pull/280280
#280280 [ledger] Remove obsolete `instrument_type` fallback logic from capture event processors
The fallback logic was temporary until all older CaptureEvents have  
been processed.
This is a followup to #279762.
Labels
accounting-engineering
Comments
2
<https://github.com/squareup/java|squareup/java>squareup/java | Mar 28th | Added by GitHub
:stamp3:
1
:th:
1



3 replies
Last reply 4 months agoView thread


mgp
:baby:  4:26 PM
Deploying 8bedc8df6f0 to Ledger staging


afranks
  9:04 AM
replied to a thread:
hey folks! question on getting the value for can_debit (on settlementstate) for a bunch of merchants. I see there’s a list_merchant_settlement_states bulk API that supports a list of tokens, so we may just be able to use that. Is that the easiest/best way to get the this value?…
quick ping on this question ^ (edited) 
View newer replies


tugce
  10:14 AM
Hi team :wave:  What is the recommended timeout to set for Ledger requests? I was thinking of increasing it to 5 seconds, in order to decrease the error rate in our service when Ledger experiences latency issues. (for example)


2 replies
Last reply 3 months agoView thread


jonchu
:spiral_calendar_pad:  11:42 AM
Hi ledger team - I wanted to bump this question from a while back that I posted in accounting-eng. Could someone provide some guidance if this is expected behavior? Thanks!


jonchu
Hi team :ablobwave:! I'm working on this ticket, and it looks like there's a transfer that has an UNSETTLEABLE blocker, which I believe comes from Ledger. Here is the transfer, with client idempotence key of 2202e4f5-8f08-4989-b56d-9904bb8139ab .
I think the issue comes from the fact that a transfer with a blocker for a stored balance gets moved to a pending balance, resulting in the dashboard showing $0. From what I can tell, this is populated by deposits (us) hitting bankc, who then calls GetClearedBalanceV2 . Is this expected behavior, or have I misunderstood something? Thanks so much for the help! :thankyoublob:
Thread in accounting-eng | Feb 28th | View message



5 replies
Last reply 3 months agoView thread


alafranchise
:spiral_calendar_pad:  2:20 PM
:ablobwave: 
@oncall
 BAAPI is going to start a backfill to update SqWeb scope data in Instruments and Gringotts (part of our BAOS migration). You may see elevated numbers of settlement view feed messages. We are going to start slowly and dial up the backfill concurrency as we go. See ROLL for details:
https://jira.sqprod.co/browse/ROLL-109147

1 reply
3 months agoView thread


andreyg
:spiral_calendar_pad:  2:24 PM
@oncall
 can I take over ledger on staging for some testing?




7 replies
Last reply 3 months agoView thread


andreyg
:spiral_calendar_pad:  2:27 PM
replied to a thread:
@oncall can I take over ledger on staging for some testing?
taking over ledger on staging for testing
View newer replies


andreyg
:spiral_calendar_pad:  3:37 PM
replied to a thread:
@oncall can I take over ledger on staging for some testing?
done with testing. I will wait until ~4pm and trigger latest master deploy to staging
View newer replies


mgp
:baby:  4:02 PM
Deploying feb727b0a4c to Ledger staging


anand
  2:00 PM
Hello, is there any endpoint via connect or internal to know if a merchant account has been frozen ? Got directed to this channel by #seller-profile.

1 reply
3 months agoView thread


kcrane
:coolfingergun:  4:06 PM
hey 
@zandt
 sorry for the late tag (and feel free to ignore this until Monday if you're off for the day already), but I had a question about commit 16b085a12d2dfbf57f4e9a8f2eed5e6e2174d658 ("[ledger] Remove unused references to payment token and refund uuid PAYMP-14").
In it, you made mtTenderServerToken/PaymentToken optional in Refund Ledger events. Is this correct & expected? I thought it was mandatory in general for payment events like Refund.
If that's expected and everyone agreed it's fine, I'll make a change in books-ddl.yaml; (one of the Refund files you changed is auto-generated from that YAML file, so I was confused when I auto-generated them again and all of a sudden some other tests I didn't change started failing lolol)



60 replies
Last reply 3 months agoView thread


smartin
  10:17 AM
Deploying 1533170b3a1 to Ledger staging


sumitg
  6:45 PM
We have a scheduled Barclays  outage from 9:45 Eastern on April 1 to 10:00 AM Eastern on April 2nd. This will impact, GBP transfers in UK. I will post any updates as we receive them. :blob-thanks:


3 replies
Last reply 3 months agoView thread

PayswingBot
APP  3:00 AM
Evacuating payments traffic from EAST datacenters (swinging WEST) in production has been initiated by mparmet with message: https://jira.sqprod.co/browse/ROLL-108623

PayswingBot
APP  3:15 AM
Restoring normal payments traffic (unswinging) in production has been initiated by mparmet with message: https://jira.sqprod.co/browse/ROLL-108623


chenj
:spiral_calendar_pad:  9:07 AM
Hi 
@oncall
, wondering if you help me identify if there is anything special regarding this payment token HbyFjvOUozgJz3KB1UdA7febJoYZY.
It’s an old payment from 3/30 but was disputed and refunded today. It landed in Statham’s DLQ due to trying to reprocess the payment and not being able to get signals back from RiskArbiter (wont be able to get it since beacon doesn’t support evaluating payments after 48 hours and its been 5 days) but we probably should’t have tried to reprocess payments as auth/capture again for a refund.
Quick glance at other refund events in presidio, seems like its not common for payment to get re-queued for processing during a refund.
So was wondering if you would be able to see if there was something different about this particular refund that might have it landed back to get processed again?
:eyes:
1
:checkmark:
1




7 replies
Last reply 3 months agoView thread


smartin
  2:30 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-109326
(ledger @ 1533170b3a17028b665d77f1e772e5c64f079e10 to production)
cc: 
@bhargava
 
@mgp
 
@andreyg
 
@mengen
 
@zifan
 
@zandt
 
@dskarbek
:+1::+1::skin-tone-4:
5
:stamp3:
1


1 reply
3 months agoView thread


bhargava
  2:30 PM
was added to #ledger by smartin
.


smartin
  3:20 PM
Deploying c56e45ba604 to Ledger staging


kcrane
:coolfingergun:  5:37 PM
deploying 035b18388b7 (latest) to staging


parkjane
:spiral_calendar_pad:  8:38 AM
:wave: Hi Team! To support Project Sequoia and Regulator Modernization, Ledger data will need to be served as a GraphQL subgraph. The Regulator team is ready to help facilitate this process, in which the details can be found here. I will be the Regulator dev working closely with this effort. Who would be the DRI for Ledger that I can coordinate with? (edited) 
:eyes:
1






+2
19 replies
Last reply 3 months agoView thread


smartin
  10:50 AM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-109354
(ledger @ 035b18388b7eebb321938dd666ebc520da04b80b) to production)
:+1::+1::skin-tone-4::+1::skin-tone-3::+1::skin-tone-2:
10
:stamp3:
1






+1
22 replies
Last reply 3 months agoView thread


smartin
  12:49 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


smartin
  1:41 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby:  rolling forward
View newer replies


smartin
  2:47 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot:  we’re out on prod
deploy checks pass
:woo-hoo:
3



smartin
  3:51 PM
deploying dd57eac8284 (latest) to staging


lagarwal
  3:15 AM
Team: we have the MySQL8 upgrade PR merged for 'ledger app https://github.com/squareup/java/pull/278329 for sometime. Can you please look and get it to merge soon? Thanks
:checkmark:
1


1 reply
3 months agoView thread


eseguy
:spiral_calendar_pad:  7:28 AM
was added to #ledger by parkjane
. Also, hulett
 joined.


smartin
  10:09 AM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-109443
(ledger @ dd57eac828424b97ac9aa361897b57dc3dfcdfae to production)
:+1::+1::skin-tone-2:
4
:stamp3:
3



14 replies
Last reply 3 months agoView thread


chenj
:spiral_calendar_pad:  11:18 AM
Hi Team, I’m clearing out some of our old pager for Staging, one of them being At least 1 payment is risk stale for at least 60 minutes
was wondering if we could purge all the risk stale payments in Staging?
:eyes:
1
:checkmark:
1



33 replies
Last reply 3 months agoView thread


smartin
  12:47 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary:  canary start
View newer replies


smartin
  1:33 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby:  rolling forward
View newer replies


smartin
  2:24 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot:  we’re out on prod
deploy checks pass
:party-parrot:
1



tmahoney
  2:58 PM
:wave: hey, is anyone able to help me understand which merchant(s), if any, use the canAutomaticallyApproveRefunds property of MerchantSettlementState?
a brief look at Ledger code makes me think that it’s an obsolete Marketplaces concept, and if so, I’d love if we could retire it (would help simplify things a bit in refundsarbiter). FWIW, my team already has controls on our end for always allow refunds for merchant/unit X (we do this for e.g. Square Hardware today), so retiring this would not be an overall reduction in functionality.




43 replies
Last reply 3 months agoView thread


smartin
  3:58 PM
deploying 69021e1b4af (latest) to staging


acastberg
  4:08 PM
:wave: 
@oncall
 when does the staging pipeline run happen? :thankyoublob:




11 replies
Last reply 3 months agoView thread


tmahoney
  4:25 PM
replied to a thread:
:wave: hey, is anyone able to help me understand which merchant(s), if any, use the canAutomaticallyApproveRefunds property of MerchantSettlementState?…
cleanup PR is up now: https://github.com/squareup/java/pull/281707
View newer replies


acastberg
  2:59 PM
:wave: 
@oncall
 I would like to flip this feature flag to disable sending of pending credit emails (edited) 
:checkmark:
1





6 replies
Last reply 3 months agoView thread


smartin
  4:06 PM
deploying cf9e5762d3c (latest) to staging


jazmineg
  10:54 AM
Hi Team! It looks like there is a $158,500.75 held on Equilibria. But not seeing any freeze on transfers or anything. Could anyone provide additional details on what this hold is? Thanks!
:eyes:
1
:checkmark:
1




4 replies
Last reply 3 months agoView thread


ashliek
:knife_fork_plate:  11:51 AM
was added to #ledger by jazmineg
.


sarve
:spiral_calendar_pad:  4:07 PM
Deploying 30e5b417f05 to Ledger staging

1 reply
3 months agoView thread


ena
  9:00 AM
[scheduled message] hey team!! #transfers is planning on increasing the US IT fee from 1.5% to 1.75% in production on Tuesday 11th April, at 9AM PST (this change was already done in staging a couple of months ago)
This will involve us updating the fee basis points in ledger’s production DB. Please take a look at  ROLL-109666 and :stamp3: if it looks good :blobheart: thank you!!





21 replies
Last reply 3 months agoView thread


jkesting
  9:45 AM
@oncall
 I am seeing some feed lag in Cloud Persister for the ledger-settled-ledger-entries_2 feed starting at around 830 PM PST last night. Is everything alright with this feed on your end? Not seeing any errors in Cloud Persister but seeing a decreased rate of consumption since that time (edited) 



4 replies
Last reply 3 months agoView thread


eengart
  9:51 AM
Hi Team! Random question about this account: CC3TNDW4QEPG5. I am in credit risk and working on this account and the account has queued up 3 times in the past month due to the failed debits. Since the M is actively processing with us, why are those transactions not being put toward the negative balance on the account?



11 replies
Last reply 3 months agoView thread


nirali
:spiral_calendar_pad:  11:11 AM
hello! Not sure if this is the best place to ask, but we're trying to get a list of all frozen sellers with an open IRF case that have a balance or not (meaning they have money in their account that they are unable to move to their bank account because they are frozen). The query we're using is below but it times out when we try to run it. Is there a more efficient way or summary ledger table that we can use to get balance information? cc 
@sarahsultan
SELECT 
    fpt.unit_token
  , fpt.payment_token
  , fpt.auth_intent_created_at AS payment_created_date
  , fpt.currency_code
  , fpt.amount_base_unit/100 AS amount_base_unit
  , fpt.card_brand
  , fpt.payment_type
FROM payments_dw.public.payment_transactions fpt
LEFT JOIN ledger.raw_feeds.ledger_entry le ON le.payment_token = fpt.payment_token
LEFT JOIN ledger.raw_feeds.settled_ledger_entry sle ON le.external_source_id = sle.externalsource_id
WHERE fpt.auth_success = 'TRUE'
AND sle.banksettlemententrytoken IS NULL
AND FPT.PAYMENT_TRX_RECOGNIZED_AT >= '2021-01-01';
(edited)

1 reply
3 months agoView thread


mchiesa
:spiral_calendar_pad:  11:32 AM
Hello :wave:  just a friendly reminder about version validation migration for the APIs in ledger.
Action Items
Please make sure the migration status for any listed API your team owns is up to date in our tracking spreadsheet. If your team has already completed the migration process, thank you! Otherwise, we kindly ask that you provide any notes or links to tickets related to completing this process in the last column (this may even include a simple indication that migration is not necessary for the listed API).
If you have any questions or concerns, please reach out to us on #api-frameworks


hoyi
  12:46 PM
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-109704
(ledger @ 30e5b417f05 to production)
:stamp:
1



4 replies
Last reply 3 months agoView thread


hoyi
  1:26 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-109704…
staging checks pass
:canary: canary start


hoyi
  4:02 PM
Deploying latest (7235f071e7f) to staging


acastberg
  8:58 AM
replied to a thread:
[scheduled message] hey team!! #transfers is planning on increasing the US IT fee from 1.5% to 1.75% in production on Tuesday 11th April, at 9AM PST (this change was already done in staging a couple of months ago)…
starting ROLL :rolling_kirby:
:yay-frog:
1

View newer replies


acastberg
  9:33 AM
replied to a thread:
[scheduled message] hey team!! #transfers is planning on increasing the US IT fee from 1.5% to 1.75% in production on Tuesday 11th April, at 9AM PST (this change was already done in staging a couple of months ago)…
ROLL complete :check-mark:
:hands-up:
1



markl
:spiral_calendar_pad:  12:35 PM
@oncall
 I merged a fix (https://github.com/squareup/java/pull/282327) to a regression I introduced with a previous change. Any chance we could get it deployed on staging?




13 replies
Last reply 3 months agoView thread


hoyi
  12:47 PM
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-109781
(ledger @ 7235f071e7f to production)
:+1:
1



9 replies
Last reply 3 months agoView thread


conner
  12:52 PM
hi 
@oncall
! the SaaS team is working on remediation for a SEV, and there's a chance we'll need to credit merchants money if their original payment method isn't viable for a refund.
the marketing team pointed us to this doc, outlining a potential credit process.
we have some questions related to this -- could you or someone on your team please join #alert-11904_bills_are_generated_for_canceled_free-trial_postpay_saas?
:eyes:
1


1 reply
3 months agoView thread


hoyi
  12:56 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-109781…
Cancelling deploy to due known bug
:sorry:
1
:ack:
1

View newer replies
12:59
Deploying 0d5b726a85a (latest) to staging


jyenbamroong
:ms-teams-jeans:  1:16 PM
hi! could i get a review on this PR to add paymentactivator to the ListMerchantSettlementStates acl whenever someone has a moment? thank you! https://github.com/squareup/java/pull/282252
:stamp:
1



hoyi
  4:04 PM
Deploying latest (f8966e21b54) to staging


ayana
:no_entry:  8:26 AM
Hi there! Can I get some assistance with these accounts?
4RYX96DBFTS6N
L427GG563DEAB
We had approved adjustments for refunds on these accounts but they were unable to credit the merchant due to the accounts being deactivated and both sellers have Sq Cards in which those processes have blocked external transfers. (Refer to slack thread if needed in regards to this issue).
We would like to see if there is any guidance on stopping the payments that is sitting in the ledgers or if there are any other alternative methods to help credit these funds to the sellers? Please and thank you!


bryanneva
Hi, I have a merchant with a Square Card with a positive adjustment. However, the ledger entry isn’t settling. I learned that these entries don’t settle until Square Card sweeps the balance to card.
Could someone help me understand why Card hasn’t swept them?
https://regulator.sqprod.co/n/users/4RYX96DBFTS6N?section=ledger-entries
Show more
Thread in square-debit-card | Apr 7th | View message
:eyes:
1






+2
21 replies
Last reply 3 months agoView thread


jzerilli
  10:58 AM
@oncall
 recoverytron is seeing rate limiting issues when trying to release reserves through ledger. A high qps merchant recently had a lot of transactions to release through ledger so traffic is higher than normal. would it be possible to raise the limit for a bit? We have ~1000 payments that need to be released




28 replies
Last reply 3 months agoView thread


cpopescu
:spiral_calendar_pad:  12:02 PM
Hi team, I just had a conversation with 
@ankit
 from the BI team on how his team can get offline access to the merchant_features table in Ledger. The preferred way would be Snowflake but Big Query would work too. What is the typical process to expose a table in Snowflake? cc 
@mgp
 
@snigdhak
 
@kcrane
 (edited) 





25 replies
Last reply 3 months agoView thread


hoyi
  1:08 PM
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-109849
(ledger @ f8966e21b54 to *production)


4 replies
Last reply 3 months agoView thread


hoyi
  1:28 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-109849…
staging checks pass
:canary: canary start
View newer replies


hoyi
  2:18 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-109849…
Consumer lag is increasing on a feed, but it’s an issue with a known, unrelated cause.
:rolling_kirby: rolling forward


brentw
:spiral_calendar_pad:  10:11 AM
Hey Ledger team, I ran into a column length limit when adding a new square bank account this morning. Created a PR for teller to increase the column length, but wanted to double check if there was anything that needed to be done on your end as well


3 replies
Last reply 3 months agoView thread


lagarwal
  11:02 AM
MySQL8 upgrade - Just writting to check that can we move 'ledger' staging on 4/17? Thanks





+1
12 replies
Last reply 2 months agoView thread


dhowe
:no_entry:  12:52 PM
registry access request for access to ledger snowflake (readonly) for square compliance engineering :pray:
https://registry.sqprod.co/access_requests/324906



4 replies
Last reply 3 months agoView thread


hoyi
  2:49 PM
set the channel topic: ALERT-11964 Balances delayed | Discussion for https://registry.sso.global.square/apps/ledger | Contact @oncall for questions | Emergency page the entire team: https://go/ledger911


hoyi
  4:14 PM
Deploying latest (93c40659d2c) to staging


hoyi
  4:24 PM
set the channel topic: Stable | Discussion for https://registry.sso.global.square/apps/ledger | Contact @oncall for questions | Emergency page the entire team: https://go/ledger911


jengel
:spiral_calendar_pad:  12:33 PM
Hey Team, is there away to determine if a seller has ever been frozen by ledger?
:checkmark:
1



4 replies
Last reply 3 months agoView thread


emilyl
  4:10 PM
deploying ccceb83d53e (latest) to staging


ishvydchenko
  4:17 PM
Hey team! Does anyone know which team owns creating the DISPUTE_ADJUSTMENT and RESOLVED_DISPUTE ledger entries?
They are both created at the exact same time so it is causing some complications in capitals migration to MoneySweeper, so we were wondering if its at all possible to offset their creation by a little?
:checkmark:
1




13 replies
Last reply 3 months agoView thread

PayswingBot
APP  3:03 AM
Evacuating payments traffic from WEST datacenters (swinging EAST) in production has been initiated by mparmet with message: https://jira.sqprod.co/browse/ROLL-109664

PayswingBot
APP  3:12 AM
Restoring normal payments traffic (unswinging) in production has been initiated by mparmet with message: https://jira.sqprod.co/browse/ROLL-109664


leah
  7:48 AM
Hi, I'm wondering if someone can take a look at BCON-10277. I understood that logic had been changed back in 2021 to stop unlinking UK bank accounts after 3 failed debits (since this is ACH logic not applicable to the UK-- and to ensure that sellers weren't DAed as a result due to the UK FCA requirement). We are still seeing accounts that have 3 failed debits, the bank unlinks, and the account becomes DAed after the grace period-- and this is leading to seller escalations and FCA complaints. (If this is not your team's responsibility I'd appreciate if you can point me in the right direction- I've been sent here from #bank-accounts-api after being redirected there from #transfers :pray:)





+1
16 replies
Last reply 3 months agoView thread


acastberg
  9:18 AM
:helloblob: hello! l would like to turn this feature flag for endpoint rule notifyInstantDepositApproval to 1% in prod today
this is where it is used in ledger
cc 
@oncall
:ack:
1



6 replies
Last reply 3 months agoView thread


eliobis
:spiral_calendar_pad:  12:21 PM
was added to #ledger by hsilverio
.


mhagy
  1:19 PM
I’m going to swing payments at 10 AM ET tomorrow, https://jira.sqprod.co/browse/ROLL-110066
I’ll announce this again tomorrow when starting in the relevant channels, including #ledger

1 reply
3 months agoView thread


emilyl
  1:24 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-110084
(ledger @ ccceb83d53e to production)

4 replies
Last reply 3 months agoView thread


emilyl
  2:02 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


emilyl
  2:30 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


emilyl
  3:35 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass


emilyl
  4:06 PM
deploying 3e51c256b17 (latest) to staging


kateo
  6:36 AM
was added to #ledger by leah
.


mhagy
  7:01 AM
replied to a thread:
I’m going to swing payments at 10 AM ET tomorrow, https://jira.sqprod.co/browse/ROLL-110066…
Starting this payswing from east/IAD to west/SJC

PayswingBot
APP  7:03 AM
Evacuating payments traffic from EAST datacenters (swinging WEST) in production has been initiated by mhagy with message: https://jira.sqprod.co/browse/ROLL-110066 for network maintenance

PayswingBot
APP  8:39 AM
Restoring normal payments traffic (unswinging) in production has been initiated by mhagy with message:  https://jira.sqprod.co/browse/ROLL-110066 normalizing now that network maintenance is complete


acastberg
  8:56 AM
replied to a thread:
:helloblob: hello! l would like to turn this feature flag for endpoint rule notifyInstantDepositApproval to 1% in prod today…
bumping this to 10% :rolling_kirby:
cc 
@oncall
View newer replies


ahdoot
  9:03 AM
:wave:, we have an interesting case:
merchant is disabled
has refunds that were processed over a year ago, but there is strong belief that merchant never got their money, and the money is being held by Square
~10 payments totaling ~$50k
timing lines up with the Russia sanctions
In situations like these in the past we’ve just had RefundsArbiter call Ledger’s CancelRefundLedgerEntry endpoint, but given how old these refunds are and how much money it is, I wanted to run this by y’all first. (edited) 


davidsmith
Another real weird question. Not related to my previous real weird question. If we want to retroactively pretend the refund for Djt8td4ziW5UaUqkcaeoPtA7taB failed and release the funds back to the seller, is there a process for that? (#recon-help has verified that the refund actually did fail, and Square has the money, and compliance people in Australia are :eyeshake:)
Thread in refunds-api-help | Apr 17th | View message
:eyes:
1



6 replies
Last reply 3 months agoView thread


tisaacs
:face_with_thermometer:  9:04 AM
was added to #ledger by ahdoot
.


emilyl
  12:48 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-110146
(ledger @ 3e51c256b17 to production)


4 replies
Last reply 3 months agoView thread


emilyl
  1:33 PM
replied to a thread:
Ledger ROLL:…
canceled today


emilyl
  4:14 PM
deploying 7460f26b815 (latest) to staging


ayana
:no_entry:  8:41 AM
Hi there -- escalating this issue from a previous thread and hoping we can get assistance for these accounts:
L11FY2H6KW7H2
4RYX96DBFTS6N
Both accounts are included on  ONCALL-147680. Still trying to figure how to refund the sellers ASAP with the funds sitting in each of their ledgers.
I was advised to reach out to #square-debit-card and they referred back to this channel for additional guidance. Can someone please assist? Please note this is time sensitive


dkong
are the adjustments stuck only for those 2 units? if it's time sensitive, we should ask the #ledger team to manually remove those settlement blockers off those units, so we can process them quickly
From a thread in square-debit-card | Apr 19th | View reply





+1
11 replies
Last reply 3 months agoView thread


jthomas
  9:34 AM
Hi! Looking at http://go/settlementschedule I’m trying to get a better understanding of the relationship between POS cutoff and Ledger settlement time. Can someone help with explaining? I’ll put specifics in the thread
:checkmark:
1



12 replies
Last reply 3 months agoView thread


boz
  10:25 AM
Hi there, our app(cloud-persister) keep getting noisy alert about spikes of feed lag from ledger-settled-ledger-entries_2, like INCIDENT #2598224
Would like to know if you could adjust the feed consumption rate or set a higher threshold for triggering the alert?
Thanks! cc 
@carolina




18 replies
Last reply 3 months agoView thread


tal
:no_entry:  10:47 AM
hey team! hopefully quick question -- can a seller only have 1 active merchant settlement state at a time?


5 replies
Last reply 3 months agoView thread


jcook
  11:28 AM
Hey all, is there a good way to freeze all units under a given merchant without individually freezing all units for a given merchant?
:checkmark:
1


1 reply
3 months agoView thread


acastberg
  11:42 AM
replied to a thread:
:helloblob: hello! l would like to turn this feature flag for endpoint rule notifyInstantDepositApproval to 1% in prod today…
bumping to 20% :rolling_kirby:
View newer replies


emilyl
  12:15 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-110207
(ledger @ 7460f26b815 to production)
:+1:
4



5 replies
Last reply 3 months agoView thread


emilyl
  12:56 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


wstewart
  1:07 PM
I'm going to take over staging for a bit


emilyl
  1:19 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


emilyl
  2:24 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass


emilyl
  4:21 PM
deploying 714a5d6e07d (latest) to staging


rachit
  5:20 PM
Hey Team,
For our new service Interchange Plus (IC+) , we will be querying  payments-raw-production.feeds.ledger_entries_raw_records in BQ.
We will be creating a service account for our production environment. Would It be possible to give our service account read access to the above table?
cc: 
@obaltay
:checkmark:
1



4 replies
Last reply 3 months agoView thread


acastberg
  9:14 AM
replied to a thread:
:helloblob: hello! l would like to turn this feature flag for endpoint rule notifyInstantDepositApproval to 1% in prod today…
bumping to 50% :rolling_kirby:
View newer replies

PayswingBot
APP  10:04 AM
Evacuating payments traffic from WEST datacenters (swinging EAST) in production has been initiated by vballari with message: as per https://jira.sqprod.co/browse/ROLL-110255


joannexu
:spiral_calendar_pad:  12:23 PM
hi, billpay started getting timeouts in staging calling get_freezes, is there an issue with ledger in staging?
example call: https://square-inc.sentry.io/issues/3609972442/?project=5959763&referrer=slack
started a couple hours ago: https://square.datadoghq.com/s/3b6b4a9c0/q9r-mah-f4a
Errors on service billpay-ledger in env staging
Added by Datadog (34 kB)
https://square.datadoghq.com/s/3b6b4a9c0/q9r-mah-f4a


1 reply
3 months agoView thread

PayswingBot
APP  12:58 PM
Restoring normal payments traffic (unswinging) in production has been initiated by vballari with message: as per https://jira.sqprod.co/browse/ROLL-110255


emilyl
  4:06 PM
deploying 3d1fa5abbd4 (latest) to staging


acastberg
  9:03 AM
replied to a thread:
:helloblob: hello! l would like to turn this feature flag for endpoint rule notifyInstantDepositApproval to 1% in prod today…
rolled out to 100% :check-mark:


sschloss
:spiral_calendar_pad:  9:32 AM
Hi team. Question about the payment_token included in Ledger cleared transaction events. Is this the same as the payment_id included in the public V2 Payments API? Or is this an internal-only token?
:checkmark:
1


1 reply
3 months agoView thread


andreyg
:spiral_calendar_pad:  4:12 PM
deploying d82f4379796 (latest) to staging (edited) 
:checkmark:
1


PayswingBot
APP  3:05 AM
Evacuating payments traffic from EAST datacenters (swinging WEST) in production has been initiated by mparmet with message: https://jira.sqprod.co/browse/ROLL-110070

PayswingBot
APP  3:13 AM
Restoring normal payments traffic (unswinging) in production has been initiated by mparmet with message: https://jira.sqprod.co/browse/ROLL-110070


stefan
:bulb:  12:07 PM
Hi team! Following up on this thread I started with #orders-reporting-team: https://square.slack.com/archives/C026QC9U2TW/p1682113539569839 to learn more about the ledger feed and particularly entries with the type CAPTURE. It looks like CAPTURE is what's used by the beemo stack to store the fees associated with a Bill for reporting (and the FEE type event, if Cost+ based on the comments in go/proto). For RST, we have a report called "Close of Day" run by the manager and the flow for running it essentially (with a lot of non-payment related stuff ommited) looks like:
Adjust all tips (if they were not already set by the employee earlier)
Capture all payments
Show a big report based on a set of calls to beemoreporter's CustomReport API
Since step 3 and 4 happens back to back here, we often don't have the right fee numbers, since it seems like it can take seconds for the capture event to be fired from ledger after step 3, and then prismo has to process it which can also be seconds behind (sometimes even hours).
So I think the first question we have is whether it's possible to calculate the fees (even if they're not final) earlier, like say when the tip is added to the tender, since it is possible for the tips to be adjusted throughout the flow of service, rather than only at close of day? That would probably help significantly with accuracy (at least, outside of times that prismo is 4h behind ledger). Follow-up question would be if it's technically possible to calculate, would it break anything else downstream (e.g., if it being calculated before capture would break the seller's balance or something by deducting fees before crediting payments)?
Totally understand if it isn't feasible, but wanted to explore what our options were since we hear complaints about the fees shown in the report being inaccurate. Thanks!


stefan
Not sure if this is the right place, so please redirect me as appropriate.
On RST, we've noticed that the fees in beemo reports are not accurate if there are bills that are pending. For our close of day feature, we capture all uncaptured bills right before showing the report, but it can take significant time (60s+ sometimes) for bills to go from starting capture to the fee event and having the fees reported correctly in the report so we've had sellers notice their fees change if they look at reports later in the night. I think this also applies to them looking at reports in dashboard too.
Is the fee calculation dependent on capture, or is that something that could potentially happen earlie… Show more
Thread in orders-reporting-team | Apr 21st | View message



7 replies
Last reply 3 months agoView thread


kcrane
:coolfingergun:  12:50 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-110423
(ledger @ d82f4379796 to production)
:+1::+1::skin-tone-2:
7




7 replies
Last reply 3 months agoView thread


kcrane
:coolfingergun:  1:12 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


kcrane
:coolfingergun:  1:48 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


kcrane
:coolfingergun:  3:02 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we're out on prod
deploy checks pass


kcrane
:coolfingergun:  5:31 PM
deploying 1da1c129744 (latest) to staging

PayswingBot
APP  7:14 AM
Evacuating payments traffic from EAST datacenters (swinging WEST) in production has been initiated by malbert with message: neteng needs to update the IAD transaction firewall for pci compliance


kdalvi
:baby-baby:  8:48 AM
Hi team, a merchant is not able to deactivate their square account because it appears they have a pending balance. However, they don't see any balance and regulator also shows the balance to be $0. Could you please help to check if there is any pending balance on this merchant 8AZDEP1RMJ69K or any of its units?
Oncall Ticket: https://jira.sqprod.co/browse/ONCALL-146623





+1
30 replies
Last reply 3 months agoView thread

PayswingBot
APP  10:37 AM
Restoring normal payments traffic (unswinging) in production has been initiated by malbert with message: network maintenance complete


kcrane
:coolfingergun:  12:35 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-110501
(ledger @ 1da1c129744 to production)
:+1::+1::skin-tone-2:
2
:stamp3:
1



12 replies
Last reply 3 months agoView thread


kcrane
:coolfingergun:  12:52 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


kcrane
:coolfingergun:  1:25 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


mgp
:baby:  2:29 PM
replied to a thread:
Ledger ROLL:…
Rolling back Ledger to d82f4379796
View newer replies


acastberg
  2:32 PM
:ablobwave: hello, transfers team is planning to start percentage rollout in prod of transactional emails tomorrow at 9am PDT (ROLL)
this will mainly affect the linkCardV2 and resendVerificationEmail endpoints
cc 
@oncall
 (edited) 
:ack-red:
1


1 reply
3 months agoView thread


kcrane
:coolfingergun:  4:27 PM
deploying 339915591eb to staging (latest)


kenji
  7:59 PM
Hi 
@mgp
, team,
SMBC is asking the below, do you happen to what this is about?
Regarding remittances using the JAPAN LINK Service as of today
One error has occurred.
We apologize for the inconvenience, but please check the following information.
Transmission information
Payer Code: 8430782 *Code discrepancy
Payee Code: CHASUS33 *Code discrepancy
Amount of remittance: 10,122,271 yen
There is no information on the payee name or receiving bank, and the only information we have received is the above.
We assume that the money was transferred to your company’s account at JP Morgan.
Can you please confirm the following information about this money transfer?
We will send the money as soon as we confirm the correct information.
Client Code (Payer Code)
Payee Code
Payee Name
Payee Address
Payee Bank/Payee Branch
(
@shigeki
@ryosuke
)


3 replies
Last reply 3 months agoView thread


kdalvi
:baby-baby:  7:49 AM
Hi team, could I pls get an approval on this app dependency request? TIA!
:checkmark:
1



kcrane
:coolfingergun:  12:52 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-110576
(ledger @ 3399155 to production)
:+1::+1::skin-tone-2:
3



11 replies
Last reply 3 months agoView thread


kcrane
:coolfingergun:  1:40 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
:bless:
1

View newer replies


kcrane
:coolfingergun:  2:36 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


vlong
  2:48 PM
replied to a thread:
:wave: Hello, we’re reaching out because your service ledger uses Envoy Logging (go/envoylogging) to log information about API Velocity endpoints. Envoy Logging is supported by our service api-observe, which your service’s Envoy sidecar asynchronously sends information to. Historically, api-observe has used endpoints_set.go to know which endpoints need to be logged and obtain information about those endpoints.…
We’ve had diffs enabled in staging/prod for some time now, and we haven’t seen any concerning diffs or issues for ledger in both prod and staging. We are going to be flipping the flag now in staging to fully switch over to the schema implementation.
View newer replies


weisong
  3:03 PM
Hi team,  we got
Protobuf::GeneratedProtos::squareup::ledger::service::FreezeService#delete_freeze received status 500 with error
https://regulator.sqprod.co/admin/sidekiq/morgue/1682546251.7204242-dce4b84e7f25d57b42bfeec9.  Can someone help to investigate that?




46 replies
Last reply 3 months agoView thread


kcrane
:coolfingergun:  3:36 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we're out on prod
deploy checks pass


eliobis
:spiral_calendar_pad:  4:28 PM
:helloblob: Hello from BAAPI! Trying to better understand how/where Ledger uses uk direct debit mandates. We're moving them to the auth service over the new few quarters and trying to map out the current use cases. Been looking through the code by I'm not too familiar with Ledger so any help is appreciated. Happy to jump in a meeting if that's easier for someone! Thanks! :slightly_smiling_face:

1 reply
3 months agoView thread


kcrane
:coolfingergun:  4:30 PM
deploying 49e0bbfa485 to staging (latest)


kenji
  6:39 PM
Hi 
@mgp

qq, no rush though, [production] JPY H2H settlement 2023-4-27 No.2240 with Mizuho Bank, Ltd. completed was sent nearly 50 minutes late than usual, and Mizuho is asking me why.
Have we changed the schedule in any way? or is this due to DST?
(
@ryosuke
@shigeki
)


5 replies
Last reply 3 months agoView thread


kcrane
:coolfingergun:  4:18 PM
deploying 80352c14b4a to staging (latest)


eslocombe
:spiral_calendar_pad:  7:51 AM
hi ledger engineers! we are trying to diagnose some performance issues the ledger database shards in staging - but have not uncovered anything in particular. The next thing I would like is for someone to (a) restart the staging app nodes to have a fresh start and then (b) to investigate if there are any issues on the app connection side. I am specifically wondering if there is something in the db connection itself making queries return slowly. I discussed it a bit in here https://square.slack.com/archives/C02FFJXER/p1682622616439449 and https://square.slack.com/archives/C03Q4J2CJ58/p1682624899777009 but the slack threads are so long that I think we might be getting into dedicated slack channel territory.


minghua
Hey folks :corgi-wave:
I have a migration stuck in FAILED_RETRYABLE for a few metaclusters (migration here)
I followed some of the previous threads that encountered the same error, and essentially created that migration to retry only the failed metaclusters, but they are still failing.
Show more
Thread in ods | Apr 27th | View message


eslocombe
did anyone here notice that ledger was performing horribly on mysql8? IMO - this needs immediate triage 
@ioberst
Thread in mysql-8-upgrades | Apr 27th | View message


3 replies
Last reply 2 months agoView thread


mgp
:baby:  5:51 PM
Deploying 8d433bdc365 to Ledger staging (latest)

PayswingBot
APP  3:03 AM
Pay swing has been initiated by mparmet with message: https://jira.sqprod.co/browse/ROLL-110444.
Evacuating payments traffic from WEST datacenters (swinging EAST) in production
**EAST** :large_green_circle: (Available): Serving new payments
**WEST** :large_orange_circle: (Degraded): NOT serving new payments

PayswingBot
APP  3:12 AM
Pay swing has been initiated by mparmet with message: https://jira.sqprod.co/browse/ROLL-110444.
Restoring normal payments traffic (unswinging) in production
**EAST** :large_green_circle: (Available): Serving new payments
**WEST** :large_green_circle: (Available): Serving new payments


brentw
:spiral_calendar_pad:  10:04 AM
Q: Does Ledger have any active Chase pipelines anymore?

1 reply
2 months agoView thread


skaltenbach
:spiral_calendar_pad:  11:38 AM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-110773
(ledger @ 8d433bdc365fa93669c54c11abae11f326ea4d60 to production)
:+1::+1::skin-tone-2:
3





10 replies
Last reply 2 months agoView thread


skaltenbach
:spiral_calendar_pad:  12:37 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


skaltenbach
:spiral_calendar_pad:  1:10 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


ishvydchenko
  2:01 PM
Hey team!
We've been testing some refund flows on staging for the capital migration to MoneySweeper and we had a case on staging where we took 3 partial refunds and it looks like only 1 of them showed up as a Ledger Entry? This seems like a potential issue since the seller sees them as refunded but we don't see it on our end?
Payment Token: https://regulator.stage.sqprod.co/n/payments/lYv8Rn6tWAWltCrGRxD3ECZHKaGZY
:eyes:
1



5 replies
Last reply 2 months agoView thread


skaltenbach
:spiral_calendar_pad:  2:54 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass


tal
:no_entry:  4:20 PM
hey team! just curious if anything changed with this script, we use it on Transfers team to be able to easily get into the right ledger DB shard in prod or staging for a given unit token. these are the aliases we use:
# This command, followed by a unit token automatically connects you the Ledger shard that the unit is stored in.
alias lpd='~/Development/java/settlements/ledger/script/calculate-shard'
alias lsd='~/Development/java/settlements/ledger/script/calculate-shard --staging'
but it seems like it's not working anymore, we're getting this error:
env: python: No such file or directory
appreciate any help :pray: !



8 replies
Last reply 2 months agoView thread


skaltenbach
:spiral_calendar_pad:  4:47 PM
deploying ba60af2f4faa2b1f16db25864d128edca35868f7 to staging (latest)


hpham
  5:34 PM
Hey 
@oncall
 I was wondering if we could halt all ledger debits on this Seller here as the Seller has made an external complaint. The system looks like it keeps debiting $9591.64 from their bank account after marking one of their debits as “failed” manually on our side. cc: 
@njain
 (edited) 





49 replies
Last reply 2 months agoView thread


songlinliu
  9:34 AM
Can I get an approval to extend regulator ’s access to ledger? https://registry.sqprod.co/app_dependency_requests/33016 Thanks
:stamp3:
1



manij
:spiral_calendar_pad:  10:16 AM
hello there, is there a way to extend a hold on a user applied via regulator "create user hold" ? for more context, credit risk ops team applied a hold on a seller(convene) but the duration is defaulted to 90 days which is not sufficient for this use case. without an option to extend to a custom time, ops team is waiting for the existing hold to expire and then apply a new hold for the next 90 days using reminders which is tedious and error prone. just wanted to check if there is any override that can be done in the backend to extend the hold. thanks  :pray:


3 replies
Last reply 2 months agoView thread


skaltenbach
:spiral_calendar_pad:  12:11 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-110861
(ledger @ ba60af2f4faa2b1f16db25864d128edca35868f7 to production)
:+1:
2




8 replies
Last reply 2 months agoView thread


nbl
  12:31 PM
Hey 
@oncall
could help explain what’s happening to a confused loans customer who called into ops? We created a ledger entry for this customer, and it seems to have taken all of their balance and debited their bank account the full amount (instead of just the amount remaining after balance). I’m not sure if this is just because it’s still in the Pending state but do you mind taking a look?
report from ops


jjuarez
@nbl
 The amount seems wrong though. We sent a debit to the linked BA for $2689. And we took their processing for $2309. All to pay for the $2689 term loan payment, that doesn’t make sense to us
From a thread in ops-term-loan | May 2nd | View reply



13 replies
Last reply 2 months agoView thread


skaltenbach
:spiral_calendar_pad:  1:04 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


lise
:no_entry:  1:23 PM
Hey team! I've noticed no new data in ledger.raw_feeds.settled_ledger_entry since 4/25. Would someone here be able to help out? Please feel free to redirect me if not the correct spot to ask. thanks!


3 replies
Last reply 2 months agoView thread


skaltenbach
:spiral_calendar_pad:  1:40 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


skaltenbach
:spiral_calendar_pad:  2:27 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass


acastberg
  2:28 PM
:wave: we have a seller (LHENBTMSDZJHA) with 2 settlements that were sent to a bank account on 4/30 that failed verification. Is there any way to know whether these funds are still in flight? If so is it possible to claw these back?
@oncall



6 replies
Last reply 2 months agoView thread


skaltenbach
:spiral_calendar_pad:  4:20 PM
deploying 53b9d0c5ab3f352557c1f6cc37f3a2cde7ba0ce3 to staging (latest)


kcrane
:coolfingergun:  6:14 PM
@tmahoney
 sorry for the slightly after-hours tag, but we're seeing some IllegalCashflowExceptions from a merchant trying to refund a lot more than they have available. is there anything we should do about this?
https://square-inc.sentry.io/issues/4149551522/?referrer=slack
IllegalCashflowException
bad cashflow: Attempt to refund more than available. Tried to refund USD 50000.00 on payment ZkSdPfHQgOPacY0E4gmOCUtFFdfZY, but only USD 0.00 remains
LEDGER-PRODUCTION-15KSLEDGER-PRODUCTION-15KS | May 2nd | Added by Sentry
Select Assignee...




41 replies
Last reply 2 months agoView thread


tmahoney
  6:48 AM
:bufo-wave: hey folks! is Ledger having trouble in staging? namely, heavily backed up on processing captures?
we’ve been getting refundsarbiter staging alerts since yesterday evening (“PAYMENT_NOT_FOUND” errors from Ledger) that suggest this is happening.



24 replies
Last reply 2 months agoView thread


skaltenbach
:spiral_calendar_pad:  11:54 AM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-110941
(ledger @ 53b9d0c5ab3f352557c1f6cc37f3a2cde7ba0ce3 to production)



18 replies
Last reply 2 months agoView thread


skaltenbach
:spiral_calendar_pad:  1:01 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


skaltenbach
:spiral_calendar_pad:  1:33 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


skaltenbach
:spiral_calendar_pad:  2:22 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass
:yey:
1



skaltenbach
:spiral_calendar_pad:  4:08 PM
deploying 3ba24f24f4cfb3608b1489448d340f14cb84377f to staging (latest)


sfitzgerald
:palm_tree:  6:00 AM
Hi team! Any chance someone can take a look at this? Missing transfers for an ES merchant but it hasn't been assigned to anyone yet! Thank you!!
:eyes:
1



3 replies
Last reply 2 months agoView thread


zellyn
:spiral_calendar_pad:  12:32 PM
Hey 
@oncall
… have y’all had trouble migrating Ledger to gRPC/envoy in the past?





+1
83 replies
Last reply 1 month agoView thread


alexandrawilliams
  1:47 PM
Hi team, MYSQL8 update:
On Monday 5/8, we will successover ledger to the B side, and monitor
Then on Monday 5/15: we will upgrade A side (assuming previous week with B side went smoothly)
Does this work for you? Please follow along in #mysql-8-upgrades and ping us with any questions. cc 
@lagarwal
 
@jzammito


2 replies
Last reply 2 months agoView thread


ioberst
:palm_tree:  2:09 PM
was added to #ledger by alexandrawilliams
.


lagarwal
  2:21 PM
replied to a thread:
MySQL8 upgrade - Just writting to check that can we move 'ledger' staging on 4/17? Thanks
Just a gentle reminder: we have the MySQL8 upgrade PR merged for 'ledger' app. We have put in week of 5/8. We will upgrade side B first then side A following week. You can follow #mysql-8-upgrades for more progress/updates. Thanks
:ok_hand::skin-tone-2:
1

View newer replies


acastberg
  2:44 PM
hello from transfers:wave: I was wondering if there's a good place to find metrics on the # of payouts being sent out during each type of pipeline run in ledger
for context: we want to know what the peak volume will be for sending transfer notifications during pipeline runs :blob-thanks:


7 replies
Last reply 2 months agoView thread


ena
  3:12 PM
heya team! seeing some timeouts on staging for ListMerchantSettlementStates , GetInstantDepositAccount , GetClearedBalanceV2 which we think might be causing some of the transfers pages to intermittently fail to load :thinkeyes: do y’all know what might be happening? :pray::skin-tone-2:
:eyes:
1




7 replies
Last reply 2 months agoView thread


kcrane
:coolfingergun:  4:13 PM
Rolling Ledger back to 53b9d0c5ab3 in staging (stable on 5/2/23); latencies are sharply elevated since the deploy last night
:+1:
1
:tybig:
1



2 replies
Last reply 2 months agoView thread


sherrywan
  8:15 AM
Good morning Ledger team! I’m an engineer from reconciliation team, and I have a bit urgent ask around CAPITAL_CREDIT_CARD_TRANSFER event type, more specifically, the external_source_id field for them. (please see screenshot)
I realized the first row on the external_source_id is merchant_token, and the second row is a concatenation of 3 different fields: I noticed the first part is the sweep token, and can I get someone’s help on the remaining parts? what are those?
appreciate your help as we’re working on reconcile these ledger entries on our side. :thankyou-2852:
Screenshot 2023-05-05 at 7.00.56 AM.png
 
Screenshot 2023-05-05 at 7.00.56 AM.png



5 replies
Last reply 2 months agoView thread


eallar
:ooo_1:  3:43 PM
:wave: Hi all, could someone help us understand why the seller LR5MJDTNM15AK is suspected?
{
  "settlement_state": [
    {
      "merchant_token": "LR5MJDTNM15AK",
      "can_settle": false,
      "reason": [
        "SUSPECTED"
      ],
      "start_at": {
        "instant_usec": 1683324094000000,
        "timezone_offset_min": 0,
        "tz_name": [
          "UTC"
        ]
      },
      "can_debit": true,
      "linked_bank_account": true,
      "transaction_fund_id": 10
    }
  ]
}




7 replies
Last reply 2 months agoView thread


smartin
  4:14 PM
deploying be424713807 (latest) to Ledger staging


sumitg
  7:37 PM
Hi team, we are having planned outage with Barclays from 10:00 PM Eastern today to 5:00 PM Eastern May 7, this will impact GBP transfers in UK. I will post updates here if outage is extended


5 replies
Last reply 2 months agoView thread


lauraknight
:bufo-mask:  10:55 AM
:wave: i’m getting failures in dashboard staging, looks like ListPendingBalances is timing out (speleo)


ioberst
:palm_tree:  12:21 PM
ODS here. To prep for the MySQL 8.0 upgrade I will need to run a Shift request on ledger_entries to rebuild the table. We generally to these for teams but for a table of this size I wanted to double check with you guys before kicking this off.





21 replies
Last reply 2 months agoView thread


wstewart
  12:43 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-111157
(ledger @ be4247138072a7821692b9b58762d4769e130217 to production)
:approve:
1




11 replies
Last reply 2 months agoView thread


egraham
:bulb:  1:15 PM
hey! Can someone help me understand why the Payments Schedule II role is included in the ledger owners group?
https://registry.sqprod.co/groups/ledger--owners
it feels like maybe it was done out of convenience at some point, but I'm not sure it makes sense today. (edited) 




8 replies
Last reply 22 days agoView thread


wstewart
  2:45 PM
deploying 1dfc31cfdeab3934a58b4a09d7d38be9808011c3 to staging


wstewart
  1:03 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-111227
(ledger @ 1dfc31cfdeab3934a58b4a09d7d38be9808011c3 to production)





18 replies
Last reply 2 months agoView thread


wstewart
  1:52 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


wstewart
  2:18 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


wstewart
  2:41 PM
Deploying 7c2dfbfbabad3d0e3ffb35d575d05efbdbfe3d1d to staging


shawnee
:dancing_pigeon:  2:49 PM
Hi team :pig-wave: Looking to get ledger over the finish line for Envoy SAFE gRPC enforcement (ROLL). It's currently in logging mode only in prod for gRPC enforcement and I'd like to enable it to 25%. Can someone confirm it's good to go for that? Best way to tell is to check for any irregularities/conflicts in these kinds of logs (1 & 2 in staging and 3 in prod) for your service.




25 replies
Last reply 2 months agoView thread


wstewart
  3:34 PM
replied to a thread:
Ledger ROLL:…
:atlassian_error: rolling back
View newer replies


olena
:ooo_1:  11:40 AM
https://jira.sqprod.co/browse/ROLL-111299
Swing payments out of US-WEST (SJC) to US-EAST (IAD) for maintenance
swing execution: May 10, 2023 at 12:00PM PT
slack thread
cc 
@oncall


olena
:thread:for swing SJC -> IAD
Thread in methods-regional-help | May 10th | View message


3 replies
Last reply 2 months agoView thread

PayswingBot
APP  12:20 PM
Pay swing has been initiated by olena with message: https://jira.sqprod.co/browse/ROLL-111299.
Evacuating payments traffic from WEST datacenters (swinging EAST) in production
**EAST** :large_green_circle: (Available): Serving new payments
**WEST** :large_orange_circle: (Degraded): NOT serving new payments


olena
:ooo_1:  1:00 PM
replied to a thread:
https://jira.sqprod.co/browse/ROLL-111299…
swing to IAD is done
:ack:
1

View newer replies


wstewart
  1:17 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-111314
(ledger @ 7c2dfbfbabad3d0e3ffb35d575d05efbdbfe3d1d to production)
:+1::+1::skin-tone-2:
5




8 replies
Last reply 2 months agoView thread


wstewart
  1:37 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


kcrane
:coolfingergun:  1:41 PM
There's an issue in Ledger (by way of Books) with an index in Spanner being re-built; this is causing a small subset of Ledger entries and their respective balances to be delayed. Once the index in spanner is rebuilt, the issue will resolve itself. Sorry about this! We're keeping an eye on it and will update here once the index is back and running. (edited) 

1 reply
2 months agoView thread

PayswingBot
APP  1:53 PM
Pay swing has been initiated by olena with message: https://jira.sqprod.co/browse/ROLL-111299.
Restoring normal payments traffic (unswinging) in production
**EAST** :large_green_circle: (Available): Serving new payments
**WEST** :large_green_circle: (Available): Serving new payments


olena
:ooo_1:  2:06 PM
replied to a thread:
https://jira.sqprod.co/browse/ROLL-111299…
unswing is done (back to normal)


wstewart
  2:18 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


egraham
:bulb:  2:22 PM
replied to a thread:
hey! Can someone help me understand why the Payments Schedule II role is included in the ledger owners group?…
:bump:  bump on this -- would y'all be comfortable w/ removing the Schedule II role from the owner group? Asking as a schedule II w/ an irrational passion for registry cleanup and a low tolerance for inbox noise.
View newer replies


wstewart
  3:40 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we're out on prod
deploy checks pass


bbradley
:knife_fork_plate:  11:03 AM
Hi Team! Could I get a review for this Registry request and PR to grant Risk-Self-Serve access to Ledger?
We'll be using the GetPendingBalance and DeleteFreeze endpoints to help us automatically respond to Fake Account DocIDV sessions. Thanks!
:approve:
1
:thank-you1:
1




10 replies
Last reply 2 months agoView thread


olena
:ooo_1:  7:17 AM
https://jira.sqprod.co/browse/ROLL-111401
Swing payments out of US-EAST (IAD) to US-WEST (SJC) for maintenance
swing execution: May 12, 2023 at 9:30AM PT
slack thread
cc 
@oncall


olena
:thread:for swing IAD -> SJC 9:30am PT
https://jira.sqprod.co/browse/ROLL-111401 (edited) 
Thread in methods-regional-help | May 12th | View message
:doneee:
1


1 reply
2 months agoView thread


smartin
  11:16 AM
@oncall
 Looking to take over staging to test the move from sake -> gRPC, would like to leave it for a couple hours if that works


2 replies
Last reply 2 months agoView thread


smartin
  11:23 AM
Deploying 2166970e73b8 (canary) to staging


2 replies
Last reply 2 months agoView thread


wstewart
  2:41 PM
deploying 138c95ad25acbf691b51de7cfd803a5b25b211ae to staging


dberner
:spiral_calendar_pad:  10:42 PM
@oncall
 We've noticed two nights in a row ledger has stopped or slowed down polling of the /1/risk-evaluation-changes feed on magistrate for over an hour, resulting in stale risk states that take hours to recover. Are you aware of any issue?




20 replies
Last reply 2 months agoView thread


oelgabry
  7:41 AM
hi team! :wave:  I work on the Square Local Offers team (aka Cashback). It's a program where merchants offer buyers cashback earnings on their purchases. We'll be integrating with Moneysweeper to collect the cashback earnings plus a commission fee for cashback-eligible transactions.
We need to add a new LE type and Allocation type and I was wondering if there is any guide to follow. I am happy to provide more context. Here is the eng design doc. thank you so much!
G Suite Document
 

Seller Billing Eng Design - MoneySweeper
Google Doc
:checkmark:
1






39 replies
Last reply 1 month agoView thread


jzerilli
  1:24 PM
Hey team, Is it ever possible for a ledger balance to change without creating a ledger entry? I am currently looking into a reserve balance discrepancy between our service recoverytron and ledger. There is a non-zero reserve balance in our service but the ledger balance is zero. I am unable to find a ledger entry that would have set the ledger balance to zero
For more info I am looking into reserves for unit 8X25SQYWH6V6W. This unit took only 3 payments with reserves. I see 3 corresponding Risk Reserve Hold's in the ledger entries for these payments, but only 2 Risk Reserve Releases. The most recent ledger entry is from 2/15 when the risk reserve release happened for payment 2. There is nothing more recent in the ledger entry table despite something else causing the remaining $4,385 balance from payment 3 to be released.





25 replies
Last reply 2 months agoView thread


mengen
:spiral_calendar_pad:  1:35 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-111589
(ledger @ 138c95ad25acbf691b51de7cfd803a5b25b211ae to production)
:+1::+1::skin-tone-4:
7
:stamp:
1



11 replies
Last reply 2 months agoView thread


kramanathan
:spiral_calendar_pad:  1:36 PM
was added to #ledger by mengen
.


mengen
:spiral_calendar_pad:  2:01 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


mengen
:spiral_calendar_pad:  2:46 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


mengen
:spiral_calendar_pad:  4:03 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass

PayswingBot
APP  6:54 AM
Pay swing has been initiated by colten with message: Neteng maintenance https://jira.sqprod.co/browse/ROLL-111541.
Evacuating payments traffic from WEST datacenters (swinging EAST) in production
**EAST** :large_green_circle: (Available): Serving new payments
**WEST** :large_orange_circle: (Degraded): NOT serving new payments

PayswingBot
APP  7:43 AM
Pay swing has been initiated by colten with message: Neteng maintenance complete..
Restoring normal payments traffic (unswinging) in production
**EAST** :large_green_circle: (Available): Serving new payments
**WEST** :large_green_circle: (Available): Serving new payments


wstewart
  10:03 AM
@oncall
 can I take over staging for a bit?



11 replies
Last reply 2 months agoView thread


mgp
:baby:  12:37 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-111637
(ledger @ 3f1ac03225321f163ceb61ec66e7ddbc250561e7 to production)
:+1:
1


3 replies
Last reply 2 months agoView thread


mgp
:baby:  12:47 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


ena
  1:25 PM
hey team! wondering if we can get a bit more context on JP weekly settlement pipelines and when the cutoff time is - from go/settlementsschedule and from what we could see in the code, we generally have a cutoff time of 3PM for weekly settlements.
In this ONCALL ticket, we mentioned to the agent that the cutoff time was 9:20am - wondering where this timeframe came from? light tagging 
@mgp
 (but no rush) since you’ve looked at this ticket previously :blobheart:


mgp
:baby:  1:30 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


mgp
:baby:  2:33 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass
2:35
Deploying 91d2678b9cf73d23929d7548232dc2893f6b0b0f to Ledger staging


ssopp
:spiral_calendar_pad:  7:24 AM
Hey team, sorry if you get this question often but I see from the Merchant Settlement Overview that a frozen merchant should be debitable still. I have a frozen merchant I made a debit against today, but it hasn't settled yet. Do I just need to wait for the nightly settlement pipeline to run? They have Square Card, so I wasn't sure if that would complicate things.


2 replies
Last reply 2 months agoView thread


mengen
:spiral_calendar_pad:  4:44 PM
Deploying 51fcba2e1b0ca0820c4cf75c1f8c7cbbafae2b20 to Ledger staging

PayswingBot
APP  5:23 PM
Pay swing has been initiated by rafe with message: pago is struggling in iad.
Evacuating payments traffic from EAST datacenters (swinging WEST) in production
**EAST** :large_orange_circle: (Degraded): NOT serving new payments
**WEST** :large_green_circle: (Available): Serving new payments

PayswingBot
APP  8:13 PM
Pay swing has been initiated by rafe with message: Pago is no longer having issues (ALERT-12188 stable).
Restoring normal payments traffic (unswinging) in production
**EAST** :large_green_circle: (Available): Serving new payments
**WEST** :large_green_circle: (Available): Serving new payments


ishvydchenko
  10:09 AM
Hey team! Any chance we can get a ledger deploy out today (since I think it was missed yesterday)?
Context: We've started the migration for Capital to use MoneySweeper and have launched with 3 sellers this week! However, we found a settling issue and 
@mgp
 helped put out a fix for it. We would love to get this deployed today so we don't need to pause the migration



8 replies
Last reply 2 months agoView thread


mgp
:baby:  11:47 AM
Per above we’d like to deploy Ledger today since we did not deploy yesterday.
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-111783
(ledger @ 51fcba2e1b0ca0820c4cf75c1f8c7cbbafae2b20 to production) (edited) 
:+1::+1::skin-tone-2:
5





16 replies
Last reply 2 months agoView thread


mgp
:baby:  12:32 PM
replied to a thread:
Per above we’d like to deploy Ledger today since we did not deploy yesterday.…
staging checks pass
:canary: canary start
:crossed_fingers:
1

View newer replies


alim
:no_entry:  12:42 PM
hi team! i'm not sure if im in the right channel (apologies in advance if not.) i have a seller who has multiple square accounts with us and is having trouble identifying which square account/location we are trying to debit for SaaS costs. Is there anyway to look up a "TXXXXXX ID" if i provide those #'s?


2 replies
Last reply 2 months agoView thread


vlong
  1:09 PM
replied to a thread:
:wave: Hello, we’re reaching out because your service ledger uses Envoy Logging (go/envoylogging) to log information about API Velocity endpoints. Envoy Logging is supported by our service api-observe, which your service’s Envoy sidecar asynchronously sends information to. Historically, api-observe has used endpoints_set.go to know which endpoints need to be logged and obtain information about those endpoints.…
Things have looked good so far in staging, and we haven’t seen any diffs in production for ledger. We’re going to go ahead and flip the flag in production/sandbox to switch over to the schema implementation.
View newer replies


mgp
:baby:  1:14 PM
replied to a thread:
Per above we’d like to deploy Ledger today since we did not deploy yesterday.…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


mgp
:baby:  2:34 PM
replied to a thread:
Per above we’d like to deploy Ledger today since we did not deploy yesterday.…
:shipitparrot: we’re out on prod
deploy checks pass


carol
:spiral_calendar_pad:  10:53 AM
Hi Ledger friends, requesting snowflake access :thank: https://registry.sqprod.co/access_requests/341196
:stamp:
1
:thanku:
1



ssopp
:spiral_calendar_pad:  11:40 AM
@oncall
 Hey team, Capital is experiencing high delay for assessments and I'm less familiar with Ledger's dashboards after the migration to Datadog. Can you confirm if Ledger's consumption of CapitalEventFeedEntries is stable/normal?
(our dashboards show lag rising steadily starting at noon)
:following:
1
:eyes:
1





7 replies
Last reply 2 months agoView thread


sbrown
  12:03 PM
:ablobwave: Hello! Not sure if this is the right place to ask, but is there any documentation on ledger.raw_feeds.merchant_settlement_state?
Looking for some information on the difference between cansettle,  candebit, and reason


2 replies
Last reply 2 months agoView thread


tochi
:spiral_calendar_pad:  12:42 PM
Hey 
@oncall
, quick question, is there any way we can see the rate of Ledger entry creation? We're wondering if there was a spike in the number entries created some time within the past 3 - 4 hours.
:checkmark:
1



2 replies
Last reply 2 months agoView thread


sarve
:spiral_calendar_pad:  4:02 PM
Deploying a7dcff89-b852-4868-9a1c-0e2683dd355b to Ledger staging
:celeryman3:
1



mgp
:baby:  5:20 PM
Deploying a9afd265748e0d81c73b6c06dabdb3b1e1e4a195 to Ledger staging


minghua
:spiral_calendar_pad:  12:43 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-112010
(`ledger` @ a9afd265748e0d81c73b6c06dabdb3b1e1e4a195 to production)
:stamp3:
1
:+1:
3


6 replies
Last reply 2 months agoView thread


minghua
:spiral_calendar_pad:  1:18 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


songye
:fine:  1:39 PM
:wave:  I am from #cards-api and trying to understand a ledger ConfirmInstrument call. In this trace there is a lot of requests from ledge to instrument.ConfirmInstrument. Wondering are they synchronous sequential calls based on a batch, or just happened to be grouped under same trace id?
:thanks:
1
:checkmark:
1



14 replies
Last reply 2 months agoView thread


minghua
:spiral_calendar_pad:  1:53 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


minghua
:spiral_calendar_pad:  3:05 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass
:bless-frog:
1



conner
  11:25 AM
Hi! Would ledger oncall be able to help us run the script related to this  (ALERT-11904) tomorrow? We'll have a google sheet with a merchant token and amount to credit.  cc 
@hoyi
 who already has context


conner
hi 
@oncall
! the SaaS team is working on remediation for a SEV, and there's a chance we'll need to credit merchants money if their original payment method isn't viable for a refund.
the marketing team pointed us to this doc, outlining a potential credit process.
we have some questions related to this -- could you or someone on your team please join #alert-11904_bills_are_generated_for_canceled_free-trial_postpay_saas?
Thread in ledger | Apr 11th | View message
:checkmark:
1



2 replies
Last reply 2 months agoView thread


minghua
:spiral_calendar_pad:  3:02 PM
Deploying ledger staging on a0979afc3c07daebda9e7036fab5e21a04d8de79


minghua
:spiral_calendar_pad:  1:09 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-112113
(`ledger` @ `a0979afc3c07daebda9e7036fab5e21a04d8de79` to *production*)


6 replies
Last reply 2 months agoView thread


minghua
:spiral_calendar_pad:  1:54 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


seung
:california:  3:02 PM
hi, for ListMerchantSettlementStatesResponse, if the can_debit field is true will linked_bank_account always be true too?
:checkmark:
1



2 replies
Last reply 2 months agoView thread


minghua
:spiral_calendar_pad:  3:26 PM
Deploying ledger staging on 8bbce9b24a5cd916f4997a9cce279012f7467348


minghua
:spiral_calendar_pad:  4:14 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass


jengel
:spiral_calendar_pad:  7:06 AM
Hey Team, my team consumes from the MerchantSettlementState feed and then stores a local replica of the data. It then queries the local replica to get a list of reasons for a unitToken. Would calling ledger listMerchantSettlementStates rpc yield the same result?
:eyes:
1



2 replies
Last reply 2 months agoView thread


agajardo
  7:37 AM
Question about freezes: What happens if freeze is called on a unit that is already frozen? Does the call return an error or does it just succeed?
:checkmark:
1




10 replies
Last reply 1 month agoView thread


harryw
:speech_balloon:  11:58 AM
was added to #ledger by cpopescu
.


emilyl
  12:19 PM
deploying 71123d41780 to staging


ashleychen
  2:53 PM
@oncall
 list

1 reply
2 months agoView thread


mgp
:baby:  2:57 PM
Deploying a7d5e649263f3a4464418b6cc9bcf6f156c659c7 to Ledger staging


minghua
:spiral_calendar_pad:  8:11 AM
:info: No deployments today


oliviazhang
:spiral_calendar_pad:  1:57 PM
Hi all, the $45k loss still shows on ACH for this seller regardless this money has been refunded, do you know when ledger balance will update so this loss will be removed?
Thank you!




18 replies
Last reply 1 month agoView thread


minghua
:spiral_calendar_pad:  2:33 PM
deploying 22b2b9799248a6435af13c502ae04528c5efe901 to staging


songlin
:spiral_calendar_pad:  1:37 PM
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-112286
(ledger @ c496f073728d682e662296f344c9151f4a5523f9 to production)
:+1:
4




7 replies
Last reply 1 month agoView thread


songlin
:spiral_calendar_pad:  1:47 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-112286…
staging checks pass
:canary: canary start
View newer replies


songlin
:spiral_calendar_pad:  2:27 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-112286…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


songlin
:spiral_calendar_pad:  2:46 PM
deploying 25965c7e81dd097ce2ba0bddc8b942c35f03f2df to staging (edited) 


songlin
:spiral_calendar_pad:  3:28 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-112286…
:shipitparrot: we're out on prod
deploy checks pass
:celeryman3:
1



ryohei
  12:24 AM
Hello team sorry if this is wrong channel but hope it is correct!
When payments are captured, is captured_at field that Square checks to determine to make a deposit in the next business day or the day after the next day?
The JP doc says a payment is sent to bank accounts the next business day if customers use Mitsui Sumitomo Bank and Mizuho Bank accounts. For the other types of accounts, it is the day after the next day. A JP partner wants to make sure that Square checks captured_at to determine the timing.
For Mitsui Sumitomo Bank and Mizuho Bank accounts, if captured_at is between 00:00 and 23:59 , it will be the next day. There will never be the day after the next day
For other bank accounts, if captured_at is between 00:00 and 23:59 , it will be the day after the next day
Thank you in advance!
:eyes:
1



13 replies
Last reply 5 days agoView thread


klachance
:no_entry:  6:51 AM
Hey team, we're getting a question from audit for a completeness check with ledger data. Would it be appropriate to directly query the ledger production database and compare it with snowflake data?
cc: 
@mmargenot
:eyes:
1



4 replies
Last reply 1 month agoView thread


mmargenot
:no_entry:  6:51 AM
was added to #ledger by klachance
.


brentw
:spiral_calendar_pad:  8:54 AM
Hey Ledger team, please hold off on merging changes to ledger today until we can verify that no emergency changes need to be made to mitigate the JPMC issues from last night. Thanks! cc: 
@oncall



4 replies
Last reply 1 month agoView thread


mgp
:baby:  11:02 AM
@oncall
 can I deploy a canary build to Ledger staging? I just need to test something for 5 minutes and then I can put it back



5 replies
Last reply 1 month agoView thread


songlin
:spiral_calendar_pad:  12:56 PM
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-112347
(ledger @ 25965c7e81dd097ce2ba0bddc8b942c35f03f2df to production)

5 replies
Last reply 1 month agoView thread


songlin
:spiral_calendar_pad:  1:08 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-112347…
staging checks pass
:canary: canary start
View newer replies


songlin
:spiral_calendar_pad:  2:19 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-112347…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


songlin
:spiral_calendar_pad:  2:25 PM
deploying 8628d131ccec33fae9ce0e0c05bef37afaa45c1e to staging


songlin
:spiral_calendar_pad:  3:26 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-112347…
:shipitparrot: we're out on prod
deploy checks pass


mgp
:baby:  3:52 PM
@oncall
 can I deploy another canary build to staging?



4 replies
Last reply 1 month agoView thread

ODS Insights
APP  5:15 PM
This is a monthly reminder from ODS. Databases for one or more apps associated with this Slack channel (#ledger) have Best Practices issues. Review the issues in the databases/best-practices screen in Square Console.
https://square-console.sqprod.co/app/ledger/databases/best-practices (1361 cases)
See https://wiki.sqprod.co/display/ProdEng/ODS+Insights+MySQL+Best+Practices for explanations of issue types.

1 reply
1 month agoView thread


songlin
:spiral_calendar_pad:  3:05 PM
deploying c2f643f4be3df3e31439568cbf94f587b4dd4031 to staging

PayswingBot
APP  10:20 AM
Pay swing has been initiated by kumar with message: East is down for v2/payments.
Evacuating payments traffic from EAST datacenters (swinging WEST) in production
:large_orange_circle: (Degraded) EAST: NOT serving new payments
:large_green_circle: (Available) WEST: Serving new payments


cqin
:spiral_calendar_pad:  11:02 AM
Hi team, repost an oncall question here. Could someone help me to understand this please? Thank you:blobheart:


cqin
Hi team, could someone look at this oncall ticket please? The seller has a refund on 5/10, however, Ledger did not debit seller’s checking balance. Does anyone have ideas on why not debit? Thank you :blobheart:
Thread in banking-services | Jun 2nd | View message
:eyes:
1






5 replies
Last reply 1 month agoView thread

PayswingBot
APP  11:06 AM
Pay swing has been initiated by kumar with message: Preceding SEV is stable. Normalizing traffic..
Restoring normal payments traffic (unswinging) in production
:large_green_circle: (Available) EAST: Serving new payments
:large_green_circle: (Available) WEST: Serving new payments


zifan
:spiral_calendar_pad:  1:03 PM
:bufo-wave: Hi team, heads up - there will be a planned outage from Barclays FileGateway between 02:45 and 15:30 BST on June 11th (Jun 10 6:45 PM - Jun 11 3:00 AM PST). cc 
@oncall

1 reply
1 month agoView thread


bjoseph
:spiral_calendar_pad:  2:49 PM
deploying latest 0b708b52701cbcee7d6a3a6a47b05b431cd99254 to staging


sherrywan
  11:11 AM
:high-five-front: Heyo ledger team! May I ask some details around the external_source_id field for the moneysweeper transferred ledger entries - what are each sub-part of the entire id (since it is an array of strings? please see screenshot).
I assume the first part is merchant_token, what about the second part?
This is pretty important & urgent for us (reconciliation team) since we need this information to compare / join with bankc tables. Thanks!!!
Screenshot 2023-06-04 at 11.06.08 PM.png
 
Screenshot 2023-06-04 at 11.06.08 PM.png


6 replies
Last reply 1 month agoView thread

PayswingBot
APP  11:54 AM
Pay swing has been initiated by lieberman with message: ZK instability.
Evacuating payments traffic from EAST datacenters (swinging WEST) in production
:large_orange_circle: (Degraded) EAST: NOT serving new payments
:large_green_circle: (Available) WEST: Serving new payments


hoyi
  12:53 PM
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-112580
(ledger @ 0b708b52701 to production)
:+1::+1::skin-tone-2:
4



4 replies
Last reply 1 month agoView thread


hoyi
  1:13 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-112580…
staging checks pass
:chocobo-face: canary start
View newer replies


hoyi
  1:42 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-112580…
canary deploy checks pass
:rolling_kirby: rolling forward

PayswingBot
APP  1:51 PM
Pay swing has been initiated by lieberman with message: ZK issues are resolved.
Restoring normal payments traffic (unswinging) in production
:large_green_circle: (Available) EAST: Serving new payments
:large_green_circle: (Available) WEST: Serving new payments


tmahoney
  3:18 PM
:wave:
hey folks, last week I noticed that refundsarbiter-staging has been getting pretty badly clogged with refunds that never approve until they eventually expire. the acceptance tests themselves don’t “care” (they’re Pago-oriented so they’re just exercising, like, “can I create this refund?), but it does create some concern that our async refund approval paths aren’t getting sufficiently exercised in staging. so I’ve been digging into why our staging refunds so rarely get approved.
what I’m seeing is that RefundsArbiter never sees a settled Ledger entry. I think this is one of those places where Ledger actually owns some Risk-oriented logic around settlement state, maybe? my conjecture here might not be particularly helpful, but basically I see:
1) this yellow banner in Regulator for our primary staging unit: https://regulator.stage.sqprod.co/n/users/P3CCK6HSNDAS7
2) that RefundsArbiter is never seeing a settled Ledger entry
and I suspect the two are related. would just like to better understand what happens here, and how we can avoid it (and/or self-serve fixing it in the future so that acceptance-test staging data doesn’t get clogged up like this). appreciate any advice y’all can give :bless:



23 replies
Last reply 1 month agoView thread


minghua
:spiral_calendar_pad:  7:15 AM
forgot to mention, but staging at d1217aba440b0ac65641a0ca74f4d6a608bc86f8 deployed yesterday evening

2 replies
Last reply 1 month agoView thread


mnovich
:spiral_calendar_pad:  11:09 AM
@oncall
 did we deploy anything to staging?
Triggered: [SQUARE][payouts-engineering][ledger]: System Status Checks Errors on check:pipeline-complete-fr_barclays_dry_run,env:staging,region:iad3a
System check metric pipeline-complete-fr_barclays_dry_run has high errors in staging
 @slack-payouts-alerts-dd-nonprod
min(last_5m): max:server.system_status.errors{service:ledger AND (env:production OR env:staging) AND region IN (*) AND check IN (*) AND check NOT IN (all) AND check:pipeline-* AND NOT check:*usd_return_chase AND NOT check:*cad_return_chase AND NOT check:*aud_return_chase AND NOT check:*jpy_return_smbc AND NOT check:*usd_return_wells_platform AND NOT check:*usd_return_celtic AND NOT check:*gbp_barclays_psr AND NOT check:*sepa_barclays_psr AND NOT check:*deprecated_fr_barclays AND NOT check:*zengin_settlement_dry_run_weekday AND NOT check:*zengin_settlement_weekday AND NOT check… Show more (10 kB)
Tags
check:pipeline-complete-fr_barclays_dry_run, env:staging, region:iad3a
Notified
@slack-payouts-alerts-dd-nonprod
https://square.datadoghq.com/monitors/105316571?group=check%3Apipeline-complete-fr_barclays_dry_run%2Cenv%3Astaging%2Cregion%3Aiad3a&from_ts=1686073031000&to_ts=1686074231000

:eyes:
1





15 replies
Last reply 1 month agoView thread


acastberg
  11:49 AM
:helloblob: hello from transfers, we see a few Canadian sellers (ex: LHP1ZZDGEZBXF) that are publishing AutoInstantTransferEvents that are consumed by deposits and failing to send since this path is only supported for US and AU.
We do also see that the sellers has the same day transfer setting enabled in dashboard but we aren't sure how they got to this state as we can't replicate this with other accounts so we think this is back-end driven.
Would anyone here be able to help figure out why this is happening? :pray: (edited) 



17 replies
Last reply 1 month agoView thread


lmancini
:blue_car:  1:56 PM
it looks like my production account LA6K6BJCJMEZH
has some ledger entries that are not settling? what are the recommended next steps for something like this? happy to provide more info if necessary
https://square.slack.com/archives/C0320QG19R9/p1686078515164759


lmancini
I just signed up for a Square Checking account in prod and then my balance was immediately reduced? I’ve never transferred any money out of this Square account so pretty confused as to what is happening with the balance? is it related to the review that looks like is indicated on the Balance page?
2 files
 
image.png
image.png
Thread in checking | Jun 6th | View message



7 replies
Last reply 1 month agoView thread


hoyi
  4:23 PM
Deploying latest (af2d6a78e71) to staging


tornubari
  5:17 PM
Hi Ledger,
I'm not certain if this is the appropriate channel for escalating this matter, but I have a merchant who experienced 27 dispute reversals from the same buyer that are two months old now. However, the funds have not appeared in the merchant's ledger. I'm wondering if there is a way for us to confirm whether these funds have been returned to Square from the buyer's bank?


3 replies
Last reply 1 month agoView thread


hoyi
  12:46 PM
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-112729
(ledger @ af2d6a78e71 to production)



6 replies
Last reply 1 month agoView thread


hoyi
  1:18 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-112729…
staging checks pass
:chocobo-face: canary start
View newer replies


irisd
:spiral_calendar_pad:  1:46 PM
Hi team :wave: I'm wondering if I can get a stamp from someone on this team to transfer the owner of the Wells GPG keys from ledger to teller?


cfu
:wave:  Hi 
@irisd
 I see that you are on the team that owns teller. Before we execute this request can we also get someone from the ledger team to comment here as a :stamp: for this request. Thank you!
From a thread in data-security-eng | Jun 7th | View reply
:stamp:
1



hoyi
  1:56 PM
replied to a thread:
Ledger ROLL: https://jira.sqprod.co/browse/ROLL-112729…
canary deploy checks pass
:rolling_kirby: rolling forward


robing
  5:09 PM
Hi everyone, I am interested on learning more about the Ledger feeds for freezes and payment holds. I am planning to consume them and would like to know some details about them, could you point me to the right point of contact for asking questions? Thank you!



36 replies
Last reply 4 days agoView thread


jcook
  5:48 PM
replied to a thread:
Hey Ledger team :wave: What are the merchant settlement states for L8X76D50F0AVT in staging? @justinroberts are puzzled as to why we are receiving NO_VERIFIED_BANK_ACCOUNT despite the seller having a linked bank account as per the linked bank accounts in regulator.…
Hey, seeing the same issue today with units L5M5SS89AR9XA and LFWDDW942MHNT.
View newer replies


janis
  4:06 AM
hello! i see a few UK sellers with a positive ledger balance and open chargebacks but the pending_balance_snapshots table is not updated with dispute cents. could you have a look why?  https://regulator.sqprod.co/n/users/LWJF3E8Z11Q14?section=ledger-entries thank you
select *
from ledger.ledger__ledger_production.pending_balance_snapshots
where merchant_token = 'LWJF3E8Z11Q14';

1 reply
1 month agoView thread


chrischiu
:spiral_calendar_pad:  8:20 AM
Hi 
@oncall
 I have a canary that I wanted to deploy to staging to test the feedetail that is being passed from feeplans to ledger. Could you help me deploy this sha 1466771 from this PR ? cc: 
@bjoseph
 (edited) 





+1
19 replies
Last reply 1 month agoView thread


bjoseph
:spiral_calendar_pad:  9:02 AM
replied to a thread:
Hi @oncall I have a canary that I wanted to deploy to staging to test the feedetail that is being passed from feeplans to ledger. Could you help me deploy this sha 1466771 from this PR ? cc: @bjoseph
deploying canary 1466771e4609ad52a313c3304288703415f128d5  to staging
View newer replies


bjoseph
:spiral_calendar_pad:  9:40 AM
replied to a thread:
Hi @oncall I have a canary that I wanted to deploy to staging to test the feedetail that is being passed from feeplans to ledger. Could you help me deploy this sha 1466771 from this PR ? cc: @bjoseph
deploying latest 78a86316b280a7397961420d92f8659676056df5  to staging
View newer replies


bji
  10:41 AM
How does ledger handle storing Japanese yen values? Is there any type of conversion to a concept of cents?


3 replies
Last reply 1 month agoView thread


robing
  10:45 AM
replied to a thread:
Hi everyone, I am interested on learning more about the Ledger feeds for freezes and payment holds. I am planning to consume them and would like to know some details about them, could you point me to the right point of contact for asking questions? Thank you!
Hi Daniel, I am working on a service that aggregates multiple feeds to understand why certain events happened based on context. I am interested on consuming the LedgerFreezes and LedgerHolds feeds to see their events and relate them to SSP actions on Risk. I'm wondering, how immediately do events get produced in those feeds? e.g. how fast would a freeze appear on the feed after it was applied by an operator?
View newer replies


jmao
  6:35 PM
Hi :wave:, Recon is currently seeing the following error when loading Ledger bank settlement entries from gs://sq-ledger-prod-bank-settlement-entries/feeds/1/bank-settlement-entries/4/proto-converted/YYYY-MM-DD/*.avro :
Error while reading data, error message: The Apache Avro library failed to read data with the following error: Cannot resolve: { "type": "enum", "namespace": "com.squareup.protos.paymentbalances.Model_PaymentBalanceAccount_", "name": "AccountType", "symbols": [ "ACCOUNT_TYPE_UNKNOWN_DO_NOT_USE", "FEE", "RISK_RESERVE", "PAYABLE" ] } with [ "null", { "type": "enum", "namespace": "com.squareup.protos.paymentbalances.ModelProtos_PaymentBalanceAccount_", "name": "AccountType", "symbols": [ "ACCOUNT_TYPE_UNKNOWN_DO_NOT_USE", "FEE", "RISK_RESERVE", "PAYABLE" ] } ] File: bigstore/sq-ledger-prod-bank-settlement-entries/feeds/1/bank-settlement-entries/4/proto-converted/2023-06-06/01/bGVkZ2VyLWFjaDoyMTk1NjExNzEx_2.avro
Was there a schema change recently? 
@mgp
 maybe related to https://github.com/squareup/java/pull/284422 ?




6 replies
Last reply 1 month agoView thread


emilyl
  2:39 PM
deploying b30e0d6c908 to staging


emilyl
  1:10 PM
:info: ledger staging will see interruptions to connections for awhile while a shift is running
:done:
1



emilyl
  1:49 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-112927
(ledger @ b30e0d6c9080f53bacafed8cf45bfa6216ee81cd to production)
:+1:
5




7 replies
Last reply 1 month agoView thread


emilyl
  1:59 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


emilyl
  2:34 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


emilyl
  3:11 PM
deploying f575557f460 (latest) to staging


emilyl
  3:43 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass


nirmit
:spiral_calendar_pad:  10:50 AM
Hey team :wave:  - looking at https://jira.sqprod.co/browse/ONCALL-150878. We (
@ahdoot
 and myself) have tried to understand what's going on and we reasoned it down to this:
Ledger balance: +216
2. Square Card: 216, Ledger balance: 0
3. Ledger balance: -225, Square Card: 216
4. Ledger Balance: -9, Square Card: 0
5. Ledger Balance: 216, Square Card: 0 refund canceled
6. Ledger balance: -9, Square Card: 225
if that looks right, can yall confirm if the debits for the merchant's accounts are in the right state and/or there werent extra debits? (edited) 
:checkmark:
1



3 replies
Last reply 1 month agoView thread


reilly
:spiral_calendar_pad:  12:39 PM
Hi team :wave:, I'm seeing some unexpected results from the Ledger list_ledger_entries RPC. I am querying this endpoint for the production unit G9W0KNK240V6F  with a lookup created_at_interval of the last week, but I don't see any results even though the merchant has ledger entries that have been created in the last month. I would expect these to be returned by the query https://regulator.sqprod.co/n/users/G9W0KNK240V6F?section=ledger-entries
:eyes:
1
:checkmark:
1



5 replies
Last reply 1 month agoView thread


emilyl
  1:07 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-113007
(ledger @ f575557f4606dd05e5978bea1bf31a4927ec0606 to production)
:+1:
2




9 replies
Last reply 1 month agoView thread


emilyl
  1:12 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


emilyl
  1:51 PM
replied to a thread:
Ledger ROLL:…
a node in sjc2b is unknown, which will block the roll forward. Going to roll back canary, rotate the unknown node out, and attempt canary again
View newer replies


emilyl
  2:19 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


emilyl
  2:35 PM
deploying eff0f6b5412 (latest) to staging
:squirtle-happy-tears:
1


1 reply
1 month agoView thread


emilyl
  3:38 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass


skhan
:spiral_calendar_pad:  8:51 AM
Hey :wave: from the #seller-branding-team! We are building a new Seller Brand API (design doc) that will be responsible for storing brand-related information. As part of this effort, brand-related data and client calls will be migrated from Roster to Seller Brand API.
Your team is responsible for one or more services (ledger) that are dependent on Roster and may be impacted by this migration. We want to make this migration as straightforward as possible and to provide clear guidance for our upcoming AP asks. Please take a few minutes to update the highlighted columns in our tracking spreadsheet for each of these services: go/seller-brand-migration-audit
:thankyou:
mwatts
 | G Suite Spreadsheet
 

Brand Dependency Audit (go/seller-brand-migration-audit)
Google Sheet
:eyes:
1
:checkmark:
1



venkata
  11:12 AM
Hi team :wave:, we have a merchant (unit) with a square card and this refund is unsettled, which is causing some downstream issues for capital. Is there a reason why the refund is unsettled and possible to settle it?
:checkmark:
1


1 reply
30 days agoView thread


emilyl
  12:42 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-113069
(ledger @ eff0f6b54122160b0dd464e7fee8f9460b817920 to production)
:+1::+1::skin-tone-3:
5
:pleasecat:
1






+3
15 replies
Last reply 30 days agoView thread


moshe
:spiral_calendar_pad:  12:45 PM
was added to #ledger by emilyl
.


bta
  12:51 PM
Taking over staging for a bit with 09aec56540eca1659b78930ffdeb954f5a80ca78





13 replies
Last reply 29 days agoView thread


emilyl
  1:16 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


emilyl
  1:39 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


bta
  2:13 PM
replied to a thread:
Taking over staging for a bit with 09aec56540eca1659b78930ffdeb954f5a80ca78
Deploying canary ae197088d720cdc4f4ba0041ef7afaf3276fae70 to ledger staging
View newer replies


emilyl
  2:39 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass


emilyl
  3:16 PM
deploying 0f690a984f3 (latest) to staging


mgp
:baby:  4:07 PM
@oncall
 running PopulatePartyAtFaultBackfila on ledger staging in dry run mode
:ack:
1



4 replies
Last reply 30 days agoView thread


nickbui
:ooo_1:  8:36 AM
@oncall
 Could I get this sha ae197088d720cdc4f4ba0041ef7afaf3276fae70 as a canary again? :ty2:



11 replies
Last reply 29 days agoView thread


ahdoot
  8:58 AM
hey 
@oncall
, not urgent b/c it’s in staging, but we’ve been noticing a lot of callouts from RefundsArbiter to Ledger’s LedgerService timing out recently in staging. Is something going on?
I’m noticing what looks like a big increase in Missed Deadlines to the LedgerService starting about a month 2 weeks ago (graph). (edited) 





10 replies
Last reply 29 days agoView thread


nickbui
:ooo_1:  9:21 AM
replied to a thread:
@oncall Could I get this sha ae197088d720cdc4f4ba0041ef7afaf3276fae70 as a canary again? :ty2:
@oncall
 my new sha to canary is: 0ae94adda94c249822769748525d1806a6b5abe5
:ack:
1
:ty2:
1

View newer replies


bta
  9:23 AM
replied to a thread:
@oncall Could I get this sha ae197088d720cdc4f4ba0041ef7afaf3276fae70 as a canary again? :ty2:
Taking over ledger staging with 0ae94adda94c249822769748525d1806a6b5abe5
View newer replies


estanfill
:spiral_calendar_pad:  9:33 AM
Hi! I’m the EM for Refunds API and we have been asked a question about transfers and refunds that I would appreciate your take on: https://square.slack.com/archives/C020XT0B9A9/p1686846690699649


estanfill
Our current CS guidance for refund cancellations has advocates do the followiing:
 locate the refund
 If the refund is “completed”, we cannot reject the refund.
 If the refund is still in “Pending” status, go to the Inbound Transfers section of Regulator.
 If there is an Inbound Transfer already initiated that contains the refund, the guidance says we cannot reject it.
Show more
Posted in refunds-api-help | Jun 15th | View message


kacie
:kermit-typing-working-like-crazy:  10:04 AM
Hi folks! I have a Strat Seller who is having issues with their bank account coming unlinked. I see several successful and several failed deposits to their bank account ending in 708 (most recent deposits have been successful) and see the reason for the fail on the failed deposits being "Credit Entry Refused by Receiver"
The seller has provided Square's ACH number or Origin IDs and spoke to Chase. Chase is saying the issue "is not on their side" and I'm really not sure where to go form here - any idea why this is happening or how we can ensure the bank account successfully stays linked?
This seller has 3 locations using the same bank account at which all the bank account has now become unlinked.
TAJR0D364WAB6
FZ7TM7Q08N4M3
LXBBZJ9FF1MEW


2 replies
Last reply 29 days agoView thread


gianni
  1:53 PM
was added to #ledger by kacie
.


emilyl
  3:26 PM
deploying 20f86a489475e4578433f2d46ca8aa45ab29a68d to staging


tal
:no_entry:  3:35 PM
hey team :ablobwave: we're seeing some timeout issues in deposits staging when calling Ledger endpoints (eg: GetDepositSchedule, GetInstantDepositAccount) that started around 12:30pm PT on June 12th. we aren't seeing anything in deposits that lines up with this timeline and saw some changes in #payment-balances-robots around that time. can you think of anything that happened that could cause these errors? cc 
@oncall





+2
27 replies
Last reply 22 days agoView thread


ahdoot
  7:41 AM
:wave: , can I get a review on this PR to add a metric to Ledger when y’all get the chance? I’ve provided context in the description, but happy to answer other questions. cc: 
@dskarbek
 (edited) 


2 replies
Last reply 24 days agoView thread


emilyl
  3:14 PM
deploying 08bff3483ec (latest) to staging


rohitdinakar
:spiral_calendar_pad:  12:58 PM
@oncall
 FYI, payment capture risk evaluations are happening via backstop since 11:57 AM PST due to a beacon redis lag issue. Fix is being deployed on the beacon side. spot checking the 15 min stale payments,  they seem to be >$1000 and backstop is keeping up with the evaluation volume for now for the sub-$1000 payments. cc 
@aackerman


chansen
Hey 
@zhonglin
 - anything I can do to help out? (I'm on fraud risk, we rely on beacon/RA for a bunch of event evals and are seeing a bunch of errors/issues on our side as well -> #fraud-eng-oncall)
Thread in beacon-dumbo-oncall | Jun 17th | View message


2 replies
Last reply 27 days agoView thread


klachance
:no_entry:  10:11 AM
Hey Team, I'm looking at a seller that has 11 chargebacks but not every chargeback has an open_dispute ledger entry so the disputed_amount_cents from the pending balance table doesn't line up with the total disputed amount. I would expect we would create a ledger entry for each new dispute to hold the funds which is typically what I see. Why is there no ledge entries for some but there is for others? Is there specific ledger entry logic that affects whether a open_dispute entry is created or not? I would expect the disputed_amount_cents to equal the total chargeback amount. We use the disputed_amount_cents as part of our recoveries calculation that we use to determine loss so this affects our overall loss amounts. Thanks cc: 
@mmargenot
https://regulator.sqprod.co/n/users/02EPE74JT17SH?section=transfers
select pbs.merchant_token
    ,pbs.currency_code
    ,pbs.next_deposit_amount_cents
    ,pbs.outstanding_amount_cents
    ,pbs.disputed_amount_cents
    ,pbs.non_expiring_hold_amount_cents
from ledger.ledger__ledger_production.pending_balance_snapshots pbs
where merchant_token = '02EPE74JT17SH'

SELECT merchant_token
    ,dense_rank() over(partition by merchant_token order by payment_token) num
    ,payment_token
    ,external_source_name
    ,entry_type
    ,to_user_amount_base
    ,to_user_amount_currency_code
FROM ledger.raw_feeds.ledger_entry le
WHERE merchant_token = '02EPE74JT17SH'
AND entry_type in ('OPEN_DISPUTE', 'RESOLVED_DISPUTE', 'DISPUTE_ADJUSTMENT')
ORDER BY 3,5
(edited)





+2
18 replies
Last reply 7 days agoView thread


hoyi
  4:25 PM
Deploying latest (03c0bffca96) to staging


ewalls
  7:50 AM
Hi Ledger team, I have a couple of questions about some LedgerEntries I'm seeing in Regulator. We were paged a couple of times for Issue encountered processing Ledger failure but I'm confused because it looks like they settled. However, I don't see a linked payment token for either.
For this unit, the LE created on 6/13/23 at 1:59pm EDT corresponds to a pending payment txn which is still pending. Why is it showing up as settled in Regulator, and why is there no linked payment token?
For this unit, the LE created on 5/25/23 at 2:08pm EDT corresponds to a pending payment txn which has been marked as succeeded. Why does it not have a linked payment token?


3 replies
Last reply 24 days agoView thread


ahdoot
  9:08 AM
replied to a thread:
:wave: , can I get a review on this PR to add a metric to Ledger when y’all get the chance? I’ve provided context in the description, but happy to answer other questions. cc: @dskarbek
Friendly :bump-thread:  on this when y’all get the chance
View newer replies


montemisa
  10:54 AM
Hello friends! I am with the reconciliation team and we consume the BankSettlementReturns feed through cloud persister. There has not been any data since 6/12. Is that expected?
accounts.google.comaccounts.google.com
Google Cloud Platform
Google Cloud Platform lets you build, deploy, and scale applications, websites, and services on the same infrastructure as Google.



5 replies
Last reply 24 days agoView thread


nickbui
:ooo_1:  12:38 PM
Could I have 
@oncall
 canary d0484a4a613504becf45b9c278d712c2000a7c08 to ledger in staging?
:ack:
1
:ty2:
1




3 replies
Last reply 24 days agoView thread


kcrane
:coolfingergun:  12:45 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-113292
(ledger @ 03c0bffca96 to production)
:+1::+1::skin-tone-2:
5


4 replies
Last reply 24 days agoView thread


kcrane
:coolfingergun:  1:03 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


kcrane
:coolfingergun:  1:31 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


skaltenbach
:spiral_calendar_pad:  2:45 PM
replied to a thread:
Hello friends! I am with the reconciliation team and we consume the BankSettlementReturns feed through cloud persister. There has not been any data since 6/12. Is that expected?
I am seeing an error in presidio for cloud-persister :
BankSettlementReturn has unknown fields [10]
when consuming this feed.
a new field was recently added to the BankSettlementReturn proto here with the number value 10, so I think cloud-persister may need to be restarted to pick up the change? cc 
@oncall
:this3:
1

View newer replies

PayswingBot
APP  3:00 PM
Pay swing has been initiated by markb with message: ROLL-113099 - neteng JPMC VPN work.
Evacuating payments traffic from EAST datacenters (swinging WEST) in production
:large_orange_circle: (Degraded) EAST: NOT serving new payments
:large_green_circle: (Available) WEST: Serving new payments


kcrane
:coolfingergun:  3:12 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we're out on prod
deploy checks pass


nickbui
:ooo_1:  3:15 PM
Could I get a review here? https://github.com/squareup/java/pull/286002 The current approval is from the #transfers side and is effectively sign off from them agreeing that the changes/intent looks good.
#286002 [ACCOUNTS-3659] Add new condition that can result in skipping email verification
This work supports the Step Up Authentication Pilot (https://docs.google.com/document/d/1oaebZSZd8aTYASGktxuC4jB3H_bHxrhj7tK2SV-aaZE/edit?pli=1#heading=h.ixzozqqgkxlh).
If you aren't familiar with the pilot, feel free to connect with me via Slack / Meets to get some context.
This PR follows this PR. It reads the new field of stepUpAuthenticationSatisfied and includes it in the criteria for skipping email verification.
Labels
accounting-engineering
Comments
5
<https://github.com/squareup/java|squareup/java>squareup/java | May 4th | Added by GitHub

2 replies
Last reply 23 days agoView thread


kcrane
:coolfingergun:  3:22 PM
Deploying latest (0ee165a6c0f) to staging

PayswingBot
APP  4:02 PM
Pay swing has been initiated by markb with message: ROLL-113099 restoring normal traffic.
Restoring normal payments traffic (unswinging) in production
:large_green_circle: (Available) EAST: Serving new payments
:large_green_circle: (Available) WEST: Serving new payments


aackerman
  5:27 PM
Hi 
@oncall
, have a non urgent issue that I wanted to drop a note in here




8 replies
Last reply 23 days agoView thread


nickbui
:ooo_1:  6:52 AM
replied to a thread:
Could I get a review here? https://github.com/squareup/java/pull/286002 The current approval is from the #transfers side and is effectively sign off from them agreeing that the changes/intent looks good.
Bump. Looking for a review from paybal
View newer replies


egraham
:bulb:  7:11 AM
replied to a thread:
hey! Can someone help me understand why the Payments Schedule II role is included in the ledger owners group?…
:bump:  seems like folks are in agreement. any true Ledger owners comfortable making the actual change? (Doesn't feel quite right for me to modify permissions as a faux owner).
View newer replies


ewalls
  12:04 PM
ServRec has been seeing 500s from Squareup::Ledger::Service::LedgerService#list_ledger_entries over the past hour. Is there something happening with Ledger right now?
Sq::Protos::RpcClient::SakeError
Squareup::Ledger::Service::LedgerService#list_ledger_entries received status 500 with error
CAPITAL-1A5CCAPITAL-1A5C | Jun 21st | Added by Sentry
Select Assignee...


11 replies
Last reply 23 days agoView thread


kcrane
:coolfingergun:  12:32 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-113350
(ledger @ 0ee165a6 to production)
:+1:
2
:stamp3:
1


4 replies
Last reply 23 days agoView thread


kcrane
:coolfingergun:  12:33 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


kcrane
:coolfingergun:  1:20 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


kcrane
:coolfingergun:  2:25 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we're out on prod
deploy checks pass


kcrane
:coolfingergun:  2:33 PM
Deploying latest (599390ad871) to staging


rpeterson
  10:12 AM
was added to #ledger by klachance
.


nickbui
:ooo_1:  10:26 AM
When would the next ledger deploy be?

1 reply
22 days agoView thread


egraham
:bulb:  11:10 AM
replied to a thread:
hey! Can someone help me understand why the Payments Schedule II role is included in the ledger owners group?…
fyi, I've removed the Payments Schedule II role from the ledger owners group!
:bless:
1
:tombstone:
1

View newer replies


ewalls
  12:52 PM
Hey Ledger team! Will a ReturnedLedgerEntry always have the same effective time as the original? I'm asking because it looks like we're seeing a case where that isn't true.
https://square.slack.com/archives/C02P16P09TR/p1687461632917699?thread_ts=1687404438.438389&cid=C02P16P09TR


ewalls
Based on how we handled this scenario from earlier this week, I was looking into this new case but I'm a bit confused about this payment.
Error: No unsettled entry found
Txn ID: 2455278270
Plan ID: 2193873
CEFE ID: 2002725206
Show more (edited) 
2 files
 
Mca repayment.png
Returned Ledger entry.png
From a thread in credit-servicing-record-alerts | Jun 22nd | View reply

1 reply
22 days agoView thread


johno
:spiral_calendar_pad:  1:26 PM
replied to a thread:
Friendly ping on this https://square.slack.com/archives/CAMN0UWMS/p1675989583282439
resurfacing this. it ended up paging us last night due to a larger than usual spike from ledger slowing down our kafka producer in esperanto. is there any way to put a cap on how heavy these bursts hit when they do happen?
View newer replies


jzerilli
  2:12 PM
Hey team, I am currently trying to trigger a bank settlement return in regulator staging for unit L33R41VJRBSB8 for testing purposes and appear to be running into an error that is coming from ledger. I will include the full stack track in this thread but seeing LedgerService#return_bank_settlement_entry received status 400 with error Invalid bank settlement entry token specified:. For reference I am using the return action shown on the transfers table and not specifying any token so im not sure why its happening. (edited) 
:checkmark:
1



9 replies
Last reply 22 days agoView thread


jessicadai
:spiral_calendar_pad:  2:13 PM
was added to #ledger by jzerilli
.


aackerman
  10:56 AM
Hi team, I have a small PR that adds a few merchants to the blacklisted-staging-merchants.yaml in ledger to address an issue with payment risk evaluations in staging, wondering if I might be able to get a look :slightly_smiling_face: https://github.com/squareup/java/pull/292797
#292797 [risk-common] dont send excluded entity for eval
After turning on the ExcludedEntities filter for statham payment evaluations in staging canary, I saw stale payments come through and eventually get evaluated by backstop. I noticed they were all from a few merchants, but not all of the merchants on the ExcludedEntities list. I think we need to align the ledger blacklisted merchant staging list with these staging merchants so that those payments don't alert for being stale, since we cannot get a beacon/RA evaluation for any payments from these units. I noticed most of the lists overlapped, with just these 3 for staging that were not in the ledger list.
Labels
accounting-engineering
Comments
3
<https://github.com/squareup/java|squareup/java>squareup/java | Jun 21st | Added by GitHub


8 replies
Last reply 18 days agoView thread


prabhjot
:no_entry:  12:17 PM
Hi Team :wave:, There is a planned Barclays FileGateway outage tonight between 06:45 PM (PDT) and tomorrow 07:30 AM (PDT), this will impact UK transfers. I’ll provide update here if the outage is extended, please let me know if I can provide more details.



3 replies
Last reply 21 days agoView thread


minghua
:spiral_calendar_pad:  2:48 PM
deploying staging on 5eafc6674adf1d9956905fc84572f9d13ff85b44


mnovich
:spiral_calendar_pad:  11:05 AM
Are items in staging holidng are for esperantoPayments feed a risk for todays ledger prod deploy?
https://apa1280--ledger.stage.sqprod.co/_admin#tab:holdingarea

1 reply
18 days agoView thread


dskarbek
:spiral_calendar_pad:  11:09 AM
BTW, since I'm about to be traveling and it's almost ledger deploy time, I approve my changes going live with the deploy.
:ty-bouncy-green:
1



mnovich
:spiral_calendar_pad:  11:37 AM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-113533
(ledger @ 5eafc6674adf1d9956905fc84572f9d13ff85b44 to production)
:+1:
1




9 replies
Last reply 18 days agoView thread


mnovich
:spiral_calendar_pad:  12:29 PM
replied to a thread:
Ledger ROLL:…
Can someone stamp this?
:stamp:
1

View newer replies


mnovich
:spiral_calendar_pad:  12:30 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


njain
:spiral_calendar_pad:  12:42 PM
Hey 
@oncall
, Capital seems to be experiencing high latency from ledger which is causing high delay in assessment creation.
(This is the dashboard I am looking at )
Could you please check to see if there are issues on the ledger side?





29 replies
Last reply 18 days agoView thread


mnovich
:spiral_calendar_pad:  12:56 PM
replied to a thread:
Ledger ROLL:…
cancelling deploy due to ongoing issue ( unrelated)


reilly
:spiral_calendar_pad:  3:25 PM
Hi team, I had some questions about this returned ledger entry (token wXu0PTLr4RsS4vT53__tGjrVG_0 ). The created at time is 6/21/23 at 8:00pm PDT , and I noticed the time it was settled or sent is exactly the same time (transfer link). This seems different from what we usually see, is there a reason this happened in this case? Asking because my team's service (Capital) depends on being able to catch RLEs being created before a settlement is sent but in this case we would not be able to do so. Thanks!
:checkmark:
1



2 replies
Last reply 17 days agoView thread


mnovich
:spiral_calendar_pad:  3:55 PM
deploying staging on 8b87ace1d860ecc9617e5d58c052371752c5d65e (edited) 


mnovich
:spiral_calendar_pad:  11:40 AM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-113627
(ledger @ 8b87ace1d860ecc9617e5d58c052371752c5d65e to production)
cc: 
@bjoseph
 
@emilyl
 
@brentw
 
@minghua
 
@dskarbek
 
@wstewart
 
@bhargava
:+1::skin-tone-2::+1::+1::skin-tone-4:
7



6 replies
Last reply 17 days agoView thread


mnovich
:spiral_calendar_pad:  12:12 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


mnovich
:spiral_calendar_pad:  12:46 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


mnovich
:spiral_calendar_pad:  1:53 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we're out on prod
deploy checks pass


mnovich
:spiral_calendar_pad:  3:15 PM
deploying staging on 27f292dba9d1e9e8f25a750f38e7e37a7a724784


sunny
  4:52 PM
https://square.slack.com/archives/C022YKL0EUE/p1687908753378109


sunny
hi! has anybody noticed issues related to recent payments loading in regulator for the Payments Table? we are investigating an oncall ticket where we see Automated Savings transfers (which are linked to payments) but we do not see the corresponding payments in the Payments table (payments no longer show after June 16th)
Merchant: MLXPD2DKQSGXZ Unit: L5KN8A2JBZW8S (this is also the only unit)
https://regulator.sqprod.co/n/users/L5KN8A2JBZW8S?section=admin-actions
Show more
Posted in regulator-help | Jun 27th | View message
:checkmark:
1




12 replies
Last reply 16 days agoView thread


sunny
  4:53 PM
replied to a thread:
hi! has anybody noticed issues related to recent payments loading in regulator for the Payments Table? we are investigating an oncall ticket where we see Automated Savings transfers (which are linked to payments) but we do not see the corresponding payments in the Payments table (payments no longer show after June 16th)…
as a follow-up, I was also impersonating the merchant and I did not see any payments (in Square Dashboard) from them after June 16th (although automated savings reflects that there were payments taken on June 17th and June 18th) - where’d the payments go? :eyes: :ghost: (edited) 
View newer replies

root
APP  10:22 AM
ODS host fpd1527.sjc3b.square (pd-odsgroup380) is down
No action is needed from you. ODS oncall will try to successover metaclusters if they are active on this host.
Please see the #situation channel for more information.
apps affected: ledger
metaclusters affected for these apps:
- pd-mysql-ledger-007
Cc: 
@oncall

1 reply
16 days agoView thread

root
APP  11:25 AM
ODS host fpd1296.iad3b.square (pd-odsgroup315) is down
No action is needed from you. ODS oncall will try to successover metaclusters if they are active on this host.
Please see the #situation channel for more information.
apps affected: ledger
metaclusters affected for these apps:
- pd-mysql-ledger-035
Cc: 
@oncall

1 reply
16 days agoView thread


mnovich
:spiral_calendar_pad:  11:27 AM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-113694
(ledger @ 27f292dba9d1e9e8f25a750f38e7e37a7a724784 to production)


6 replies
Last reply 16 days agoView thread


mnovich
:spiral_calendar_pad:  11:33 AM
replied to a thread:
Ledger ROLL:…
can I get a :stamp:  from anyone?
View newer replies


mnovich
:spiral_calendar_pad:  12:21 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


mnovich
:spiral_calendar_pad:  12:52 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


mnovich
:spiral_calendar_pad:  1:54 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we're out on prod
deploy checks pass


mnovich
:spiral_calendar_pad:  2:43 PM
deploying 2bf2986e1ad39d0638692b1eb0496b5fb963ca43 to staging


suril
  7:24 AM
Hello Team, I need help with one question. When seller’s ledger balance goes to negative, ledger recovers it via debiting seller’s external bank account. Does ledger create ledger entry for the ACH debit? (I did not see it in the Regulator Ledger Entries tab). What is the the best way to see this ACH on any of the available UI?



3 replies
Last reply 15 days agoView thread


alexluk
:spiral_calendar_pad:  2:36 PM
:wave: Hello owners of ledger,
The 3P Enablement Team, previously API Frameworks, is in the process of gathering information around rate limiting usage and requirements from owners of public APIs. We're hoping to make improvements to rate limiting in our platform and potentially monetize from top callers of our APIs.
We would greatly appreciate if you could fill out this google form to help inform our product decisions: https://forms.gle/iUE9w5b4tpAhMqJu8
Thank you and we'll keep you updated!


faisal
  3:34 PM
Hello, Ledger maintainers –
Block is migrating our Linux hosts to Oracle Linux 8, and the newer GPG software version in OL8 introduces a breaking change in the gpg command line tool Ledger uses for encryption. We need you to make a change in your project to keep it running on OL8.
To ease the transition to the new OS, Data Security Engineering has tested packaging changes that allow most software to continue working with minimal code changes. To prepare your app for the transition, we ask that you review OL8 Migration and GPG - Instructions for Service Owners, identify a team-member to coordinate this change, and provide us with a ticket we can watch to see your progress (if possible).
If you have any questions about this GPG upgrade path, please reach out to #data-security-eng. For general information about the OL8 upgrade, please see #oracle8-migration.
2 files
 

Next OS Project Overview
Google Doc

OL8 Migration and GPG - Instructions for Service Owners
Google Doc

1 reply
14 days agoView thread


mnovich
:spiral_calendar_pad:  3:54 PM
deploying a69baaed49036008b9be195556bad7d946086907 to staging


jsandifer
  1:28 PM
hi team. risk is seeing some instances in which fraudsters are able to exit funds before risk systems can flag the activity, largely it seems because Ledger is reflecting a  0 balance. the full thread is below, but does anyone have any ideas on why this might be happening?
https://square.slack.com/archives/CSS9G0N77/p1688058355042289
:speech_balloon:
1




12 replies
Last reply 10 days agoView thread


smartin
  3:24 PM
deploying f7c9d337d713bd42ddc585c31307273807d62654 to staging


prabhjot
:no_entry:  5:36 PM
Hi Team :wave:, There is a planned Barclays FileGateway starting now until 05:30 AM (PDT) tomorrow, this will impact UK transfers. I’ll provide update here if the outage is extended, please let me know if I can provide more details.
:ack:
1



parkjane
:spiral_calendar_pad:  12:25 PM
Hi Team! Would creator_token  from GetFreezesResponse always return a unit/merchant token? If so, which one is prioritized in returning (i.e. freeze creator has both unit/merchant token)?


tal
:no_entry:  2:19 PM
hey! not sure if this is the right place but i'm taking payments via Virtual Terminal in staging and it's been over an hour and i'm not seeing the funds in my balance :thinkeyes: any idea what could be causing the delay :bufo-pray: ?


6 replies
Last reply 9 days agoView thread


mengen
:spiral_calendar_pad:  2:50 PM
deploying 8ed4a3da3a83226643d132ff51f36446a91ee1e7  to staging


mengen
:spiral_calendar_pad:  5:37 PM
deploy c2e9781149ffedab055a5a41018aba4d63909fc3  to staging


joshuaw
  6:52 AM
I'm curious if there's a recommended way to configure settledLedgerEntry feed consumption. Every Saturday when free processing entries come in we see a massive spike in our feed lag. I'm wondering if you all are aware of any clients who can successfully handle the spike in traffic without much feed lag or if there's any other recommended approach or future plan to mitigate this lag?


ena
  8:37 AM
heya team! :ablobwave: from the Transfers team here! we're getting some inquiries (thread, thread) about sellers not receiving their nightly settlement sent last night (5th july). Regulator is showing these transfers as successful but sellers are saying the funds haven't hit their bank account yet (e.g. this transfer). They've called up their bank with the trace id and the routing number, but the banks say they didn't receive anything from Square. Would someone be able to help us take a look? :tybig: cc 
@ecoleman


cdannenberg
Hey Team - similar to the above, have another Strategic Seller, Fortuna Bakery, reporting they have not received transfers today for either of the two below accounts for any locations: 
@oncall
1.) ML6YQD88QSK9Q
2.)MLA78B4WQ5S9S
Thread in transfers | Jul 6th | View message


coglander
Hi team, I am covering for jean while he is ooo. Juice Press (Strategic Account) did not receive their transfers today. It is crucial as they need to pay out their payroll. ZH2JE5C3T7ZVS Can anyone take a look for me
Thread in transfers | Jul 6th | View message





+4
29 replies
Last reply 8 days agoView thread


jchi
  9:58 AM
was added to #ledger by bforehand
. Also, joycec
 joined.


joshuaw
  10:08 AM
I'm planning on increasing the max items for beemos consumption of ledgerEntries for 25 to 100. Please let me know if there are any concerns. We currently consume using 16 shards.  https://github.com/squareup/java/pull/294511

1 reply
8 days agoView thread

root
APP  11:38 AM
ODS host fpd1519.sjc3b.square (pd-odsgroup376) is down
No action is needed from you. ODS oncall will try to successover metaclusters if they are active on this host.
Please see the #situation channel for more information.
apps affected: ledger
metaclusters affected for these apps:
- pd-mysql-ledger-003
Cc: 
@oncall

1 reply
8 days agoView thread


zifan
:spiral_calendar_pad:  12:14 PM
Hi team! I have a question on ledger's logic on handling JP transfers. Does SMBC_daily pipeline only process transfers from SMBC to SMBC? And weekly pipeline handles transfers from SMBC to non-SMBC banks? Is that also true for Mizuho_daily and Mizuho_weekly pipelines? Or, according to this logic, does all transfers to non-SMBC && non-Mizuho goes to SMBC_weekly pipeline? Please help me to understand the difference between transfers processed by JP daily and weekly pipelines. :messenger-thanks:
:eyes:
1



10 replies
Last reply 8 days agoView thread


mengen
:spiral_calendar_pad:  12:33 PM
Ledger ROLL:
https://jira.sqprod.co/browse/ROLL-113961
(ledger @ c2e9781149ffedab055a5a41018aba4d63909fc3 to production)
:+1:
2






12 replies
Last reply 8 days agoView thread


cadams
:red_circle:  12:35 PM
was added to #ledger by mengen
. Also, cgarnier
 joined.


mengen
:spiral_calendar_pad:  12:59 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


mengen
:spiral_calendar_pad:  1:21 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
View newer replies


brentw
:spiral_calendar_pad:  1:58 PM
Hey Ledger team, I’m working on changes to process Chase ACK files in Teller for US, CA, and AU. I’m curious what you think the level of difficulty would be to perform similar changes in ledger, or if you think it’s worth it considering the latter two marketplaces have been migrated fully to teller.


mengen
:spiral_calendar_pad:  2:45 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass
:tada:
1



tmahoney
  3:05 PM
is CreateRefundLedgerEntry eligible to be marked idempotent?



48 replies
Last reply 22 hours agoView thread


tmahoney
  3:25 PM
replied to a thread:
is CreateRefundLedgerEntry eligible to be marked idempotent?
PR here: https://github.com/squareup/java/pull/294586
#294586 [ledger] make CreateRefundLedgerEntry idempotent with 1000ms retry ti…
…meout
Doing this to mitigate some transient failures in staging (and, less often, prod) from RefundsArbiter calling this RPC.
Used https://wiki.sqprod.co/display/DPS/Consuming+and+Exposing+RPC+Services as a reference.
Corresponding Slack discussion: https://square.slack.com/archives/CAMN0UWMS/p1688681104137169
Labels
accounting-engineering
Comments
1
<https://github.com/squareup/java|squareup/java>squareup/java | Jul 6th | Added by GitHub
:stamp3:
1
:thankyoublob:
1

View newer replies


tal
:no_entry:  3:31 PM
hey team! just wanted to surface this thread again, we've been getting a lot of timeouts in staging to downstream Ledger endpoints that Deposits calls, sometimes preventing us from being able to test properly. it seems to largely be units on ledger shard 10 -- is there anything still going on with that shard?


tal
hey team :ablobwave: we're seeing some timeout issues in deposits staging when calling Ledger endpoints (eg: GetDepositSchedule, GetInstantDepositAccount) that started around 12:30pm PT on June 12th. we aren't seeing anything in deposits that lines up with this timeline and saw some changes in #payment-balances-robots around that time. can you think of anything that happened that could cause these errors? cc 
@oncall
Thread in ledger | Jun 15th | View message


4 replies
Last reply 4 days agoView thread


zeke
  4:19 PM
Hi team, a follow up to this thread, I’ve got another single payment that’s stale for risk: zNm0prUfv5rEWs7ltb8fxMj3uaB. I checked in Magistrate and we cleared it. I can republish it but this happens every so often. 
@oncall
 can you take a look?


rho
@oncall
 hi, risk infra here. We’ve had a couple instances where we’ve gotten paged for a single payment not being cleared from ledger. We usually refeed or clear it via admin console but I wanted to bring it up since it’s happened intermittently. There’s one such stale payment right now if you wanted to take a look.
Thread in ledger | Feb 10th | View message
:eyes:
1




5 replies
Last reply 8 days agoView thread


mengen
:spiral_calendar_pad:  4:36 PM
deploying 7c77617ab1acff7bc00c6d90699bdcae1d933755 to staging


trandall
  3:00 PM
Hey I was hoping to get confirmation on why an MCA Repayment Refund ledger entry hasn’t been able to be processed yet? (continuation from this thread)
The $34.67 refund ledger entry part of this payment is the entry that hasn’t settled. Is this solely because the current primary payer on the plan doesn’t have a linked bank account, even though the secondary payer does have a linked bank account? And all that needs to happen to get this refund to settle is have Ops deactivate the current primary payer and make the secondary payer the primary payer? (ops mentioned that the current primary payer unit got hacked so I’m assuming that the unit hasn’t been updated on the Capital side to reflect this)




9 replies
Last reply 1 day agoView thread


dberner
:spiral_calendar_pad:  9:02 AM
Hi team - just an FYI, we have an issue in IAD magistrate that prevents us from processing risk events in that dc. To mitigate, we moved all event processing over to SJC. Unfortunately, the exception was not being logged so we are unable to identify a root cause. As such, we have fixed the exception swallowing and deployed it, and are now going to turn on IAD processing in production to replicate the errors deliberately. We will not leave it on longer than a minute before turning it off again. SJC will pick the failed messages back up and process them normally, and we should not see any stale payments as a result of this, but we're letting you know just in case there is an issue. cc @risk-infra-eng

2 replies
Last reply 4 days agoView thread


kingraham
:spiral_calendar_pad:  10:49 AM
hello, Invoices received an ONCALL issue related to a 'Bookkeeper adjustment' that with the MCA Repayment is consuming the invoice payment (regulator link for transfer from JIRA). Can someone assist?


2 replies
Last reply 4 days agoView thread


jsookikian
  11:40 AM
Hey team, I'm looking into a request from an EU seller who is trying to link their bank account again. Upon inspection, it looks like the had 2 failed bank transfers that are showing R10 return codes, which seems odd considering both transfers were credit. Can someone help provide some more information? cc: 
@ssusanto


lcarrie
Hey team - I have a seller (ML14871F99WES) who recently changed back account and is waiting for this bank account to be verified. They've asked if there's any way for this process to be expedited or anything we can do on our end to speed up the process? Thanks!
Thread in bank-accounts-api | Jul 10th | View message
:eyes:
1



4 replies
Last reply 4 days agoView thread


heggert
:speech_balloon:  11:47 AM
Hey team , Seller asking why her account is negative, i found that back in 3/7  -3 payments were flagged as possible buyer fraud and ssp sent. Seller already transferred the funds out, so we tried to pull funds from BA, but failed 3 times and unlinked, looks like those payments cleared from hold on 3/11 , she re linked a BA on 7/5 and now a return ledger entry tried to pull the funds again and caused the account to go negative. These ledger entries shoudl not be there as the paymenst were cleared. can you look into this, i think we need to reverse all the ledger entries on last failed attempt to debit her account as they are no longer needed since the hold was released. please lmk so i can update the seller. Risk ops said they removed the hold on their end, but we still ended up charging her again on 7/9 with a bank withdrawl, this should not have happened. This should be reversed as we took her initial balance as well. I was told to escalate here by tier 2 risk. ANy assistance would be appreciated.
LK7VB1N3C9RV4





+6
48 replies
Last reply 1 day agoView thread


lucasc
  11:52 AM
Hi team! I have a quick question for you. What triggers settlement for a payment on a bill/order? I noticed on this payment from this bill that the payment was authed/captured in January but the payment is settled in June. I know this is test data but curious what the workflow is here and if this is likely to happen in prod


2 replies
Last reply 4 days agoView thread


skaltenbach
:spiral_calendar_pad:  1:32 PM
Ledger ROLL:
https://block.atlassian.net/browse/ROLL-114059
(ledger @ 5a428a79c00c12e8b7da2d69adc37da5807de724 to production)
:+1::+1::skin-tone-2:
8






+1
64 replies
Last reply 1 day agoView thread


skaltenbach
:spiral_calendar_pad:  3:49 PM
deploying ef7a95891eb47b9fdfc44ac933c321d6b33fefdb (latest) to staging


hagit
:palm_tree:  4:58 PM
replied to a thread:
Hey team , Seller asking why her account is negative, i found that back in 3/7 -3 payments were flagged as possible buyer fraud and ssp sent. Seller already transferred the funds out, so we tried to pull funds from BA, but failed 3 times and unlinked, looks like those payments cleared from hold on 3/11 , she re linked a BA on 7/5 and now a return ledger entry tried to pull the funds again and caused the account to go negative. These ledger entries shoudl not be there as the paymenst were cleared. can you look into this, i think we need to reverse all the ledger entries on last failed attempt to debit her account as they are no longer needed since the hold was released. please lmk so i can update the seller. Risk ops said they removed the hold on their end, but we still ended up charging her again on 7/9 with a bank withdrawl, this should not have happened. This should be reversed as we took her initial balance as well. I was told to escalate here by tier 2 risk. ANy assistance would be appreciated.…
@oncall
, can you please help look at the payments in this thread? It seems to be a ledger issue with holds :pray:
View newer replies


suril
  4:49 AM
Hi Team, In the current state, Capital is creating Ledger entries to process payments to payoff loan. We are trying to learn which ledger entries ends up making ledger balance negative which results in Ledger creating ACH debit (ex: if Ledger debits $40 from external bank account, which Ledger entries are aggregating to $40). We are hoping to create metrics in looker at the product level, so looking for some help to understand data model in snowflake. Thanks!


14 replies
Last reply 1 day agoView thread


dpotvin
:spiral_calendar_pad:  8:41 AM


dpotvin
Hi all, we are rotating the Barclays UK key right now
Posted in banking-connections | Jul 11th | View message


nirmit
:spiral_calendar_pad:  9:30 AM
hey team 
@oncall
 - Looking at the RQM page for this payment, a refund ledger entry is created even though the refund reservation failed. Any idea what's going on here? Here’s an example with the same error type but correctly not making a refund ledger entry
:eyes:
1


1 reply
3 days agoView thread


alisonc
  12:31 PM
Hi team, in Datadog, I see that deposits sends about 4k QPS to ledger but only around 2k QPS are 200s. Is this due to rate limiting, and if so, where does this configuration exist? The rate limiting config in console for ledger appears to be unrelated.


2 replies
Last reply 3 days agoView thread


skaltenbach
:spiral_calendar_pad:  12:36 PM
replied to a thread:
Ledger ROLL:…
updated Ledger ROLL: https://block.atlassian.net/browse/ROLL-114119
cc: 
@brentw
 - this one includes some changes from you as well
:+1::+1::skin-tone-2:
6

View newer replies


skaltenbach
:spiral_calendar_pad:  1:06 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
View newer replies


skaltenbach
:spiral_calendar_pad:  1:52 PM
replied to a thread:
Ledger ROLL:…
rolling back!
:cry:
1

View newer replies


skaltenbach
:spiral_calendar_pad:  2:42 PM
deploying a7c94c99006c8952577b0b07acda49fde9b14b9a (latest) to staging


manij
:spiral_calendar_pad:  4:30 PM
hello there, is there a way to extend a hold on a user applied via regulator "create user hold" ? for more context, credit risk ops team applied a hold on a seller(convene) but the duration is defaulted to 90 days which is not sufficient for this use case. without an option to extend to a custom time, ops team is waiting for the existing hold to expire and then apply a new hold for the next 90 days using reminders which is tedious and error prone. just wanted to check if there is any override that can be done in the backend to extend the hold. thanks  :pray:



5 replies
Last reply 2 days agoView thread


skaltenbach
:spiral_calendar_pad:  5:40 PM
deploying e680bce3d481691a66c372a6428882467f5d971f to staging

1 reply
3 days agoView thread

root
APP  8:17 PM
ODS host fpd1517.sjc3b.square (pd-odsgroup375) is down
No action is needed from you. ODS oncall will try to successover metaclusters if they are active on this host.
Please see the #situation channel for more information.
apps affected: ledger
metaclusters affected for these apps:
- pd-mysql-ledger-002
Cc: 
@oncall
:ack-red:
1




4 replies
Last reply 3 days agoView thread

root
APP  9:02 PM
ODS host fpd1517.sjc3b.square (pd-odsgroup375) is down
No action is needed from you. ODS oncall will try to successover metaclusters if they are active on this host.
Please see the #situation channel for more information.
apps affected: ledger
metaclusters affected for these apps:
- pd-mysql-ledger-002
Cc: 
@oncall

1 reply
3 days agoView thread

root
APP  6:43 AM
ODS host fpd1553.iad3b.square (pd-odsgroup382) is down
No action is needed from you. ODS oncall will try to successover metaclusters if they are active on this host.
Please see the #situation channel for more information.
apps affected: ledger
metaclusters affected for these apps:
- pd-mysql-ledger-009
Cc: 
@oncall

1 reply
2 days agoView thread


dpotvin
:spiral_calendar_pad:  7:46 AM


dpotvin
We are rotating the Barclays SEPA key now
Posted in banking-connections | Jul 12th | View message


skaltenbach
:spiral_calendar_pad:  12:21 PM
replied to a thread:
Ledger ROLL:…
Ledger ROLL with the BankSettlementEntryTransformer fix:
https://block.atlassian.net/browse/ROLL-114171
(ledger @ e680bce3d481691a66c372a6428882467f5d971f) to production)
:+1:
3

View newer replies


skaltenbach
:spiral_calendar_pad:  12:56 PM
replied to a thread:
Ledger ROLL:…
staging checks pass
:canary: canary start
:llama-eagerly-awaiting-death:
2

View newer replies


skaltenbach
:spiral_calendar_pad:  1:34 PM
replied to a thread:
Ledger ROLL:…
canary deploy checks pass
:rolling_kirby: rolling forward
:yay-cat:
1

View newer replies


skaltenbach
:spiral_calendar_pad:  2:33 PM
replied to a thread:
Ledger ROLL:…
:shipitparrot: we’re out on prod
deploy checks pass
:tada:
1



skaltenbach
:spiral_calendar_pad:  2:41 PM
deploying fc56d58a64c27423572d568c3dd2a82fa0eaaca6 (latest) to staging


heggert
:speech_balloon:  4:16 PM
Hey team, i have another one for you : 4QKYN46JG4V4G , seller has multiple adjustments with no explanations , looks like he had 2 disputes on 6/15 (271.88 and 200.00), we took 116.96 on 6/20 for an adjustment when seller took a payment , then a transfer of 271.88 which im guessing is for the dipsute ,  on 6/22 seller transfers 60.00 bucks into this account, we then have adjuments for giving back the 116.96 then removing 176.96, taking the 60.00 , on 6/26 we have back the 176.96 then the seller transfer the funds out, on 7/3 we gave 400.00 , took 200.00 , then took 197.30 , on 7/10 we give back the 197.30 , take 400.00 leaving the account negative 202.70 , seller then takes 2 payments 193.90 and 237.29 with 146.80 going to savings, i ask for your help cause im trying to understand where the seller stands, he started out owing 471.88 , but looks like we were trying to take more funds and he took the funds out  , an extra  176.96 leaving him owing a total of 648.84 due to dipsutes and us paying him to much, so far iu calculate that we got 271.88 and 202.70 from him already leaving 174.26 im guessing will be an adjustmnet later down the road once it gets caught, my question is , do we know why we kept putting funds in and taking funds out, and why we dont just leave the account negative whats owed. DIdnt know if you could help me here with this, ty.
:eyes:
1



14 replies
Last reply 18 hours agoView thread

PayswingBot
APP  7:06 AM
Pay swing has been initiated by malbert with message: neteng request https://square.slack.com/archives/CV3T92JV6/p1689003092063559.
Evacuating payments traffic from EAST datacenters (swinging WEST) in production
:large_orange_circle: (Degraded) EAST: NOT serving new payments
:large_green_circle: (Available) WEST: Serving new payments


meganz
  10:25 AM
Hi team, can someone point me to the Snowflake table that contains the Transfers balance that shows up in the Regulator for Square Account? The #regulator-help channel point me to here, as they mentioned the information appears to be coming from a request that is ultimately routed to the Ledger service. Thank you! :pray:
Binary
 

Screenshot 2023-07-12 at 2.50.39 PM.png
Binary

PayswingBot
APP  10:42 AM
Pay swing has been initiated by malbert with message: unswinging payments per https://square.slack.com/archives/CV3T92JV6/p1689003092063559.
Restoring normal payments traffic (unswinging) in production
:large_green_circle: (Available) EAST: Serving new payments
:large_green_circle: (Available) WEST: Serving new payments


ssuppal
:spiral_calendar_pad:  1:47 PM
Hello :wave:, owners of: ledger
We’re reaching out to you because one or more of your APIs uses version validation via Envoy or API Velocity. Due to a reorg shifting priorities on the team, the Envoy Version Validation filter has been defunded.
If you have already migrated your app to the Envoy Version Validation filter then we will rollback your API to use the version validation code in API Velocity and resolve any diffs in the version data. There will be no impact to your customers. We will post updates to this channel.
If you are currently using version validation in API Velocity then please do not migrate to the Envoy Version Validation filter! Do nothing.
Apologies for any inconvenience this has caused your team. We hope to make this a seamless and pain-free rollback. Please respond to this thread with any questions.
Thanks,
3P Enablement (formerly API Frameworks)


rohitdinakar
:spiral_calendar_pad:  2:40 PM
@oncall
 Hi from Risk Infra, due to a downstream beacon redis issue, you might see an increase in stale risk payments (currently, about 500 payments are 15 minute stale). our backstop framework is kicking in (for the past 30 minutes or so) and keeping the staleness down within SLA as much as possible


zhonglin
Hi 
@oncall
, can I get some help checking the redis cluster of beacon? Our updateRedis consumption is stopping again: https://square.datadoghq.com/dashboard/jrv-kzw-zsy/squaremlfsveneur---beacon-update-red[…]-green&from_ts=1689278189101&to_ts=1689281789101&live=true
Thread in ods | Yesterday at 2:00 PM | View message
:eyes:
1
:thank:
1






+1
14 replies
Last reply 17 hours agoView thread


skaltenbach
:spiral_calendar_pad:  2:43 PM
deploying dce24d8bd1f2f647c3c60d7c7a1b510268628e9f (latest) to staging


emilee
  3:14 PM
Hi, I’m working on reporting taxes for Australian Square sellers and have a question on this payment. Will put details in a thread (cc: 
@kbrunnerdunn
)


2 replies
Last reply 19 hours agoView thread
Only visible to you

Slackbot
  10:20 AM
:wave: Welcome to #ledger! People in this channel tend to join #banking-services, #alert-12575_change_requests_for_uk_settlement_bank_accounts_are_not, and #bank-accounts-api, too.


